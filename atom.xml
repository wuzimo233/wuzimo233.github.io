<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>zimo</title>
  
  <subtitle>zimoの博客</subtitle>
  <link href="https://wuzimo233.github.io/atom.xml" rel="self"/>
  
  <link href="https://wuzimo233.github.io/"/>
  <updated>2022-09-25T03:21:51.634Z</updated>
  <id>https://wuzimo233.github.io/</id>
  
  <author>
    <name>Zimo</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>git基本操作</title>
    <link href="https://wuzimo233.github.io/posts/18.html"/>
    <id>https://wuzimo233.github.io/posts/18.html</id>
    <published>2022-09-25T03:21:15.000Z</published>
    <updated>2022-09-25T03:21:51.634Z</updated>
    
    <content type="html"><![CDATA[<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h1 id="git基本操作"><a href="#git基本操作" class="headerlink" title="git基本操作"></a>git基本操作</h1><p><strong>学习来源</strong>：<a href="https://doc.houdunren.com/git/1%20%E6%8E%8C%E6%8F%A1GIT.html#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE">https://doc.houdunren.com/git/1%20%E6%8E%8C%E6%8F%A1GIT.html#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE</a></p><h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><p>官网：<a href="https://git-scm.com/">https://git-scm.com/</a> 、<a href="https://gitforwindows.org/">https://gitforwindows.org/</a></p><p>安装过程略过，百度一堆</p><p>安装后通过以下命令查看，如果显示版本号那就是安装成功了</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">git --version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="配置作者信息"><a href="#配置作者信息" class="headerlink" title="配置作者信息"></a>配置作者信息</h2><p>桌面单击右键选择 Git Bash Here，</p><h3 id="cd回车到根目录"><a href="#cd回车到根目录" class="headerlink" title="cd回车到根目录"></a><strong>cd回车到根目录</strong></h3><pre class="line-numbers language-none"><code class="language-none">cd  //回到根目录<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="新建-git文件夹"><a href="#新建-git文件夹" class="headerlink" title="新建 git文件夹"></a><strong>新建 git文件夹</strong></h3><pre class="line-numbers language-js" data-language="js"><code class="language-js">mkdir git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>使用cd 切换到git目录</strong></p><pre class="line-numbers language-none"><code class="language-none">cd git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="配置自己的信息"><a href="#配置自己的信息" class="headerlink" title="配置自己的信息"></a><strong>配置自己的信息</strong></h3><p>邮箱和名称</p><pre class="line-numbers language-none"><code class="language-none">git config --global user.email "12345678@qq.com"git config --global user.name "zimo"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>接着回到根目录（Ctrl+L键是清理屏幕）</p><pre class="line-numbers language-none"><code class="language-none">cd <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="查看配置成功与否"><a href="#查看配置成功与否" class="headerlink" title="查看配置成功与否"></a><strong>查看配置成功与否</strong></h3><p>（前提是已经安装Sublime Text软件，且配置了系统变量）</p><pre class="line-numbers language-none"><code class="language-none">subl .gitconfig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>回到git目录，新建一个edu文件夹，并且进入</p><pre class="line-numbers language-none"><code class="language-none">mkdir educd edu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="查看当前路径"><a href="#查看当前路径" class="headerlink" title="查看当前路径"></a>查看当前路径</h3><pre class="line-numbers language-none"><code class="language-none">pwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="查看目录下文件"><a href="#查看目录下文件" class="headerlink" title="查看目录下文件"></a>查看目录下文件</h3><p><strong>ls</strong><br>仅罗列出当前目录下的文件名或目录名</p><pre class="line-numbers language-none"><code class="language-none">ls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>ls -a</strong><br>列出目录下的所有文件，包括以 . 开头的隐含文件。</p><pre class="line-numbers language-none"><code class="language-none">ls -a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>ls -l （等价于ll）</strong><br>列出文件的详细信息。</p><p><strong>ls -al (等价于ll -a)</strong><br>显示当前目录下的所有文件及文件夹包括隐藏的.和…等的详细信息</p><h3 id="回退指令"><a href="#回退指令" class="headerlink" title="回退指令"></a>回退指令</h3><p><strong>返回上一层目录</strong></p><pre class="line-numbers language-none"><code class="language-none">cd ..<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> cd -返回到上一次的工作目录。</p><h2 id="基础流程"><a href="#基础流程" class="headerlink" title="基础流程"></a>基础流程</h2><h3 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a><strong>创建仓库</strong></h3><pre class="line-numbers language-none"><code class="language-none">git init  //在任意目录下创建仓库<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="克隆仓库"><a href="#克隆仓库" class="headerlink" title="克隆仓库"></a><strong>克隆仓库</strong></h3><p>在git目录下</p><pre class="line-numbers language-none"><code class="language-none">git clone xxxxxxxx.xxx （github地址）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="git流水线分析"><a href="#git流水线分析" class="headerlink" title="git流水线分析"></a>git流水线分析</h3><p>git就是一个仓库，例如现实中一个服装厂仓库，我们把做好的服装放到仓库里。</p><pre class="line-numbers language-none"><code class="language-none">现实中：【做好的服装】=====&gt; 【工人用手放到推车】 ====&gt; 【 用推车放到 】  ====&gt;【服装仓库】程序员：【写好的代码】 =====&gt; 【   git add    】 ====&gt; 【 git commit】  ====&gt;【git仓库】有时候需要改动服装（文件），那么就需要查看生产车间的状态是怎么样的 ===&gt; 使用git status 查看状态ps：小推车在git中也叫做暂存区<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="练习git流水线"><a href="#练习git流水线" class="headerlink" title="练习git流水线"></a><strong>练习git流水线</strong></h3><p><strong>git目录下新建一个文件夹hd</strong></p><pre class="line-numbers language-none"><code class="language-none">mkdir hd // 创建hd文件夹cd hd // 切换目录到cdgit init   // 初始化空的仓库<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>使用touch命令新建空白文件</strong></p><pre class="line-numbers language-none"><code class="language-none">touch a.php        // 新建空白文件git status    // 查看状态，发现 a.php文件是未跟踪状态，即没有被版本库提交过git add    // 放到小推车里git commit -m 'xxx'  // 推送到本地仓库并且添加描述此时 git status没有异常， 生产车间状态和仓库的文件是一摸一样的，不需要再把车间文件放到仓库<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="多个文件一并提交"><a href="#多个文件一并提交" class="headerlink" title="多个文件一并提交"></a>多个文件一并提交</h3><pre class="line-numbers language-none"><code class="language-none">git add . // 会将未跟踪的所有文件提交到暂存区（推车里）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="gitignore详解控制版本库文件管理"><a href="#gitignore详解控制版本库文件管理" class="headerlink" title=".gitignore详解控制版本库文件管理"></a>.gitignore详解控制版本库文件管理</h2><p>git下新建目录 shop</p><pre class="line-numbers language-none"><code class="language-none">mkdir shopcd shopsubl .gitignore // 使用subl 新建.gitignore文件并打开，这里面能够配置哪些文件需要提交touch a.txt // 使用touch 新建文件git status// 此时可以看到 .gitignore 和 a.txt文件未提交到暂存区在.gitignore文件中 写入 *.txt // 此时看不到 a.txt文件未提交到暂存区mkdir vendor git status// 发现未跟踪列表没有vendor文件夹（因为不会跟踪空白文件）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>.gitignore 文件如下</strong></p><pre class="line-numbers language-none"><code class="language-none"># 该文件是存放不提交到仓库的文件# 所有txt文件都检测不到 除了a.txt*.txt!a.txt# 提交时检测不到vendor文件夹及子文件夹所有的php文件/vendor/**/*.php# 提交时检测不到该文件夹下所有内容# /vendor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="从版本库中删除资源的技巧"><a href="#从版本库中删除资源的技巧" class="headerlink" title="从版本库中删除资源的技巧"></a>从版本库中删除资源的技巧</h2><p>git下新建目录 bbs</p><pre class="line-numbers language-none"><code class="language-none">mkdir bbscd bbsgit inittouch a.txtgit statusgit add .git commit -m '版本1'git rm a.txt // 会同时删除版本库和本地的文件touch readme.txtgit add .git commit -m '版本2'有时候有很多文件放到版本库，其实没有必要，也就是本地需要保留，版本库不需要放入git rm --cached readme.txt    // 移除的是版本库的文件，本地该文件依然保留着<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="从版本库中修改资料名称"><a href="#从版本库中修改资料名称" class="headerlink" title="从版本库中修改资料名称"></a>从版本库中修改资料名称</h2><pre class="line-numbers language-none"><code class="language-none">touch c.phpgit add .git commit -m '版本1'git mv c.php zimo.php  // 改名git statusgit commit -m 'c.php 改名为 zimo.php'git statusgit log --name-only<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用log日志查看历史操作行为"><a href="#使用log日志查看历史操作行为" class="headerlink" title="使用log日志查看历史操作行为"></a>使用log日志查看历史操作行为</h2><p>git下新建目录 hd</p><pre class="line-numbers language-none"><code class="language-none">mkdir hdcd hdgit inittouch a.php git add .git commit -m '提交a.php版本1'touch b.phpvim a.php// 打开vim编辑器 按i 输入文字输入zimo.com 文字cat a.php // 查看编辑的内容git add .git commit -m '将新增b文件和更新后a文件提交'git log// 查看日志 （包含每次提交的唯一哈希值、作者、时间、描述等）git log -p // 查看详细日志（包含更新的内容）git log -p -1   // 查看最近的一次提交git log --oneline// 查看简短日志 (git log --oneline -p等同于git log -p)git log --name-only // 查看文件发生的变化git log --name-status //查看文件具体发生了什么类型（新增，删除等）变化<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用amend修改最新一次提交事件"><a href="#使用amend修改最新一次提交事件" class="headerlink" title="使用amend修改最新一次提交事件"></a>使用amend修改最新一次提交事件</h2><p>git下新建目录 zz</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">mkdir zzcd zzgit initgit logtouch a<span class="token punctuation">.</span>phpgit add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'第一次提交a.php'</span>git log <span class="token comment">// 发现描述不具体</span>git commit <span class="token operator">--</span>amend<span class="token comment">// 打开vim编辑器，修改刚才的描述 zimo的第一次提交a.php</span>git logtouch b<span class="token punctuation">.</span>php <span class="token comment">// 有时候想将另一个文件也放到这次提交里面</span>git add <span class="token punctuation">.</span>git statusgit commit <span class="token operator">--</span>amend<span class="token comment">// 添加一行描述 增加b.php a.php</span>git status git log <span class="token operator">--</span>name<span class="token operator">-</span>only <span class="token comment">// 看到新提交了两个文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="管理暂存区中的文件"><a href="#管理暂存区中的文件" class="headerlink" title="管理暂存区中的文件"></a>管理暂存区中的文件</h2><p>git下新建目录 xj</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">mkdir xjcd xjgit initls <span class="token operator">-</span>atouch a<span class="token punctuation">.</span>php<span class="token comment">// 文件放入暂存区</span>git add <span class="token punctuation">.</span>git rm <span class="token operator">--</span>cached a<span class="token punctuation">.</span>php<span class="token comment">// 撤销文件放入暂存区</span>vim a<span class="token punctuation">.</span>php <span class="token comment">// 编辑一下a.php文件</span>git statusgit add a<span class="token punctuation">.</span>phpgit status <span class="token comment">// 此时发现文件已经在暂存区了，此时如果后悔和之前第一次不一样</span>git reset Head a<span class="token punctuation">.</span>php<span class="token comment">// 这样可以取消放入</span>cat a<span class="token punctuation">.</span>php<span class="token comment">// 查看文件内容 里边的内容还是之前编辑那样</span>git checkout a<span class="token punctuation">.</span>php <span class="token comment">// 恢复到仓库提交的初始状态</span>cat a<span class="token punctuation">.</span>php<span class="token comment">// 此时文件内没有内容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="alias命令别名提高操作效率"><a href="#alias命令别名提高操作效率" class="headerlink" title="alias命令别名提高操作效率"></a>alias命令别名提高操作效率</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js">之前敲提交需要：git add <span class="token punctuation">.</span> git commit<span class="token operator">-</span>m <span class="token string">''</span> 每次都比较麻烦git config <span class="token operator">--</span>global alias<span class="token punctuation">.</span>a add  <span class="token comment">// 以后git a . 等价于 ait add .</span>subl <span class="token punctuation">.</span>gitconfig<span class="token comment">// 在根目录执行 查看全局配置文件 可以看到[alias]下有 a = add ，此时可以直接在这里编辑想改的代码</span><span class="token comment">// 比如我改成如下</span><span class="token punctuation">[</span>alias<span class="token punctuation">]</span>a <span class="token operator">=</span> add <span class="token punctuation">.</span> c <span class="token operator">=</span> commitl <span class="token operator">=</span> logs <span class="token operator">=</span> status<span class="token comment">// 回到xj仓库目录</span>touch z<span class="token punctuation">.</span>phpgit sgit agit sgit c<span class="token comment">// 会打开vim 第一行写上描述保存退出即可</span>git l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Git分支"><a href="#Git分支" class="headerlink" title="Git分支"></a>Git分支</h2><h3 id="详解Git分支Branch存在的意义"><a href="#详解Git分支Branch存在的意义" class="headerlink" title="详解Git分支Branch存在的意义"></a>详解Git分支Branch存在的意义</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span> <span class="token punctuation">]</span>是提交的版本  其他功能分支a <span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span> <span class="token punctuation">]</span> <span class="token operator">/</span> \<span class="token operator">/</span>  \<span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token operator">--</span><span class="token operator">-</span> master主分支<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">&gt;</span>\   <span class="token operator">/</span>     \  <span class="token operator">/</span> 其他功能分支b <span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span> <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="实例讲解分支branch基本管理操作"><a href="#实例讲解分支branch基本管理操作" class="headerlink" title="实例讲解分支branch基本管理操作"></a>实例讲解分支branch基本管理操作</h3><p>git下新建目录 fz</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">mkdir fzcd fzgit initgit branch <span class="token comment">// 此时查看分支是查看不到任何分支</span>touch xj<span class="token punctuation">.</span>phpgit add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'提交xj.php'</span>git branch<span class="token comment">// 此时会看到一个主分支 * master，*星号代表当前所在的分支</span>git branch ask  <span class="token comment">// 创建一个ask分支</span>git branch<span class="token comment">// 此时可以看到主分支 *master和branch 分支</span>git checkout ask <span class="token comment">//切换分支到ask</span>touch ask<span class="token punctuation">.</span>htmlgit add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'提交ask.html'</span>ls<span class="token comment">// 可以看到俩文件 ask.html 和 xj.php</span>git checkout master ls <span class="token comment">// 此时切换分支回master后仅看到 xi.php</span>git checkout <span class="token operator">-</span>b bbs  <span class="token comment">// 创建并且切换到bbs分支</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="分支的合并与删除"><a href="#分支的合并与删除" class="headerlink" title="分支的合并与删除"></a>分支的合并与删除</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js">git checkout master     <span class="token comment">// 假如当前产品问答功能已经做好，需要切换到主分支</span>git merge ask  <span class="token comment">// 将ask分支的所有提交合并到主分支上</span>git branch <span class="token operator">-</span>d ask<span class="token comment">// 删除分支</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="分支冲突实例解决"><a href="#分支冲突实例解决" class="headerlink" title="分支冲突实例解决"></a>分支冲突实例解决</h3><p><strong>一个资源被不同的分支所共同修改了，在合并的时候会产生冲突</strong></p><p>git下新建目录 ct</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">mkdir ctcd ctgit initvim xj<span class="token punctuation">.</span>php     <span class="token comment">// 使用vim任意新建一个文件，内容冒号 :</span>git commit <span class="token operator">-</span>m <span class="token string">'master提交xj.php'</span>  git branch ask <span class="token comment">// 创建ask分支</span>git checkout <span class="token operator">-</span>b bbs  <span class="token comment">// 创建并切换到bbs分支</span>ls <span class="token comment">// 能够看到包含了之前master提交的xj.php文件（因为是从主分支的提交点后创建的ask和bbs分支，因此也拥有主分支提交的文件）</span>vim xj<span class="token punctuation">.</span>php   <span class="token comment">// 此时内容是 : 将其改为bbs</span>git add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'bbs提交xj.php'</span>git checkout askvim xj<span class="token punctuation">.</span>php<span class="token comment">// 此时内容是 : 将其改为ask</span>git add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'ask提交的xj.php'</span>git checkout master <span class="token comment">// 切换回主分支</span>git merge bbs<span class="token comment">// 合并bbs分支</span>cat xj<span class="token punctuation">.</span>php    <span class="token comment">// 可以看到内容是 bbs</span>git merge ask <span class="token comment">// 此时合并ask分支将会报错 Merge conflict in xj.php</span>subl xj<span class="token punctuation">.</span>php   <span class="token comment">// 打开xj.php,可以看到结构如下</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> <span class="token constant">HEAD</span>bbs<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>ask<span class="token operator">&gt;&gt;&gt;</span><span class="token operator">&gt;&gt;&gt;</span><span class="token operator">&gt;</span> ask<span class="token comment">// 直接将内容改为这样保存</span>bbsaskgit add <span class="token punctuation">.</span>  <span class="token comment">// 此时再提交即可</span>git commit <span class="token operator">-</span>m <span class="token string">'修复合并提交xj.php'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="分支管理merged及分支强制删除"><a href="#分支管理merged及分支强制删除" class="headerlink" title="分支管理merged及分支强制删除"></a>分支管理merged及分支强制删除</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">git branch <span class="token operator">--</span>merged <span class="token comment">// 查看已经合并的分支</span>git checkout <span class="token operator">-</span>b test<span class="token comment">// 新建并切换到分支test </span>git checkout master <span class="token comment">// 切换到主分支</span>git branch <span class="token operator">--</span>merged <span class="token comment">// 可以看到ask、bbs已经和master分支合并</span>git checkout testtouch mm<span class="token punctuation">.</span>phpgit agit commit <span class="token operator">-</span>m <span class="token string">'test提交mm.php'</span>git checkout mastergit branch <span class="token operator">--</span>no<span class="token operator">-</span>merged<span class="token comment">// 查看没有合并的分支</span>git branch <span class="token operator">-</span>d test<span class="token comment">// 删除分支 test 会有提示</span>git branch <span class="token operator">-</span><span class="token class-name">D</span> test    <span class="token comment">// 直接删除分支</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="标准的分支操作工作流"><a href="#标准的分支操作工作流" class="headerlink" title="标准的分支操作工作流"></a>标准的分支操作工作流</h3><pre class="line-numbers language-none"><code class="language-none">master 被称为：稳定分支一般从master分出develop分支然后从develop分出ask分支此时我和张三是ask分支新增模块的开发者，就将这个分支拉到本地假如我负责登录页面，然后我可以在本地创建ui或者其他分支，等写好功能后合并到ask假如张三负责后台页面，他可能会本地创建ht或者其他分支，等写好功能后合并到ask然后将ask分支合并到develop分支<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="stash临时存储区实例讲解"><a href="#stash临时存储区实例讲解" class="headerlink" title="stash临时存储区实例讲解"></a>stash临时存储区实例讲解</h2><p>主要解决：临时需要切换分支，但是当前分支不想提交，我们可以将其暂时存储起来</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">mkdir nscd nsgit inittouch master<span class="token punctuation">.</span>phpgit add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'提交master.php'</span>git branch askgit branch bbsgit checkout askgit branch可以看到当前有三个分支<span class="token operator">*</span> ask   bbs  mastertouch ask<span class="token punctuation">.</span>phpgit add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'ask提交ask.php'</span>vim ask<span class="token punctuation">.</span>php <span class="token comment">// 内容里添加ask.php 保存退出,注意该文件已经commit一次了</span>git add <span class="token punctuation">.</span>git status   <span class="token comment">// 可以看到添加暂存区成功</span>On branch askChanges to be committed<span class="token operator">:</span>  <span class="token punctuation">(</span>use <span class="token string">"git restore --staged &lt;file&gt;..."</span> to unstage<span class="token punctuation">)</span>        modified<span class="token operator">:</span>   asd<span class="token punctuation">.</span>php<span class="token comment">// 此时想切换到bbs分支将会提示</span>git checkout bbs<span class="token comment">// error: Your local changes to the following files would be overwritten by checkout:</span>        asd<span class="token punctuation">.</span>php<span class="token comment">// Please commit your changes or stash them before you switch branches.</span>Aborting<span class="token comment">// 会提示如果切换分支会覆盖文件，因此不允许切换其他分支</span><span class="token comment">// 因此可以把当前文件放到临时存储区</span>git stashgit stash list   <span class="token comment">// 可以查看临时存储区的列表</span>git checkout bbs <span class="token comment">// 然后可以切换分支</span>git checkout ask<span class="token comment">// bbs分支忙完后切换回ask</span>git stash apply <span class="token comment">// 恢复临时存储区的文件</span>git stash list   <span class="token comment">// 当然临时存储区里文件依然存在的</span>git stash drop stash@<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>  <span class="token comment">// 不想要的话可以删除</span>git stash list<span class="token comment">// 此时临时存储区为空</span>git stash<span class="token comment">// 再来放到临时存储区暂存一下</span><span class="token comment">// 如果想把临时存储区直接删除为空可以使用：</span>git stash pop<span class="token comment">// 将文件库提交一次</span>git add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'提交asd,master'</span>touch xj<span class="token punctuation">.</span>php      <span class="token comment">// 因为还没有放进暂存区，此时执行临时存储区是不会操作的</span>git stash<span class="token comment">//No local changes to save</span>git add <span class="token punctuation">.</span>git stash<span class="token comment">// 需要文件放入暂存区后再执行</span>touch ns<span class="token punctuation">.</span>php<span class="token comment">// 再新增一个</span>git add <span class="token punctuation">.</span>git stashgit stash apply stash@<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment">// 可以恢复第一个文件</span>git stash apply stash@<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment">// 可以恢复第二个文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用TAG标签声明项目阶段版本"><a href="#使用TAG标签声明项目阶段版本" class="headerlink" title="使用TAG标签声明项目阶段版本"></a>使用TAG标签声明项目阶段版本</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js">git tag  <span class="token comment">// 显示当前TAG列表</span>git tag v1<span class="token punctuation">.</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="生成zip代码发布压缩包"><a href="#生成zip代码发布压缩包" class="headerlink" title="生成zip代码发布压缩包"></a>生成zip代码发布压缩包</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js">mkdir <span class="token constant">TAG</span>cd <span class="token constant">TAG</span>git inittouch tag<span class="token punctuation">.</span>txtgit add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'test'</span><span class="token comment">// 'tagcms/'表示压缩之后的文件叫'tagcms'</span>git archive master <span class="token operator">--</span>prefix<span class="token operator">=</span><span class="token string">'tagcms/'</span> <span class="token operator">--</span>forma<span class="token operator">=</span>zip <span class="token operator">&gt;</span> tagcms<span class="token punctuation">.</span>zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用系统别名定义git全局指令"><a href="#使用系统别名定义git全局指令" class="headerlink" title="使用系统别名定义git全局指令"></a>使用系统别名定义git全局指令</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js">cd  <span class="token comment">// 回到根目录</span>ls <span class="token operator">-</span>a   <span class="token comment">// 找到.bash_profile ，我没找到新建了一个</span><span class="token comment">// 使用subl打开该文件</span>subl <span class="token punctuation">.</span>bash_profile<span class="token comment">// 输入以下内容</span>alias gs<span class="token operator">=</span><span class="token string">"git status"</span>alias gc<span class="token operator">=</span><span class="token string">"git commit -m "</span>alias gl<span class="token operator">=</span><span class="token string">"git log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit"</span>alias gb<span class="token operator">=</span><span class="token string">"git branch"</span>alias ga<span class="token operator">=</span><span class="token string">"git add ."</span>alias go<span class="token operator">=</span><span class="token string">"git checkout"</span><span class="token comment">// 关闭当前git窗口，重新打开一个git窗口就可以使用刚才配置的命令</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="合并分支产生的实际问题演示"><a href="#合并分支产生的实际问题演示" class="headerlink" title="合并分支产生的实际问题演示"></a>合并分支产生的实际问题演示</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js">mkdir yscd ysgit inittouch master<span class="token punctuation">.</span>phpgagc <span class="token string">'master提交master.php'</span>go <span class="token operator">-</span>b askgb<span class="token comment">// 此时已经在ask分支上</span>touch ask<span class="token punctuation">.</span>phpgagc <span class="token string">'ask提交ask.php'</span>gl  <span class="token comment">// 查看到文件的提交信息</span>go master<span class="token comment">// 切换分支</span>git merge ask  <span class="token comment">// 合并ask，可以看到Fast-forward快速合并关键词</span>gl   <span class="token comment">// 查看日志 </span> <span class="token operator">*</span> a9c1c63 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token constant">HEAD</span> <span class="token operator">-</span><span class="token operator">&gt;</span> master<span class="token punctuation">,</span> ask<span class="token punctuation">)</span> ask提交ask<span class="token punctuation">.</span><span class="token function">php</span> <span class="token punctuation">(</span><span class="token number">5</span> minutes ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span> <span class="token operator">*</span> <span class="token number">1</span>ac517b <span class="token operator">-</span> master提交master<span class="token punctuation">.</span><span class="token function">php</span> <span class="token punctuation">(</span><span class="token number">17</span> minutes ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token comment">//当前分支如下</span>                 ask分支<span class="token operator">-</span><span class="token punctuation">[</span>提交ask<span class="token punctuation">.</span>php<span class="token punctuation">]</span>         <span class="token operator">/</span>       \      <span class="token operator">/</span>        \<span class="token operator">--</span>master主分支<span class="token operator">--</span><span class="token punctuation">[</span>提交master<span class="token punctuation">.</span>php<span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span>合并<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token comment">// 另一种情况</span>cd <span class="token punctuation">.</span><span class="token punctuation">.</span>mkdir ys2cd ys2git inittouch master<span class="token punctuation">.</span>phpgagc <span class="token string">'master commit'</span>gl    <span class="token comment">// 查看日志 看到是初次提交</span><span class="token operator">*</span> <span class="token number">12e27</span>d9 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token constant">HEAD</span> <span class="token operator">-</span><span class="token operator">&gt;</span> master<span class="token punctuation">)</span> master <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">5</span> seconds ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span>go <span class="token operator">-</span>b asktouch ask<span class="token punctuation">.</span>phpgagc <span class="token string">'ask commit'</span>go master <span class="token comment">// 切换到master</span>touch m2<span class="token punctuation">.</span>phpgagc <span class="token string">'m2 commit'</span>git merge ask    <span class="token comment">// 合并描述任意打字</span>gl   <span class="token comment">// 查看日志 如下：</span><span class="token operator">*</span>   <span class="token number">42</span>cf081 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token constant">HEAD</span> <span class="token operator">-</span><span class="token operator">&gt;</span> master<span class="token punctuation">)</span> zimo Merge branch <span class="token string">'ask'</span> <span class="token punctuation">(</span><span class="token number">2</span> minutes ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token operator">|</span>\<span class="token operator">|</span> <span class="token operator">*</span> b9dff47 <span class="token operator">-</span> <span class="token punctuation">(</span>ask<span class="token punctuation">)</span> ask <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">20</span> hours ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token operator">|</span> <span class="token number">7</span>f0e6fe <span class="token operator">-</span> m2 <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">20</span> hours ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">/</span><span class="token operator">*</span> <span class="token number">12e27</span>d9 <span class="token operator">-</span> master <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">20</span> hours ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token comment">//当前分支如下</span><span class="token operator">--</span>master主分支<span class="token operator">--</span><span class="token punctuation">[</span>提交master<span class="token punctuation">.</span>php<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">[</span>提交m2<span class="token punctuation">.</span>php<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">[</span>合并<span class="token punctuation">]</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&gt;</span>   \   <span class="token operator">/</span>   \ <span class="token operator">/</span>   ask分支<span class="token operator">-</span><span class="token punctuation">[</span>提交ask<span class="token punctuation">.</span>php<span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="rebase合理的优化分支合并"><a href="#rebase合理的优化分支合并" class="headerlink" title="rebase合理的优化分支合并"></a>rebase合理的优化分支合并</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 以上可知，主分支提交一个文件后，并分出去一个分支后，如果没有新的提交没有commit记录，在合并分支时候就不会有合并的记录</span><span class="token comment">// rebase就是先将子分支提交记录存起来看不见，然后将子分支的提交点移动到主分支最新的提交点，然后将子分支的动作恢复与主分支进行合并</span><span class="token comment">// 如果在其他开源项目提交一些操作的时候先走一下rebase</span>cd <span class="token punctuation">.</span><span class="token punctuation">.</span>mkdir recd regit init<span class="token comment">// 主分支提交一次</span>touch master<span class="token punctuation">.</span>phpgagc <span class="token string">'master commit'</span>gl<span class="token operator">*</span> <span class="token number">691006</span>b <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token constant">HEAD</span> <span class="token operator">-</span><span class="token operator">&gt;</span> master<span class="token punctuation">)</span> master <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">3</span> seconds ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token comment">// 然后切换到子分支 ask，创建文件提交一次</span>go <span class="token operator">-</span>b <span class="token string">'ask'</span>touch ask<span class="token punctuation">.</span>phpgagc <span class="token string">'ask commit'</span>gl  <span class="token comment">// 此时子分支能看到俩条记录</span><span class="token operator">*</span> f83df17 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token constant">HEAD</span> <span class="token operator">-</span><span class="token operator">&gt;</span> ask<span class="token punctuation">)</span> ask <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">9</span> seconds ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token number">691006</span>b <span class="token operator">-</span> <span class="token punctuation">(</span>master<span class="token punctuation">)</span> master <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">3</span> minutes ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token comment">// 回到主分支 </span>go mastertouch m2<span class="token punctuation">.</span>phpgagc <span class="token string">'m2 commit'</span><span class="token comment">// 此时因为主分支往前走了一个提交，如果合并分支会产生合并记录</span>go askglgit rebase mastergl<span class="token comment">// 可以看到将子分支的提交（ ask commit）放到主分支最新提交（ m2 commit）的后边了</span><span class="token operator">*</span> <span class="token number">6</span>a89788 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token constant">HEAD</span> <span class="token operator">-</span><span class="token operator">&gt;</span> ask<span class="token punctuation">)</span> ask <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">14</span> seconds ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token number">9</span>d3435c <span class="token operator">-</span> <span class="token punctuation">(</span>master<span class="token punctuation">)</span> m2 <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">3</span> minutes ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token number">691006</span>b <span class="token operator">-</span> master <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">9</span> minutes ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span>go masterglgit merge askgl<span class="token comment">// 日志非常干净</span><span class="token operator">*</span> <span class="token number">6</span>a89788 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token constant">HEAD</span> <span class="token operator">-</span><span class="token operator">&gt;</span> master<span class="token punctuation">,</span> ask<span class="token punctuation">)</span> ask <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">4</span> minutes ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token number">9</span>d3435c <span class="token operator">-</span> m2<span class="token punctuation">.</span><span class="token function">php</span> <span class="token punctuation">(</span><span class="token number">7</span> minutes ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token number">691006</span>b <span class="token operator">-</span> master <span class="token function">commit</span> <span class="token punctuation">(</span><span class="token number">12</span> minutes ago<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">2022</span>zimo<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="国内与国外项目托管平台介绍"><a href="#国内与国外项目托管平台介绍" class="headerlink" title="国内与国外项目托管平台介绍"></a>国内与国外项目托管平台介绍</h2><pre class="line-numbers language-none"><code class="language-none">使用github创建仓库https://github.com/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="C:\Users\zimo\AppData\Roaming\Typora\typora-user-images\image-20220923111228567.png" alt="image-20220923111228567" style="zoom:67%;"><h2 id="SSH与GITHUB远程无密码连接"><a href="#SSH与GITHUB远程无密码连接" class="headerlink" title="SSH与GITHUB远程无密码连接"></a>SSH与GITHUB远程无密码连接</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js">生成秘钥使用 ssh 连接 Github 发送指令更加安全可靠，也可以免掉每次输入密码的困扰。在命令行中输入以下代码（windows 用户使用 Git Bash）<span class="token comment">// ssh-keygen -t rsa</span>一直按回车键直到结束。系统会在<span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>ssh 目录中生成 id_rsa和id_rsa<span class="token punctuation">.</span>pub，即密钥id_rsa和公钥id_rsa<span class="token punctuation">.</span>pub。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打开 id_rsa.pub,复制密钥，点击github头像，再点击设置</p><img src="C:\Users\zimo\AppData\Roaming\Typora\typora-user-images\image-20220923111757069.png" alt="image-20220923111757069" style="zoom:67%;"><p>点击new ssh key</p><img src="C:\Users\zimo\Desktop\屏幕截图 2022-09-23 112030.jpg" alt="屏幕截图 2022-09-23 112030" style="zoom:67%;"><pre class="line-numbers language-none"><code class="language-none">向 GitHub 添加秘钥点击 New SSH key 按钮，添加上面生成的 id_rsa.pub 公钥内容。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后就能使用ssh链接直接拉取代码文件了。</p><img src="C:\Users\zimo\AppData\Roaming\Typora\typora-user-images\image-20220923153139583.png" alt="image-20220923153139583" style="zoom:67%;"><pre class="line-numbers language-js" data-language="js"><code class="language-js">git clone git@github<span class="token punctuation">.</span>com<span class="token operator">:</span>wuzimo666<span class="token operator">/</span>demo<span class="token punctuation">.</span>gitcd demo<span class="token comment">// 拉取到本地后，假如你新提交了文件,这时文件还在本地</span>touch zimo<span class="token punctuation">.</span>zimo<span class="token punctuation">.</span>comgit add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'test'</span><span class="token comment">// 当你想提交给远程，此时需要使用：</span>git push<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="C:\Users\zimo\Desktop\屏幕截图 2022-09-23 153723.png" alt="屏幕截图 2022-09-23 153723" style="zoom:67%;"><img src="C:\Users\zimo\AppData\Roaming\Typora\typora-user-images\image-20220923153941619.png" alt="image-20220923153941619" style="zoom:67%;"><p>此时发现远程仓库中多了刚才提交的文件</p><h2 id="本地版本使用remote与GITHUB关联"><a href="#本地版本使用remote与GITHUB关联" class="headerlink" title="本地版本使用remote与GITHUB关联"></a>本地版本使用remote与GITHUB关联</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// github新建一个仓库zimo</span>mkdir testcd testgit initsubl <span class="token constant">README</span><span class="token punctuation">.</span><span class="token constant">MD</span>  <span class="token comment">// 内容随意</span>git add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'first commit'</span>subl <span class="token constant">README</span><span class="token punctuation">.</span><span class="token constant">MD</span> <span class="token comment">// 打开readme将以下代码写入</span>git remote add origin git@github<span class="token punctuation">.</span>com<span class="token operator">:</span>wuzimo666<span class="token operator">/</span>zimo<span class="token punctuation">.</span>git <span class="token comment">// 添加远程仓库与远程进行关联，可以像服务器推送代码</span>git remote add origin git@github<span class="token punctuation">.</span>com<span class="token operator">:</span>wuzimo666<span class="token operator">/</span>zimo<span class="token punctuation">.</span>git （自己的ssh仓库地址）git remote <span class="token operator">-</span>v <span class="token comment">// 查看远程仓库</span>git push <span class="token operator">-</span>u origin master <span class="token comment">// 推送数据到远程仓库</span><span class="token comment">// 此时刷新github仓库可以看到有README.MD文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="本地分支与github远程分支同步"><a href="#本地分支与github远程分支同步" class="headerlink" title="本地分支与github远程分支同步"></a>本地分支与github远程分支同步</h2><pre class="line-numbers language-none"><code class="language-none">// 接上边，当前能够看到仓库只有一个master分支<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="C:\Users\zimo\AppData\Roaming\Typora\typora-user-images\image-20220924205442846.png" alt="image-20220924205442846" style="zoom: 67%;"><pre class="line-numbers language-js" data-language="js"><code class="language-js">git branch <span class="token operator">-</span>a  <span class="token comment">// 查看远程分支，远程分支会用红色表示出来</span><span class="token comment">// 在本地新建一个分支并切换  ask</span>git checkout <span class="token operator">-</span>b asktouch ask<span class="token punctuation">.</span>htmlgit add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'ask commit'</span> git push <span class="token comment">// 此时会出现错误 （大意是：当前的分支没有与远程的分支进行关联） 可以使用以下代码：</span>git push <span class="token operator">--</span>set<span class="token operator">-</span>upstream origin ask  <span class="token comment">// 此时仓库中能够看到多了一个ask分支</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="新入职员工参与项目开发时分支使用"><a href="#新入职员工参与项目开发时分支使用" class="headerlink" title="新入职员工参与项目开发时分支使用"></a>新入职员工参与项目开发时分支使用</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 场景：公司当前项目有个功能正在开发，新建了一个ask分支，我新来公司，经理也把我归纳到该开发小组里。所以我需要将代码拉到我的电脑里</span><span class="token comment">// 来到根目录 克隆仓库里代码</span>git clone git@github<span class="token punctuation">.</span>com<span class="token operator">:</span>wuzimo666<span class="token operator">/</span>zimo<span class="token punctuation">.</span>gitcd zimogit branch <span class="token comment">// 可以看到当前在且仅有master分支</span>git branch <span class="token operator">-</span>agit pull origin ask<span class="token operator">:</span>ask  <span class="token comment">// 请求远程，把ask分支请求到本地里，因为本地目前是master分支</span>git checkout ask<span class="token comment">// 此时就把需要开发的ask分支拉取到本地了</span><span class="token comment">// 模拟开发工作</span><span class="token comment">// 创建文件</span>touch index<span class="token punctuation">.</span>phptouch hello<span class="token punctuation">.</span>aspgit add <span class="token punctuation">.</span>git commit <span class="token operator">-</span>m <span class="token string">'zimo first commit'</span> git push <span class="token comment">// 此时会出现错误 （大意是：当前的分支没有与远程的分支进行关联） 可以使用以下代码：</span>git push <span class="token operator">--</span>set<span class="token operator">-</span>upstream origin ask  <span class="token comment">// 此时仓库中ask分支能够看到多了俩文件： index.php hello.asp</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="github远程分支的合并"><a href="#github远程分支的合并" class="headerlink" title="github远程分支的合并"></a>github远程分支的合并</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 当前功能开发完成，线上需要把ask分支合并到master，然后删除ask分支</span>git checkout master git pull     <span class="token comment">// 把master更改成最新的状态</span>git checkout askgit rebase master   <span class="token comment">// 将ask分支的起始点移动到master的最新点上 </span>git checkout mastergit merge askgit push <span class="token comment">// 推送到远程</span>git branch <span class="token operator">--</span>merged <span class="token comment">// 查看合并的分支</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="远程分支删除操作"><a href="#远程分支删除操作" class="headerlink" title="远程分支删除操作"></a>远程分支删除操作</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 接上方 直接使用</span>git push origin <span class="token operator">--</span><span class="token keyword">delete</span> askgit branch <span class="token operator">-</span>agit branch <span class="token operator">-</span>d ask <span class="token comment">// 删除本地的ask分支</span>git branch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="自动部署之流程分析与创建WEB站点"><a href="#自动部署之流程分析与创建WEB站点" class="headerlink" title="自动部署之流程分析与创建WEB站点"></a>自动部署之流程分析与创建WEB站点</h2><pre class="line-numbers language-none"><code class="language-none">github服务器  -------- 运行网站代码的服务器   \  \   本地生产的代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="GITHUB自动部署到WEB服务器"><a href="#GITHUB自动部署到WEB服务器" class="headerlink" title="GITHUB自动部署到WEB服务器"></a>GITHUB自动部署到WEB服务器</h2><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h1 id=&quot;git基本操作&quot;&gt;&lt;a href=&quot;#git基本操作&quot; class=&quot;headerlink&quot; title=&quot;git基本操作&quot;&gt;&lt;/a&gt;git基本操</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="GIT" scheme="https://wuzimo233.github.io/tags/GIT/"/>
    
  </entry>
  
  <entry>
    <title>微信小程序商城项目</title>
    <link href="https://wuzimo233.github.io/posts/17.html"/>
    <id>https://wuzimo233.github.io/posts/17.html</id>
    <published>2022-07-25T07:30:00.000Z</published>
    <updated>2022-07-25T07:27:40.191Z</updated>
    
    <content type="html"><![CDATA[<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="工具篇"><a href="#工具篇" class="headerlink" title="工具篇"></a><strong>工具</strong>篇</h3><ul><li>下载 HBuilder <a href="https://www.dcloud.io/index.html">https://www.dcloud.io/index.html</a><ul><li>安装所有插件</li></ul></li><li>下载微信开发者工具 <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html</a></li><li>注册并登录微信公众平台：<a href="https://mp.weixin.qq.com/">https://mp.weixin.qq.com/</a>  <ul><li>获取 <strong>AppID(小程序ID)</strong></li></ul></li></ul><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><strong>生成小程序以及要跳过的坑</strong></p><ul><li>生成小程序时不能用ID选择器，用class</li><li>uniapp没有router路由 </li><li>小程序生命周期函数（比如onload）不能用在子组件里面，而是用在父组件里面</li><li>小程序没有 window对象，包括没有 document… 等节点操作 （例如：document.getElementById() 。。。）</li></ul><h2 id="搭建项目"><a href="#搭建项目" class="headerlink" title="搭建项目"></a>搭建项目</h2><h3 id="主界面配置"><a href="#主界面配置" class="headerlink" title="主界面配置"></a>主界面配置</h3><p>HBuilder新建默认模板项目，运行到小程序模拟器微信开发者工具，同时打开微信开发者工具的设置-安全设置-开启服务端口。</p><p><strong>配置主界面下方四个tab栏：</strong></p><ul><li><p>将准备好的素材文件夹 <strong>static</strong> 覆盖到项目根目录，</p></li><li><p>在<strong>pages</strong>下新建 <strong>sort</strong>（分类）、<strong>shopping</strong>（购物车）、<strong>my</strong>（我的）三个文件夹，并都在内部创建子vue文件，</p></li><li><p>接着在pages.json文件配置底部导航栏，代码如下：</p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span><span class="token string">"pages"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">//pages数组中第一项表示应用启动页，参考：https://uniapp.dcloud.io/collocation/pages</span><span class="token punctuation">{</span><span class="token comment">// 展示用户初次进入的页面</span><span class="token string">"path"</span><span class="token operator">:</span> <span class="token string">"pages/index/index"</span><span class="token punctuation">,</span><span class="token string">"style"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"首页"</span><span class="token punctuation">,</span><span class="token string">"navigationBarBackgroundColor"</span><span class="token operator">:</span><span class="token string">"#fe0024"</span><span class="token punctuation">,</span><span class="token string">"navigationBarTextStyle"</span><span class="token operator">:</span><span class="token string">"white"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"path"</span><span class="token operator">:</span> <span class="token string">"pages/search/search"</span><span class="token punctuation">,</span><span class="token string">"style"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"搜索"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"path"</span><span class="token operator">:</span> <span class="token string">"pages/sort/sort"</span><span class="token punctuation">,</span><span class="token string">"style"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"分类"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"path"</span><span class="token operator">:</span> <span class="token string">"pages/shopping/shopping"</span><span class="token punctuation">,</span><span class="token string">"style"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"购物车"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"path"</span><span class="token operator">:</span> <span class="token string">"pages/my/my"</span><span class="token punctuation">,</span><span class="token string">"style"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"个人中心"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// globalStyle 用于设置应用的状态栏、导航条、标题、窗口背景色等。</span><span class="token string">"globalStyle"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTextStyle"</span><span class="token operator">:</span> <span class="token string">"black"</span><span class="token punctuation">,</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"uni-app"</span><span class="token punctuation">,</span><span class="token string">"navigationBarBackgroundColor"</span><span class="token operator">:</span> <span class="token string">"#F8F8F8"</span><span class="token punctuation">,</span><span class="token string">"backgroundColor"</span><span class="token operator">:</span> <span class="token string">"#F8F8F8"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 如果应用是一个多 tab 应用，可以通过 tabBar 配置项指定一级导航栏，</span><span class="token comment">// 以及 tab 切换时显示的对应页</span><span class="token string">"tabBar"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"#333333"</span><span class="token punctuation">,</span><span class="token string">"selectedColor"</span><span class="token operator">:</span> <span class="token string">"#8fc0ff"</span><span class="token punctuation">,</span><span class="token string">"backgroundColor"</span><span class="token operator">:</span> <span class="token string">"#ffffff"</span><span class="token punctuation">,</span><span class="token string">"borderStyle"</span><span class="token operator">:</span> <span class="token string">"black"</span><span class="token punctuation">,</span><span class="token string">"list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"pagePath"</span><span class="token operator">:</span> <span class="token string">"pages/index/index"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token operator">:</span> <span class="token string">"首页"</span><span class="token punctuation">,</span><span class="token string">"iconPath"</span><span class="token operator">:</span> <span class="token string">"./static/tab/tab-a.png"</span><span class="token punctuation">,</span><span class="token string">"selectedIconPath"</span><span class="token operator">:</span> <span class="token string">"./static/tab/tab-b.png"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"pagePath"</span><span class="token operator">:</span> <span class="token string">"pages/sort/sort"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token operator">:</span> <span class="token string">"分类"</span><span class="token punctuation">,</span><span class="token string">"iconPath"</span><span class="token operator">:</span> <span class="token string">"./static/tab/tab-c.png"</span><span class="token punctuation">,</span><span class="token string">"selectedIconPath"</span><span class="token operator">:</span> <span class="token string">"./static/tab/tab-d.png"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"pagePath"</span><span class="token operator">:</span> <span class="token string">"pages/shopping/shopping"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token operator">:</span> <span class="token string">"购物车"</span><span class="token punctuation">,</span><span class="token string">"iconPath"</span><span class="token operator">:</span> <span class="token string">"./static/tab/tab-e.png"</span><span class="token punctuation">,</span><span class="token string">"selectedIconPath"</span><span class="token operator">:</span> <span class="token string">"./static/tab/tab-f.png"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"pagePath"</span><span class="token operator">:</span> <span class="token string">"pages/my/my"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token operator">:</span> <span class="token string">"我的"</span><span class="token punctuation">,</span><span class="token string">"iconPath"</span><span class="token operator">:</span> <span class="token string">"./static/tab/tab-g.png"</span><span class="token punctuation">,</span><span class="token string">"selectedIconPath"</span><span class="token operator">:</span> <span class="token string">"./static/tab/tab-h.png"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="首页组件拆分"><a href="#首页组件拆分" class="headerlink" title="首页组件拆分"></a>首页组件拆分</h3><p>在pages/index下新建文件夹‘sonzjijian’ ，依次新建 search.vue、swipers.vue、purchase.vue、list.vue等文件，首页下方是动态的加载效果所以考虑引用公共组件 ，即在pages下新建comonents文件夹，内部新建card.vue</p><pre><code>// 引入组件 （首页从上至下排序）搜索                      search.vue轮播                      swipers.vue抢购                        purchase.vue天猫榜单                      list.vue引入公用组件 --懒加载卡片       card.vue</code></pre><p>在<strong>pages/index/index.vue</strong>里引入所有子组件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 搜索 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Search<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Search<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 轮播图 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Swipers<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Swipers<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 抢购 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Purchase <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Purchase<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 榜单 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>List <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 卡片流 懒加载卡片<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Card <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>。。。<span class="token comment">// 引入组件</span><span class="token comment">// 搜索</span><span class="token keyword">import</span> Search <span class="token keyword">from</span> <span class="token string">'./sonzhujian/search.vue'</span><span class="token comment">// 轮播</span><span class="token keyword">import</span> Swipers <span class="token keyword">from</span> <span class="token string">'./sonzhujian/swipers.vue'</span><span class="token comment">// 抢购</span><span class="token keyword">import</span> Purchase <span class="token keyword">from</span> <span class="token string">'./sonzhujian/purchase.vue'</span><span class="token comment">// 天猫榜单</span><span class="token keyword">import</span> List <span class="token keyword">from</span> <span class="token string">'./sonzhujian/list.vue'</span><span class="token comment">// 引入公用的组件 --懒加载卡片</span><span class="token keyword">import</span> Card <span class="token keyword">from</span> <span class="token string">'../commponents/card.vue'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>components<span class="token operator">:</span><span class="token punctuation">{</span>Search<span class="token punctuation">,</span>Swipers<span class="token punctuation">,</span>Purchase<span class="token punctuation">,</span>List<span class="token punctuation">,</span>Card<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="完成搜索组件展示"><a href="#完成搜索组件展示" class="headerlink" title="完成搜索组件展示"></a>完成搜索组件展示</h4><p>关于upx单位：</p><p>uni-app 使用 upx 作为默认尺寸单位， upx 是相对于基准宽度的单位，可以根据<a href="https://baike.baidu.com/item/%E5%B1%8F%E5%B9%95/3750314">屏幕</a>宽度进行自适应。uni-app 规定屏幕基准宽度750upx。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 首页搜索区域 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-men"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> uniapp 不需要。。<span class="token operator">/</span> 可以直接输入文件夹名字查找<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/logo.png"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-ing"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/sousuo.png"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> placeholder<span class="token operator">=</span><span class="token string">"搜索喜欢的内容"</span> disabled <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-saoma"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/saoma.png"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token comment">/* scoped  css样式仅在当前文件生效*/</span><span class="token punctuation">.</span>search<span class="token operator">-</span>view <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #fe001d<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>view image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>ing <span class="token punctuation">{</span>background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> row<span class="token punctuation">;</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>position<span class="token operator">:</span> relative<span class="token punctuation">;</span>margin<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>ing input <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #b2b2b2<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>ing image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">35</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">35</span>upx<span class="token punctuation">;</span>position<span class="token operator">:</span> absolute<span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>align<span class="token operator">-</span>self<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>saoma <span class="token punctuation">{</span>margin<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>men <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="自定义轮播展示与请求轮播数据"><a href="#自定义轮播展示与请求轮播数据" class="headerlink" title="自定义轮播展示与请求轮播数据"></a>自定义轮播展示与请求轮播数据</h4><p>使用 swiper 组件 请求轮播数据完成数据渲染</p><p>打开项目接口文档拿到 首页轮播的接口地址</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"swiper-top"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> @change  事件<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>swiper <span class="token operator">:</span>autoplay<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">:</span>circular<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">:</span>interval<span class="token operator">=</span><span class="token string">"2000"</span> <span class="token operator">:</span>duration<span class="token operator">=</span><span class="token string">"1000"</span> @change<span class="token operator">=</span><span class="token string">"swiperFun()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 每个swiper<span class="token operator">-</span>item 都是独立的会滑动板块 是需要要遍历的整体 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in bannerdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"swiper-item"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> mode 图片裁剪、缩放的模式  <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span>item<span class="token punctuation">.</span>image mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>swiper<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 指示点 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"instruct-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in bannerdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 小方块颜色动态的跟随背景图变化而变化  num默认<span class="token number">0</span>，即让下标为<span class="token number">0</span>的第一个方块套上了该<span class="token keyword">class</span>属性，activee选择器生效的前提是value值为真 想让方块颜色跟随背景图变化需要找到滑动事件：current <span class="token operator">--</span>当前所在滑块的index@change <span class="token operator">--</span>current改变时会触发 change 事件，<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"instruct"</span> <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{active:index == num}"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 指示方块的下标值等于num</span>num<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>            bannerdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">banner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            uni<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                url<span class="token operator">:</span><span class="token string">'https://meituan.thexxdd.cn/api/getbanner'</span><span class="token punctuation">,</span>                methods<span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span>                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>bannerdata <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token function-variable function">fail</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token comment">// 使用swiper自带的@change事件 --滑块滑动时的触发事件   它接收一个参数  每次滑动后current值会增加 而ecurrent的值和index的值是相等的 </span><span class="token function">swiperFun</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// console.log(e.detail.current);</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>current<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>swiper<span class="token operator">-</span>top <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">250</span>upx<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">20</span>upx <span class="token number">10</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>position<span class="token operator">:</span> relative<span class="token punctuation">;</span><span class="token punctuation">}</span>swiper <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">250</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span>background<span class="token operator">:</span> yellow<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>overflow<span class="token operator">:</span> hidden<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>swiper<span class="token operator">-</span>item <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">250</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span>overflow<span class="token operator">:</span> hidden<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>swiper<span class="token operator">-</span>item image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">250</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 指示点 */</span><span class="token punctuation">.</span>instruct<span class="token operator">-</span>view <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>position<span class="token operator">:</span> absolute<span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>instruct <span class="token punctuation">{</span>background<span class="token operator">:</span> #<span class="token number">4e90</span>a6<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>active <span class="token punctuation">{</span>background<span class="token operator">:</span> #ffffff <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="class封装request请求"><a href="#class封装request请求" class="headerlink" title="class封装request请求"></a>class封装request请求</h4><p>原因：很多页面都需要发起请求，即需要使用uni.request（），那么就比较麻烦。</p><pre><code>uni.request({      url:'',      methods:'',      success:(res)=&gt;{            console.log(res)      },      fail:(err)=&gt;{            console.log(err)      }})</code></pre><p>如果将其抽出封装成公用的方法或者类就很方便了。</p><p>项目根目录下新建api文件夹，其下再建立api.js、request.js</p><h5 id="封装请求接口"><a href="#封装请求接口" class="headerlink" title="封装请求接口"></a>封装请求接口</h5><p><strong>在request.js里放置所有的请求接口，</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//  该文件用于写请求地址</span><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://meituan.thexxdd.cn/api/'</span><span class="token comment">// 使用面向对象class方法创造 urls类</span><span class="token keyword">const</span>  urls <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span><span class="token comment">//constructor 构造方法 --可以从别的页面传值过来 接收值</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// static：静态方法 --直接使用类来调用（即 urls.m() 就可以调用），不是静态方法的话需要实例化类 也就是new</span><span class="token comment">// 存放所有的方法</span><span class="token keyword">static</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 首页轮播图 --使用es6的模板字符串方法拼接</span><span class="token keyword">let</span> bannerget <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">getbanner</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 导出对象</span><span class="token keyword">return</span> <span class="token punctuation">{</span>bannerget<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> urls<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="封装请求方式"><a href="#封装请求方式" class="headerlink" title="封装请求方式"></a>封装请求方式</h5><p><strong>在api.js中作request请求</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// request 该文件用于 写请求方法</span><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span><span class="token comment">// 参数url是request.js暴露出的url </span><span class="token comment">// 参数data是post请求传递的值</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span>arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>arg <span class="token operator">=</span> arg<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// 封装 post请求</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span>method<span class="token operator">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>data<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>arg<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 封装 get请求</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span>method<span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> request<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在swiper组件此时可以这样使用</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> urls <span class="token keyword">from</span> <span class="token string">'../../../api/request.js'</span><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'../../../api/api.js'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 指示方块的下标值等于num</span>num<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>            bannerdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function">banner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token comment">//返回新的promise实例对象</span>             <span class="token keyword">new</span> <span class="token class-name">request</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bannerget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>                 <span class="token keyword">this</span><span class="token punctuation">.</span>bannerdata <span class="token operator">=</span> res<span class="token punctuation">.</span>data             <span class="token punctuation">}</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">swiperFun</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>current<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token comment">//加载完后直接调用banner方法   </span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">banner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>还能使用try catch 方法</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token function">banner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">//返回新的promise实例对象用await接收到结果(记得方法前加上axync) 当返回错误的时候会进入 catch里</span>            <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">request</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bannerget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>bannerdata <span class="token operator">=</span> data<span class="token punctuation">.</span>data        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为每个页面几乎都有请求发送，每次引入api和request就很麻烦，所以<strong>挂载到全局</strong> <strong>main.js</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//main.js中引入api和request</span><span class="token comment">// 引入请求地址</span><span class="token keyword">import</span> urls <span class="token keyword">from</span> <span class="token string">'./api/request.js'</span> <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>Urls <span class="token operator">=</span> urls<span class="token comment">// 引入请求方法</span><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'./api/api.js'</span> <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>Request <span class="token operator">=</span> request<span class="token comment">//此时的swiper组件中就这样发送请求了</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token function">banner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">//返回新的promise实例对象用await接收到结果(记得方法前加上axync) 当返回错误的时候会进入 catch里</span>            <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bannerget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>bannerdata <span class="token operator">=</span> data<span class="token punctuation">.</span>data        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="统一请求接口到父组件"><a href="#统一请求接口到父组件" class="headerlink" title="统一请求接口到父组件"></a>统一请求接口到父组件</h5><p>每个页面都再调用请求也很麻烦，所以<strong>将所有请求放到父组件统一发送</strong>，父组件将接口响应的数据传递给子组件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 搜索 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Search<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Search<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 轮播图 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Swipers <span class="token operator">:</span>bannerdata<span class="token operator">=</span><span class="token string">"bannerdata"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Swipers<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 抢购 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Purchase<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Purchase<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 榜单 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>List<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 卡片流 懒加载卡片<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Card<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入组件</span><span class="token comment">// 搜索</span><span class="token keyword">import</span> Search <span class="token keyword">from</span> <span class="token string">'./sonzhujian/search.vue'</span><span class="token comment">// 轮播</span><span class="token keyword">import</span> Swipers <span class="token keyword">from</span> <span class="token string">'./sonzhujian/swipers.vue'</span><span class="token comment">// 抢购</span><span class="token keyword">import</span> Purchase <span class="token keyword">from</span> <span class="token string">'./sonzhujian/purchase.vue'</span><span class="token comment">// 天猫榜单</span><span class="token keyword">import</span> List <span class="token keyword">from</span> <span class="token string">'./sonzhujian/list.vue'</span><span class="token comment">// 引入公用的组件 --懒加载卡片</span><span class="token keyword">import</span> Card <span class="token keyword">from</span> <span class="token string">'../commponents/card.vue'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>components<span class="token operator">:</span><span class="token punctuation">{</span>Search<span class="token punctuation">,</span>Swipers<span class="token punctuation">,</span>Purchase<span class="token punctuation">,</span>List<span class="token punctuation">,</span>Card<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>bannerdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>recomdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>billdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>commdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pageid<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 把请求统一放到父组件</span><span class="token keyword">async</span> <span class="token function">indexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 轮播</span><span class="token keyword">let</span> banner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bannerget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token comment">// 同时并发请求：Promise.all([]) 里边的所有请求全部得到结果后才会返回</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>banner<span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 轮播</span><span class="token keyword">this</span><span class="token punctuation">.</span>bannerdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 上拉加载所得数据</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span><span class="token comment">/* 全局背景色 */</span>page <span class="token punctuation">{</span>background<span class="token operator">:</span> #f4f4f4<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>子组件 <strong>swiper.vue</strong> 通过<strong>props</strong>接收父组件传递来的数据</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token comment">// bannerdata是父组件 通过ref传递进来的数据 类型是Array</span>props<span class="token operator">:</span><span class="token punctuation">{</span>bannerdata<span class="token operator">:</span>Array<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="完成推荐抢购商品组件数据"><a href="#完成推荐抢购商品组件数据" class="headerlink" title="完成推荐抢购商品组件数据"></a>完成推荐抢购商品组件数据</h4><p>在request.js中添加抢购商品接口 </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//  该文件用于写请求地址</span><span class="token comment">// static：静态方法 --直接使用类来调用（即 urls.m() 就可以调用），不是静态方法的话需要实例化类 也就是new</span><span class="token comment">// 存放所有的方法</span><span class="token keyword">static</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 首页轮播图 --使用es6的模板字符串方法拼接</span><span class="token keyword">let</span> bannerget <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">getbanner</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 推荐抢购商品 </span><span class="token keyword">let</span> getrecommurl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">recom</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 导出对象</span><span class="token keyword">return</span> <span class="token punctuation">{</span>bannerget<span class="token punctuation">,</span>getrecommurl<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在index/index.vue中使用</strong>，并将<strong>recomdata</strong>数据通过ref传递到子组件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 把请求统一放到父组件</span><span class="token keyword">async</span> <span class="token function">indexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 轮播</span><span class="token keyword">let</span> banner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bannerget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 推荐抢购商品 </span><span class="token keyword">let</span> recomm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getrecommurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token comment">// 同时并发请求：Promise.all([])</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>banner<span class="token punctuation">,</span>recomm<span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 轮播</span><span class="token keyword">this</span><span class="token punctuation">.</span>bannerdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token comment">// 快抢购</span><span class="token keyword">this</span><span class="token punctuation">.</span>recomdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>子组件purchase.vue代码如下：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 抢购组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Purchase-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 左边 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-left widthing"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-top"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>recomdata<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>recomdata<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lable<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in recomdata[0].image"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.img"</span> alt<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 右边 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-right widthing"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 上 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-right-top"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-top two"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>recomdata<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>recomdata<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lable<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-right-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in recomdata[1].image"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.img"</span> alt<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 下 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-top three"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>recomdata<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>recomdata<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lable<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-right-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in recomdata[2].image"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.img"</span> alt<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>props<span class="token operator">:</span> <span class="token punctuation">{</span> recomdata<span class="token operator">:</span> Array<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>Purchase<span class="token operator">-</span>view <span class="token punctuation">{</span>background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>top <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">9</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>top text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>top text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">24</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> red<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 图片 */</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>img <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>img view <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">150</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>img image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">120</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">120</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>img view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter">n <span class="token operator">+</span> <span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>padding<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>right<span class="token operator">-</span>img <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>right<span class="token operator">-</span>img image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">120</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">120</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>right<span class="token operator">-</span>img view <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">150</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>right <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>right view <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>flex <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>widthing <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span>box<span class="token operator">-</span>sizing<span class="token operator">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>left <span class="token punctuation">{</span>border<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f1f1f1<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pur<span class="token operator">-</span>right<span class="token operator">-</span>top <span class="token punctuation">{</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f1f1f1<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>two text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>color<span class="token operator">:</span> #ff7594 <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>three text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>color<span class="token operator">:</span> #<span class="token number">96</span>b06f <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="完成天猫榜单组件数据"><a href="#完成天猫榜单组件数据" class="headerlink" title="完成天猫榜单组件数据"></a>完成天猫榜单组件数据</h4><p>在request.js中添加抢购商品接口 </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 存放所有的方法</span><span class="token keyword">static</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 首页轮播图 --使用es6的模板字符串方法拼接</span><span class="token keyword">let</span> bannerget <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">getbanner</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 推荐抢购商品 </span><span class="token keyword">let</span> getrecommurl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">recom</span><span class="token template-punctuation string">`</span></span>        <span class="token comment">// 天猫榜单</span><span class="token keyword">let</span> billboardurl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">billboard</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 导出对象</span><span class="token keyword">return</span> <span class="token punctuation">{</span>bannerget<span class="token punctuation">,</span>getrecommurl<span class="token punctuation">,</span>            billboardurl<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在index/index.vue中使用</strong>，并将<strong>billdata</strong>数据通过ref传递到子组件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 把请求统一放到父组件</span><span class="token keyword">async</span> <span class="token function">indexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 轮播</span><span class="token keyword">let</span> banner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bannerget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 推荐抢购商品 </span><span class="token keyword">let</span> recomm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getrecommurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// 天猫榜单</span><span class="token keyword">let</span> billboard <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>billboardurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token comment">// 同时并发请求：Promise.all([])</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>banner<span class="token punctuation">,</span>recomm<span class="token punctuation">,</span>billboard<span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 轮播</span><span class="token keyword">this</span><span class="token punctuation">.</span>bannerdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token comment">// 快抢购</span><span class="token keyword">this</span><span class="token punctuation">.</span>recomdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data                    <span class="token comment">// 天猫榜单</span><span class="token keyword">this</span><span class="token punctuation">.</span>billdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>子组件list.vue代码如下:</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"list-top"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"list-text"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>天猫榜单<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>闭着眼睛跟榜买<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"list-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item, index) in billdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"menb"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>want <span class="token punctuation">}</span><span class="token punctuation">}</span>人想要<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>props<span class="token operator">:</span> <span class="token punctuation">{</span> billdata<span class="token operator">:</span> Array <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token comment">/* /less */</span><span class="token punctuation">.</span>list<span class="token operator">-</span>top <span class="token punctuation">{</span>margin<span class="token operator">:</span> <span class="token number">20</span>upx <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>list<span class="token operator">-</span>text <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">70</span>rpx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>list<span class="token operator">-</span>text text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>background<span class="token operator">:</span> #<span class="token number">2</span>c405a<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">35</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>list<span class="token operator">-</span>text text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">5</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>list<span class="token operator">-</span>text text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">24</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">999999</span><span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>list<span class="token operator">-</span>view <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">400</span>rpx<span class="token punctuation">;</span>background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">9</span>rpx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>menb text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>menb text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>color<span class="token operator">:</span> #fe0024<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>menb image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">80</span>rpx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>rpx <span class="token operator">!</span>important<span class="token punctuation">;</span>padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">4</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>menb <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">33.333</span><span class="token operator">%</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">2</span>rpx<span class="token punctuation">;</span>box<span class="token operator">-</span>sizing<span class="token operator">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>list<span class="token operator">-</span>view view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">-</span>n <span class="token operator">+</span> <span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f1f1f1<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>list<span class="token operator">-</span>view view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>border<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f1f1f1<span class="token punctuation">;</span>border<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f1f1f1<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>list<span class="token operator">-</span>view view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">5</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>border<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f1f1f1<span class="token punctuation">;</span>border<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f1f1f1<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="封装并请求卡片流商品组件"><a href="#封装并请求卡片流商品组件" class="headerlink" title="封装并请求卡片流商品组件"></a>封装并请求卡片流商品组件</h4><p>因为该组件的（流动布局）功能在其他页面也会用到，所以封装到公共组件文件夹去，即在<strong>pages下新建comonents文件夹</strong>，再新建<strong>card.vue</strong>文件</p><p>在<strong>request.js</strong>中添加<strong>卡片商品流以及上拉加载接口</strong> </p><p>由于接口文档显示get请求需要携带?query参数，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 存放所有的方法</span><span class="token keyword">static</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 首页轮播图 --使用es6的模板字符串方法拼接</span><span class="token keyword">let</span> bannerget <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">getbanner</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 推荐抢购商品 </span><span class="token keyword">let</span> getrecommurl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">recom</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 天猫榜单</span><span class="token keyword">let</span> billboardurl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">billboard</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 卡片商品流以及上拉加载</span><span class="token keyword">let</span> commodcradurl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">commodcrad</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 导出对象</span><span class="token keyword">return</span> <span class="token punctuation">{</span>bannerget<span class="token punctuation">,</span>getrecommurl<span class="token punctuation">,</span>billboardurl<span class="token punctuation">,</span>commodcradurl<span class="token punctuation">,</span>searchurl<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在index/index.vue中使用</strong>，并将<strong>recomdata</strong>数据通过ref传递到子组件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">。。。。。。<span class="token comment">// 引入公用的组件 --懒加载卡片</span><span class="token keyword">import</span> Card <span class="token keyword">from</span> <span class="token string">'../commponents/card.vue'</span><span class="token comment">// 把请求统一放到父组件</span>menthods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token function">indexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 轮播</span><span class="token keyword">let</span> banner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bannerget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 推荐抢购商品 </span><span class="token keyword">let</span> recomm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getrecommurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 天猫榜单</span><span class="token keyword">let</span> billboard <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>billboardurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 卡片商品流以及上拉加载 （！！注意需要携带参数）</span><span class="token keyword">let</span> commodcrad <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>commodcradurl <span class="token operator">+</span> <span class="token string">'?page='</span> <span class="token operator">+</span>                       <span class="token keyword">this</span><span class="token punctuation">.</span>pageid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token comment">// 同时并发请求：Promise.all([])</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>banner<span class="token punctuation">,</span>recomm<span class="token punctuation">,</span>billboard<span class="token punctuation">,</span>commodcrad<span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 轮播</span><span class="token keyword">this</span><span class="token punctuation">.</span>bannerdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token comment">// 快抢购</span><span class="token keyword">this</span><span class="token punctuation">.</span>recomdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token comment">// 天猫榜单</span><span class="token keyword">this</span><span class="token punctuation">.</span>billdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token comment">// 卡片商品流</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span> <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>          <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>公用组件Card.vue代码如下:</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in commdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-card"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-left"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>freight<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>预计<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>Duration<span class="token punctuation">}</span><span class="token punctuation">}</span>h发货<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-right"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>Price<span class="token punctuation">}</span><span class="token punctuation">}</span>￥<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token comment">// props接收父组件传递的数组对象</span>props<span class="token operator">:</span><span class="token punctuation">{</span>commdata<span class="token operator">:</span>Array<span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>img <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">450</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>img image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">450</span>rpx<span class="token punctuation">;</span>border<span class="token operator">-</span>top<span class="token operator">-</span>left<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>top<span class="token operator">-</span>right<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>card <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">%</span> <span class="token operator">-</span> <span class="token number">5</span>rpx <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">5</span>rpx<span class="token punctuation">;</span>background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>title <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>rpx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>rpx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">50</span>rpx<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span>overflow<span class="token operator">:</span> hidden<span class="token punctuation">;</span>text<span class="token operator">-</span>overflow<span class="token operator">:</span> ellipsis<span class="token punctuation">;</span>display<span class="token operator">:</span> <span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token punctuation">;</span><span class="token operator">-</span>webkit<span class="token operator">-</span>line<span class="token operator">-</span>clamp<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 控制多行的行数</span><span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token operator">-</span>orient<span class="token operator">:</span> vertical<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>left <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>left text <span class="token punctuation">{</span>padding<span class="token operator">:</span> <span class="token number">3</span>rpx <span class="token number">4</span>rpx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>left text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>border<span class="token operator">:</span> <span class="token number">2</span>rpx solid #<span class="token number">1183e6</span><span class="token punctuation">;</span>margin<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">1183e6</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>left text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>border<span class="token operator">:</span> <span class="token number">2</span>rpx solid red<span class="token punctuation">;</span>color<span class="token operator">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>right <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>rpx<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>color<span class="token operator">:</span> #f3022f<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>rpx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">50</span>rpx<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comm<span class="token operator">-</span>view <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">5</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="完成上拉加载"><a href="#完成上拉加载" class="headerlink" title="完成上拉加载"></a>完成上拉加载</h5><p>上拉加载时，一般会加载全部服务器返回的数据，一般用户不会看完那么多的数据，体验感不好，因此一般是仅显示前几条数据，其他数据下拉屏幕获取</p><p>首先先封装上拉加载时执行的函数 **pullup()**，</p><p>使用uni-app 生命周期 <strong>onReachBottom</strong> 函数来操作 – 页面滚动到底部的事件（不是scroll-view滚到底），常用于下拉下一页数据。</p><p>在<strong>index.vue</strong>中添加如下代码</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 上拉加载所得数据</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token function">pullup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 卡片流商品</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token keyword">let</span> commodcrad <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>commodcradurl <span class="token operator">+</span> <span class="token string">'?page='</span> <span class="token operator">+</span>                                 <span class="token keyword">this</span><span class="token punctuation">.</span>pageid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>commodcrad<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 把之前得到的数据和上拉得到的数据作数组合并 !    ES6的数组合并方法</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata<span class="token punctuation">,</span><span class="token operator">...</span>commodcrad<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 页面处理事件--上拉加载更多</span><span class="token function">onReachBottom</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageid <span class="token operator">++</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pullup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="封装上拉提示"><a href="#封装上拉提示" class="headerlink" title="封装上拉提示"></a><strong>封装上拉提示</strong></h5><p>用户在上拉的时候，应该给出一个提示比如：正在加载中…   或者到底了…</p><p>因为该功能属于公共的，所以考虑封装到公共commponents文件夹里 新建<strong>loading-men.vue</strong>文件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 上拉加载组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 默认是隐藏的该组件，当上拉加载时，父组件传递的对象参数 <span class="token function">到loAD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 中，解构后让 v<span class="token operator">-</span><span class="token keyword">if</span>为真 组件显示<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"loading-men"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"loading"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 没数据后图片会隐藏 控制图片的代码是写在index<span class="token punctuation">.</span><span class="token function">vue的pullup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法里 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/loadtmall.gif"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"picture"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>tips<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>picture<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>tips<span class="token operator">:</span> <span class="token string">'玩命加载中'</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token function">loAd</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 接收父组件传递过来的 whether 数据  其他俩值是默认值</span><span class="token keyword">let</span> <span class="token punctuation">{</span> whether <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> picture <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> tips <span class="token operator">=</span> <span class="token string">'玩命加载中'</span><span class="token punctuation">}</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>            <span class="token comment">// 下方数据的数据会自动获取上边的解构的对象值，如果父组件没有传递，就取默认值</span><span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> whether<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>picture <span class="token operator">=</span> picture<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>tips <span class="token operator">=</span> tips<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>loading<span class="token operator">-</span>men <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">200</span>rpx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>color<span class="token operator">:</span> #a7a7a7<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>loading<span class="token operator">-</span>men image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">60</span>rpx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> block<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为用到的地方较多，所以引入到<strong>main.js</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 引入上拉加载组件</span><span class="token keyword">import</span> loadn <span class="token keyword">from</span> <span class="token string">'pages/commponents/loading-men.vue'</span><span class="token comment">// 注册到组件</span>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'loader-on'</span><span class="token punctuation">,</span>loadn<span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token comment">// 然后在index.vue中引入组件loader-on组件</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 上拉加载 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loader<span class="token operator">-</span>on ref<span class="token operator">=</span><span class="token string">"loadon"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loader<span class="token operator">-</span>on<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时在index.vue中 <strong>pullup()</strong> <strong>方法</strong>和 <strong>onReachBottom()</strong> <strong>事件</strong>  代码修改如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 上拉加载所得数据</span><span class="token keyword">async</span> <span class="token function">pullup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 卡片流商品</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token comment">// 下拉后得到的数据（数组）</span><span class="token keyword">let</span> commodcrad <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>commodcradurl <span class="token operator">+</span> <span class="token string">'?page='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>commodcrad<span class="token punctuation">,</span><span class="token string">'上拉加载的数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>commodcrad<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 当没有数据时，通过ref，将下拉加载的图片隐藏 同时调整提示的文字</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loadon<span class="token punctuation">.</span><span class="token function">loAd</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  whether <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> picture <span class="token operator">:</span><span class="token boolean">false</span> <span class="token punctuation">,</span> tips <span class="token operator">:</span> <span class="token string">'我是有底线的！'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 需要把之前得到的数据和上拉得到的数据做数组合并 !!  。。。表示展开</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata<span class="token punctuation">,</span><span class="token operator">...</span>commodcrad<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 页面处理事件--上拉加载更多</span><span class="token comment">// 给子组件传递数据，即让index.vue中调用子组件的方法，考虑使用ref（在组件上添加） --类似传统的document.getElementById()</span><span class="token function">onReachBottom</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loadon<span class="token punctuation">.</span><span class="token function">loAd</span><span class="token punctuation">(</span><span class="token punctuation">{</span> whether<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageid <span class="token operator">++</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pullup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="商品搜索页面"><a href="#商品搜索页面" class="headerlink" title="商品搜索页面"></a>商品搜索页面</h4><p>因为商品搜索并不是在 index.vue 组件上执行，而是跳转到搜索的功能组件里执行。</p><p>因此在 <strong>pages **文件夹 新建 **search / search.vue</strong></p><p>先在<strong>pages.json</strong>里配置路径</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span><span class="token string">"path"</span><span class="token operator">:</span> <span class="token string">"pages/search/search"</span><span class="token punctuation">,</span><span class="token string">"style"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"搜索"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 <strong>index / sonzhujian / search.vue</strong> 中设置<strong>点击input框区域的跳转功能</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-ing"</span> @click<span class="token operator">=</span><span class="token string">"searCh()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/sousuo.png"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> placeholder<span class="token operator">=</span><span class="token string">"搜索喜欢的内容"</span> disabled <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// ...</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token function">searCh</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// uni.navigateTo 保留当前页面，跳转到目标页面</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    url<span class="token operator">:</span> <span class="token string">'../search/search'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>搜索页面布局</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 搜索页面组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 文本框 和 搜索按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-cont"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用v<span class="token operator">-</span>model 获取输入框的值 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> placeholder<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"inputclass"</span> confirm<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"搜索"</span> focus<span class="token operator">=</span><span class="token string">"true"</span> placeholder<span class="token operator">=</span><span class="token string">"请输入关键字"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">'searchdata'</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-code"</span> <span class="token operator">&gt;</span>搜索<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 搜索历史 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-history"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"ifhistory"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 最近搜索 和 删除icon<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>最近搜索<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/searchend.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 历史关键词 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"menu-block"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>衣服<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>裤子<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>女装<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>search <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> row<span class="token punctuation">;</span>background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span>margin<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search input <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">666666</span><span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>cont <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">30</span>upx <span class="token number">0</span><span class="token punctuation">;</span>background<span class="token operator">:</span> #f8f8f8<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>code <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">150</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>history<span class="token punctuation">{</span>margin<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>title<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span> font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span>space<span class="token operator">-</span>between<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>search<span class="token operator">-</span>title image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">36</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">36</span>upx<span class="token punctuation">;</span> display<span class="token operator">:</span> block<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>menu<span class="token operator">-</span>block view <span class="token punctuation">{</span>background<span class="token operator">:</span> #f7f8fa<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">6</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">27</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">292</span>c33<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">20</span>upx <span class="token number">20</span>upx <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>menu<span class="token operator">-</span>block <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> row<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> flex<span class="token operator">-</span>start<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="历史搜索的功能实现"><a href="#历史搜索的功能实现" class="headerlink" title="历史搜索的功能实现"></a>历史搜索的功能实现</h5><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 搜索页面组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 文本框 和 搜索按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-cont"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用v<span class="token operator">-</span>model 获取输入框的值   @confirm 点击键盘按钮触发事件<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> placeholder<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"inputclass"</span> confirm<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"搜索"</span> focus<span class="token operator">=</span><span class="token string">"true"</span> placeholder<span class="token operator">=</span><span class="token string">"请输入关键字"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">'searchdata'</span> @confirm<span class="token operator">=</span><span class="token string">"onKeyInput"</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 给点击搜索绑定点击事件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-code"</span> @click<span class="token operator">=</span><span class="token string">"seArch()"</span> <span class="token operator">&gt;</span>搜索<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 搜索历史 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-history"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"ifhistory"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 最近搜索 和 删除icon<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>最近搜索<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/searchend.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 历史关键词 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"menu-block"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in Storagedata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"menubtn(item)"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入公用的组件 --懒加载卡片</span><span class="token keyword">import</span> Card <span class="token keyword">from</span> <span class="token string">'../commponents/card.vue'</span><span class="token comment">// 解构console.log()方便使用</span><span class="token keyword">var</span> <span class="token punctuation">{</span>log<span class="token punctuation">}</span> <span class="token operator">=</span> console<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>components<span class="token operator">:</span><span class="token punctuation">{</span>Card<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 存放输入框的值</span>searchdata<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">// 是否有搜索历史</span>ifhistory<span class="token operator">:</span><span class="token string">'false'</span><span class="token punctuation">,</span><span class="token comment">// 搜索历史数据</span>Storagedata<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">// 请求页数</span>pageid<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">// 搜索的结果</span>commdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// 没有搜索结果</span>searchno<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">// 最后一次搜索结果</span>searchkey<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods <span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 点击 搜索按钮 触发搜索功能</span><span class="token function">seArch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchdata <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>ifhistory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageid <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchdata<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">searchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchdata<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 键盘 回车键 触发搜索功能</span><span class="token function">onKeyInput</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> searchkey <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token comment">// 当文本框不为空时</span><span class="token keyword">if</span><span class="token punctuation">(</span>searchkey <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>ifhistory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageid <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span>searchkey<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">searchData</span><span class="token punctuation">(</span>searchkey<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 在去请求接口之前，要把搜索结果先存到 本地缓存，然后放到最近搜索这里 （接收的参数是回车事件获取到的 value）</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token parameter">searchkey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 存之前先取之前用户搜索的历史 --key值随意取名  如果没有就取空数组表示本地缓存没有数据</span><span class="token keyword">let</span> searcharray <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'search_key'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">// 存到 searcharray 数组前面</span>searcharray<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>searchkey<span class="token punctuation">)</span><span class="token comment">// 存  uni.setStorageSync(KEY,DATA) key是名称 DATA是内容</span>uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'search_key'</span><span class="token punctuation">,</span>searcharray<span class="token punctuation">)</span><span class="token comment">// 取  uni.getStorageSync(KEY)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 取出本地缓存的搜索历史</span><span class="token comment">// uni.setStorage(OBJECT) 将数据存储在本地缓存中指定的 key 中，会覆盖掉原来该 key 对应的内容，这是一个异步接口。</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> setdata <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'search_key'</span><span class="token punctuation">)</span><span class="token comment">// 1.判断缓存里有没有重复的关键词   --有就 数组去重</span><span class="token comment">// 使用的是ES6 Set方法</span><span class="token keyword">let</span> setdataarr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>setdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 2.判断缓存里有没有数据</span><span class="token keyword">if</span><span class="token punctuation">(</span>setdataarr<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 隐藏搜索历史</span><span class="token keyword">this</span><span class="token punctuation">.</span>ifhistory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>Storagedata <span class="token operator">=</span>  setdataarr<span class="token keyword">this</span><span class="token punctuation">.</span>ifhistory <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token comment">//.....</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="商品搜索请求接口"><a href="#商品搜索请求接口" class="headerlink" title="商品搜索请求接口"></a>商品搜索请求接口</h5><p>先添加清除历史功能</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 最近搜索 和 删除icon<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>最近搜索<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 给图标添加点击事件 removeStorage <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"removeStorage()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/searchend.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 清空本地缓存 即清空搜索历史 </span><span class="token function">removeStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">removeStorageSync</span><span class="token punctuation">(</span><span class="token string">'search_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 在调用一下setStorage方法，主要目的是将最近搜索给隐藏</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> <strong>公用的请求接口方法</strong> </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 公用的请求接口方法  搜索商品</span><span class="token keyword">async</span> <span class="token function">searchData</span><span class="token punctuation">(</span>searchkey<span class="token punctuation">,</span>idn<span class="token operator">=</span><span class="token string">'001'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchkey <span class="token operator">=</span> searchkey<span class="token comment">// 请求的参数</span><span class="token keyword">const</span> keys <span class="token operator">=</span> <span class="token string">'?keyword='</span> <span class="token operator">+</span> searchkey <span class="token operator">+</span> <span class="token string">'&amp;'</span> <span class="token operator">+</span> <span class="token string">'page='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageid<span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> searchdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>searchurl <span class="token operator">+</span> keys<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 判断</span><span class="token keyword">if</span><span class="token punctuation">(</span>idn <span class="token operator">==</span> <span class="token string">'002'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 上拉加载</span><span class="token keyword">if</span><span class="token punctuation">(</span>searchdata<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loadon<span class="token punctuation">.</span><span class="token function">loAd</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  whether <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> picture <span class="token operator">:</span><span class="token boolean">false</span> <span class="token punctuation">,</span> tips <span class="token operator">:</span> <span class="token string">'我是有底线的！'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata<span class="token punctuation">,</span><span class="token operator">...</span>searchdata<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 隐藏</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loadon<span class="token punctuation">.</span><span class="token function">loAd</span><span class="token punctuation">(</span><span class="token punctuation">{</span>whether <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 判断是否有数据 没有就展示提示</span><span class="token keyword">if</span><span class="token punctuation">(</span>searchdata<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchno <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 有数据的话就赋值给data里 不展示提示</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> searchdata<span class="token punctuation">.</span>data<span class="token keyword">this</span><span class="token punctuation">.</span>searchno <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>引入style文件夹里的公共样式 在 <strong>main.js</strong> </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 提示框的css样式</span><span class="token keyword">import</span> <span class="token string">'./style/style.css'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>最终代码如下:</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 搜索页面组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 文本框 和 搜索按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-cont"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用v<span class="token operator">-</span>model 获取输入框的值   @confirm 点击键盘按钮触发事件<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> placeholder<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"inputclass"</span> confirm<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"搜索"</span> focus<span class="token operator">=</span><span class="token string">"true"</span> placeholder<span class="token operator">=</span><span class="token string">"请输入关键字"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">'searchdata'</span> @confirm<span class="token operator">=</span><span class="token string">"onKeyInput"</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 给点击搜索绑定点击事件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-code"</span> @click<span class="token operator">=</span><span class="token string">"seArch()"</span> <span class="token operator">&gt;</span>搜索<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 搜索历史 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-history"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"ifhistory"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 最近搜索 和 删除icon<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>最近搜索<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"removeStorage()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/searchend.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 历史关键词 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"menu-block"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in Storagedata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"menubtn(item)"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 展示搜索结果 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Card <span class="token operator">:</span>commdata<span class="token operator">=</span><span class="token string">"commdata"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!searchno"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 没有搜索结果 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"empty-cart"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"searchno"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/sousuono.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>抱歉！暂无相关商品<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 上拉加载 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loader<span class="token operator">-</span>on ref<span class="token operator">=</span><span class="token string">"loadon"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loader<span class="token operator">-</span>on<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入公用的组件 --懒加载卡片</span><span class="token keyword">import</span> Card <span class="token keyword">from</span> <span class="token string">'../commponents/card.vue'</span><span class="token comment">// 解构console.log()方便使用</span><span class="token keyword">var</span> <span class="token punctuation">{</span>log<span class="token punctuation">}</span> <span class="token operator">=</span> console<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>components<span class="token operator">:</span><span class="token punctuation">{</span>Card<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 存放输入框的值</span>searchdata<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">// 是否有搜索历史</span>ifhistory<span class="token operator">:</span><span class="token string">'false'</span><span class="token punctuation">,</span><span class="token comment">// 搜索历史数据</span>Storagedata<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">// 请求页数</span>pageid<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">// 搜索的结果</span>commdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// 没有搜索结果</span>searchno<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">// 搜索值最后一次搜索结果</span>searchkey<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods <span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 点击 搜索按钮 触发搜索功能</span><span class="token function">seArch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchdata <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>ifhistory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageid <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchdata<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">searchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchdata<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 键盘 回车键 触发搜索功能</span><span class="token function">onKeyInput</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> searchkey <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token comment">// 当文本框不为空时</span><span class="token keyword">if</span><span class="token punctuation">(</span>searchkey <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>ifhistory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageid <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span>searchkey<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">searchData</span><span class="token punctuation">(</span>searchkey<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 在去请求接口之前，要把搜索结果先存到 本地缓存，然后放到最近搜索这里 （接收的参数是回车事件获取到的 value）</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token parameter">searchkey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 存之前先取之前用户搜索的历史 --key值随意取名  如果没有就取空数组表示本地缓存没有数据</span><span class="token keyword">let</span> searcharray <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'search_key'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">// 存到 searcharray 数组前面</span>searcharray<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>searchkey<span class="token punctuation">)</span><span class="token comment">// 存  uni.setStorageSync(KEY,DATA) key是名称 DATA是内容</span>uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'search_key'</span><span class="token punctuation">,</span>searcharray<span class="token punctuation">)</span><span class="token comment">// 取  uni.getStorageSync(KEY)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 取出本地缓存的搜索历史</span><span class="token comment">// uni.setStorage(OBJECT) 将数据存储在本地缓存中指定的 key 中，会覆盖掉原来该 key 对应的内容，这是一个异步接口。</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> setdata <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'search_key'</span><span class="token punctuation">)</span><span class="token comment">// 1.判断缓存里有没有重复的关键词   --有就 数组去重</span><span class="token comment">// 使用的是ES6 Set方法</span><span class="token keyword">let</span> setdataarr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>setdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 2.判断缓存里有没有数据</span><span class="token keyword">if</span><span class="token punctuation">(</span>setdataarr<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 隐藏搜索历史</span><span class="token keyword">this</span><span class="token punctuation">.</span>ifhistory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>Storagedata <span class="token operator">=</span>  setdataarr<span class="token keyword">this</span><span class="token punctuation">.</span>ifhistory <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 清空本地缓存的Storage即清空搜索历史</span><span class="token function">removeStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> uni<span class="token punctuation">.</span><span class="token function">removeStorageSync</span><span class="token punctuation">(</span><span class="token string">'search_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 搜索历史</span><span class="token function">menubtn</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 先隐藏搜索历史</span><span class="token keyword">this</span><span class="token punctuation">.</span>ifhistory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageid <span class="token operator">=</span> <span class="token number">0</span><span class="token comment">// 再发起请求</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">searchData</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 公用的请求接口方法  搜索商品 给参数传一个值 idn 用于判断触发搜索</span><span class="token keyword">async</span> <span class="token function">searchData</span><span class="token punctuation">(</span>searchkey<span class="token punctuation">,</span>idn<span class="token operator">=</span><span class="token string">'001'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchkey <span class="token operator">=</span> searchkey<span class="token comment">// 请求的参数</span><span class="token keyword">const</span> keys <span class="token operator">=</span> <span class="token string">'?keyword='</span> <span class="token operator">+</span> searchkey <span class="token operator">+</span> <span class="token string">'&amp;'</span> <span class="token operator">+</span> <span class="token string">'page='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageid<span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> searchdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>searchurl <span class="token operator">+</span> keys<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 判断</span><span class="token keyword">if</span><span class="token punctuation">(</span>idn <span class="token operator">==</span> <span class="token string">'002'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 上拉加载</span><span class="token keyword">if</span><span class="token punctuation">(</span>searchdata<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loadon<span class="token punctuation">.</span><span class="token function">loAd</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  whether <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> picture <span class="token operator">:</span><span class="token boolean">false</span> <span class="token punctuation">,</span> tips <span class="token operator">:</span> <span class="token string">'我是有底线的！'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata<span class="token punctuation">,</span><span class="token operator">...</span>searchdata<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 隐藏</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loadon<span class="token punctuation">.</span><span class="token function">loAd</span><span class="token punctuation">(</span><span class="token punctuation">{</span>whether <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 判断是否有数据 没有就展示提示</span><span class="token keyword">if</span><span class="token punctuation">(</span>searchdata<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchno <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 有数据的话就赋值给data里 不展示提示</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> searchdata<span class="token punctuation">.</span>data<span class="token keyword">this</span><span class="token punctuation">.</span>searchno <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 页面处理事件--上拉加载更多</span><span class="token function">onReachBottom</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 显示提示 通过ref 操作dom</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loadon<span class="token punctuation">.</span><span class="token function">loAd</span><span class="token punctuation">(</span><span class="token punctuation">{</span> whether<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageid<span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">searchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchkey<span class="token punctuation">,</span><span class="token string">'002'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="商品详情页"><a href="#商品详情页" class="headerlink" title="商品详情页"></a>商品详情页</h3><h4 id="自定义顶部导航栏"><a href="#自定义顶部导航栏" class="headerlink" title="自定义顶部导航栏"></a>自定义顶部导航栏</h4><p>在<strong>pages</strong>文件夹下新建 <strong>details.vue</strong>文件</p><p>pages.json中写入地址</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span><span class="token comment">// 展示用户初次进入的页面</span><span class="token string">"path"</span><span class="token operator">:</span> <span class="token string">"pages/details/details"</span><span class="token punctuation">,</span><span class="token string">"style"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"详情页"</span><span class="token punctuation">,</span><span class="token string">"navigationStyle"</span><span class="token operator">:</span> <span class="token string">"custom"</span>  <span class="token comment">// 文字可以排列到顶部</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>获取右上角胶囊按钮的宽高和到边框的距离</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// getMenuButtonBoundingClientRect()  本API用于获取小程序下胶囊按钮的布局位置信息（宽高、边距等等），方便开发者布局顶部内容时避开该按钮坐标信息以屏幕左上角为原点。</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>下方的部分新建<strong>sonzujian文件夹下新建top.vue</strong>：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"navs-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"navs-image"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">" 'height:'+ tophight.height + 'px;' "</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/fanhuihei.png"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"navs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in navalue"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 动态设置 高度 和 行高  与胶囊对齐 同时设置一个底部横线<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"navs-nav"</span> <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{navactivetext:index == num}"</span><span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">" 'height:'+ tophight.height + 'px;' + 'line-height:' + tophight.height + 'px;' "</span>@click<span class="token operator">=</span><span class="token string">"navbtn(index)"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view style<span class="token operator">=</span><span class="token string">"width: 20px; padding-right: 20rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>props<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 接收父组件数据 子组件自定义高度</span>tophight<span class="token operator">:</span>Object<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>num<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>navalue<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token operator">:</span><span class="token string">'商品'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token operator">:</span><span class="token string">'评价'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token operator">:</span><span class="token string">'详情'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 控制短横线跳转位置</span><span class="token function">navbtn</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> index<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>navs<span class="token operator">-</span>nav<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span> width<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span> text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span> color<span class="token operator">:</span> #<span class="token number">464230</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">.</span>navs<span class="token operator">-</span>image image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token punctuation">.</span>navs<span class="token operator">-</span>image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span> display<span class="token operator">:</span> flex<span class="token punctuation">;</span> align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span> padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>navs<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span> align<span class="token operator">-</span>self<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>navactivetext<span class="token punctuation">{</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">5</span>upx solid #<span class="token number">3</span>d3b32<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>navs<span class="token operator">-</span>view<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span> justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>此时父组件details.vue是这样：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 返回按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"header-fixed backno"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"showAbs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 箭头符号设置的动态的高 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"status_bar"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"'height: '+ tophight.top + 'px;'"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"navs-image"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"'height: '+ tophight.height + 'px;' "</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/fanhuibai.jpg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> tab <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>子组件 默认不显示出来<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"header-fixed backyes"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"!showAbs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 放置一个div 撑开到顶部距离 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"status_bar"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"'height: '+ tophight.top + 'px;'"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引用子组件   且给子组件传递 tophight 子组件里设置高度<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>top <span class="token operator">:</span>tophight<span class="token operator">=</span><span class="token string">"tophight"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>top<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> Top <span class="token keyword">from</span> <span class="token string">'./sonzhujian/top.vue'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>components<span class="token operator">:</span><span class="token punctuation">{</span>Top<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>tophight<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 胶囊按钮的数据</span>showAbs<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//控制箭头按钮显示/隐藏</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 获取胶囊按钮的数据  m包含胶囊按钮的所有信息</span><span class="token keyword">this</span><span class="token punctuation">.</span>tophight <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getMenuButtonBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span>page<span class="token punctuation">{</span>background<span class="token operator">:</span> #f2f2f2<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>header<span class="token operator">-</span>fixed<span class="token punctuation">{</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>backyes<span class="token punctuation">{</span>background<span class="token operator">:</span> #f8f8f8<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>backno<span class="token punctuation">{</span>background<span class="token operator">:</span> none<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>status_bar <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token comment">/* background: #007AFF; */</span><span class="token punctuation">}</span><span class="token punctuation">.</span>navs<span class="token operator">-</span>image image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">28</span>px<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">28</span>px<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>navs<span class="token operator">-</span>image<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span> padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* banner部分 */</span><span class="token punctuation">.</span>imageurl <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">700</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span>swiper <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">700</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>swiper<span class="token operator">-</span>video<span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">700</span>upx<span class="token punctuation">;</span> background<span class="token operator">:</span> #<span class="token number">4</span>CD964<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>swiper<span class="token operator">-</span>video video<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">700</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 自定义按钮 */</span><span class="token punctuation">.</span>video<span class="token operator">-</span>img image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span> z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">999</span><span class="token punctuation">;</span>border<span class="token operator">:</span> <span class="token number">2</span>px solid #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>video<span class="token operator">-</span>img<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>position<span class="token operator">:</span> absolute<span class="token punctuation">;</span> bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span>transform<span class="token operator">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">)</span> <span class="token function">translateY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>video<span class="token operator">-</span>btn<span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">700</span>upx<span class="token punctuation">;</span> position<span class="token operator">:</span> relative<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="滚动监听显示隐藏导航栏"><a href="#滚动监听显示隐藏导航栏" class="headerlink" title="滚动监听显示隐藏导航栏"></a>滚动监听显示隐藏导航栏</h4><p>首先有滚动监听的方法： onPageScroll ( )   – 监听页面滚动，参数为Object</p><p>然后有滚动的淡入淡出效果: opacity属性 </p><p>此时details.vue文件代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 返回按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"header-fixed backno"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"showAbs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 箭头符号设置的动态的高 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"status_bar"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"'height: '+ tophight.top + 'px;'"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"navs-image"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"'height: '+ tophight.height + 'px;' "</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/fanhuibai.jpg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> tab <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>子组件 默认不显示出来 同时透明度值默认是<span class="token number">0</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"header-fixed backyes"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"!showAbs"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"{opacity:styleObject}"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 放置一个div 撑开到顶部距离 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"status_bar"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"'height: '+ tophight.top + 'px;'"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引用子组件   且给子组件传递 tophight 子组件里设置高度<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>top <span class="token operator">:</span>tophight<span class="token operator">=</span><span class="token string">"tophight"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>top<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view style<span class="token operator">=</span><span class="token string">"height: 2000upx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> Top <span class="token keyword">from</span> <span class="token string">'./sonzhujian/top.vue'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>components<span class="token operator">:</span><span class="token punctuation">{</span>Top<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>tophight<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 胶囊按钮的数据</span>showAbs<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//控制箭头按钮显示/隐藏 true为显示</span>styleObject<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">//透明度</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 获取胶囊按钮的数据  m包含胶囊按钮的所有信息</span><span class="token keyword">this</span><span class="token punctuation">.</span>tophight <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getMenuButtonBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 这里的 e 就是滚动的距离</span><span class="token function">onPageScroll</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleScroll</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>scrollTop<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 导航栏的显示 接收一个参数    top是滚动的距离</span><span class="token function">handleScroll</span><span class="token punctuation">(</span><span class="token parameter">top</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 90 300 是任意随便写的 当滑动的距离大于90时</span><span class="token keyword">if</span><span class="token punctuation">(</span>top <span class="token operator">&gt;</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> opacity <span class="token operator">=</span> top <span class="token operator">/</span> <span class="token number">300</span>     <span class="token comment">// 这一步是让透明度尽量变小 </span>opacity <span class="token operator">=</span> opacity <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> opacity    <span class="token comment">// 如果透明度大于1就等于1 否则透明度就取小于1 </span><span class="token keyword">this</span><span class="token punctuation">.</span>showAbs <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment">// 控制顶部栏 的箭头按钮隐藏</span><span class="token keyword">this</span><span class="token punctuation">.</span>styleObject <span class="token operator">=</span> opacity<span class="token comment">// 透明度赋值一下</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>shhowAbs <span class="token operator">=</span> <span class="token boolean">true</span>  <span class="token comment">//小于90 即显示顶部导航栏</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="带视频和图片的轮播组件"><a href="#带视频和图片的轮播组件" class="headerlink" title="带视频和图片的轮播组件"></a>带视频和图片的轮播组件</h4><p>轮播组件其实也就是swiper组件</p><p>因为uniapp 的swiper组件 再子组件内时，带有视频的轮播不能播放视频，所以轮播还是写到父组件 <strong>details.vue</strong> 里边</p><p><strong>:show-center-play-btn = “false”</strong>  隐藏视频中间默认得播放按钮<br><strong>:controls=”false”</strong>                            隐藏左下角播放组件<br><strong>object-fit=”cover”</strong>                    当视频大小与 video 容器大小不一致时，视频的表现形式。contain：包含，fill：填充，cover：覆盖<strong>uni.createVideoContext(videoId, this)</strong>     创建并返回 video 上下文 videoContext 对象获取videodom对象</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 返回按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 子组件 tab <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>组件 默认不显示出来 同时透明度值默认是<span class="token number">0</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 图片视频宣传样例 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 注意：如果含有视频播放，在子组件里无法触发视频播放，必须要在父组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>swiper <span class="token operator">:</span>indicator<span class="token operator">-</span>dots<span class="token operator">=</span><span class="token string">"dots"</span>  <span class="token operator">:</span>interval<span class="token operator">=</span><span class="token string">"3000"</span> <span class="token operator">:</span>duration<span class="token operator">=</span><span class="token string">"1000"</span> <span class="token operator">:</span>circular<span class="token operator">=</span><span class="token string">"true"</span>indicator<span class="token operator">-</span>color<span class="token operator">=</span><span class="token string">"rgba(216, 216, 216)"</span>indicator<span class="token operator">-</span>active<span class="token operator">-</span>color<span class="token operator">=</span><span class="token string">"#7a7a7a"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>swiper<span class="token operator">-</span>item <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"swiper-video"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"video-btn"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>video id<span class="token operator">=</span><span class="token string">"myVideo"</span> src<span class="token operator">=</span><span class="token string">"http://vd2.bdstatic.com/mda-naa98nr851kwmwya/cae_h264_delogo/1641911777690304151/mda-naa98nr851kwmwya.mp4"</span><span class="token operator">:</span>show<span class="token operator">-</span>center<span class="token operator">-</span>play<span class="token operator">-</span>btn <span class="token operator">=</span> <span class="token string">"false"</span> <span class="token operator">:</span>controls<span class="token operator">=</span><span class="token string">"false"</span>object<span class="token operator">-</span>fit<span class="token operator">=</span><span class="token string">"cover"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 播放按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"video-img"</span> @click<span class="token operator">=</span><span class="token string">"videoPlay()"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/bofang.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span><span class="token operator">&lt;</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"imageurl"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>swiper<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>videoplay<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token comment">// 得到视频上下文 得到结果是对象</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 得到视频节点 (对象)</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoplay <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">createVideoContext</span><span class="token punctuation">(</span><span class="token string">'myVideo'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 手动触发视频播放</span><span class="token function">videoPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoplay<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="视频操作的一些方法"><a href="#视频操作的一些方法" class="headerlink" title="视频操作的一些方法"></a>视频操作的一些方法</h4><p><strong>在video上添加属性</strong></p><p><strong>@play</strong>=”playFun”   当开始/继续播放时触发 play事件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 视频播放时触发的方法</span><span class="token function">playFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>startVideo <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token comment">// 中间播放按钮 隐藏</span><span class="token keyword">this</span><span class="token punctuation">.</span>conting <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">//显示视频左下角播放组控件</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>@pause</strong>=”pauseFun”  当暂停播放时触发 pause 事件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 视频暂停时触发的方法</span><span class="token function">pauseFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>conting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">this</span><span class="token punctuation">.</span>startVideo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>@ended</strong>=”endedFun“   当播放到末尾时触发 ended 事件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">endedFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>conting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">this</span><span class="token punctuation">.</span>startVideo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>swiper 的滑动事件</strong></p><p> <strong>@change</strong>  current 改变时会触发 change 事件，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">@change<span class="token operator">=</span><span class="token string">"bannerfun()"</span>  <span class="token comment">//写在swiper属性中</span><span class="token comment">// 滑块滑动时触发</span><span class="token function">bannerfun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoplay<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="请求banner栏的数据"><a href="#请求banner栏的数据" class="headerlink" title="请求banner栏的数据"></a>请求banner栏的数据</h4><p>接口的添加就和之前一样定义好就不赘述了，</p><p>在mthods里定义请求的方法</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token comment">// 请求数据方法</span><span class="token keyword">async</span> <span class="token function">detRequest</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> introduce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>introduceurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 因为后期需要发起多次请求,用promise.all做一个并发请求</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>introduce<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">// 图片视频的数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>imagetext <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dataconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment">// 在onLoad里边调用请求方法 这里的参数是暂时选择的一个接口地址</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">detRequest</span><span class="token punctuation">(</span><span class="token string">'5f8bbf2823954733542169a1'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在swiper里遍历</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>swiper <span class="token operator">:</span>indicator<span class="token operator">-</span>dots<span class="token operator">=</span><span class="token string">"dots"</span>  <span class="token operator">:</span>interval<span class="token operator">=</span><span class="token string">"3000"</span> <span class="token operator">:</span>duration<span class="token operator">=</span><span class="token string">"1000"</span> <span class="token operator">:</span>circular<span class="token operator">=</span><span class="token string">"true"</span>indicator<span class="token operator">-</span>color<span class="token operator">=</span><span class="token string">"rgba(216, 216, 216)"</span>indicator<span class="token operator">-</span>active<span class="token operator">-</span>color<span class="token operator">=</span><span class="token string">"#7a7a7a"</span>@change<span class="token operator">=</span><span class="token string">"bannerfun()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(iteming,index) in imagetext[0].media"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>swiper<span class="token operator">-</span>item <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"swiper-video"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"video-btn"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>video id<span class="token operator">=</span><span class="token string">"myVideo"</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"iteming.video"</span><span class="token operator">:</span>show<span class="token operator">-</span>center<span class="token operator">-</span>play<span class="token operator">-</span>btn <span class="token operator">=</span> <span class="token string">"false"</span> <span class="token operator">:</span>controls<span class="token operator">=</span><span class="token string">"conting"</span>object<span class="token operator">-</span>fit<span class="token operator">=</span><span class="token string">"cover"</span>@play<span class="token operator">=</span><span class="token string">"playFun"</span>@pause<span class="token operator">=</span><span class="token string">"pauseFun"</span>@ended<span class="token operator">=</span><span class="token string">"endedFun"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 播放按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"video-img"</span> @click<span class="token operator">=</span><span class="token string">"videoPlay()"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"startVideo"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/bofang.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,indexing) in iteming.imgArray"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"indexing"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"imageurl"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>swiper<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对指示点的出现时机作配置，当请求到的数据里的video有数据时，不显示指示点，否则显示指示点</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 请求数据方法</span><span class="token keyword">async</span> <span class="token function">detRequest</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> introduce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>introduceurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 因为后期需要发起多次请求,用promise.all做一个并发请求</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>introduce<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">// 图片视频的数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>imagetext <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token keyword">let</span> mendata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">// 如果有视频,不显示面板指示点 先拿到数据里的video地址</span><span class="token keyword">this</span><span class="token punctuation">.</span>truevideo <span class="token operator">=</span> mendata<span class="token punctuation">.</span>media<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>video<span class="token comment">// 三元表达式 如果视频数据为空 就显示指示点 否则不显示</span><span class="token keyword">this</span><span class="token punctuation">.</span>dots <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>truevideo <span class="token operator">==</span> <span class="token string">''</span><span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时用v-if判断，当没有请求到video数据时，隐藏视频的swiper=</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 视频数据不为空 才显示视频组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>swiper<span class="token operator">-</span>item <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"swiper-video"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"iteming.video !== ''"</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>对有视频的情况，进行指示点的详细判断，在视频页面不显示指示点，图片页面显示指示点，核心思路是e.current值</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 滑块滑动时触发  这里的 e 包含了很多的数据 其中 current值等于 请求到的index值</span><span class="token function">bannerfun</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// if(e.detail.current !== 0) { //滑块滑动到图片的时候显示面板指示点 方法 1</span><span class="token comment">// this.dots = true</span><span class="token comment">// }else {</span><span class="token comment">// this.dots = false</span><span class="token comment">// }</span><span class="token keyword">let</span> inx <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>current <span class="token comment">//滑块滑动到图片的时候显示面板指示点 方法 2</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>truevideo <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoplay<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//暂停视频</span><span class="token keyword">this</span><span class="token punctuation">.</span>dots <span class="token operator">=</span> inx <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>dots <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当滑动视频时候会触发自带的 enable-progress-gesture 属性 –开启控制进度的手势 ，给它关闭掉，这样下次会继续播放之前暂停的视频。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 在video标签内</span><span class="token operator">:</span>enable<span class="token operator">-</span>progress<span class="token operator">-</span>gesture <span class="token operator">=</span> <span class="token string">"false"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="封装预览图片"><a href="#封装预览图片" class="headerlink" title="封装预览图片"></a>封装预览图片</h4><p>预览图片功能是公共的组件，因此抽出到新目录</p><p>在根目录下新建<strong>public/logic.js</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 预览图片</span><span class="token keyword">class</span> <span class="token class-name">Login</span><span class="token punctuation">{</span><span class="token comment">// index --当前图片下标     imgarr --图片地址(是数组参数)</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>imgarr</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> index<span class="token keyword">this</span><span class="token punctuation">.</span>imgarr <span class="token operator">=</span> imgarr<span class="token punctuation">}</span><span class="token comment">// 调用预览图片的方法</span><span class="token function">previewImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">previewImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>current<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">,</span>urls<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>imgarr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 导出</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> Login <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>引入到details.vue文件</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 预览图片 node导入模式</span><span class="token keyword">const</span> <span class="token punctuation">{</span> Login <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../public/logic.js'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>给图片上添加点击事情,同时实例化引入的Login，并传入参数后调用内置的previewImg方法</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"imageurl"</span> @click<span class="token operator">=</span><span class="token string">"previmg(indexing,iteming.imgArray)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token comment">//...</span><span class="token comment">// 预览图片</span><span class="token function">previmg</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>imgArray</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>imgArray<span class="token punctuation">)</span><span class="token comment">// 实例化类 ,同时传入俩参数,接着调用里边的previewImg方法</span><span class="token keyword">new</span> <span class="token class-name">Login</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>imgArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">previewImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="获取商品标题价格等数据"><a href="#获取商品标题价格等数据" class="headerlink" title="获取商品标题价格等数据"></a>获取商品标题价格等数据</h4><p>在<strong>pages/details/sonzhujian下新建price.vue</strong></p><p>接着在<strong>details.vue引入price.vue，</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格区域 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"price-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>当前价<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"price-list"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>¥<span class="token punctuation">{</span><span class="token punctuation">{</span>priceetc<span class="token punctuation">.</span>Trueprice<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"scribing"</span><span class="token operator">&gt;</span>原价¥<span class="token punctuation">{</span><span class="token punctuation">{</span>priceetc<span class="token punctuation">.</span>Crossedprice<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  淘金币抵<span class="token number">6</span><span class="token operator">%</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Discount-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>priceetc<span class="token punctuation">.</span>Goldcoin<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>priceetc<span class="token punctuation">.</span>integral<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 标题 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"price-Title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"titleing"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>priceetc<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"price-Image"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/canshu.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>参数<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 月销 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Monthly"</span><span class="token operator">&gt;</span>销量<span class="token punctuation">{</span><span class="token punctuation">{</span>priceetc<span class="token punctuation">.</span>sales_volume<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>props<span class="token operator">:</span><span class="token punctuation">{</span>priceetc<span class="token operator">:</span>Object<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>price<span class="token operator">-</span>view<span class="token punctuation">{</span><span class="token comment">/* background: #FFFFFF; */</span>background<span class="token operator">:</span>linear<span class="token operator">-</span><span class="token function">gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span>#ff0000<span class="token punctuation">,</span>#ff4000<span class="token punctuation">,</span>#ff8000<span class="token punctuation">)</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">120</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">35</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>price<span class="token operator">-</span>list<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span> line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>price<span class="token operator">-</span>list text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span> padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>price<span class="token operator">-</span>list text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span><span class="token comment">/* background: red;color: #fe0032;height: 30upx;line-height: 30upx;text-align: center;border-radius: 50upx;padding: 9upx 23upx; */</span><span class="token punctuation">}</span><span class="token punctuation">.</span>scribing<span class="token punctuation">{</span>text<span class="token operator">-</span>decoration<span class="token operator">:</span> line<span class="token operator">-</span>through<span class="token punctuation">;</span> color<span class="token operator">:</span> #b5b5b5 <span class="token operator">!</span>important<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">7</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>textstyle text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span> <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>coupon<span class="token operator">-</span>text<span class="token punctuation">{</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span> <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 优惠券 */</span><span class="token punctuation">.</span>Discount<span class="token operator">-</span>view<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>Discount<span class="token operator">-</span>view text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">-</span>n<span class="token operator">+</span><span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>background<span class="token operator">:</span> #ffeaef<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>margin<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>Discount<span class="token operator">-</span>view text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">3</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> right<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 标题 */</span><span class="token punctuation">.</span>price<span class="token operator">-</span>Title<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">35</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>titleing<span class="token punctuation">{</span>overflow<span class="token operator">:</span> hidden<span class="token punctuation">;</span>text<span class="token operator">-</span>overflow<span class="token operator">:</span> ellipsis<span class="token punctuation">;</span>display<span class="token operator">:</span> <span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token punctuation">;</span><span class="token operator">-</span>webkit<span class="token operator">-</span>line<span class="token operator">-</span>clamp<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// 控制多行的行数</span><span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token operator">-</span>orient<span class="token operator">:</span> vertical<span class="token punctuation">;</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>price<span class="token operator">-</span>Title image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span> padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">5</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>price<span class="token operator">-</span>Image<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span> justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> flex<span class="token operator">-</span>end<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">150</span>upx<span class="token punctuation">;</span><span class="token comment">/* background: #1183E6; */</span><span class="token punctuation">}</span><span class="token comment">/* 月销 */</span><span class="token punctuation">.</span>Monthly<span class="token punctuation">{</span>background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span> color<span class="token operator">:</span> #<span class="token number">999999</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> flex<span class="token operator">-</span>end<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="兄弟组件传值请求产品参数数据"><a href="#兄弟组件传值请求产品参数数据" class="headerlink" title="兄弟组件传值请求产品参数数据"></a>兄弟组件传值请求产品参数数据</h4><p>在<strong>pages/details/sonzhujian下新建parame.vue</strong></p><p>接着在<strong>details.vue引入parame.vue，</strong>同时引入写好的公共样式文件夹pattern，并在main.js中引入</p><p><strong>功能需求：</strong>price.vue组件中点击参数后，parame.vue组件显示产品参数页面</p><p><strong>思路：</strong></p><p>默认使用v-if 隐藏</p><p>然后兄弟组件间传值  –使用bus总线传值</p><p>public文件夹下新建文件bus.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// vue 的总线传值</span><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后在main.js中引入</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// bus传值</span><span class="token keyword">import</span> bus <span class="token keyword">from</span> <span class="token string">'./public/bus.js'</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus <span class="token operator">=</span> bus<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在要发送数据的组件里使用全局事件总线：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 兄弟组件传值显示产品参数</span><span class="token function">parameFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// $emit() 传值  第一个值是要调用组件的名称可以随意命名  第二个值是要传递的参数</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'parames'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>show<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在要用到数据的组件里接收：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 接收 $on</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'parames'</span><span class="token punctuation">,</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 让键值对的键相对应</span><span class="token keyword">this</span><span class="token punctuation">.</span>couponif <span class="token operator">=</span> res<span class="token punctuation">.</span>show<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在price.vue组件的点击参数事件中，添加请求方法，并通过全局总线传递给兄弟组件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> priceetc<span class="token punctuation">.</span>id <span class="token operator">--</span> 通过父组件details<span class="token punctuation">.</span>vue传递过来的priceetc<span class="token punctuation">.</span>id 值作为本组件发起请求的id参数 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"price-Image"</span> @click<span class="token operator">=</span><span class="token string">"parameFun(priceetc.id)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/canshu.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>参数<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 兄弟组件传值显示产品参数</span><span class="token keyword">async</span> <span class="token function">parameFun</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> parameter <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parameterurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// $emit() 传值  第一个值是要调用组件的名称可以随意命名  第二个值是要传递的参数</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'parames'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>show<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>data<span class="token operator">:</span>parameter<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>子组件代码如下：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"couponif"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 遮罩层 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> catchtouchmove 防止穿透点击下方的事件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Coupon-yin anim"</span> <span class="token operator">:</span>catchtouchmove<span class="token operator">=</span><span class="token string">"true"</span> @click<span class="token operator">=</span><span class="token string">"hideCou()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Coupon-view coup-anim"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Coupon-title"</span><span class="token operator">&gt;</span>产品参数<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in paramedata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"parame-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"parame-left"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"parame-right"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>label<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>couponif<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 隐藏组件的数据</span>paramedata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// 接收所有产品参数的数据</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 接收 $on 兄弟组件数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'parames'</span><span class="token punctuation">,</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 让键值对的键相对应</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">{</span>show<span class="token punctuation">,</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token keyword">this</span><span class="token punctuation">.</span>paramedata <span class="token operator">=</span> data<span class="token keyword">this</span><span class="token punctuation">.</span>couponif <span class="token operator">=</span> show<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 隐藏该组件</span><span class="token function">hideCou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>couponif <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>parame<span class="token operator">-</span>view<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>rpx<span class="token punctuation">;</span> display<span class="token operator">:</span> flex<span class="token punctuation">;</span> border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">1</span>px solid #<span class="token constant">F0F0F0</span><span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> flex<span class="token operator">-</span>start<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">25</span>rpx <span class="token number">15</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>parame<span class="token operator">-</span>left<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>parame<span class="token operator">-</span>right<span class="token punctuation">{</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="获取商品评价数据"><a href="#获取商品评价数据" class="headerlink" title="获取商品评价数据"></a>获取商品评价数据</h4><p>在<strong>pages/details/sonzhujian下新建evaluate.vue</strong></p><p>接着在<strong>details.vue引入evaluate.vue，</strong>引入css样式</p><p>在添加请求商品评价数据的方法，通过ref传递给子组件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品评价 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>evaluate <span class="token operator">:</span>comment<span class="token operator">=</span><span class="token string">"comment"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>evaluate<span class="token operator">&gt;</span><span class="token comment">// 请求数据方法</span><span class="token keyword">async</span> <span class="token function">detRequest</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 商品评价的数据</span><span class="token keyword">let</span> wxcommnt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>wxcommnturl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 因为后期需要发起多次请求,用promise.all做一个并发请求</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>introduce<span class="token punctuation">,</span>wxcommnt<span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 拿到评价数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>comment <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>子组件evaluate.vue代码如下</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 当返回的评价数据大于<span class="token number">0</span>条才展示此组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"evaluate-view"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"comment[0].commlen &gt; 0"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 第一排 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"evaluate-top"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token function">商品评价</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span>comment<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>commlen<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"evaluate-rig"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>查看全部<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/quanbu.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 评论的标签  <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果评价标签数据数组的长度大于<span class="token number">0</span>才展示数据 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"evaluate-class"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"comment[0].commtag.length &gt; 0"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in comment[0].commtag"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>label<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>num<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 评价内容 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"evaluate-User"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in comment[0].parcontent"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"USering"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.avatarUrl"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>nickName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"USering-text"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"USering-time"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>time<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>颜色<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>尺码<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> <span class="token comment">// 接收父组件的数据</span>props<span class="token operator">:</span> <span class="token punctuation">{</span>comment<span class="token operator">:</span>Array<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span>view<span class="token punctuation">{</span>background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span>top<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token comment">/* background: #4CD964; */</span><span class="token punctuation">}</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span>rig image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">27</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">27</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span>rig<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 分类 */</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span><span class="token keyword">class</span><span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span> display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">15</span>upx <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span><span class="token keyword">class</span> <span class="token class-name">text</span><span class="token punctuation">{</span>background<span class="token operator">:</span> #feecea<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">0</span>upx <span class="token number">14</span>upx <span class="token number">14</span>upx <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 用户评价 */</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span>User<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span> color<span class="token operator">:</span> #<span class="token number">999999</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span>User image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">50</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>USering<span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span> <span class="token comment">/* background: #007AFF; */</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>USering text<span class="token punctuation">{</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>USering<span class="token operator">-</span>text<span class="token punctuation">{</span>color<span class="token operator">:</span> #<span class="token number">333333</span><span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span>overflow<span class="token operator">:</span> hidden<span class="token punctuation">;</span>text<span class="token operator">-</span>overflow<span class="token operator">:</span> ellipsis<span class="token punctuation">;</span>display<span class="token operator">:</span> <span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token punctuation">;</span><span class="token operator">-</span>webkit<span class="token operator">-</span>line<span class="token operator">-</span>clamp<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// 控制多行的行数</span><span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token operator">-</span>orient<span class="token operator">:</span> vertical<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>USering<span class="token operator">-</span>time<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>USering<span class="token operator">-</span>time text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="请求商品详情图片介绍数据"><a href="#请求商品详情图片介绍数据" class="headerlink" title="请求商品详情图片介绍数据"></a>请求商品详情图片介绍数据</h4><p>数据在datails中已经取到，是priceetc:{} 数据里</p><p>在<strong>pages/details/sonzhujian下新建produce.vue</strong>，在父组件引入</p><p>同时父组件将priceetc通过ref传递给<strong>produce.vue</strong></p><p>其中图片是应该点击能够预览，可以使用之前封装的 <strong>logic.js</strong></p><pre><code>// 预览图片 node导入模式const { Login } = require('../../public/logic.js')</code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Product-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in priceetc.Detaileddrawing"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> @click<span class="token operator">=</span><span class="token string">"previmg(index,priceetc.Detaileddrawing)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 预览图片 node导入模式</span><span class="token keyword">const</span> <span class="token punctuation">{</span> Login <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../../public/logic.js'</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>props<span class="token operator">:</span><span class="token punctuation">{</span>priceetc<span class="token operator">:</span>Object<span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 参数1 --当前图片下标     参数2 --图片地址(所有图片的数组)</span><span class="token function">previmg</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>imgArray</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Login</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>imgArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">previewImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>Product<span class="token operator">-</span>view<span class="token punctuation">{</span>margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span> padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>Product<span class="token operator">-</span>view image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span> vertical<span class="token operator">-</span>align<span class="token operator">:</span> bottom<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="商品所有的评价"><a href="#商品所有的评价" class="headerlink" title="商品所有的评价"></a>商品所有的评价</h4><p>在pages下<strong>新建comments文件夹</strong>，同时在其下 <strong>新建comments.vue,</strong></p><p>为了便于观察，可以在page.json中先将comments.vue,放到第一位</p><p>开始写comments.vue组件内容</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 评价分类的标签 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果评价标签的数据长度大于<span class="token number">0</span><span class="token punctuation">,</span>就表示有数据<span class="token punctuation">,</span>才显示标签 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"evaluate-class"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"labeldata.length &gt; 0"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item, index) in labeldata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果评价标签数据中的num值为空代表是<span class="token string">'全部'</span>标签<span class="token punctuation">,</span>就不展条数 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.num == ''"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>label <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>label <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>num <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 完整的评价内容 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in commdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-user"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-top comments-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.avatarUrl"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 用户头像 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>nickName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 用户昵称 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-zh comments-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>time<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>颜色分类<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>尺码<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-mes"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果 item<span class="token punctuation">.</span>isimg 中有数据<span class="token punctuation">,</span>就显示图片 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-img"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.isimg"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(items,indexs) in item.image"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"indexs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 评论图片   有没有数据 取决于isimg的布尔值 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"user-images"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"items"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 选中第几个</span>labeldata<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>commdata<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token function">reqComm</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> comtag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>comtagurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//评价分类标签数据</span><span class="token keyword">let</span> comtconent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>comtconenturl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">'&amp;label='</span> <span class="token operator">+</span> <span class="token string">'全部'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//评价的内容数据</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>comtag<span class="token punctuation">,</span> comtconent<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 标签数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>labeldata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span><span class="token comment">// 评价数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reqComm</span><span class="token punctuation">(</span><span class="token string">'5f8bbf2823954733542169a1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>view <span class="token punctuation">{</span>margin<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 分类 */</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span><span class="token keyword">class</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span>padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">1</span>px solid #eeeeee<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span><span class="token keyword">class</span> <span class="token class-name">text</span> <span class="token punctuation">{</span>background<span class="token operator">:</span> #feecea<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">0</span>upx <span class="token number">14</span>upx <span class="token number">14</span>upx <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 选中*/</span><span class="token punctuation">.</span>actives <span class="token punctuation">{</span>background<span class="token operator">:</span> #ff0036 <span class="token operator">!</span>important<span class="token punctuation">;</span>color<span class="token operator">:</span> #fff <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* user评价 */</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>user <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">1</span>px solid #eeeeee<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">25</span>upx <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>flex <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>top image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">60</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>top text <span class="token punctuation">{</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>zh <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #a7a7a7<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>zh text <span class="token punctuation">{</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>mes <span class="token punctuation">{</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">1.5</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>top <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>img <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>user<span class="token operator">-</span>images <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">33.33</span><span class="token operator">%</span> <span class="token operator">-</span> <span class="token number">10</span>rpx <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">200</span>rpx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>user<span class="token operator">-</span>images image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">200</span>rpx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">2</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="完成商品分类查询评价"><a href="#完成商品分类查询评价" class="headerlink" title="完成商品分类查询评价"></a>完成商品分类查询评价</h4><p>先完成图片预览功能</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"items"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span> @click<span class="token operator">=</span><span class="token string">"preTmage(indexs,item.image)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token comment">// 预览图片 node导入模式</span><span class="token keyword">const</span> <span class="token punctuation">{</span> Login <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../public/logic.js'</span><span class="token punctuation">)</span><span class="token comment">// 阅览图片方法</span><span class="token function">preTmage</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>imgArray</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Login</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>imgArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">previewImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后完成点击标签变色，且展示相关评论功能，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 评价分类的标签 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果评价标签的数据长度大于<span class="token number">0</span><span class="token punctuation">,</span>就表示有数据<span class="token punctuation">,</span>才显示标签 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"evaluate-class"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"labeldata.length &gt; 0"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item, index) in labeldata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果评价标签数据中的num值为空代表是<span class="token string">'全部'</span>标签<span class="token punctuation">,</span>就不展示条数 <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 添加动态的<span class="token keyword">class</span> 当num等于下标值时触发<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.num == ''"</span> <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{ actives: num == index }"</span> @click<span class="token operator">=</span><span class="token string">"labelFun(item.commid,item.label,index)"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>label <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">else</span> <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{ actives: num == index }"</span> @click<span class="token operator">=</span><span class="token string">"labelFun(item.commid,item.label,index)"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>label <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>num <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 完整的评价内容 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item, index) in commdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-user"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-top comments-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.avatarUrl"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 用户头像 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>nickName <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 用户昵称 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-zh comments-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>time <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>颜色分类<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>color <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>尺码<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>size <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-mes"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>text <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果 item<span class="token punctuation">.</span>isimg 中有数据<span class="token punctuation">,</span>就显示图片 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comments-img"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.isimg"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(items, indexs) in item.image"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"indexs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 评论图片   有没有数据 取决于isimg的布尔值 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"user-images"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"items"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span> @click<span class="token operator">=</span><span class="token string">"preTmage(indexs, item.image)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 预览图片 node导入模式</span><span class="token keyword">const</span> <span class="token punctuation">{</span> Login <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../public/logic.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 选中第几个</span>num<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>labeldata<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 标签数据</span>commdata<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// 评价数据</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token function">reqComm</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> comtag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>comtagurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//评价分类标签数据</span><span class="token keyword">let</span> comtconent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>comtconenturl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">'&amp;label='</span> <span class="token operator">+</span> <span class="token string">'全部'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//评价的内容数据</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>comtag<span class="token punctuation">,</span> comtconent<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 标签数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>labeldata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span><span class="token comment">// 评价数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 预览览图片方法</span><span class="token function">preTmage</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> imgArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Login</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> imgArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">previewImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 点击标签切换的方法</span><span class="token keyword">async</span> <span class="token function">labelFun</span><span class="token punctuation">(</span><span class="token parameter">commid<span class="token punctuation">,</span>label<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> index<span class="token comment">// 请求分类标签的接口</span><span class="token keyword">let</span> comtconent1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>comtconenturl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> commid <span class="token operator">+</span> <span class="token string">'&amp;label='</span> <span class="token operator">+</span> label<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> comtconent1<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// onLoad生命周期可以接收上个页面过来的值  e就包含接收的数据</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reqComm</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>view <span class="token punctuation">{</span>margin<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 分类 */</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span><span class="token keyword">class</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span>padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">1</span>px solid #eeeeee<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>evaluate<span class="token operator">-</span><span class="token keyword">class</span> <span class="token class-name">text</span> <span class="token punctuation">{</span>background<span class="token operator">:</span> #feecea<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">0</span>upx <span class="token number">14</span>upx <span class="token number">14</span>upx <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 选中*/</span><span class="token punctuation">.</span>actives <span class="token punctuation">{</span>background<span class="token operator">:</span> #ff0036 <span class="token operator">!</span>important<span class="token punctuation">;</span>color<span class="token operator">:</span> #fff <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* user评价 */</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>user <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">1</span>px solid #eeeeee<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">25</span>upx <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>flex <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>top image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">60</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>top text <span class="token punctuation">{</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>zh <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #a7a7a7<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>zh text <span class="token punctuation">{</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>mes <span class="token punctuation">{</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">1.5</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>top <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>comments<span class="token operator">-</span>img <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>user<span class="token operator">-</span>images <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">33.33</span><span class="token operator">%</span> <span class="token operator">-</span> <span class="token number">10</span>rpx <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">200</span>rpx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>user<span class="token operator">-</span>images image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">200</span>rpx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">2</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后完成点击evaluate.vue组件的查看全部，携带id跳转到当前商品的评价页面功能</p><p>先给evaluate添加点击事件并且拿到评价数据中携带的商品id，然后使用uni.navigateTo跳转到comments页面</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"evaluate-rig"</span> @click<span class="token operator">=</span><span class="token string">"commEnts(comment[0].parcontent[0].commid)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>查看全部<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/quanbu.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 跳转到评论详情</span><span class="token function">commEnts</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../comments/comments?id='</span> <span class="token operator">+</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>comments组件接收值，然后调用请求接口的方法</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// onLoad生命周期可以接收上个页面过来的值  e就包含接收的数据</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reqComm</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="锚点链接将页面滚动到目标位置"><a href="#锚点链接将页面滚动到目标位置" class="headerlink" title="锚点链接将页面滚动到目标位置"></a>锚点链接将页面滚动到目标位置</h4><p><strong>uni.pageScrollTo(OBJECT)</strong>  –将页面滚动到目标位置</p><p>在top.vue文件中，通过$parent调用父组件的方法，同时传递参数index过去</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 控制短横线跳转位置</span><span class="token function">navbtn</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> index<span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 跳转到页面顶部</span>uni<span class="token punctuation">.</span><span class="token function">pageScrollTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>scrollTop<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>duration<span class="token operator">:</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span><span class="token function">fathEr</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>父组件中给节点添加 class属性，即可使用uni.pageScrollTo的方法去跳转到该节点</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品评价 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>evaluate <span class="token operator">:</span>comment<span class="token operator">=</span><span class="token string">"comment"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"evaluate"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>evaluate<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>product <span class="token operator">:</span>priceetc<span class="token operator">=</span><span class="token string">"priceetc"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"produce"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>product<span class="token operator">&gt;</span><span class="token comment">// 被 子组件top 用来锚点链接</span><span class="token function">fathEr</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> clsdata <span class="token operator">=</span> index <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">'.evaluate'</span> <span class="token operator">:</span> <span class="token string">'.produce'</span>uni<span class="token punctuation">.</span><span class="token function">pageScrollTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>selector<span class="token operator">:</span>clsdata<span class="token punctuation">,</span>duration<span class="token operator">:</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时发现因为之前固定了导航栏，所以滑动到评价或者详情区域，被胶囊按钮的高度和它到顶部的距离之和盖住了一部分</p><p>如下代码导致：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 子组件 tab <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>组件 默认不显示出来 同时透明度值默认是<span class="token number">0</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"header-fixed backyes"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"!showAbs"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"{opacity:styleObject}"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 放置一个div 撑开到顶部距离 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"status_bar"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"'height: '+ tophight.top + 'px;'"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引用子组件   且给子组件传递 tophight 子组件里设置高度<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>top <span class="token operator">:</span>tophight<span class="token operator">=</span><span class="token string">"tophight"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>top<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>解决方法：减去顶部被盖住的距离</p><p><strong>思路：不使用uniapp的方法，使用微信小程序的一个方法</strong></p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.html">SelectorQuery</a> wx.createSelectorQuery()</p><p>功能描述：</p><p>返回一个 SelectorQuery 对象实例。在自定义组件或包含自定义组件的页面中，应使用 <code>this.createSelectorQuery()</code> 来代替。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> query <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#the-id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>query<span class="token punctuation">.</span><span class="token function">selectViewport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>top       <span class="token comment">// #the-id节点的上边界坐标</span>  res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scrollTop <span class="token comment">// 显示区域的竖直滚动位置</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 被子组件top 用来锚点链接</span><span class="token function">fathEr</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> clsdata <span class="token operator">=</span> index <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">'.evaluate'</span> <span class="token operator">:</span> <span class="token string">'.produce'</span><span class="token punctuation">;</span><span class="token keyword">let</span> he <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tophight<span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tophight<span class="token punctuation">.</span>height<span class="token punctuation">;</span> <span class="token comment">//胶囊按钮到顶部距离 + 自身高度</span><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>clsdata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>query<span class="token punctuation">.</span><span class="token function">selectViewport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// res[0].top       // clsdata节点到上边界的距离 节点的上边界坐标</span><span class="token comment">// res[1].scrollTop // 往下滑动屏幕后,到节点的距离   显示区域的竖直滚动位置</span><span class="token comment">// 跳转</span>uni<span class="token punctuation">.</span><span class="token function">pageScrollTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>scrollTop<span class="token operator">:</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>top <span class="token operator">+</span> res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scrollTop <span class="token operator">-</span> he<span class="token punctuation">,</span>duration<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>添加功能：当和滑动到目标位置时，顶部的导航栏自动选中对应的tab</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** 定义mutations事件类型：函数名称port const ADDCOUNT = </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="商品详情页下方的功能组件"><a href="#商品详情页下方的功能组件" class="headerlink" title="商品详情页下方的功能组件"></a>商品详情页下方的功能组件</h4><p>pages/details/sonzhujian/新建shopping.vue</p><p><strong>静态布局如下：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping-text"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/fenxiang.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>分享<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping-text middle"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/gouwuche.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>购物车<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token number">10</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 未收藏 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping-text"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/shoucang.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>收藏<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 已收藏 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping-text"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/yishoucang.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>已收藏<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"join join-right"</span><span class="token operator">&gt;</span>加入购物车<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"join join-left"</span><span class="token operator">&gt;</span>立即购买<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录弹窗 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>shopping<span class="token operator">-</span>view image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">35</span>rpx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">35</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopping<span class="token operator">-</span>view <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>border<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">1</span>rpx solid #cccccc<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>join <span class="token punctuation">{</span>flex<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> white<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopping<span class="token operator">-</span>text <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopping<span class="token operator">-</span>text text <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">23</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">5</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">666666</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>join<span class="token operator">-</span>right <span class="token punctuation">{</span>background<span class="token operator">:</span> linear<span class="token operator">-</span><span class="token function">gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> #ffc800 <span class="token number">10</span><span class="token operator">%</span><span class="token punctuation">,</span> #ff9602 <span class="token number">80</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>border<span class="token operator">-</span>top<span class="token operator">-</span>left<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">-</span>left<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>join<span class="token operator">-</span>left <span class="token punctuation">{</span>background<span class="token operator">:</span> linear<span class="token operator">-</span><span class="token function">gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> #ff7500 <span class="token number">10</span><span class="token operator">%</span><span class="token punctuation">,</span> #ff4b00 <span class="token number">80</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>border<span class="token operator">-</span>top<span class="token operator">-</span>right<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">-</span>right<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>margin<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>middle <span class="token punctuation">{</span>border<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f4f4f4<span class="token punctuation">;</span>border<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f4f4f4<span class="token punctuation">;</span>position<span class="token operator">:</span> relative<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>middle text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">16</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #fe0036<span class="token punctuation">;</span>color<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">!</span>important<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>position<span class="token operator">:</span> absolute<span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="收藏和取消收藏功能"><a href="#收藏和取消收藏功能" class="headerlink" title="收藏和取消收藏功能"></a>收藏和取消收藏功能</h5><p>点击收藏后，发起请求</p><p>所以这个接口是有权限的，因为一般收藏需要用户<strong>登录了才能操作</strong>，收藏只属于自己，不属于别人。（权限接口，需携带token）</p><p>根据请求的返回值，来显示或者隐藏 组件</p><p>在<strong>shopping组件</strong>中要写俩对应不同的图标情况</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 未收藏 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 根据接口文档 id为<span class="token number">1</span> 是收藏 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping-text"</span> @click<span class="token operator">=</span><span class="token string">"collEct(1)"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"collects == 0"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/shoucang.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>收藏<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 已收藏 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 根据接口文档 id为<span class="token number">2</span> 是取消收藏 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping-text"</span> @click<span class="token operator">=</span><span class="token string">"collEct(0)"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"collects == 1"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/yishoucang.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>已收藏<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在<strong>details.vue</strong>中拿到商品id</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 商品id</span><span class="token keyword">this</span><span class="token punctuation">.</span>goodid <span class="token operator">=</span> mendata<span class="token punctuation">.</span>id通过ref传递给子组件props<span class="token operator">:</span><span class="token punctuation">{</span>goodid<span class="token operator">:</span>String<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 未收藏 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 子组件将接收到的goodid 当作第二个data参数填入 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping-text"</span> @click<span class="token operator">=</span><span class="token string">"collEct(1,goodid)"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"collects == 0"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/shoucang.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>收藏<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 已收藏 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 根据接口文档 id为<span class="token number">2</span> 是取消收藏 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping-text"</span> @click<span class="token operator">=</span><span class="token string">"collEct(0,goodid)"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"collects == 1"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/yishoucang.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>已收藏<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在点击事件中发起<strong>post请求</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 收藏和取消收藏</span><span class="token keyword">async</span> <span class="token function">collEct</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span>id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> num<span class="token operator">:</span>num<span class="token punctuation">,</span>id<span class="token operator">:</span>id <span class="token punctuation">}</span>  <span class="token comment">// 等于 { num,id }</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// this.Urls.m().enshrineurl 代表url , data 代表携带的参数 data</span><span class="token keyword">let</span> enshrine <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enshrineurl<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>enshrine<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">{</span> errrcode <span class="token punctuation">}</span> <span class="token operator">=</span> enshrine<span class="token punctuation">.</span>msg<span class="token keyword">if</span><span class="token punctuation">(</span>errrcode <span class="token operator">==</span> <span class="token string">'401'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 要登录</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时<strong>点击收藏会返回401，没有权限，即没有登录的时候，后端不知道是谁在操作收藏会阻止。</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** 定义mutations事件类型：函数名称port const ADDCOUNT = </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="登录弹窗以及微信小程序登录"><a href="#登录弹窗以及微信小程序登录" class="headerlink" title="登录弹窗以及微信小程序登录"></a>登录弹窗以及微信小程序登录</h5><p>当点击收藏后，弹出登录弹窗，登陆后刷新页面</p><h6 id="登录弹窗"><a href="#登录弹窗" class="headerlink" title="登录弹窗"></a>登录弹窗</h6><p>功能在很多页面都要用到，因此抽出做一个公用的组件</p><p>在pages/commponents/新建showmodal.vue,并<strong>注册到main.js</strong>，同时在shopping组件中引入showmodal组件</p><p><strong>showmodal.vue 布局如下：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"showmodel anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"modeling"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"showmodel-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"showmodel-tips"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>请登录后在操作<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"showmodel-button"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>button plain<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">&gt;</span>取消<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 小程序中只有button触发登录 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>button plain<span class="token operator">=</span><span class="token string">"true"</span> open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"getUserInfo"</span> @click<span class="token operator">=</span><span class="token string">"getUserInfo()"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 默认隐藏的数据</span>modeling<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>modeling <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>showmodel<span class="token punctuation">{</span>background<span class="token operator">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">999</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>showmodel<span class="token operator">-</span>view<span class="token punctuation">{</span>background<span class="token operator">:</span> white<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">90</span>rpx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">280</span>rpx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>position<span class="token operator">:</span> relative<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>showmodel<span class="token operator">-</span>tips<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">190</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>showmodel<span class="token operator">-</span>tips text<span class="token punctuation">{</span>display<span class="token operator">:</span> block<span class="token punctuation">;</span> text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span> font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">32</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>showmodel<span class="token operator">-</span>button<span class="token punctuation">{</span>border<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">0.5</span>rpx solid #<span class="token constant">FEECEA</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>position<span class="token operator">:</span> absolute<span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>showmodel<span class="token operator">-</span>button button<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">32</span>rpx<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>border<span class="token operator">:</span> none<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">!</span>important<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> inherit<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>showmodel<span class="token operator">-</span>button button<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>border<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">0.5</span>rpx solid #<span class="token constant">FEECEA</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>showmodel<span class="token operator">-</span>button button<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>color<span class="token operator">:</span> #ff6699<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后 注册到main.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 注册到main.js</span><span class="token comment">// 引入登录弹窗组件</span><span class="token keyword">import</span> showmodal <span class="token keyword">from</span> <span class="token string">'pages/commponents/showmodal.vue'</span>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'showmodal'</span><span class="token punctuation">,</span>showmodal<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//在 shopping组件中引入showmodal组件</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用 全局引入的登录弹窗 组件<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>showmodal<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>showmodal<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>showmodal.vue中，默认隐藏组件</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"showmodel anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"modeling"</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>当有登录请求的时候显示</strong>，即当点击 shopping组件中收藏时，后端返回401检测到没有登录时候，在shopping组件中去操控子组件showmodal的v-if属性</p><p>思路：<strong>父子组件传值，refs</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用 全局引入的登录弹窗 组件<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>showmodal ref<span class="token operator">=</span><span class="token string">"show"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>showmodal<span class="token operator">&gt;</span><span class="token comment">// 请求的时候如果返回值是401 就展示弹窗组件 （通过ref调用子组件里的方法）</span><span class="token keyword">if</span><span class="token punctuation">(</span>errcode <span class="token operator">==</span> <span class="token string">'401'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 要登录</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>show<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="登录逻辑"><a href="#登录逻辑" class="headerlink" title="登录逻辑"></a><strong>登录逻辑</strong></h6><p>思路：</p><p>封装发起登录的请求方法：</p><p><strong>新建login/login.js</strong></p><ol><li><p><strong>引入请求接口、请求方法、弹框类</strong></p></li><li><p>新建wxLogin类， 接收俩参数，user和msg，在类中封装wxlogin( )方法 和 loGin( )方法</p></li><li><p>wxlogin方法获取登录请求要携带的五个参数：</p><p>1）首先将user对象 解构出微信头像、微信昵称。</p><p>2）然后返回一个promise实例对象，执行 **wx.login(Object object)**，调用接口获取登录凭证（code）。通过凭证进而换取用户登录态信息，包括用户在当前小程序的唯一标识（openid）、微信开放平台帐号下的唯一标识（unionid，若当前小程序已绑定到微信开放平台帐号）及本次登录的会话密钥（session_key）等。用户数据的加解密通讯需要依赖会话密钥完成。</p><p>将五个数据赋值给了data中，<strong>返回的成功值取到data 将会return出去</strong></p></li><li><p>loGin( )方法中：</p><p>1）首先判断constructor构造函数的第二个参数msg，是否值为”getUserProfile:ok”，如果不是就抛出错误(‘登录失败’)， <strong>//抛出错误,阻止代码允许</strong></p><p>2）接着获取code，即调用wxlogin()方法结果赋值给userdata，此时userdata包含了所有的参数，记得添加await和async拿到返回值</p><p>3）然后再try，catch中调用后台的微信接口返回结果给user，添加刚才得到的userdata作为请求的data参数</p><p>4）判断user中msg值是否为 SUCCESS，如果是就 执行 **uni.setStorageSync(KEY,DATA) **</p><p>将 data 存储在本地缓存中指定的 key 中，会覆盖掉原来该 key 对应的内容，这是一个同步接口。</p><p><strong>//即存储用户信息到本地缓存</strong></p></li></ol><p>​        5）然后调用 弹窗 中的showtoast方法，显示登录成功</p><p>​        6）最后返回 <strong>return(‘SUCCESS’)</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 微信登录</span><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'../api/api.js'</span> <span class="token comment">// 引入请求接口</span><span class="token keyword">import</span> urls <span class="token keyword">from</span> <span class="token string">'../api/request.js'</span><span class="token comment">// 引入请求方法</span><span class="token keyword">import</span> toast <span class="token keyword">from</span> <span class="token string">'../public/toast.js'</span><span class="token comment">// 引入弹框类</span><span class="token keyword">class</span> <span class="token class-name">wxLogin</span> <span class="token punctuation">{</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span>msg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">}</span><span class="token comment">// 调用接口登录,async其实是返回一个promise</span><span class="token keyword">async</span> <span class="token function">loGin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 拒绝登录 即登陆失败</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">!==</span> <span class="token string">"getUserInfo:ok"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拒绝登录'</span><span class="token punctuation">)</span><span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token string">'登录失败'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment">// 获取code</span><span class="token keyword">let</span> userdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wxlogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">request</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>wxloginurl<span class="token punctuation">,</span>userdata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'wxuser'</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//存储用户信息到本地缓存</span><span class="token keyword">new</span> <span class="token class-name">toast</span><span class="token punctuation">(</span><span class="token string">'登录成功'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token comment">// 500,501,502,</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 获取code</span><span class="token function">wxlogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> <span class="token punctuation">{</span>avatarUrl<span class="token punctuation">,</span>nickName<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">//wx404e88f75f32c85b</span>appid<span class="token operator">:</span><span class="token string">'wx404e88f75f32c85b'</span><span class="token punctuation">,</span>secret<span class="token operator">:</span><span class="token string">'0402d0b4b834bf9449b2477115a2e25f'</span><span class="token punctuation">,</span>nickName<span class="token punctuation">,</span>avatarUrl<span class="token punctuation">,</span>code<span class="token operator">:</span>res<span class="token punctuation">.</span>code<span class="token punctuation">}</span><span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'登录失败'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> wxLogin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="收藏按钮逻辑"><a href="#收藏按钮逻辑" class="headerlink" title="收藏按钮逻辑"></a>收藏按钮逻辑</h6><p><strong>点击收藏按钮后 getUserInfo() 执行思路：</strong></p><ol><li><p>点击确定 会隐藏 showmodel组件</p></li><li><p>实例化 <strong>Toast</strong> 类，并传递 title值，同时实例调用 **showloading()**方法，内部 **uni.showLoading **方法生效即显示loading提示框，展示提示文字title值，并且使用mask显示透明蒙层防止触摸穿透</p></li><li><p>获取用户信息 –<strong>wx.getUserProfile</strong>，获取用户头像昵称等。当点击拒绝，可以在err回调中查看errMsg，当点击允许后调用res回调，回调中res能够拿到err数据中的包含用户头像和昵称的信息<strong>userInfo</strong>和 代表成功值的<strong>errMsg信息</strong>，</p></li><li><p>然后调用<strong>wxusEr（）</strong>，即调用前边写在<strong>login.js</strong>里的登录请求方法，成功后存储用户头像、昵称和token值到本地，然后调用其他弹窗组件**showtoast()**，显示登录成功后自动隐藏。</p></li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 登录</span><span class="token keyword">async</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>modeling <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'登录中'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">/*wx.getUserProfile 获取用户信息。页面产生点击事件后才可调用，每次请求都会弹出授权窗口，用户同意后返回userInfo。该接口用于替换 wx.getUserInfo， */</span>wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>desc<span class="token operator">:</span> <span class="token string">'登录'</span> <span class="token comment">//声明获取用户个人信息后的用途，不超过30个字符</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>            <span class="token keyword">let</span> <span class="token punctuation">{</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wxusEr</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拒绝登录或登录失败'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 调用登录</span><span class="token keyword">async</span> <span class="token function">wxusEr</span><span class="token punctuation">(</span><span class="token parameter">userInfo<span class="token punctuation">,</span>errMsg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">wxLogin</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loGin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'coll'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 更新收藏状态</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'collict'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>colldata<span class="token operator">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="封装消息提示框"><a href="#封装消息提示框" class="headerlink" title="封装消息提示框"></a>封装消息提示框</h5><p>微信弹窗已经弃用</p><p>现在准备一个登录时候的弹窗反馈：使用微信小程序（uni）自带的uni.showToast</p><p><strong>新建public/toast.js</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 一些弹窗</span><span class="token keyword">class</span> <span class="token class-name">Toast</span><span class="token punctuation">{</span><span class="token comment">// titleString提示的内容，长度与 icon 取值有关</span><span class="token comment">// iconString图标</span><span class="token comment">// durationNumber提示的延迟时间，单位毫秒，默认：1500</span><span class="token comment">// maskBoolean是否显示透明蒙层，防止触摸穿透，默认：false</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">title<span class="token punctuation">,</span>icon<span class="token punctuation">,</span>duration<span class="token operator">=</span><span class="token number">1300</span><span class="token punctuation">,</span>mask<span class="token operator">=</span><span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token keyword">this</span><span class="token punctuation">.</span>icon <span class="token operator">=</span> icon<span class="token keyword">this</span><span class="token punctuation">.</span>duration <span class="token operator">=</span> duration<span class="token keyword">this</span><span class="token punctuation">.</span>mask <span class="token operator">=</span> mask<span class="token punctuation">}</span><span class="token comment">// 消息提示框：自动消失</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    title<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>icon<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>icon<span class="token punctuation">,</span>    duration<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">,</span>mask<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>mask<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// 消息提示框：手动消失</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//  uni.showLoading  显示 loading 提示框, 需主动调用 uni.hideLoading 才能关闭提示框。</span>uni<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    title<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>mask<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>mask<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> Toast<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>main.js引入</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// toast弹窗</span><span class="token keyword">import</span> toast <span class="token keyword">from</span> <span class="token string">'./public/toast.js'</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$Toast <span class="token operator">=</span> toast<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="携带token令牌登录小程序"><a href="#携带token令牌登录小程序" class="headerlink" title="携带token令牌登录小程序"></a>携带token令牌登录小程序</h5><p>使用 <strong>js-base64加密token</strong>，下载 js-base.js到本地的api下，</p><p>在login.js中引入加密方法，取出本地存储的token进行加密，然后将token放置在header中</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// request 该文件封装了请求方法</span><span class="token comment">// 引入js-base.js</span><span class="token keyword">let</span> Base64 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Base64<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span><span class="token comment">// 参数url是request.js暴露出的url </span><span class="token comment">// 参数data是post请求传递的值</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>arg <span class="token operator">=</span> arg<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// 封装 post请求</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span>method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>data<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>arg<span class="token punctuation">,</span>header<span class="token operator">:</span> <span class="token punctuation">{</span>Authorization<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">baseFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 封装 get请求</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span>method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>header<span class="token operator">:</span> <span class="token punctuation">{</span>Authorization<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">baseFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 输出成功的值</span><span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 失败的原因/提示</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 加密token 方法</span><span class="token function">baseFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">const</span> token <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token string">'wxuser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>token <span class="token comment">//取出token</span><span class="token keyword">const</span> base64 <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>token <span class="token operator">+</span> <span class="token string">':'</span><span class="token punctuation">)</span> <span class="token comment">//使用base里的方法</span><span class="token keyword">return</span> <span class="token string">'Basic '</span> <span class="token operator">+</span> base64<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> request<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>当请求携带了token后，shopping.vue中</strong></p><p>let <strong>enshrine</strong> = await new this.Request(this.Urls.m().enshrineurl,data).modepost();</p><p><strong>enshrine就能返回带有</strong>：</p><p><strong>成功的200 状态码 errcodes</strong></p><p><strong>表示收藏与否的数值 1或者 2</strong></p><p><strong>和提示信息msg</strong></p><p>判断：<strong>当collects值为errcodes时，下方栏展示收藏或者未收藏的图标，但因为每次重新请求数据默认是取到collects的默认值0，所以图标不会变化</strong>。</p><p>因此还需要请求一个接口   –<strong>获取详情页商品是否收藏：GET /collection?query=       {权限接口，需携带token}</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 收藏和取消收藏</span><span class="token keyword">async</span> <span class="token function">collEct</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span>id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> num<span class="token operator">:</span>num<span class="token punctuation">,</span>id<span class="token operator">:</span>id <span class="token punctuation">}</span>  <span class="token comment">// 等于 { num,id }</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// this.Urls.m().enshrineurl 代表url , data 代表携带的参数 data</span><span class="token keyword">let</span> enshrine <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enshrineurl<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>enshrine<span class="token punctuation">,</span><span class="token string">'我是enshrine'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">{</span> errcode <span class="token punctuation">}</span> <span class="token operator">=</span> enshrine<span class="token punctuation">.</span>msg<span class="token keyword">if</span><span class="token punctuation">(</span>errcode <span class="token operator">==</span> <span class="token string">'401'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 要登录</span><span class="token comment">// 使用 全局引入的登录弹窗 组件里的方法</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>show<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>errcode <span class="token operator">==</span> <span class="token string">'200'</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collects <span class="token operator">=</span> enshrine<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>collects <span class="token comment">//判断当collects值为errcodes时，下方栏展示收藏或者未收藏的图标，但因为每次重新请求数据默认是取到collects的默认值0，使用图标不会变化</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="获取该商品是否已经收藏"><a href="#获取该商品是否已经收藏" class="headerlink" title="获取该商品是否已经收藏"></a>获取该商品是否已经收藏</h5><p><strong>父组件datails</strong>中调用<strong>获取详情页商品是否收藏</strong>的接口 <strong>collectionur</strong></p><p>即当页面加载就调用该接口检查是否res[2]的返回值，并将返回值赋值给<strong>colldata</strong> ，通过refs将colldata传递给子组件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 获取商品是否收藏</span><span class="token keyword">let</span> collection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collectionurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>introduce<span class="token punctuation">,</span> wxcommnt<span class="token punctuation">,</span>collection<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'商品是否收藏数据'</span><span class="token punctuation">,</span>res<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>colldata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 底部操作栏组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>shopping <span class="token operator">:</span>goodid<span class="token operator">=</span><span class="token string">"goodid"</span> <span class="token operator">:</span>colldata<span class="token operator">=</span><span class="token string">"colldata"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>shopping<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>子组件shopping</strong>中接收数据，</p><p><strong>监听器wtach</strong> 监听msg对象中是否有变化，有新值就赋值给collects，<strong>这样就实现了收藏图标变化</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">props<span class="token operator">:</span><span class="token punctuation">{</span>goodid<span class="token operator">:</span>String<span class="token punctuation">,</span>colldata<span class="token operator">:</span>Object<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    watch<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 收藏和获取该商品是否收藏</span><span class="token function">colldata</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">{</span> collects <span class="token punctuation">}</span> <span class="token operator">=</span> newValue<span class="token punctuation">.</span>msg<span class="token keyword">this</span><span class="token punctuation">.</span>collects <span class="token operator">=</span> collects<span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>当本地没有token的时候，即用户重新登陆后，</strong></p><p><strong>虽然这个请求返回的msg.errcode 值是 302 ，msg.msg返回值是 “未登录,收藏默认未收藏状态”</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> collection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collectionurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>introduce<span class="token punctuation">,</span> wxcommnt<span class="token punctuation">,</span>collection<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// .......</span><span class="token punctuation">{</span>__ob__<span class="token operator">:</span> Observer<span class="token punctuation">}</span>msg<span class="token operator">:</span> Objectcollects<span class="token operator">:</span> <span class="token number">0</span>errcode<span class="token operator">:</span> <span class="token string">"302"</span>msg<span class="token operator">:</span> <span class="token string">"未登录,收藏默认未收藏状态"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>但是：当登陆后，之前收藏的图标仍然显示未收藏</strong></p><p>思路：每次登录后刷新收藏状态</p><p>首先需要知道登陆成功，即shopping组件中，当errcode值等于401时候，表示没有登录，就调用弹窗组件<strong>showmodal.vue</strong>展示提示登录的弹窗,<strong>并且传递值 ‘coll’ 到子组件的参数中</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 收藏和取消收藏</span><span class="token keyword">async</span> <span class="token function">collEct</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span>id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> num<span class="token operator">:</span>num<span class="token punctuation">,</span>id<span class="token operator">:</span>id <span class="token punctuation">}</span>  <span class="token comment">// 等于 { num,id }</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// this.Urls.m().enshrineurl 代表url , data 代表携带的参数 data</span><span class="token keyword">let</span> enshrine <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enshrineurl<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>enshrine<span class="token punctuation">,</span><span class="token string">'我是查看收藏成功与否'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">{</span> errcode <span class="token punctuation">}</span> <span class="token operator">=</span> enshrine<span class="token punctuation">.</span>msg<span class="token keyword">if</span><span class="token punctuation">(</span>errcode <span class="token operator">==</span> <span class="token string">'401'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 要登录</span><span class="token comment">// 使用 全局引入的登录弹窗 组件里的方法</span>            <span class="token comment">// 登陆这里传值过去 coll </span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>show<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token string">'coll'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>errcode <span class="token operator">==</span> <span class="token string">'200'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>collects <span class="token operator">=</span> enshrine<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>collects<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>子组件中，showing方法显示组件，同时接受值‘coll’，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 默认隐藏的数据</span>modeling<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">// 告知是哪个组件传值过来</span>msg<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment">// 显示组件  接收父组件shopping里的coll 这里参数默认是空值</span><span class="token function">showing</span><span class="token punctuation">(</span>msg <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token keyword">this</span><span class="token punctuation">.</span>modeling <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后拿着msg到<strong>调用登录方法 wxusEr</strong> 下：</p><p><strong>判断如果当前组件的msg等于了‘coll’，就使用全局事件总线将data值传递出去   命名未 collict</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 调用登录</span><span class="token keyword">async</span> <span class="token function">wxusEr</span><span class="token punctuation">(</span><span class="token parameter">userInfo<span class="token punctuation">,</span>errMsg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">wxLogin</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loGin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// data 值是 success 来自于login.js中的返回值</span>                <span class="token comment">//如果登录成功就</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'coll'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 更新收藏状态 emit是传值的作用 collict随意命名 值的话是data data值是SUCCESS</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'collict'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>colldata<span class="token operator">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>最后在父组件这，先封装一个更新收藏状态的方法，然后在生命周期created中接收 collict 值，当值等于SUCCESS时，调用更新状态的方法</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 登录成功后，更新收藏状态</span><span class="token keyword">async</span> <span class="token function">reFresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 获取商品是否已经收藏</span><span class="token keyword">let</span> collection <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collectionurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goodid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>collection<span class="token punctuation">,</span><span class="token string">'更新商品是否收藏'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>collects <span class="token operator">=</span> collection<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>collects<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 接收showmodal组件传过来的判断是否登录的 SUCCESS 值</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'collict'</span><span class="token punctuation">,</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>colldata <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 更新收藏状态</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reFresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="获取购物车商品件数"><a href="#获取购物车商品件数" class="headerlink" title="获取购物车商品件数"></a>获取购物车商品件数</h5><p>在接口文件内添加获取商品件数接口 ，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"> <span class="token comment">// 获取购物车件数</span><span class="token keyword">let</span> mycarturl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">mycart</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 加入购物车</span><span class="token keyword">let</span> atcarturl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">atcart</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>在details组件内，发起请求，拿到res数据，初次其长度为0，即购物车里0件商品</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 获取购物车件数</span><span class="token keyword">let</span> mycart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token comment">// 因为后期需要发起多次请求,用promise.all做一个并发请求</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token operator">...</span> <span class="token punctuation">,</span> mycart<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">' ... '</span> <span class="token punctuation">,</span> 获取购物车数据'<span class="token punctuation">,</span>res<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>然后shopping中完成登陆之后刷新购物车功能</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 登录成功后，更新收藏状态</span><span class="token keyword">async</span> <span class="token function">reFresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 获取商品是否已经收藏</span><span class="token keyword">let</span> collection <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collectionurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goodid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>collection<span class="token punctuation">,</span><span class="token string">'更新商品是否收藏'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>collects <span class="token operator">=</span> collection<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>collects<span class="token comment">// 更新购物车件数</span><span class="token keyword">let</span> mycart <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>cartnum <span class="token operator">=</span> mycart<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="封装商品sku选择组件"><a href="#封装商品sku选择组件" class="headerlink" title="封装商品sku选择组件"></a><strong>封装商品sku选择组件</strong></h5><p>在pages/commponents下新建addtocart组件，同时在details中引入，</p><p><strong>静态布局代码如下</strong>：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 公用的商品sku选择组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Coupon-yin anim"</span> <span class="token operator">:</span>catchtouchmove<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Coupon-view coup-anim padd"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品图片 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"commodity-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"commodity-left-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"attribute.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span>图片<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"commodity-zh"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>¥<span class="token number">300</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>库存<span class="token number">100</span>件<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"choice"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>请选择<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>颜色<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>尺码<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"commodity-right-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/guanbi.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span>图片<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 主要颜色 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-title"</span><span class="token operator">&gt;</span>主要颜色<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-mian"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span>图片<span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>黑色<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 尺寸 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-title"</span><span class="token operator">&gt;</span>尺码<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-mian sku-two"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token constant">S</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token constant">M</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 购买数量 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-view sku-height"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-title numes"</span><span class="token operator">&gt;</span>购买数量<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-mums-gight"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 确定按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> <span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录弹窗 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>showmodal ref<span class="token operator">=</span><span class="token string">"show"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>showmodal<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>padd <span class="token punctuation">{</span>padding<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span>margin<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">90</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>Coupon<span class="token operator">-</span>view text <span class="token punctuation">{</span>display<span class="token operator">:</span> block<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>commodity<span class="token operator">-</span>view <span class="token punctuation">{</span><span class="token comment">/* background: #4CD964; */</span>height<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>commodity<span class="token operator">-</span>left<span class="token operator">-</span>img <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>commodity<span class="token operator">-</span>left<span class="token operator">-</span>img image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>commodity<span class="token operator">-</span>zh <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">27</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">3</span>d4245<span class="token punctuation">;</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>commodity<span class="token operator">-</span>zh view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">35</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #fe0036<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>commodity<span class="token operator">-</span>zh view <span class="token punctuation">{</span>padding<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>choice <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>choice text <span class="token punctuation">{</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>commodity<span class="token operator">-</span>right<span class="token operator">-</span>img <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>commodity<span class="token operator">-</span>right<span class="token operator">-</span>img image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* sku */</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>view <span class="token punctuation">{</span>margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">1</span>px solid #e5e5e5<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>title <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">051</span>b28<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>margin<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>mian image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">17</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>mian view <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">65</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #f5f5f5<span class="token punctuation">;</span>border<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f5f5f5<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">14</span>upx<span class="token punctuation">;</span>margin<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>margin<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>mian <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">27</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">051</span>b28<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>two view <span class="token punctuation">{</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">35</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 购买数量 */</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>height <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">120</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>numes <span class="token punctuation">{</span>margin<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>mums<span class="token operator">-</span>gight <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>mums<span class="token operator">-</span>gight view <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">051</span>b28<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>background<span class="token operator">:</span> #f5f5f5<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sku<span class="token operator">-</span>mums<span class="token operator">-</span>gight view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>background<span class="token operator">:</span> none <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>determine <span class="token punctuation">{</span>z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">999</span><span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>background<span class="token operator">:</span> #fe0036<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 选了颜色加上边框 */</span><span class="token punctuation">.</span>active <span class="token punctuation">{</span>border<span class="token operator">:</span> <span class="token number">1</span>rpx solid red <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>添加 隐藏或显示 购物车组件功能</strong></p><h6 id="显示组件思路"><a href="#显示组件思路" class="headerlink" title="显示组件思路:"></a><strong>显示组件思路:</strong></h6><p><strong>在父组件details中通过ref绑定子组件Addtocart，然后details中封装一个方法用于在子组件shopping中用$parent调用该方法来控制Addtocart组件中的数据</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 公用的商品sku组件 父组件通过ref可以通过这个方式 控制节点  <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Addtocart ref<span class="token operator">=</span><span class="token string">"addto"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Addtocart<span class="token operator">&gt;</span><span class="token comment">// 父组件details中被子组件shopping调用的方法</span><span class="token function">shoPp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>addto<span class="token punctuation">.</span><span class="token function">showCou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// shopping调用父组件details里的sku组件</span><span class="token function">couponsFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span><span class="token function">shoPp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// Addtocart组件中控制显示隐藏的方法 被其他组件调用</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 被其他组件调用显示sku组件</span><span class="token function">showCou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>couponif <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="隐藏组件思路："><a href="#隐藏组件思路：" class="headerlink" title="隐藏组件思路："></a>隐藏组件思路：</h6><p><strong>给叉叉按钮或者遮罩背景添加点击事件，然后将v-if属性变为false</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 背景遮罩层 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Coupon-yin anim"</span> <span class="token operator">:</span>catchtouchmove<span class="token operator">=</span><span class="token string">"true"</span> @click<span class="token operator">=</span><span class="token string">"hideCou()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"commodity-right-img"</span> @click<span class="token operator">=</span><span class="token string">"hideCou()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 叉叉按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/guanbi.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span>图片<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 隐藏sku组件</span><span class="token function">hideCou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>couponif <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="sku组件的确定功能"><a href="#sku组件的确定功能" class="headerlink" title="sku组件的确定功能"></a>sku组件的确定功能</h6><p>点击立即购买也会显示sku组件，但是立即购买显示的sku组件的确定按钮是会跳转到付款页面，而点击加入购物车显示的sku组件的确定按钮仅仅是加入了购物车功能，在点击确定按钮时，要让按钮知道点击的目的。</p><p>所以要传值过去，让确定按钮执行相应的操作。</p><p>思路：</p><p><strong>多写两条确定按钮，分别触发的点击事件不一样，通过v-if来选择不同的情况。</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 确定按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '002'"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '003'"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// data中默认mean值是002</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>couponif<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//显示 或 隐藏该组件</span>mean<span class="token operator">:</span> <span class="token string">'002'</span><span class="token punctuation">,</span><span class="token comment">// 设置一个值   002代表加入购物车    003代表直接购买 </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 在shopping组件中给立即购买添加相同的点击事件，但传递的参数值不同 </span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"join join-right"</span> @click<span class="token operator">=</span><span class="token string">"couponsFun('002')"</span><span class="token operator">&gt;</span>加入购物车<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"join join-left"</span> @click<span class="token operator">=</span><span class="token string">"couponsFun('003')"</span><span class="token operator">&gt;</span>立即购买<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 调用父组件details里的sku组件 并且将相应点击触发的值传递给父组件的shoPp方法的参数中</span><span class="token function">couponsFun</span><span class="token punctuation">(</span><span class="token parameter">mean</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span><span class="token function">shoPp</span><span class="token punctuation">(</span>mean<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 父组件details被子组件shopping调用 同时接收子组件传递的参数值mean 最终通过ref拿到子组件sku的节点并使用其showCou方法 同时传递mean参数值 </span><span class="token function">shoPp</span><span class="token punctuation">(</span><span class="token parameter">mean</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>addto<span class="token punctuation">.</span><span class="token function">showCou</span><span class="token punctuation">(</span>mean<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="请求商品sku组件的数据"><a href="#请求商品sku组件的数据" class="headerlink" title="请求商品sku组件的数据"></a>请求商品sku组件的数据</h5><p>后台request.js配置很好接口后，到父组件details，发起请求拿到数据，并拿到轮播的第一张图片和价格、库存、商品id、标题等数据然后psuh到res[4]数据中，最后传递给子组件sku使用数据</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 请求数据方法  id是商品的id</span><span class="token keyword">async</span> <span class="token function">detRequest</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// ......</span>          <span class="token comment">// 商品sku组件数据</span><span class="token keyword">let</span> wxsku <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>wxskuurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token comment">// 因为后期需要发起多次请求,用promise.all做一个并发请求</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token operator">...</span> <span class="token punctuation">,</span> wxsku <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' ... , '</span>sku组件数据'<span class="token punctuation">,</span>res<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 获取sku数据 这里的数据来自轮播图和商品价格</span><span class="token keyword">let</span> defaultdata <span class="token operator">=</span> <span class="token punctuation">{</span>image<span class="token operator">:</span>mendata<span class="token punctuation">.</span>media<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>imgArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 拿到轮播图第一张图片</span>price<span class="token operator">:</span>mendata<span class="token punctuation">.</span>describe<span class="token punctuation">.</span>Trueprice<span class="token punctuation">,</span>   <span class="token comment">// 拿到价格</span>totalstock<span class="token operator">:</span>mendata<span class="token punctuation">.</span>describe<span class="token punctuation">.</span>Total_stock<span class="token punctuation">,</span> <span class="token comment">// 拿到库存</span>id<span class="token operator">:</span>mendata<span class="token punctuation">.</span>id<span class="token punctuation">,</span>  <span class="token comment">// 拿到商品id</span>title<span class="token operator">:</span>mendata<span class="token punctuation">.</span>describe<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token comment">// 拿到商品标题，在提交到购物车需要用到</span><span class="token punctuation">}</span><span class="token comment">// 将以上数据 push到一个数组里面 即 商品sku组件数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>skudata <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token keyword">this</span><span class="token punctuation">.</span>skudata<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>defaultdata<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>skudata<span class="token punctuation">,</span><span class="token string">'商品sku新数据'</span><span class="token punctuation">)</span>                                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>子组件保存数据：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">props<span class="token operator">:</span><span class="token punctuation">{</span>skudata<span class="token operator">:</span>Array<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// watch监听数据</span><span class="token comment">// 因为图片会随着选择码数时变化，所以使用监听更高效 </span>watch<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 获取父组件来的sku默认展示数据</span><span class="token function">skudata</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span><span class="token string">'sku新值'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> newValue<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token keyword">this</span><span class="token punctuation">.</span>attribute <span class="token operator">=</span> newValue<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> newValue<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>couponif<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//显示 或 隐藏该组件</span>mean<span class="token operator">:</span> <span class="token string">'002'</span><span class="token punctuation">,</span><span class="token comment">// 设置一个值   002代表加入购物车    003代表直接购买 </span>id<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">//商品id</span>attribute<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 商品展示的sku</span>title<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">// 商品标题</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>sku组件中模板代码修改如下：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品图片 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"commodity-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"commodity-left-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"attribute.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"commodity-zh"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>¥<span class="token punctuation">{</span><span class="token punctuation">{</span>attribute<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>库存<span class="token punctuation">{</span><span class="token punctuation">{</span>attribute<span class="token punctuation">.</span>totalstock<span class="token punctuation">}</span><span class="token punctuation">}</span>件<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"choice"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>请选择<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>颜色<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>尺码<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"commodity-right-img"</span> @click<span class="token operator">=</span><span class="token string">"hideCou()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 叉叉按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/guanbi.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 主要颜色 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-title"</span><span class="token operator">&gt;</span>主要颜色<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-mian"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in skudata[1]"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 尺寸 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-title"</span><span class="token operator">&gt;</span>尺码<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-mian sku-two"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in skudata[0]"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="计算属性处理选中某个sku"><a href="#计算属性处理选中某个sku" class="headerlink" title="计算属性处理选中某个sku"></a>计算属性处理选中某个sku</h5><p>给 <strong>颜色 / 尺码</strong> 按钮添加点击事件，并且动态绑定边框变色的css属性 ，属性值默认-1，index值取自于对应的item 或 item.color</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 给颜色按钮添加点击事件，并且动态绑定边框变色的css属性   </span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"colorFun(item.color,index)"</span> <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{active:index == colornum}"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 尺码添加点击事件， 并且动态绑定边框变色的css属性 </span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in skudata[0]"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"sizeFun(item,index)"</span> <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{active:index == sizenum}"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token comment">// 选择颜色</span><span class="token function">colorFun</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>colornum <span class="token operator">=</span> index<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 选择尺码</span><span class="token function">sizeFun</span><span class="token punctuation">(</span><span class="token parameter">size<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizenum <span class="token operator">=</span> index<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>接着完成请选择：颜色 尺码 的文字动态变化</strong></p><p><strong>使用计算属性：choice</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 选择颜色</span><span class="token function">colorFun</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>colornum <span class="token operator">=</span> index    <span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">=</span> color <span class="token comment">//每次选中颜色后 data中的colorvalue就有值 可以将其赋值给请选择。。。</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 选择尺码</span><span class="token function">sizeFun</span><span class="token punctuation">(</span><span class="token parameter">size<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizenum <span class="token operator">=</span> index   <span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">=</span> size<span class="token comment">//每次选中尺码后 data中的sizevalue就有值 可以将其赋值给请选择。。。</span><span class="token punctuation">}</span>computed<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 选择sku的改变</span><span class="token function">choice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">==</span> <span class="token string">''</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">'请选择'</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">'已选择'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>**此时，在template模板中的代码块如下使用计算属性中的方法  **</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"choice"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>choice<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>颜色<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>尺码<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>再一次使用计算属性：skumen 完成选择颜色或者尺码时，上方主要颜色下 显示的文字</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 选择颜色或者尺码 主要颜色下显示的文字</span><span class="token function">skumen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 两个都被选中</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 返回一个对象</span><span class="token keyword">return</span> <span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue<span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment">// 两个都未选中</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">==</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">'主要颜色'</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">'尺码'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment">// 假如尺码没有选择, 并且 颜色选择了</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">==</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">'尺码'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment">// 假如尺码选择了, 并且 颜色没选择</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">'主要颜色'</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>最后当未选择商品和尺码时候 ，禁止确定按钮功能</strong></p><p>在计算属性中，添加return的一个 键值对，当ban为true时，可以触发确定的点击功能</p><p><strong>扩展知识：JS中的逻辑运算符&amp;&amp;、||</strong></p><ul><li> 只要“&amp;&amp;”前面是false，无论“&amp;&amp;”后面是true还是false，结果都将返“&amp;&amp;”前面的值;</li><li>只要“&amp;&amp;”前面是true，无论“&amp;&amp;”后面是true还是false，结果都将返“&amp;&amp;”后面的值;</li><li>只要“||”前面为false,不管“||”后面是true还是false，都返回“||”后面的值。</li><li>只要“||”前面为true,不管“||”后面是true还是false，都返回“||”前面的值。                        </li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 确定按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 利用计算属性 如果两个未选中就禁止使用确定按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '002'"</span> @click<span class="token operator">=</span><span class="token string">"skumen.ban &amp;&amp; detErmine()"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 。。。。。。</span><span class="token comment">// 选择颜色或者尺码 主要颜色下显示的文字</span><span class="token function">skumen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 两个都被选中</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 返回一个对象</span><span class="token keyword">return</span> <span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue<span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue<span class="token punctuation">,</span>ban<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token comment">// 两个都未选中</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">==</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">'主要颜色'</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">'尺码'</span><span class="token punctuation">,</span>ban<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token comment">// 假如尺码没有选择, 并且 颜色选择了</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">==</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">'尺码'</span><span class="token punctuation">,</span>ban<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token comment">// 假如尺码选择了, 并且 颜色没选择</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">'主要颜色'</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>ban<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="请求每个sku的库存、价格"><a href="#请求每个sku的库存、价格" class="headerlink" title="请求每个sku的库存、价格"></a>请求每个sku的库存、价格</h5><p>分析可得当同时选择了颜色和尺码，才会展示相应的价格和库存，即发起请求 <strong>this.skuing()</strong></p><p>那么如何得知选择了尺码和颜色呢</p><p>**在监听器中，监听skumen方法返回的数据变化： ** 当得到的newValue中的color和size数据不为空，即都选择了就调用请求方法</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods：<span class="token punctuation">{</span><span class="token comment">// 获取请求每个sku的数据</span><span class="token keyword">async</span> <span class="token function">skuRequest</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> querysku <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>queryskuurl<span class="token punctuation">,</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>querysku<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 刚好得到的data和之前用于展示库存、价格、图片的对象里的键值对一致 </span><span class="token keyword">this</span><span class="token punctuation">.</span>attribute <span class="token operator">=</span> querysku<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>watch<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 是否选择了尺码和颜色</span><span class="token function">skumen</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span><span class="token string">'更新后的尺码和颜色数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">{</span> color<span class="token punctuation">,</span>size <span class="token punctuation">}</span> <span class="token operator">=</span> newValue<span class="token keyword">if</span><span class="token punctuation">(</span>color <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> size <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">skuRequest</span><span class="token punctuation">(</span>            <span class="token comment">// 将请求需要的参数在这里放到一个对象中一个带到请求方法参数中</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> color<span class="token operator">:</span>color<span class="token punctuation">,</span>size<span class="token operator">:</span>size<span class="token punctuation">}</span>             <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="商品购买数量加减"><a href="#商品购买数量加减" class="headerlink" title="商品购买数量加减"></a>商品购买数量加减</h5><p>对减号和加号添加点击事件，并且当数值为1时，禁用减号按钮，核心思路是利用三元表达式和 click 的false情况</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 购买数量 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-view sku-height"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-title numes"</span><span class="token operator">&gt;</span>购买数量<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sku-mums-gight"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 三元表达式 如果商品数量等于<span class="token number">1</span> 就禁用 <span class="token operator">-</span> 按钮 ，否则可以使用减号按钮<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"many === 1 ? forbid==false : forbid==true &amp;&amp; reDuce()"</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"pLus()"</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        many<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 购买数量</span>forbid<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 购买数量最少为1，&lt;=1 时禁止按钮点击</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 数量</span><span class="token function">reDuce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>many <span class="token operator">--</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>many <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'数量不能低于1'</span><span class="token punctuation">,</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 加数量</span><span class="token function">pLus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>many <span class="token operator">++</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="加入所选商品到购物车"><a href="#加入所选商品到购物车" class="headerlink" title="加入所选商品到购物车"></a>加入所选商品到购物车</h5><p><strong>当点击确定按钮，需要在addtoart.vue文件中获取如下的data对象中的所有数据用作请求的data参数，</strong></p><p>拿到返回结果后，判断如果存在errcode 即没有登录，调用登录弹窗和登录请求弹窗。</p><p>如果返回的数据值 ‘SUCCESS’ ，那么隐藏sku组件，同时调用反馈弹窗，并且调用一次获取购物车件数的接口，将拿到的件数（length值）传递给shoppping.vue组件中，刷新购物车的件数 —（<strong>使用vuex传值</strong>）</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 加入购物车按钮 (需要选择颜色和尺码后才能触发)</span><span class="token function">detErmine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 点击确定按钮 要将这里的data对象传到请求作为参数使用</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue<span class="token punctuation">,</span>color<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue<span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>attribute<span class="token punctuation">.</span>image<span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>attribute<span class="token punctuation">.</span>price<span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>many<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> atcartdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>atcarturl<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">,</span><span class="token string">'加入购物车的返回数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 如果errcode存在就需要登录</span><span class="token comment">// 登陆这里传值过去 'coll'</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>show<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token string">'coll'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideCou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'加入购物车成功'</span><span class="token punctuation">,</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//反馈 弹窗</span><span class="token comment">// 相同的sku（颜色、尺码一样）加入购物车后只显示一条，仅件数变化 （后端接口已经做了处理）</span><span class="token keyword">let</span> mycart <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mycart<span class="token punctuation">,</span><span class="token string">"购物车件数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="vuex传值到购物车的商品数量"><a href="#vuex传值到购物车的商品数量" class="headerlink" title="vuex传值到购物车的商品数量"></a>vuex传值到购物车的商品数量</h5><p>在项目根目录下新建文件夹 store，其下新建<strong>store.js</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// vuex存放数据，数据仓库，数据管理中心</span><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token comment">// 购物车件数</span><span class="token keyword">const</span> cartnum <span class="token operator">=</span> <span class="token punctuation">{</span>nums<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">}</span><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">// 购物车件数</span>cartnum<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">// 数据仓库中心</span>state<span class="token punctuation">,</span><span class="token comment">// 传值</span><span class="token comment">// actions : 异步传值 --不能直接到达数据仓库，组件中使用 ： store.dispatch()</span><span class="token comment">// getters : 类似计算属性，带有缓存，有新的值进来才会被触发 （不常用）</span><span class="token comment">// mutitions : 同步传值：可以直接传给state    组件中使用 ： store.commit('mutations中方法名',value) </span>mutations<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 加入购物车成功后传值的购物车条数  (第一个参数是state仓库，第二个是要传递过来的值)</span><span class="token function">mutacart</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>nums</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 接收到组件传过来的值之后要存储到数据中心仓库</span>state<span class="token punctuation">.</span>cartnum <span class="token operator">=</span> <span class="token punctuation">{</span>nums<span class="token operator">:</span>nums<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在sku组件中，将获取到的购物车件数，存储到vuex中，</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 加入购物车按钮 (需要选择颜色和尺码后才能触发)</span><span class="token keyword">async</span> <span class="token function">detErmine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 点击确定按钮 要将这里的data对象传到请求作为参数使用</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue<span class="token punctuation">,</span>color<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue<span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>attribute<span class="token punctuation">.</span>image<span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>attribute<span class="token punctuation">.</span>price<span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>many<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> atcartdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>atcarturl<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">,</span><span class="token string">'加入购物车的返回数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 如果errcode存在就需要登录</span><span class="token comment">// 登陆这里传值过去 'coll'</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>show<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token string">'coll'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideCou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'加入购物车成功'</span><span class="token punctuation">,</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//反馈 弹窗</span><span class="token comment">// 相同的sku（颜色、尺码一样）加入购物车后只显示一条，仅件数变化 （后端接口已经做了处理）</span><span class="token keyword">let</span> mycart <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mycart<span class="token punctuation">,</span><span class="token string">"购物车件数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 使用vuex方法 将购物车件数值传递到 仓库</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'mutacart'</span><span class="token punctuation">,</span>mycart<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在shopping.vue组件，监听器中使用vuex的数据</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">watch<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 加入购物车成功后存储到vuex后，从vuex仓库中心拿取值；监听vuex数据中心的值变化，</span><span class="token comment">// 如果vuex数据中心的值变化才会被触发执行</span><span class="token string">"$store.state.cartnum"</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span><span class="token string">'监听器监听vuex中购物车件数'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>cartnum <span class="token operator">=</span> newValue<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="商品订单页"><a href="#商品订单页" class="headerlink" title="商品订单页"></a>商品订单页</h3><h4 id="直接下单获取待付款商品数据"><a href="#直接下单获取待付款商品数据" class="headerlink" title="直接下单获取待付款商品数据"></a>直接下单获取待付款商品数据</h4><p>pages新建 payment-page目录，下方新建payment.vue,同时去page.json中引入</p><p>然后对addtocart.vue文件中的确定按钮进行添加点击事件，并配置方法，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '003'"</span> @click<span class="token operator">=</span><span class="token string">"skumen.ban &amp;&amp; purChase()"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 直接下单</span><span class="token keyword">async</span> <span class="token function">purChase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 点击确定按钮 要将这里的data对象传到请求作为参数使用，因为购物车的商品类目不止一个，所以用数组包裹很多对象</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue<span class="token punctuation">,</span>color<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue<span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>attribute<span class="token punctuation">.</span>image<span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>attribute<span class="token punctuation">.</span>price<span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>many<span class="token punctuation">,</span>total_price<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>attribute<span class="token punctuation">.</span>price <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>many<span class="token punctuation">,</span>  <span class="token comment">//商品总价</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token comment">// 校验登录状态</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> tokening <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tokeningurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tokening<span class="token punctuation">,</span><span class="token string">'检查登录状态'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>tokening<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode <span class="token operator">==</span> <span class="token string">"401"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 没有token 就展示登录弹窗</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>show<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token string">'coll'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>tokening<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 数组，对象转换成字符串才能携带值</span><span class="token keyword">let</span> cartdata <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token comment">// 跳转到下单页面 同时携带参数</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../payment-page/payment?cartdata='</span> <span class="token operator">+</span> cartdata<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 在payment.vue组件中，使用onLoad生命周期 的e参数 接收 参数</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token comment">// e就是上个页面使用navigateTo路径，携带的值  --来自于addtocart组件 purChase方法</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 将JSON字符串转化为对象</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cartdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="视图层展示待付款的商品"><a href="#视图层展示待付款的商品" class="headerlink" title="视图层展示待付款的商品"></a>视图层展示待付款的商品</h4><p>js浮点数解决：</p><p>在上个组件addtocart中对total_price数据进行修改</p><p>*<em>total_price:parseFloat((this.attribute.price * this.many).toFixed(10)),*</em>  //商品总价 ,解决浮点数</p><p><strong>总价显示小数点后两位：</strong></p><p><code>npm i e-commerce_price</code></p><p>// 引入下载的node库 –支付小数点后两位 价格补零<br><strong>const Price = require(‘e-commerce_price’)</strong></p><p><strong>payment.vue 完整代码如下：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 收货地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-name"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-left-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/address-shouhuo.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 收货地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-add"</span> <span class="token operator">&gt;</span>请选择收货地址<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-right-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/shouhuo-jiantou.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-commodity"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in comminfo"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>颜色<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>尺码<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>￥ <span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>x<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>共<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span>件 小计<span class="token operator">:</span> ￥ <span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>total_price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 底部提交订单 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"place-order"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>合计<span class="token operator">:</span> ￥<span class="token punctuation">{</span><span class="token punctuation">{</span>Totalprice<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text @click<span class="token operator">=</span><span class="token string">"placeOrder()"</span><span class="token operator">&gt;</span>提交订单<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入下载的node库 --支付小数点后两位 价格补零</span><span class="token keyword">const</span> Price <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'e-commerce_price'</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>comminfo<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//上个页面接收的商品数据</span>Totalprice<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//商品总价 小数点两位数</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// e就是路径上携带的值 来自于addtocart组件 purChase方法</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 将JSON字符串转化为对象</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cartdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>comminfo <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cartdata<span class="token punctuation">)</span><span class="token comment">// 合计支付总价计算 numdata默认为0，使用forEach遍历</span><span class="token keyword">let</span> numdata <span class="token operator">=</span> <span class="token number">0</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cartdata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>numdata <span class="token operator">+=</span> item<span class="token punctuation">.</span>total_price<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 合计总价 小数点两位数</span><span class="token keyword">this</span><span class="token punctuation">.</span>Totalprice <span class="token operator">=</span> <span class="token function">Price</span><span class="token punctuation">(</span>numdata<span class="token punctuation">)</span> <span class="token comment">// 将需补0的数据传入方法</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>page<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span> #f2f2f2<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>view<span class="token punctuation">{</span>margin<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>name<span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">150</span>upx<span class="token punctuation">;</span>background<span class="token operator">-</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span> border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>left<span class="token operator">-</span>img<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>left<span class="token operator">-</span>img image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">60</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>add text<span class="token punctuation">{</span>display<span class="token operator">:</span> block<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>add text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>padding<span class="token operator">:</span> <span class="token number">4</span>rpx <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>add<span class="token punctuation">{</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>right<span class="token operator">-</span>img<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>right<span class="token operator">-</span>img image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 下单商品 */</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>commodity<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span> border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">15</span>upx <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>order<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span><span class="token comment">/* background: #4CD964; */</span>margin<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>order text<span class="token punctuation">{</span>display<span class="token operator">:</span> block<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>order<span class="token operator">-</span>img<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>order<span class="token operator">-</span>img image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>title<span class="token punctuation">{</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>title text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>overflow<span class="token operator">:</span> hidden<span class="token punctuation">;</span>text<span class="token operator">-</span>overflow<span class="token operator">:</span> ellipsis<span class="token punctuation">;</span>display<span class="token operator">:</span> <span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token punctuation">;</span><span class="token operator">-</span>webkit<span class="token operator">-</span>line<span class="token operator">-</span>clamp<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token operator">-</span>orient<span class="token operator">:</span> vertical<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>title text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">5</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">7</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>price<span class="token punctuation">{</span>text<span class="token operator">-</span>align<span class="token operator">:</span> right<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>payment<span class="token operator">-</span>flex<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>text<span class="token operator">-</span>you<span class="token punctuation">{</span>color<span class="token operator">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">)</span><span class="token punctuation">;</span>margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 提交 */</span><span class="token punctuation">.</span>place<span class="token operator">-</span>order<span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>background<span class="token operator">-</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> flex<span class="token operator">-</span>end<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>place<span class="token operator">-</span>order text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">)</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">270</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>margin<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="我的收货地址页面"><a href="#我的收货地址页面" class="headerlink" title="我的收货地址页面"></a>我的收货地址页面</h4><p>   在pages下新建my-address文件夹，然后在下方新建my-address.vue、new-address.vue文件</p><p><strong>然后注册到pages.json</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span><span class="token string">"path"</span><span class="token operator">:</span> <span class="token string">"pages/my-address/my-addres"</span><span class="token punctuation">,</span><span class="token string">"style"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"我的收货地址"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"path"</span><span class="token operator">:</span> <span class="token string">"pages/my-address/new-address"</span><span class="token punctuation">,</span><span class="token string">"style"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"新增收货地址"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>my-address.vue组件静态布局</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-name"</span> @click<span class="token operator">=</span><span class="token string">"getAdd(item)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>北京大学<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-adding"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>张三<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token number">10086</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-change"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/genggai.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 新增收货地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"button-address"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/xinzeng.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>新增收货地址<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token function">getadd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> atcartdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>gainaddurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">,</span><span class="token string">'请求收货地址信息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getadd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>page<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span> #<span class="token constant">F2F2F2</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>address<span class="token operator">-</span>view<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span> margin<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>address<span class="token operator">-</span>name<span class="token punctuation">{</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">130</span>rpx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>address<span class="token operator">-</span>name view<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>address<span class="token operator">-</span>change<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>address<span class="token operator">-</span>change image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>address<span class="token operator">-</span>adding<span class="token punctuation">{</span>color<span class="token operator">:</span> #<span class="token constant">A7A7A7</span><span class="token punctuation">;</span> padding<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>address<span class="token operator">-</span>adding text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">15</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 新增收货地址 */</span><span class="token punctuation">.</span>button<span class="token operator">-</span>address<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span> align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>button<span class="token operator">-</span>address image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>完成新的登录页面</strong></p><p><strong>在pages/components/新建login-page.vue</strong></p><p>在里边完成登录逻辑</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"login-page"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"login"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">"primary"</span> open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"getUserInfo"</span> @click<span class="token operator">=</span><span class="token string">"getUserInfo()"</span><span class="token operator">&gt;</span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入登录</span><span class="token keyword">import</span> wxLogin <span class="token keyword">from</span> <span class="token string">'../../login/login.js'</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>login<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token parameter">boll<span class="token operator">=</span><span class="token boolean">true</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>login <span class="token operator">=</span> boll<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 登录</span><span class="token keyword">async</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'登录中'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//新的登录接口：wx.getUserProfile</span>wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>desc<span class="token operator">:</span> <span class="token string">'登录'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">let</span> <span class="token punctuation">{</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wxusEr</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拒绝登录或登录失败'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 调用登录</span><span class="token keyword">async</span> <span class="token function">wxusEr</span><span class="token punctuation">(</span><span class="token parameter">userInfo<span class="token punctuation">,</span>errMsg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">wxLogin</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loGin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 登录成功更新需要请求的接口或者数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'mycart'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>cart<span class="token operator">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>login <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>login<span class="token operator">-</span>page<span class="token punctuation">{</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">999</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>login<span class="token operator">-</span>page button<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">350</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>因为其他地方会用到，所以放到公共main.js中</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 引入新的登录组件</span><span class="token keyword">import</span> loginpage <span class="token keyword">from</span> <span class="token string">'pages/commponents/login-page.vue'</span>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'loginpage'</span><span class="token punctuation">,</span>loginpage<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>引入到收货组件my-address.vue里使用</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-view"</span><span class="token operator">&gt;</span>。。。。。<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 新增收货地址 <span class="token operator">--</span><span class="token operator">&gt;</span>。。。。。<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录界面 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>完整login-page.vue逻辑代码</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入 微信登录逻辑</span><span class="token keyword">import</span> wxLogin <span class="token keyword">from</span> <span class="token string">'../../login/login.js'</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>login<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//默认不展示登录组件，除非登录接口返回数据</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 当需要展示组件时，调用这个方法 默认是true 即可以展示组件</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token parameter">boll<span class="token operator">=</span><span class="token boolean">true</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>login <span class="token operator">=</span> boll<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 登录的方法</span><span class="token keyword">async</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 显示其他的弹窗 登录时的反馈 弹窗</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'登录中'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">/*wx.getUserProfile 获取用户信息。页面产生点击事件后才可调用，每次请求都会弹出授权窗口，用户同意后返回 userInfo */</span><span class="token comment">//新的登录接口：wx.getUserProfile</span>wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>desc<span class="token operator">:</span> <span class="token string">'登录咯'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">let</span> <span class="token punctuation">{</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">}</span> <span class="token operator">=</span> res <span class="token comment">// res中包含用户的个人信息 如昵称,头像等 </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wxusEr</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拒绝登录或登录失败'</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'用户取消登录'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//登录时的反馈 弹窗</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 调用登录</span><span class="token keyword">async</span> <span class="token function">wxusEr</span><span class="token punctuation">(</span><span class="token parameter">userInfo<span class="token punctuation">,</span>errMsg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 微信登录逻辑</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">wxLogin</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loGin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 登录成功后 更新需要请求的接口或者数据 emit是传值的作用 </span><span class="token comment">// mycart、cart随意命名 cart值是data data值是SUCCESS 在my-addres.vue中接收 $on</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'mycart'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>cart<span class="token operator">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>login <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>my-address.vue组件逻辑代码</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 获取收货地址</span><span class="token keyword">async</span> <span class="token function">getadd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> atcartdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>gainaddurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">,</span><span class="token string">'请求到的收货地址信息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 需要登录 使用ref获取登录组件的节点 然后调用节点下的控制展示组件的方法showing()</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getadd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'mycart'</span><span class="token punctuation">,</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// res就是收到的值 这里是来自于loain-oage.vue中的 cart: "SUCCESS"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span><span class="token string">'我是收到的data'</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>cart <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 如果登录成功就 获取收货地址</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getadd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// gainaddurl</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="获取我的收货地址数据"><a href="#获取我的收货地址数据" class="headerlink" title="获取我的收货地址数据"></a>获取我的收货地址数据</h4><p>首次获取到的数据肯定是空的，因为没有设置过地址</p><p><strong>对获取到的请求结果进行判断，出现errcode值就需要重新登陆，数据长度为0，展示提示新增地址的消息，最后拿到结果赋值</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>adddata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//存放收货地址信息</span>searchno<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//默认不展示提示</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 获取收货地址</span><span class="token keyword">async</span> <span class="token function">getadd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> atcartdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>gainaddurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">,</span><span class="token string">'请求到的收货地址信息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 如果存在errcode值就表示没有token 没有登录</span><span class="token keyword">if</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 就需要登录 使用ref获取登录组件的节点 然后调用节点下的控制展示组件的方法showing()</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 如果data长度为0,就表示收货地址为空</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 展示提示信息</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchno <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 登陆后拿到数据时赋值给一个数组中 </span><span class="token keyword">this</span><span class="token punctuation">.</span>adddata <span class="token operator">=</span> atcartdata<span class="token punctuation">.</span>data<span class="token keyword">this</span><span class="token punctuation">.</span>searchno <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">//同时隐藏提示信息</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span>      <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>最终拿到数据后，遍历数据然后放到view标签中展示</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in adddata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-name"</span> @click<span class="token operator">=</span><span class="token string">"getAdd(item)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>city <span class="token operator">+</span> item<span class="token punctuation">.</span>address<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-adding"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>mobile<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-change"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/genggai.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 新增收货地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"button-address"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/xinzeng.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>新增收货地址<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录界面 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loginpage ref<span class="token operator">=</span><span class="token string">"loginmen"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果没有保存收货地址 就展示此处 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"empty-cart"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"searchno"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/search/sousuono.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>你还没有收货地址<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>然后在new-address.vue文件中，进行代码编写</strong> ：静态布局如下 主要难点是使用了 <strong>uniapp的picker</strong>选择器</p><p>picker：</p><p>从底部弹起的滚动选择器。支持五种选择器，通过mode来区分，分别是普通选择器，多列选择器，时间选择器，日期选择器，省市区选择器，默认是普通选择器。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"new-address-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 收货地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"new-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>收货城市<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span>  placeholder<span class="token operator">=</span><span class="token string">"请选择收货城市"</span> disabled placeholder<span class="token operator">-</span>style<span class="token operator">=</span><span class="token string">"color:#9c9c9c"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>picker mode<span class="token operator">=</span><span class="token string">"region"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>选择城市<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>picker<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 详细地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"new-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>详细地址<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span>  placeholder<span class="token operator">=</span><span class="token string">"请填写详细地址"</span> placeholder<span class="token operator">-</span>style<span class="token operator">=</span><span class="token string">"color:#9c9c9c"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 联系人 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"new-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>联系人<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span>  placeholder<span class="token operator">=</span><span class="token string">"请填写收货人姓名"</span> placeholder<span class="token operator">-</span>style<span class="token operator">=</span><span class="token string">"color:#9c9c9c"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 手机号码 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"new-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>手机号<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"number"</span>  placeholder<span class="token operator">=</span><span class="token string">"请填写收货人手机号码"</span> placeholder<span class="token operator">-</span>style<span class="token operator">=</span><span class="token string">"color:#9c9c9c"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 保存地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conServe adcolor"</span> <span class="token operator">&gt;</span>保存地址<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 修改地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conServe adcolor"</span>  v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!nameadd"</span><span class="token operator">&gt;</span>修改地址<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 删除地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conServe decolor"</span>  v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!nameadd"</span><span class="token operator">&gt;</span>删除<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>new<span class="token operator">-</span>address<span class="token operator">-</span>view <span class="token punctuation">{</span>padding<span class="token operator">:</span> <span class="token number">10</span>upx <span class="token number">30</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>new<span class="token operator">-</span>address <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>rpx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">1</span>rpx solid #f0f0f0<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>new<span class="token operator">-</span>address view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">150</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>new<span class="token operator">-</span>address view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>new<span class="token operator">-</span>address view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>color<span class="token operator">:</span> #<span class="token number">4</span>cd964<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 保存 */</span><span class="token punctuation">.</span>conServe <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">80</span>rpx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>rpx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">30</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>adcolor <span class="token punctuation">{</span>background<span class="token operator">:</span> linear<span class="token operator">-</span><span class="token function">gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> #ffd300<span class="token punctuation">,</span> #e6be00<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>decolor <span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span> red<span class="token punctuation">;</span>color<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在选择城市这里，添加**@change事件   – value 改变时触发 change 事件，event.detail = {value: value}**</p><p>然后把e里边拿到的数据赋值给city，然后将city字符串通过 v-model绑定到 input标签中，</p><p>其他input也通过v-model绑定数据到data中</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 收货城市 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"new-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>收货城市<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span>  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"city"</span> placeholder<span class="token operator">=</span><span class="token string">"请选择收货城市"</span> disabled placeholder<span class="token operator">-</span>style<span class="token operator">=</span><span class="token string">"color:#9c9c9c"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>picker mode<span class="token operator">=</span><span class="token string">"region"</span> @change<span class="token operator">=</span><span class="token string">"regionChange"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>选择城市<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>picker<span class="token operator">&gt;</span>y<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 详细地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"new-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>详细地址<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"address"</span> placeholder<span class="token operator">=</span><span class="token string">"请填写详细地址"</span> placeholder<span class="token operator">-</span>style<span class="token operator">=</span><span class="token string">"color:#9c9c9c"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 联系人 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"new-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>联系人<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"name"</span>  placeholder<span class="token operator">=</span><span class="token string">"请填写收货人姓名"</span> placeholder<span class="token operator">-</span>style<span class="token operator">=</span><span class="token string">"color:#9c9c9c"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 手机号码 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"new-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>手机号<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"number"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"mobile"</span> placeholder<span class="token operator">=</span><span class="token string">"请填写收货人手机号码"</span> placeholder<span class="token operator">-</span>style<span class="token operator">=</span><span class="token string">"color:#9c9c9c"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>city<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>address<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>mobile<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 省市区选择  e里边包含了选择的城市数据</span><span class="token function">regionChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// console.log(e.detail)</span><span class="token keyword">let</span> values <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token comment">// 浙江省 杭州市 上城区</span><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment">//空字符串</span>values<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>str <span class="token operator">+=</span> item <span class="token operator">+</span> <span class="token string">' '</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> str<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="新增收货地址"><a href="#新增收货地址" class="headerlink" title="新增收货地址"></a>新增收货地址</h4><p>拿到用户填写的收货地址数据后，需要点击保存地址按钮提交数据到后台，</p><p>在<strong>new-address.vue</strong> 中，给按钮绑定点击事件<strong>preTion( )</strong>,在事件中发起请求，声明一个对象保存需要的参数数据，作为请求的参数使用，并且请求成功和失败时候设置对应的提示弹窗，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>city<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>address<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>mobile<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 省市区选择  e里边包含了选择的城市数据</span><span class="token function">regionChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// console.log(e.detail)</span><span class="token keyword">let</span> values <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token comment">// 浙江省 杭州市 上城区</span><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment">//空字符串</span>values<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>str <span class="token operator">+=</span> item <span class="token operator">+</span> <span class="token string">' '</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> str<span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token comment">// 保存并提交收货地址</span><span class="token keyword">async</span> <span class="token function">preTion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'正在提交中'</span><span class="token punctuation">,</span><span class="token string">'loading'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>city<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>city<span class="token punctuation">,</span>address<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>address<span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>mobile<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>mobile<span class="token punctuation">}</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> sudeadd <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sudeaddurl<span class="token punctuation">,</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sudeadd<span class="token punctuation">,</span><span class="token string">'提交保存的收货地址'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>sudeadd<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'提交成功'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span>                        <span class="token comment">// 完成自动返回到上一级页面</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>sudeadd<span class="token punctuation">.</span>msg<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token comment">// 如果出现errcode 就表示没有登录 </span><span class="token keyword">if</span><span class="token punctuation">(</span>sudeadd<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 就需要登录 使用ref获取登录组件的节点 然后调用节点下的控制展示组件的方法showing()</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>当新增保存地址后，完成自动返回到上一级页面</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>sudeadd<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'提交成功'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>sudeadd<span class="token punctuation">.</span>msg<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上一级页面 <strong>my-address.vue</strong> 中每次<strong>进入页面要刷新一下 收货地址</strong> </p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 获取收货地址</span><span class="token keyword">async</span> <span class="token function">getadd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> atcartdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>gainaddurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">,</span><span class="token string">'请求到的收货地址信息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 如果存在errcode值就表示没有token 没有登录</span><span class="token keyword">if</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 就需要登录 使用ref获取登录组件的节点 然后调用节点下的控制展示组件的方法showing()</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 如果data长度为0,就表示收货地址为空</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>atcartdata<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 展示提示信息</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchno <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 登陆后拿到数据时赋值给一个数组中 </span><span class="token keyword">this</span><span class="token punctuation">.</span>adddata <span class="token operator">=</span> atcartdata<span class="token punctuation">.</span>data<span class="token keyword">this</span><span class="token punctuation">.</span>searchno <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">//同时隐藏提示信息</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 点击新增收货地址按钮</span><span class="token function">chAnge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'./new-address'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// onShow生命周期 表示:无论从什么页面返回,都会再一次执行下面的方法</span><span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getadd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>实现收货地址的修改功能</strong></p><p>点击修改图标，进入修改地址页面，可以编辑和删除</p><p>给点击事件传递两个值，第一个001代表修改收货地址，002代表新增收货地址，第二个参数item，包含了地址的详细信息，是放到修改点击事件里</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in adddata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-name"</span> @click<span class="token operator">=</span><span class="token string">"getAdd(item)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>city <span class="token operator">+</span> item<span class="token punctuation">.</span>address<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-adding"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>mobile<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 传值  <span class="token number">001</span>表示修改  同时将item传递过去<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-change"</span> @click<span class="token operator">=</span><span class="token string">"chAnge('001',item)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/genggai.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 新增收货地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 传值  <span class="token number">002</span>表示新增收货 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"button-address"</span> @click<span class="token operator">=</span><span class="token string">"chAnge('002')"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/xinzeng.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>新增收货地址<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 新增收货地址 同时也修改地址  传递参数判断 点击后跳转的页面,将参数转为json字符串添加到要跳转链接后边</span><span class="token function">chAnge</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">'002'</span><span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span>data <span class="token punctuation">}</span><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'./new-address?value='</span> <span class="token operator">+</span> str<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在new-address.vue中</strong>，接收数据 同时调用获取按钮的方法，接收到的数据传入<strong>useradd</strong>方法中 从而变更data中控制v-if的值，达到显示需要的按钮，</p><p>同时，将数据解构出来，赋值给data中数据，即页面显示的收货地址信息填充为用户之前输入的信息</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 保存地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conServe adcolor"</span> @click<span class="token operator">=</span><span class="token string">"preTion()"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"nameadd"</span><span class="token operator">&gt;</span>保存地址<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 修改地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conServe adcolor"</span> @click<span class="token operator">=</span><span class="token string">"preTion()"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!nameadd"</span><span class="token operator">&gt;</span>修改地址<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 删除地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conServe decolor"</span> @click<span class="token operator">=</span><span class="token string">"preTion()"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!nameadd"</span><span class="token operator">&gt;</span>删除地址<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 获取用户从那个按钮点击进来的</span><span class="token function">useradd</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 修改地址或者删除地址</span><span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">'001'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>nameadd <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment">// 将接收的到数据解构出来存储</span><span class="token keyword">let</span> <span class="token punctuation">{</span> city<span class="token punctuation">,</span>address<span class="token punctuation">,</span>mobile<span class="token punctuation">,</span>name<span class="token punctuation">,</span>_id <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> city<span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token keyword">this</span><span class="token punctuation">.</span>mobile <span class="token operator">=</span> mobile<span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> _id<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>nameadd <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// e 里边包含了上个组件传递的数据</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token string">'接收到上个组件的数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// JSON.parse(e.value) json字符串还原为js对象</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">useradd</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="更改删除收货地址"><a href="#更改删除收货地址" class="headerlink" title="更改删除收货地址"></a>更改删除收货地址</h4><p><strong>在new-address.vue中</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 修改地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conServe adcolor"</span> @click<span class="token operator">=</span><span class="token string">"modifyAdd()"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!nameadd"</span><span class="token operator">&gt;</span>修改地址<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 删除地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conServe decolor"</span> @click<span class="token operator">=</span><span class="token string">"deleteAdd()"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!nameadd"</span><span class="token operator">&gt;</span>删除地址<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>修改收货地址方法</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 修改收货地址</span><span class="token keyword">async</span> <span class="token function">modifyAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'正在修改中'</span><span class="token punctuation">,</span><span class="token string">'loading'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>city<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>city<span class="token punctuation">,</span>address<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>address<span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>mobile<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>mobile<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> modifyadd <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>modifyaddurl<span class="token punctuation">,</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>modifyadd<span class="token punctuation">,</span><span class="token string">'修改收货地址'</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>modifyadd<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'修改成功'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>modifyadd<span class="token punctuation">.</span>msg<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token comment">// 如果出现errcode 就表示没有登录</span><span class="token keyword">if</span><span class="token punctuation">(</span>modifyadd<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 就需要登录 使用ref获取登录组件的节点 然后调用节点下的控制展示组件的方法showing()</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>删除收货地址方法</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 删除收货地址</span><span class="token keyword">async</span> <span class="token function">deleteAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'删除中'</span><span class="token punctuation">,</span><span class="token string">'loading'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> deleadd <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>deleaddurl <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// console.log(deleadd,'删除收货地址')</span><span class="token keyword">if</span><span class="token punctuation">(</span>deleadd<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>deleadd<span class="token punctuation">.</span>msg<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token comment">// 如果出现errcode 就表示没有登录</span><span class="token keyword">if</span><span class="token punctuation">(</span>deleadd<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 就需要登录 使用ref获取登录组件的节点 然后调用节点下的控制展示组件的方法showing()</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="商品订单页选择收货地址"><a href="#商品订单页选择收货地址" class="headerlink" title="商品订单页选择收货地址"></a>商品订单页选择收货地址</h4><p>提交订单页面 –<strong>payment.vue</strong> 给 “请选择收货地址” 添加点击事件  <strong>@click=”shAddress()**，跳转到我的收货地址 – **my-address.vue</strong>组件中</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 收货地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-name"</span> @click<span class="token operator">=</span><span class="token string">"shAddress()"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-left-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/address-shouhuo.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 收货地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-add"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"nameadd"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>orderdata<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>orderdata<span class="token punctuation">.</span>mobile<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>orderdata<span class="token punctuation">.</span>city <span class="token operator">+</span> orderdata<span class="token punctuation">.</span>address<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-add"</span>  v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!nameadd"</span><span class="token operator">&gt;</span>请选择收货地址<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-right-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/shouhuo-jiantou.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 选择收货地址</span><span class="token function">shAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">//跳转到我的收货地址 -- myaddress.vue组件中</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../my-address/my-addres'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>my-address.vue</strong>组件中，添加点击地址后的事件**@click=”getAdd(item)”**，同时拿到包含收货地址详细信息的item作为参数，</p><p>在方法中，调用 **this.$store.commit(‘mutaadd’,item)**，将item传入vuex的mutation中的mutaadd方法中，将item赋值给state中的addordr。</p><p>接着<strong>uni.navigateBack</strong> 返回上一级 <strong>payment.vue</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 新增收货地址页面 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in adddata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 设置点击地址后的点击事件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-name"</span> @click<span class="token operator">=</span><span class="token string">"getAdd(item)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>city <span class="token operator">+</span> item<span class="token punctuation">.</span>address<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-adding"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>mobile<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 传值  <span class="token number">001</span>表示修改  同时将item传递过去<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-address-change"</span> @click<span class="token operator">=</span><span class="token string">"chAnge('001',item)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/genggai.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token comment">// 选中某个收货地址 携带数据返回上一级订单页面</span><span class="token function">getAdd</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 使用vuex传值 将这item传值到state中</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'mutaadd'</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> <strong>payment.vue</strong>中设置监听器，监听<strong>state中addordr</strong>是否变化，将变化后的数据（ 即收货地址信息）赋值给 <strong>this.orderdata</strong>，</p><p>最后计算属性中，nameadd()方法，判断 转化为JSON字符串的<strong>this.orderdata</strong>是否为空，空的话<strong>nameadd</strong>返回false，否则true。即控制显示的是否显示请选择收货地址还是已经选择的收货地址</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">watch<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 监听vuex的收货地址数据 newValue里边就包含了vuex里的数据</span><span class="token string">"$store.state.addordr"</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span><span class="token string">'监听到的新值'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>orderdata <span class="token operator">=</span> newValue<span class="token punctuation">.</span>address<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    computed<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 是否选择了收货地址</span><span class="token function">nameadd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>orderdata<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"{}"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="微信支付"><a href="#微信支付" class="headerlink" title="微信支付"></a>微信支付</h3><h4 id="获取支付所需数据，以及try-catch-的应用"><a href="#获取支付所需数据，以及try-catch-的应用" class="headerlink" title="获取支付所需数据，以及try{}catch{}的应用"></a>获取支付所需数据，以及try{}catch{}的应用</h4><p>payment.vue组件，<strong>点击提交订单按钮的点击事件</strong></p><p>代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 底部提交订单 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"place-order"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>合计<span class="token operator">:</span> ￥<span class="token punctuation">{</span><span class="token punctuation">{</span>Totalprice<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text @click<span class="token operator">=</span><span class="token string">"placeOrder()"</span><span class="token operator">&gt;</span>提交订单<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 提交订单</span><span class="token keyword">async</span> <span class="token function">placeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 商品数据 通过对comminfo数据进行map方法遍历，会返回一个新的数组对象</span><span class="token keyword">let</span> codata <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>comminfo<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token operator">:</span>item<span class="token punctuation">.</span>id<span class="token punctuation">,</span>image<span class="token operator">:</span>item<span class="token punctuation">.</span>image<span class="token punctuation">,</span>title<span class="token operator">:</span>item<span class="token punctuation">.</span>title<span class="token punctuation">,</span>size<span class="token operator">:</span>item<span class="token punctuation">.</span>size<span class="token punctuation">,</span>color<span class="token operator">:</span>item<span class="token punctuation">.</span>color<span class="token punctuation">,</span>price<span class="token operator">:</span>item<span class="token punctuation">.</span>price<span class="token punctuation">,</span>many<span class="token operator">:</span>item<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token keyword">return</span> data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 准备一个对象 将请求需要的参数放入</span><span class="token keyword">let</span> dataobj <span class="token operator">=</span> <span class="token punctuation">{</span>consignee<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>orderdata<span class="token punctuation">,</span> <span class="token comment">// 收货地址相关数据</span>commodity<span class="token operator">:</span>codata<span class="token punctuation">,</span><span class="token comment">// 商品相关数据</span>total_price<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>Totalprice<span class="token punctuation">,</span><span class="token comment">// 商品总价数据</span>idcard<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>idcard<span class="token punctuation">,</span><span class="token comment">// 购物车内所有商品的id相关数据</span><span class="token punctuation">}</span><span class="token comment">// 1.请求统一下单 接口</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> wxpayurl <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>wxpay<span class="token punctuation">,</span>dataobj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>wxpayurl<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>wxpayurl<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// throw 用来捕获一个错误  如果try 中出现throw关键词，就会进入catch里面来</span><span class="token keyword">throw</span> wxpayurl<span class="token punctuation">.</span>msg<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// e就是throw 捕获的错误 </span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token keyword">throw</span> e <span class="token comment">//如果try 中出现throw关键词，此时try catch 后边的代码将不会执行</span><span class="token punctuation">}</span><span class="token comment">// 2.调用微信支付接口</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="wx-requestpayment-调起微信付款"><a href="#wx-requestpayment-调起微信付款" class="headerlink" title="wx.requestpayment()调起微信付款"></a>wx.requestpayment()调起微信付款</h4><p>payment.vue组件中，点击提交订单后。</p><p>原本在请求接口时，是调用<strong>wxpay</strong>接口    – var <strong>wxpay</strong> = await new this.Request(this.Urls.m().wxpay,dataobj).modepost();<br>但因为个人没有微信商户号，所以这里使用的是虚拟支付接口<strong>fictpay</strong> –let <strong>fictpay</strong> = await new this.Request(this.Urls.m().fictpay,dataobj).modepost();</p><p>携带参数完整时， <strong>返回结果是”SUCCESS”</strong></p><p><strong>methods中方法如下：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 选择收货地址</span><span class="token function">shAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../my-address/my-addres'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 提交订单</span><span class="token keyword">async</span> <span class="token function">placeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 商品数据 通过对comminfo数据进行map方法遍历，会返回一个新的数组对象</span><span class="token keyword">let</span> codata <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>comminfo<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token operator">:</span>item<span class="token punctuation">.</span>id<span class="token punctuation">,</span>image<span class="token operator">:</span>item<span class="token punctuation">.</span>image<span class="token punctuation">,</span>title<span class="token operator">:</span>item<span class="token punctuation">.</span>title<span class="token punctuation">,</span>size<span class="token operator">:</span>item<span class="token punctuation">.</span>size<span class="token punctuation">,</span>color<span class="token operator">:</span>item<span class="token punctuation">.</span>color<span class="token punctuation">,</span>price<span class="token operator">:</span>item<span class="token punctuation">.</span>price<span class="token punctuation">,</span>many<span class="token operator">:</span>item<span class="token punctuation">.</span>many<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">return</span> data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 准备一个对象 将请求需要的参数放入</span><span class="token keyword">let</span> dataobj <span class="token operator">=</span> <span class="token punctuation">{</span>consignee<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>orderdata<span class="token punctuation">,</span> <span class="token comment">// 收货地址相关数据</span>commodity<span class="token operator">:</span>codata<span class="token punctuation">,</span><span class="token comment">// 商品相关数据</span>total_price<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>Totalprice<span class="token punctuation">,</span><span class="token comment">// 支付总价数据</span>idcard<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>idcard<span class="token punctuation">,</span><span class="token comment">// 购物车内所有商品的id相关数据</span><span class="token punctuation">}</span><span class="token comment">// 1.请求统一下单接口   </span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 微信支付: 统一下单接口</span><span class="token comment">// 因为个人没有认证微信商户号，这里使用的是虚拟支付接口 返回结果是"SUCCESS"</span><span class="token keyword">let</span> fictpay <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fictpayurl<span class="token punctuation">,</span>dataobj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>fictpay<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>fictpay<span class="token punctuation">.</span>data<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// throw 用来捕获一个错误  如果try 中出现throw关键词，就会进入catch里面来</span><span class="token keyword">throw</span> fictpay<span class="token punctuation">.</span>msg<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// e就是throw 捕获的错误 </span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token comment">// throw e //如果try 中出现throw关键词，此时try catch 后边的代码将不会执行</span><span class="token punctuation">}</span><span class="token comment">// 2.调用微信支付接口</span><span class="token comment">// 3.查询订单是否支付成功</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>当拥有微信商户认证时候，发起真正的请求时，</strong></p><p>使用 wxpay接口 – var <strong>wxpay</strong> = await new this.Request(this.Urls.m().wxpay,dataobj).modepost();</p><p><strong>methods中方法如下：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token comment">// 选择收货地址</span><span class="token function">shAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../my-address/my-addres'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 提交订单</span><span class="token keyword">async</span> <span class="token function">placeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 商品数据 通过对comminfo数据进行map方法遍历，会返回一个新的数组对象</span><span class="token keyword">let</span> codata <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>comminfo<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token operator">:</span>item<span class="token punctuation">.</span>id<span class="token punctuation">,</span>image<span class="token operator">:</span>item<span class="token punctuation">.</span>image<span class="token punctuation">,</span>title<span class="token operator">:</span>item<span class="token punctuation">.</span>title<span class="token punctuation">,</span>size<span class="token operator">:</span>item<span class="token punctuation">.</span>size<span class="token punctuation">,</span>color<span class="token operator">:</span>item<span class="token punctuation">.</span>color<span class="token punctuation">,</span>price<span class="token operator">:</span>item<span class="token punctuation">.</span>price<span class="token punctuation">,</span>many<span class="token operator">:</span>item<span class="token punctuation">.</span>many<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">return</span> data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 准备一个对象 将请求需要的参数放入</span><span class="token keyword">let</span> dataobj <span class="token operator">=</span> <span class="token punctuation">{</span>consignee<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>orderdata<span class="token punctuation">,</span> <span class="token comment">// 收货地址相关数据</span>commodity<span class="token operator">:</span>codata<span class="token punctuation">,</span><span class="token comment">// 商品相关数据</span>total_price<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>Totalprice<span class="token punctuation">,</span><span class="token comment">// 支付总价数据</span>idcard<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>idcard<span class="token punctuation">,</span><span class="token comment">// 购物车内所有商品的id相关数据</span><span class="token punctuation">}</span><span class="token comment">// 1.请求统一下单接口   </span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 微信支付: 统一下单接口</span><span class="token keyword">var</span> wxpay <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>wxpay<span class="token punctuation">,</span>dataobj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>wxpay<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 存储商户订单号和订单id</span> <span class="token keyword">this</span><span class="token punctuation">.</span>outno <span class="token operator">=</span> wxpayurl<span class="token punctuation">.</span>data<span class="token punctuation">.</span>out_trade_no <span class="token keyword">this</span><span class="token punctuation">.</span>ide <span class="token operator">=</span> wxpayurl<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id<span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>wxpay<span class="token punctuation">.</span>data<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// throw 用来捕获一个错误  如果try 中出现throw关键词，就会进入catch里面来</span><span class="token keyword">throw</span> wxpay<span class="token punctuation">.</span>msg<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// e就是throw 捕获的错误 </span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token keyword">throw</span> e <span class="token comment">//如果try 中出现throw关键词，此时try catch 后边的代码将不会执行即不会调用下边的微信接口</span><span class="token punctuation">}</span><span class="token comment">// 2.调用微信支付接口</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// package：属于源码里的关键词 因此这个参数不能解构使用 而是：package:wxpay.data.package</span><span class="token comment">// 从真正的微信支付接口中拿到返回结果，这4（5）个数据用于调用微信支付接口时作为参数，</span><span class="token keyword">let</span> <span class="token punctuation">{</span> nonceStr<span class="token punctuation">,</span>paySign<span class="token punctuation">,</span>signType<span class="token punctuation">,</span>timeStamp <span class="token punctuation">}</span> <span class="token operator">=</span> wxpay<span class="token punctuation">.</span>data<span class="token comment">// 使用下方调用支付的方法 wxPay(payment)</span><span class="token keyword">let</span> wxpay <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wxPay</span><span class="token punctuation">(</span><span class="token punctuation">{</span> nonceStr<span class="token punctuation">,</span>paySign<span class="token punctuation">,</span>signType<span class="token punctuation">,</span>timeStamp<span class="token punctuation">,</span><span class="token keyword">package</span><span class="token operator">:</span>wxpay<span class="token punctuation">.</span>data<span class="token punctuation">.</span>package <span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>wxpay<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'支付失败'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token keyword">throw</span> e<span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 调用支付的方法：包装一个promise</span>    <span class="token comment">//  payment就是接收到的5个数据，用于调用微信支付接口的参数</span><span class="token function">wxPay</span><span class="token punctuation">(</span><span class="token parameter">payment</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>wx<span class="token punctuation">.</span><span class="token function">requestpayment</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>payment<span class="token punctuation">,</span><span class="token function-variable function">success</span><span class="token operator">:</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">fail</span><span class="token operator">:</span><span class="token parameter">Error</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span>Error<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="查询订单是否支付成功"><a href="#查询订单是否支付成功" class="headerlink" title="查询订单是否支付成功"></a>查询订单是否支付成功</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 3.查询订单是否支付成功 （去微信那边查询是否成功）</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> dataobj <span class="token operator">=</span> <span class="token punctuation">{</span>outno<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>outno<span class="token punctuation">,</span>id<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>ide<span class="token punctuation">}</span><span class="token keyword">let</span> queryorderurl <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>queryorderurl<span class="token punctuation">,</span>dataobj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>queryorderurl<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'支付成功'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> <span class="token string">'支付失败'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="动态路由跳转详情页"><a href="#动态路由跳转详情页" class="headerlink" title="动态路由跳转详情页"></a>动态路由跳转详情页</h4><p>在pages.json文件中，将首页排到首位</p><ul><li><p><strong>完成轮播页</strong>，点击图片跳转到对应页面功能</p></li><li><p>在pages/index/sonzhujian/<strong>swipers.vue</strong>下,添加点击事件 <strong>deTails(item._id)</strong></p><p><strong>deTails( item._id ）</strong>这里的 <strong>_id</strong> 就是通过轮播接口，返回的成功数据中的_id ，表示商品的唯一标识</p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span>    <span class="token comment">//这里的 _id 就是通过轮播接口，返回的成功数据中的_id表示商品的唯一标识</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"swiper-item"</span> @click<span class="token operator">=</span><span class="token string">"deTails(item._id)"</span><span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> mode 图片裁剪、缩放的模式  <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span>item<span class="token punctuation">.</span>image mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>swiper<span class="token operator">-</span>item<span class="token operator">&gt;</span><span class="token comment">// 跳转到详情页</span><span class="token function">deTails</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">// 跳转到详情页组件，同时携带商品id参数</span>url<span class="token operator">:</span><span class="token string">'../details/details?id='</span> <span class="token operator">+</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>完成快抢购页</strong>，点击图片跳转到对应页面功能</li><li>在pages/index/sonzhujian/<strong>purchhase.vue</strong>下,添加点击事件 <strong>deTails(item._id)</strong></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pur-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in recomdata[0].image"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.img"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> @click<span class="token operator">=</span><span class="token string">"daTails(item._id)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 跳转到详情页</span><span class="token function">deTails</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">// 跳转到详情页组件，同时携带商品id参数</span>url<span class="token operator">:</span><span class="token string">'../details/details?id='</span> <span class="token operator">+</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>完成天猫榜单页</strong>，点击图片跳转到对应页面功能</li><li>在pages/index/sonzhujian/<strong>list.vue</strong>下,添加点击事件 <strong>deTails(item._id)</strong></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item, index) in billdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"menb"</span> @click<span class="token operator">=</span><span class="token string">"deTails(item._id)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>want <span class="token punctuation">}</span><span class="token punctuation">}</span>人想要<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token comment">// 跳转到详情页</span><span class="token function">deTails</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">// 跳转到详情页组件，同时携带商品id参数</span>url<span class="token operator">:</span><span class="token string">'../details/details?id='</span> <span class="token operator">+</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>完成卡片流页</strong>，点击图片跳转到对应页面功能</li><li>在pages/commponents/<strong>card.vue</strong>下,添加点击事件 <strong>deTails(item._id)</strong></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in commdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-card"</span> @click<span class="token operator">=</span><span class="token string">"deTails(item._id)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-left"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>freight<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>预计<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>Duration<span class="token punctuation">}</span><span class="token punctuation">}</span>h发货<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"comm-right"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>Price<span class="token punctuation">}</span><span class="token punctuation">}</span>￥<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token comment">// 跳转到详情页</span><span class="token function">deTails</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">// 跳转到详情页组件，同时携带商品id参数</span>url<span class="token operator">:</span><span class="token string">'../details/details?id='</span> <span class="token operator">+</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>完成右上角按钮的返回功能</strong></p><p>进入pages/details/<strong>details.vue文件</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 返回按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"header-fixed backno"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"showAbs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 箭头符号设置的动态的高 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"status_bar"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"'height: ' + tophight.top + 'px;'"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"navs-image"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"'height: ' + tophight.height + 'px;'"</span> @click<span class="token operator">=</span><span class="token string">"pageRe()"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/fanhuibai.jpg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 返回上级页面 按钮</span><span class="token function">pageRe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>同时给top.vue组件中的左上角按钮 也设置点击事件</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"navs-image"</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">" 'height:'+ tophight.height + 'px;'"</span>  @click<span class="token operator">=</span><span class="token string">"pageRe()"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/fanhuihei.png"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 返回上级页面 按钮</span><span class="token function">pageRe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="个人中心页面"><a href="#个人中心页面" class="headerlink" title="个人中心页面"></a>个人中心页面</h3><p><strong>静态布局</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-view-user"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image  src<span class="token operator">=</span><span class="token string">"/static/details/weidenglu.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-view-name"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>button  plain<span class="token operator">=</span><span class="token string">"true"</span> open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"getUserInfo"</span> @click<span class="token operator">=</span><span class="token string">"getUserInfo()"</span><span class="token operator">&gt;</span>点击登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 菜单 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-menu"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in datas"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.img"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>datas<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'img'</span><span class="token operator">:</span><span class="token string">'/static/details/daifukuan.svg'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">:</span><span class="token string">'待付款'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'img'</span><span class="token operator">:</span><span class="token string">'/static/details/daifahuo.svg'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">:</span><span class="token string">'待发货'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'img'</span><span class="token operator">:</span><span class="token string">'/static/details/daishouhuo.svg'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">:</span><span class="token string">'待收货'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'img'</span><span class="token operator">:</span><span class="token string">'/static/details/daipingjia.svg'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token operator">:</span><span class="token string">'待评价'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>usering<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>userdata<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>my<span class="token operator">-</span>view<span class="token punctuation">{</span>background<span class="token operator">:</span> linear<span class="token operator">-</span><span class="token function">gradient</span><span class="token punctuation">(</span>to top<span class="token punctuation">,</span> #ff0714 <span class="token number">10</span><span class="token operator">%</span><span class="token punctuation">,</span> #ff3388 <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">500</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">-</span>left<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">-</span>right<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>position<span class="token operator">:</span> relative<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>view<span class="token operator">-</span>user<span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>position<span class="token operator">:</span> absolute<span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">170</span>upx<span class="token punctuation">;</span><span class="token comment">/* width: 100%; */</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>view<span class="token operator">-</span>user text<span class="token punctuation">{</span>display<span class="token operator">:</span> block<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>view<span class="token operator">-</span>user image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span> border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>view<span class="token operator">-</span>user view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>view<span class="token operator">-</span>name text<span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">32</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>view<span class="token operator">-</span>name button<span class="token punctuation">{</span>border<span class="token operator">:</span> none<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">32</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>view<span class="token operator">-</span>name<span class="token punctuation">{</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>menu<span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span> background<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>position<span class="token operator">:</span> absolute<span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">350</span>upx<span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">35</span>upx<span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">35</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token comment">/* margin: 0 35upx; */</span>box<span class="token operator">-</span>shadow<span class="token operator">:</span> <span class="token number">0</span>upx <span class="token number">10</span>rpx <span class="token number">10</span>rpx #e9e9e9<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>around<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>menu image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> block<span class="token punctuation">;</span>align<span class="token operator">-</span>self<span class="token operator">:</span> center<span class="token punctuation">;</span>padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>my<span class="token operator">-</span>menu view<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当本地存在token时候，显示个人信息：</p><p><strong>使用v-if 和 v-else来判断头像和个人名称的显示</strong></p><p>取出本地token，如果取不到就显示请登录，取到数据吧表示已经登录，则显示个人头像和名称</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-view-user"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"usering"</span> src<span class="token operator">=</span><span class="token string">"/static/details/weidenglu.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image v<span class="token operator">-</span><span class="token keyword">else</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"userdata.avatarUrl"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-view-name"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>button v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"usering"</span> plain<span class="token operator">=</span><span class="token string">"true"</span> open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"getUserInfo"</span> @click<span class="token operator">=</span><span class="token string">"getUserInfo()"</span><span class="token operator">&gt;</span>点击登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">else</span> <span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>userdata<span class="token punctuation">.</span>nickName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span> methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 取出本地</span><span class="token function">ifUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> user <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'wxuser'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>usering <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>usering <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">this</span><span class="token punctuation">.</span>userdata <span class="token operator">=</span> user<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ifUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>当本地没有token时，点击按钮登录事件</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>button v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"usering"</span> plain<span class="token operator">=</span><span class="token string">"true"</span> open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"getUserInfo"</span> @click<span class="token operator">=</span><span class="token string">"getUserInfo()"</span><span class="token operator">&gt;</span>点击登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token comment">// 引入 微信登录逻辑</span><span class="token keyword">import</span> wxLogin <span class="token keyword">from</span> <span class="token string">'../../login/login.js'</span><span class="token comment">// 触发登录事件</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 显示其他的弹窗 登录时的反馈 弹窗</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'登录中'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">/*wx.getUserProfile 获取用户信息。页面产生点击事件后才可调用，每次请求都会弹出授权窗口，用户同意后返回 userInfo */</span><span class="token comment">//新的登录接口：wx.getUserProfile</span>wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>desc<span class="token operator">:</span> <span class="token string">'登录咯'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">let</span> <span class="token punctuation">{</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">}</span> <span class="token operator">=</span> res <span class="token comment">// res中包含用户的个人信息 如昵称,头像等 </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wxusEr</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拒绝登录或登录失败'</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'用户取消登录'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//登录时的反馈 弹窗</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 调用登录</span><span class="token keyword">async</span> <span class="token function">wxusEr</span><span class="token punctuation">(</span><span class="token parameter">userInfo<span class="token punctuation">,</span>errMsg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 微信登录逻辑</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">wxLogin</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loGin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ifUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//登录成功后刷新一下本组件</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="订单中心页面"><a href="#订单中心页面" class="headerlink" title="订单中心页面"></a>订单中心页面</h3><p><strong>需求：点击待付款或者待发货应该跳转到订单中心</strong></p><p>在pages/新建 personal文件夹/<strong>personal.vue</strong></p><p><strong>静态布局</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"choice-tips"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item, index) in datas"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果下标index 等于 num值，就让当前下标对应的标签拥有 activetext css属性 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{ activetext: index == num }"</span> @click<span class="token operator">=</span><span class="token string">"menubtn(index)"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"choice-content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Tobepaid v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"num == 0 ? true : false"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Tobepaid<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Deliverde v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"num == 1 ? true : false"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Deliverde<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Received v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"num == 2 ? true : false"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Received<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Evaluated v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"num == 3 ? true : false"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Evaluated<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>num<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>datas<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'待付款'</span><span class="token punctuation">,</span> <span class="token string">'待发货'</span><span class="token punctuation">,</span> <span class="token string">'待收货'</span><span class="token punctuation">,</span> <span class="token string">'待评价'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token function">menubtn</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> index<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> e<span class="token punctuation">.</span>index<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>page <span class="token punctuation">{</span>background<span class="token operator">:</span> #eeeeee<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>choice<span class="token operator">-</span>tips <span class="token punctuation">{</span>background<span class="token operator">:</span> #d9ffe7<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>around<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">6</span>d6d6d<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>choice<span class="token operator">-</span>tips text <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>activetext <span class="token punctuation">{</span>color<span class="token operator">:</span> #fe0036 <span class="token operator">!</span>important<span class="token punctuation">;</span>border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">4</span>upx solid #fe0036<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>choice<span class="token operator">-</span>content <span class="token punctuation">{</span>margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>针对订单中心的四个板块，分别创建子组件</strong></p><p>在pages/personal/创建 sonzujian文件夹,</p><p>在sonzujian文件夹下新建 待付款组件 <strong>tobepaid.vue</strong>、待发货组件 <strong>delivered.vue</strong>、待收货组件 <strong>received.vue</strong>、待评价组件 <strong>evaluated.vue</strong></p><p><strong>通过 三元表达式，对num值是否等于index值作判断，从而显示或隐藏子组件</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 展示子组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"choice-content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 显示的条件是 num的值是否和当前的index下标对上 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Tobepaid v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"num == 0 ? true : false"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Tobepaid<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Delivered v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"num == 1 ? true : false"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Delivered<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Received v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"num == 2 ? true : false"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Received<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Evaluated v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"num == 3 ? true : false"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Evaluated<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 引入子组件</span><span class="token keyword">import</span>  tobepaid <span class="token keyword">from</span> <span class="token string">'./sonzujian/tobepaid.vue'</span><span class="token keyword">import</span>  delivered <span class="token keyword">from</span> <span class="token string">'./sonzujian/delivered.vue'</span><span class="token keyword">import</span>  received <span class="token keyword">from</span> <span class="token string">'./sonzujian/received.vue'</span><span class="token keyword">import</span>  evaluated <span class="token keyword">from</span> <span class="token string">'./sonzujian/evaluated.vue'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="获取待付款订单"><a href="#获取待付款订单" class="headerlink" title="获取待付款订单"></a>获取待付款订单</h4><p><strong>tobepaid 静态布局代码</strong>：</p><p>css样式 引入的是style里的公共样式 </p><p>没有商户号是无法拿到待付款数据</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 待付款组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-commodity"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-tips"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.expire"</span><span class="token operator">&gt;</span>该订单已过期<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-tips"</span> v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>等待买家付款<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"iteming.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span>图片<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>标题<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>颜色<span class="token operator">:</span>黑色<span class="token punctuation">;</span>尺码<span class="token operator">:</span><span class="token constant">L</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>￥<span class="token number">0.6</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>x2<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-Price"</span><span class="token operator">&gt;</span>需付款￥<span class="token number">1.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 付款 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-payment"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>付款<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录界面弹窗 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loginpage ref<span class="token operator">=</span><span class="token string">"loginmen"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入公共样式</span><span class="token keyword">import</span> <span class="token string">'../../../style/order.css'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 获取待付款数据</span><span class="token keyword">async</span> <span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> topebaid <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>topebaidurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 如果没有添加购物数据</span><span class="token keyword">if</span><span class="token punctuation">(</span>topebaid <span class="token operator">==</span> <span class="token string">'Not Found'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有商户号，不会有待付款数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>假如有商户号代码如下</strong></p><p>（使用一些假数组数据）</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 待付款组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 遍历商品条数和数据 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in topebaid"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-commodity"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 两种情况：<span class="token number">1</span>、订单没有过期时候，俩小时内发起付款没有支付，俩小时内可以再次付款，<span class="token number">2</span>、俩小时之后就不能再付款了，商品显示该订单已过期 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-tips"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.expire"</span><span class="token operator">&gt;</span>该订单已过期<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-tips"</span> v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>等待买家付款<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 遍历商品里面 因为可能支付时候不止一个商品 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(iteming,indexs) in item.order"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"indexs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"iteming.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>颜色<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>尺码<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>￥<span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>x<span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-Price"</span><span class="token operator">&gt;</span>需付款￥<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>total_price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 付款 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-payment"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果过期，就显示删除订单 否则可以付款<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.expire"</span><span class="token operator">&gt;</span>删除订单<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>付款<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 没有订单数据 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>ordering ref<span class="token operator">=</span><span class="token string">"orderload"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ordering<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录界面弹窗 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loginpage ref<span class="token operator">=</span><span class="token string">"loginmen"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入公共样式</span><span class="token keyword">import</span> <span class="token string">'../../../style/order.css'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">{</span>topebaid<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>expire<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>total_price<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">,</span>order<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">'5526网面-天空蓝'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">"http://h.thexxdd.cn/tianmao/public%5Cuploads%5C1606059327494-4142549.jpg"</span><span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">"37"</span><span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token string">"耐克新款2022 女生白色皮面鞋子高级【店长推荐】"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>expire<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>total_price<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>order<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">'5526网面-渣渣灰'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">"http://h.thexxdd.cn/tianmao/public%5Cuploads%5C1606059327494-4142549.jpg"</span><span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">"41"</span><span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token string">"361新款2022 男生灰色皮面鞋子【店长推荐】"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 获取待付款数据</span><span class="token keyword">async</span> <span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> topebaid <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>topebaidurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 如果没有添加购物数据</span><span class="token keyword">if</span><span class="token punctuation">(</span>topebaid <span class="token operator">==</span> <span class="token string">'Not Found'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有商户号，不会有待付款数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// 如果未登录 调用登录弹窗</span><span class="token keyword">if</span><span class="token punctuation">(</span>topebaid<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 如果登录成功后</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>topebaid<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 没有待付款数据</span><span class="token keyword">if</span><span class="token punctuation">(</span>topebaid<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>topebaid <span class="token operator">=</span> topebaid<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 接收登录组件传递的值 登录成功后也要刷新数据</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'mycart'</span><span class="token punctuation">,</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">// 当登录成功后</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>cart <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 调用方法刷新数据</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="订单的详情页"><a href="#订单的详情页" class="headerlink" title="订单的详情页"></a>订单的详情页</h4><p><strong>准备一个没有订单时候，页面的展示效果提示</strong></p><p><strong>pages/commponents **下新建 **ordering.vue</strong>，</p><p><strong>静态布局</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 没有订单数据 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"empty-cart"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"emcart"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"http://h.thexxdd.cn/video/tianmao/noorder.png"</span> mode<span class="token operator">=</span><span class="token string">"aspectFit"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>没有相关订单数据<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>emcart<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">od<span class="token operator">=</span><span class="token boolean">true</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>emcart <span class="token operator">=</span> od<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在 tobepaid.vue组件中引入，</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 没有订单数据 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>ordering ref<span class="token operator">=</span><span class="token string">"orderload"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ordering<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>接着开始新建目录 放订单详情</strong>，因为详情是对于四个板块都类似布局所以抽出到单独文件夹</p><p><strong>pages</strong>下新建 <strong>order-details</strong>文件夹，其下新建<strong>order.vue</strong>文件，记得去pages.json中注册</p><p><strong>静态布局</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 订单详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-details-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>等待买家付款<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"http://h.thexxdd.cn/video/tianmao/001.webp"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-details-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/address-shouhuo.svg"</span> mode<span class="token operator">=</span><span class="token string">"aspectFit"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-details-name"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>马云 <span class="token number">10086</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>四川省成都市 阿里巴巴<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-commodity pay-border"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-tips tips-import"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"http://h.thexxdd.cn/tianmao/public%5Cuploads%5C1606059327494-4142549.jpg"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>商品标题<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>颜色<span class="token operator">:</span>黑色<span class="token punctuation">;</span>尺码<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>￥ <span class="token number">100</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>x1<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-Price"</span><span class="token operator">&gt;</span>需付款￥<span class="token number">100</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 订单编号 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-number"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>订单编号<span class="token operator">:</span> <span class="token number">123456</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>创建时间<span class="token operator">:</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-details-play"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>右下角按钮<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token string">'../../style/order.css'</span><span class="token keyword">import</span> <span class="token string">'../../style/order-details.css'</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>values<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>orderdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后回到订单中心 <strong>personal.vue</strong></p><p>设置点击商品跳转到商品详情页，如果订单过期无法点击！</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 不存在订单过期的数据才能点击 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order"</span> @click<span class="token operator">=</span><span class="token string">"!item.expire &amp;&amp; payDetail()"</span><span class="token operator">&gt;</span>    <span class="token comment">// 跳转到商品详情页</span><span class="token function">payDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../order-details/order'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>因为待付款、待发货、待收货三个板块的详情页也有不同之处，所以需要一些数据进行动态传值</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 跳转到商品详情页</span><span class="token function">payDetail</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 准备一个对象传入 ，不能直接从路径携带过去</span><span class="token keyword">let</span> tip <span class="token operator">=</span> <span class="token punctuation">{</span>tips<span class="token operator">:</span><span class="token string">'等待买家付款'</span><span class="token punctuation">,</span>sum<span class="token operator">:</span><span class="token string">'需付款'</span><span class="token punctuation">,</span>show<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//是否展示付款按钮</span>text<span class="token operator">:</span><span class="token string">'付款'</span><span class="token punctuation">,</span>id<span class="token operator">:</span>id<span class="token punctuation">}</span><span class="token comment">// 将对象数据转化成json字符串 然后传入到跳转的组件里</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tip<span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../order-details/order?value='</span> <span class="token operator">+</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>商品详情组件中<strong>，order.vue</strong> 在onload接收数据 </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// e 接收tobepaid.vue组件 跳转过来时携带的数据</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 将数据转化为js对象</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>value<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>values <span class="token operator">=</span> value <span class="token comment">//接收值然后遍历</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>tobepaid.vue 组件 完整代码如下：</strong></p><p>因为是没有商户号的购买数据，无法拿到相关数据<br> 因此自己创建一个假数组对象<strong>当作拿到的tobedetail接口数据</strong></p><p>然后将数据进行几次遍历到相应位置上</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 订单详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-details-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>values<span class="token punctuation">.</span>tips<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"http://h.thexxdd.cn/video/tianmao/001.webp"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 地址 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-details-address"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/address-shouhuo.svg"</span> mode<span class="token operator">=</span><span class="token string">"aspectFit"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-details-name"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in orderdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>consignee<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>consignee<span class="token punctuation">.</span>mobile<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>consignee<span class="token punctuation">.</span>city<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>consignee<span class="token punctuation">.</span>address<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(items,indexs) in orderdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"indexs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-commodity pay-border"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-tips tips-import"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(itemimg,indexss) in items.order"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"indexss"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"itemimg.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>itemimg<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>颜色<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>itemimg<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>尺码<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>itemimg<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>￥<span class="token punctuation">{</span><span class="token punctuation">{</span>itemimg<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>x<span class="token punctuation">{</span><span class="token punctuation">{</span>itemimg<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-Price"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>values<span class="token punctuation">.</span>sum<span class="token punctuation">}</span><span class="token punctuation">}</span>￥<span class="token punctuation">{</span><span class="token punctuation">{</span>items<span class="token punctuation">.</span>total_price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 订单编号 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-number"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in orderdata"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>订单编号<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>order_number<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>创建时间<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>time<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-details-play"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"values.sum"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>values<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token string">'../../style/order.css'</span><span class="token keyword">import</span> <span class="token string">'../../style/order-details.css'</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 准备空对象，接收tobepaid.vue组件 跳转过来时携带的数据</span>values<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>orderdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 请求商品数据的方法</span><span class="token keyword">async</span> <span class="token function">tobedetail</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> tobedetail <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tobedetail <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 此处因为是没有商户号的购买数据，无法拿到相关数据</span><span class="token comment">// 因此自己创建一个假数组对象当作拿到的tobedetail数据</span><span class="token keyword">let</span> tobedetails <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>consignee<span class="token operator">:</span><span class="token punctuation">{</span>address<span class="token operator">:</span><span class="token string">"阿里巴巴"</span><span class="token punctuation">,</span>city<span class="token operator">:</span><span class="token string">"四川省 成都市 高新区"</span><span class="token punctuation">,</span>mobile<span class="token operator">:</span><span class="token string">"15858588888"</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token string">"马云"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>nonceStr<span class="token operator">:</span><span class="token string">"yybvvcyP6CDZ08E4"</span><span class="token punctuation">,</span>order<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">'5526网面-天空蓝'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">"http://h.thexxdd.cn/tianmao/public%5Cuploads%5C1606059327494-4142549.jpg"</span><span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">"37"</span><span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token string">"耐克新款2022 女生白色皮面鞋子高级【店长推荐】"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>order_number<span class="token operator">:</span><span class="token string">"1607585433768778712"</span><span class="token punctuation">,</span>out_trade_no<span class="token operator">:</span><span class="token string">"2zmCzfDZe6Zr8rKYCz43AbXEe2Kk2Pcs"</span><span class="token punctuation">,</span><span class="token keyword">package</span><span class="token operator">:</span><span class="token string">"prepay_id=wx101530337150731019fc4f4e85085f0000"</span><span class="token punctuation">,</span>paySign<span class="token operator">:</span><span class="token string">"C0E5435D1E89E2562048740360E37201"</span><span class="token punctuation">,</span>signType<span class="token operator">:</span><span class="token string">"MD5"</span><span class="token punctuation">,</span>time<span class="token operator">:</span><span class="token string">"2022-07-15 16:46:00"</span><span class="token punctuation">,</span>timeStamp<span class="token operator">:</span><span class="token string">"1657874760"</span><span class="token punctuation">,</span>total_price<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">,</span>_id<span class="token operator">:</span><span class="token string">"5fd1ce998c16885a1972d20b"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">]</span>tobedetail<span class="token punctuation">.</span>data <span class="token operator">=</span> tobedetails<span class="token keyword">this</span><span class="token punctuation">.</span>orderdata <span class="token operator">=</span> tobedetail<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// e 接收tobepaid.vue组件 跳转过来时携带的数据</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 将数据转化为js对象</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>value<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>values <span class="token operator">=</span> value<span class="token comment">// 调用请求方法</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tobedetail</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="待付款再次付款（上）"><a href="#待付款再次付款（上）" class="headerlink" title="待付款再次付款（上）"></a>待付款再次付款（上）</h4><p>在public文件夹中新建 payment.js</p><p><strong>封装一个类，用于待付款的付款请求</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 用于待付款的付款请求</span><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'../api/api.js'</span><span class="token keyword">import</span> urls <span class="token keyword">from</span> <span class="token string">'../api/request.js'</span><span class="token comment">// 待付款</span><span class="token keyword">class</span> <span class="token class-name">Payment</span> <span class="token punctuation">{</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">payment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>payment <span class="token operator">=</span> payment<span class="token punctuation">}</span><span class="token comment">// 1、拉起付款， </span><span class="token function">paySuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wxPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">throw</span> e<span class="token punctuation">}</span><span class="token comment">// 2、查询订单</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> queryorder <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">request</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>queryorderurl，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> queryorder<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">throw</span> <span class="token string">'支付失败'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 调用微信支付</span><span class="token function">wxPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>wx<span class="token punctuation">.</span><span class="token function">requestPayment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  timeStamp<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  nonceStr<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  signType<span class="token operator">:</span> <span class="token string">'MD5'</span><span class="token punctuation">,</span>  paySign<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token parameter">Error</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>   <span class="token function">reject</span><span class="token punctuation">(</span>Error<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>Payment<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在待付款组件中添加点击事件，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">else</span> @click<span class="token operator">=</span><span class="token string">"payMent()"</span><span class="token operator">&gt;</span>付款<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="待付款再次付款（下）"><a href="#待付款再次付款（下）" class="headerlink" title="待付款再次付款（下）"></a>待付款再次付款（下）</h4><p>给方法传值（对象）</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">else</span> @click<span class="token operator">=</span><span class="token string">"payMent({_id:item.id,})"</span><span class="token operator">&gt;</span>付款<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token comment">// 在付款</span><span class="token function">payMent</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>引入付款类</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 引入付款类</span><span class="token keyword">const</span> <span class="token punctuation">{</span>Payment<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../../public/payment.js'</span><span class="token punctuation">)</span><span class="token comment">// 在付款</span><span class="token function">payMent</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">paySucc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>然后去方法类中拿到obj对象参数后，代码如下</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 用于待付款的付款请求</span><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'../api/api.js'</span><span class="token keyword">import</span> urls <span class="token keyword">from</span> <span class="token string">'../api/request.js'</span><span class="token comment">// 待付款</span><span class="token keyword">class</span> <span class="token class-name">Payment</span> <span class="token punctuation">{</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">payment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>payment <span class="token operator">=</span> payment<span class="token punctuation">}</span><span class="token comment">// 1、拉起付款， </span><span class="token keyword">async</span> <span class="token function">paySuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wxPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">throw</span> e<span class="token punctuation">}</span><span class="token comment">// 2、查询订单</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> queryorder <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">request</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>queryorderurl<span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>payment<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>outno<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>payment<span class="token punctuation">.</span>out_trade_no<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> queryorder<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">throw</span> <span class="token string">'支付失败'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 调用微信支付</span><span class="token function">wxPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>wx<span class="token punctuation">.</span><span class="token function">requestPayment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  timeStamp<span class="token operator">:</span> <span class="token string">'this.payment.timeStamp'</span><span class="token punctuation">,</span>  nonceStr<span class="token operator">:</span> <span class="token string">'this.payment.nonceStr'</span><span class="token punctuation">,</span>  <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">'this.payment.package'</span><span class="token punctuation">,</span>  signType<span class="token operator">:</span> <span class="token string">'this.payment.signType'</span><span class="token punctuation">,</span>  paySign<span class="token operator">:</span> <span class="token string">'this.payment.paySign'</span><span class="token punctuation">,</span>  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token parameter">Error</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>   <span class="token function">reject</span><span class="token punctuation">(</span>Error<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>Payment<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时点击tobepaid组件的付款将会弹出二维码，但是由于我这是假数据，仅仅返回一个无权限的数据。</p><p><strong>下一步做在订单详情页的付款按钮的功能</strong></p><p>在order.vue组件中，添加点击事件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-details-play"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"values.sum"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>text @click<span class="token operator">=</span><span class="token string">"conFirm()"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>values<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 右下角按钮（付款、确认收货、评价）</span><span class="token function">conFirm</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>text <span class="token operator">==</span> <span class="token string">'付款'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'正在下单中'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//手动 弹窗</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>orderdata<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">paySuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'支付成功'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token comment">// 支付成功跳转</span>uni<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../personal/personal'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'支付失败（无商品号权限）'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>text <span class="token operator">==</span> <span class="token string">'确认收货'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>text <span class="token operator">==</span> <span class="token string">'评价'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="订单详情页"><a href="#订单详情页" class="headerlink" title="订单详情页"></a>订单详情页</h3><h4 id="删除订单"><a href="#删除订单" class="headerlink" title="删除订单"></a>删除订单</h4><p><strong>在待付款组件tobepaid.vue中，有的商品过期，需要删除</strong></p><p><strong>准备删除接口</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 删除订单</span><span class="token keyword">let</span> deleorder <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deleorder</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> <strong>给删除按钮添加点击事件 deteOrder（_id）</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 付款 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-payment"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果过期，就显示删除订单 否则可以付款<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.expire"</span> @click<span class="token operator">=</span><span class="token string">"deteOrder(item._id)"</span><span class="token operator">&gt;</span>删除订单<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">else</span> @click<span class="token operator">=</span>"<span class="token function">payMent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span>item<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>timeStamp<span class="token operator">:</span>item<span class="token punctuation">.</span>timeStamp<span class="token punctuation">,</span>nonceStr<span class="token operator">:</span>item<span class="token punctuation">.</span>nonceStr<span class="token punctuation">,</span><span class="token keyword">package</span><span class="token operator">:</span>item<span class="token punctuation">.</span>package<span class="token punctuation">,</span>signType<span class="token operator">:</span>item<span class="token punctuation">.</span>signType<span class="token punctuation">,</span>paySign<span class="token operator">:</span>item<span class="token punctuation">.</span>paySign<span class="token punctuation">,</span>out_trade_no<span class="token operator">:</span>item<span class="token punctuation">.</span>out_trade_no<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token operator">&gt;</span>付款<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 删除订单</span><span class="token keyword">async</span> <span class="token function">deteOrder</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> deleorder <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>deleorder <span class="token operator">+</span> <span class="token string">'?orderid'</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>deleorder<span class="token punctuation">,</span><span class="token string">'删除订单'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>deleorder<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//刷新页面</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>deleorder<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">"参数填写错误"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'删除失败（无商品号权限）'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="待发货和待收货"><a href="#待发货和待收货" class="headerlink" title="待发货和待收货"></a>待发货和待收货</h4><h5 id="delivered-vue待发货"><a href="#delivered-vue待发货" class="headerlink" title="**delivered.vue待发货 **"></a>**delivered.vue待发货 **</h5><p>组件中，  代码如下:</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 待发货组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in tbdelivered"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-commodity"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-tips"</span><span class="token operator">&gt;</span>买家已付款<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(items,indexs) in item.order"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"indexs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order"</span> @click<span class="token operator">=</span><span class="token string">"payDetail(item._id)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 图片 <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"items.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>items<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>颜色<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>items<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>尺码<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>items<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 单价、数量 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>￥ <span class="token punctuation">{</span><span class="token punctuation">{</span>items<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>x<span class="token punctuation">{</span><span class="token punctuation">{</span>items<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-Price"</span><span class="token operator">&gt;</span>实付款￥<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>total_price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录界面 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loginpage ref<span class="token operator">=</span><span class="token string">"loginmen"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 没有相关订单 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>ordering ref<span class="token operator">=</span><span class="token string">"orderload"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ordering<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token string">'../../../style/order.css'</span> <span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>tbdelivered<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> tbdelivered <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tbdelivered<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tbdelivered<span class="token punctuation">,</span><span class="token string">'获取待发货数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 如果未登录 调用登录弹窗</span><span class="token keyword">if</span><span class="token punctuation">(</span>tbdelivered<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 如果登录成功后</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>tbdelivered<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 没有待付款数据</span><span class="token keyword">if</span><span class="token punctuation">(</span>tbdelivered<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 就提示没有数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>orderload<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>tbdelivered <span class="token operator">=</span> tbdelivered<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 跳转到商品详情页</span><span class="token function">payDetail</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 准备一个对象传入 ，不能直接从路径携带过去</span><span class="token keyword">let</span> tip <span class="token operator">=</span> <span class="token punctuation">{</span>tips<span class="token operator">:</span><span class="token string">'买家已经付款'</span><span class="token punctuation">,</span>sum<span class="token operator">:</span><span class="token string">'实付款'</span><span class="token punctuation">,</span>show<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否展示付款按钮</span>text<span class="token operator">:</span><span class="token string">'付款'</span><span class="token punctuation">,</span>id<span class="token operator">:</span>id<span class="token punctuation">}</span><span class="token comment">// 将对象数据转化成json字符串 然后传入到跳转的组件里</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tip<span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../order-details/order?value='</span> <span class="token operator">+</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 登录成功后也要刷新数据  接收登录组件传递的值 </span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'mycart'</span><span class="token punctuation">,</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">// 当登录成功后</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>cart <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 调用方法刷新数据</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="received-vue-待收货"><a href="#received-vue-待收货" class="headerlink" title="**received.vue **待收货"></a>**received.vue **待收货</h5><p>组件中，  代码如下:</p><p><strong>ps:  由于待收货接口拿不到数据，这里使用的是待发货的接口</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 待收货组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in gtbreceived"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">'index'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-commodity"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-tips"</span><span class="token operator">&gt;</span>卖家已发货<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(iteming, indexs) in item.order"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">'indexs'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order"</span> @click<span class="token operator">=</span><span class="token string">"payDeatil(item._id)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"iteming.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>颜色<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>尺码<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>￥ <span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>x<span class="token punctuation">{</span><span class="token punctuation">{</span>iteming<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-Price"</span><span class="token operator">&gt;</span>实付款￥<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>total_price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 付款 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-payment"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text @click<span class="token operator">=</span><span class="token string">"conRece(item._id)"</span><span class="token operator">&gt;</span>确认收货<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录界面 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loginpage ref<span class="token operator">=</span><span class="token string">"loginmen"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 没有相关订单 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>ordering ref<span class="token operator">=</span><span class="token string">"orderload"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ordering<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token string">'../../../style/order.css'</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>gtbreceived<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 获取待收货数据</span><span class="token keyword">async</span> <span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 由于待收货接口拿不到数据，这里使用的是待发货的接口</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tbdelivered<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token string">'获取待收货数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>gtbreceived <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 当数据为0 时候，要清空页面数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>orderload<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>gtbreceived <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 订单详情页</span><span class="token function">payDeatil</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> tip <span class="token operator">=</span> <span class="token punctuation">{</span>tips<span class="token operator">:</span><span class="token string">'卖家已发货'</span><span class="token punctuation">,</span>sum<span class="token operator">:</span><span class="token string">'实付款'</span><span class="token punctuation">,</span>show<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>text<span class="token operator">:</span><span class="token string">'确认收货'</span><span class="token punctuation">,</span>id<span class="token punctuation">}</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tip<span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../order-details/order?value='</span> <span class="token operator">+</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 确认收货</span><span class="token keyword">async</span> <span class="token function">conRece</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> conreceipt <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>conreceipt <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>conreceipt<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 刷新数据</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'确认收货成功'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 小程序的生命周期在子组件不会执行</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'mycart'</span><span class="token punctuation">,</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>cart <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后点击待收货进入商品详情组件order.vue，对右下角的确认收货作点击事件</p><p>是</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 右下角按钮（付款、确认收货、评价）</span><span class="token function">conFirm</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>text <span class="token operator">==</span> <span class="token string">'付款'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'正在下单中'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//手动 弹窗</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>orderdata<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">paySuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'支付成功'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token comment">// 支付成功跳转</span>uni<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../personal/personal'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'支付失败（无商品号权限）'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>text <span class="token operator">==</span> <span class="token string">'确认收货'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">conRece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 支付成功跳转</span>uni<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../personal/personal'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 确认收货</span><span class="token keyword">async</span> <span class="token function">conRece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> conreceipt <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>conreceipt <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>conreceipt<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 刷新数据</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'确认收货成功'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="待评价"><a href="#待评价" class="headerlink" title="待评价"></a>待评价</h4><p>使用假数据</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品详情 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in tbevaluated"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">'index'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-commodity"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"order-tips"</span><span class="token operator">&gt;</span>交易完成<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order"</span> @click<span class="token operator">=</span><span class="token string">"payDeatil(item._id)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-order-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>颜色<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>尺码<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"payment-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>￥ <span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-you"</span><span class="token operator">&gt;</span>x<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-Price"</span><span class="token operator">&gt;</span>实付款￥<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>price <span class="token operator">*</span> item<span class="token punctuation">.</span>many<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 去评价 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"presonal-payment"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text @click<span class="token operator">=</span><span class="token string">"conRece(item._id,item.id,item.size,item.color)"</span><span class="token operator">&gt;</span>去评价<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录界面 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loginpage ref<span class="token operator">=</span><span class="token string">"loginmen"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 没有相关订单 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>ordering ref<span class="token operator">=</span><span class="token string">"orderload"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ordering<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token string">'../../../style/order.css'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 假数据</span>tbevaluated<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token string">"5fd1ce998c16885a1972d20b"</span><span class="token punctuation">,</span> <span class="token comment">//订单号</span>id<span class="token operator">:</span><span class="token string">"5f8bbf2823954733542169a1"</span><span class="token punctuation">,</span>color<span class="token operator">:</span><span class="token string">'5526网面-天空蓝'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">"http://h.thexxdd.cn/tianmao/public%5Cuploads%5C1606059327494-4142549.jpg"</span><span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">"37"</span><span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token string">"耐克新款2022 女生白色皮面鞋子高级【店长推荐】"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token string">"5fd1ce998c16885a1972d20b"</span><span class="token punctuation">,</span> <span class="token comment">//订单号</span>id<span class="token operator">:</span><span class="token string">"5f8bbf2823954733542169a1"</span><span class="token punctuation">,</span>color<span class="token operator">:</span><span class="token string">'5526网面-渣渣灰'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">"http://h.thexxdd.cn/tianmao/public%5Cuploads%5C1606059327494-4142549.jpg"</span><span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">"41"</span><span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token string">"361新款2022 男生灰色皮面鞋子【店长推荐】"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 获取待评价数据</span><span class="token keyword">async</span> <span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tbevaluated<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token string">'获取待评价数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 由于没有商户号，待评价接口拿不到数据，这里使用的是假数据当作接口返回的数据</span><span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 如果没有登录 弹出登录框</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginmen<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// this.tbevaluated = [] // 当数据为0 时候，要清空页面数据</span><span class="token comment">// this.$refs.orderload.init() //展示没有数据的提示</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有商品号，使用假数据当作接口返回的数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>     <span class="token comment">// 点击商品跳转到订单详情页</span><span class="token function">payDeatil</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> tip <span class="token operator">=</span> <span class="token punctuation">{</span>tips<span class="token operator">:</span><span class="token string">'交易完成'</span><span class="token punctuation">,</span>sum<span class="token operator">:</span><span class="token string">'实付款'</span><span class="token punctuation">,</span>show<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>text<span class="token operator">:</span><span class="token string">'去评价'</span><span class="token punctuation">,</span>id<span class="token punctuation">,</span>evt<span class="token operator">:</span><span class="token string">'002'</span><span class="token punctuation">}</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tip<span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../order-details/order?value='</span> <span class="token operator">+</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 小程序的生命周期在子组件不会执行</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'mycart'</span><span class="token punctuation">,</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>cart <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Tobepaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后对点击商品跳转到详情组件的功能实现，通过在跳转的方法payDeatil(id)中，传递的参数多加一个evt，当evt为002，就代表是待评价的组件去往详情页，</p><p>然后详情组件中判断evt值进行相应操作</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 请求商品数据的方法</span><span class="token keyword">async</span> <span class="token function">tobedetail</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>evt<span class="token operator">=</span><span class="token string">'001'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 当第二个参数是 evt为001 的时候代表的是 待付款、待发货、待收货的订单详情</span><span class="token comment">// 当第二个参数是 evt为002 的时候代表的是 待评价的订单详情</span><span class="token keyword">if</span><span class="token punctuation">(</span>evt <span class="token operator">==</span> <span class="token string">'001'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> tobedetail <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tobedetail <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 此处因为是没有商户号的购买数据，无法拿到相关数据</span><span class="token comment">// 因此自己创建一个假数组对象当作拿到的tobedetail数据</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tobedetail<span class="token punctuation">,</span><span class="token string">'我是待付款、待发货、待收货的商品数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> tobedetails <span class="token operator">=</span>         <span class="token punctuation">[</span><span class="token punctuation">{</span>consignee<span class="token operator">:</span><span class="token punctuation">{</span>address<span class="token operator">:</span><span class="token string">"阿里巴巴"</span><span class="token punctuation">,</span>city<span class="token operator">:</span><span class="token string">"四川省 成都市 高新区"</span><span class="token punctuation">,</span>mobile<span class="token operator">:</span><span class="token string">"15858588888"</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token string">"马云"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>nonceStr<span class="token operator">:</span><span class="token string">"yybvvcyP6CDZ08E4"</span><span class="token punctuation">,</span>order<span class="token operator">:</span>                <span class="token punctuation">[</span><span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">'5526网面-天空蓝'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">"http://h.thexxdd.cn/tianmao/public%5Cuploads%5C1606059327494-4142549.jpg"</span><span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">"37"</span><span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token string">"耐克新款2022 女生白色皮面鞋子高级【店长推荐】"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>order_number<span class="token operator">:</span><span class="token string">"1607585433768778712"</span><span class="token punctuation">,</span>out_trade_no<span class="token operator">:</span><span class="token string">"2zmCzfDZe6Zr8rKYCz43AbXEe2Kk2Pcs"</span><span class="token punctuation">,</span><span class="token keyword">package</span><span class="token operator">:</span><span class="token string">"prepay_id=wx101530337150731019fc4f4e85085f0000"</span><span class="token punctuation">,</span>paySign<span class="token operator">:</span><span class="token string">"C0E5435D1E89E2562048740360E37201"</span><span class="token punctuation">,</span>signType<span class="token operator">:</span><span class="token string">"MD5"</span><span class="token punctuation">,</span>time<span class="token operator">:</span><span class="token string">"2022-07-15 16:46:00"</span><span class="token punctuation">,</span>timeStamp<span class="token operator">:</span><span class="token string">"1657874760"</span><span class="token punctuation">,</span>total_price<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">,</span>_id<span class="token operator">:</span><span class="token string">"5fd1ce998c16885a1972d20b"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">]</span>tobedetail<span class="token punctuation">.</span>data <span class="token operator">=</span> tobedetails<span class="token keyword">this</span><span class="token punctuation">.</span>orderdata <span class="token operator">=</span> tobedetail<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 待评价组件的商品详情接口数据</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> dtpepage <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dtpepage <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 此处因为是没有商户号的购买数据，拿到是空数据</span><span class="token comment">// 因此自己创建一个假数组对象当作拿到的tobedetail数据</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dtpepage<span class="token punctuation">,</span><span class="token string">'我是待评价组件的商品数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> tobedetails <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>consignee<span class="token operator">:</span><span class="token punctuation">{</span>address<span class="token operator">:</span><span class="token string">"阿里巴巴"</span><span class="token punctuation">,</span>city<span class="token operator">:</span><span class="token string">"四川省 成都市 高新区"</span><span class="token punctuation">,</span>mobile<span class="token operator">:</span><span class="token string">"15858588888"</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token string">"马云"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>nonceStr<span class="token operator">:</span><span class="token string">"yybvvcyP6CDZ08E4"</span><span class="token punctuation">,</span>order<span class="token operator">:</span>                    <span class="token punctuation">[</span><span class="token punctuation">{</span>color<span class="token operator">:</span><span class="token string">'5526网面-天空蓝'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">"http://h.thexxdd.cn/tianmao/public%5Cuploads%5C1606059327494-4142549.jpg"</span><span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token string">"37"</span><span class="token punctuation">,</span>title<span class="token operator">:</span><span class="token string">"耐克新款2022 女生白色皮面鞋子高级【店长推荐】"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>order_number<span class="token operator">:</span><span class="token string">"1607585433768778712"</span><span class="token punctuation">,</span>out_trade_no<span class="token operator">:</span><span class="token string">"2zmCzfDZe6Zr8rKYCz43AbXEe2Kk2Pcs"</span><span class="token punctuation">,</span><span class="token keyword">package</span><span class="token operator">:</span><span class="token string">"prepay_id=wx101530337150731019fc4f4e85085f0000"</span><span class="token punctuation">,</span>paySign<span class="token operator">:</span><span class="token string">"C0E5435D1E89E2562048740360E37201"</span><span class="token punctuation">,</span>signType<span class="token operator">:</span><span class="token string">"MD5"</span><span class="token punctuation">,</span>time<span class="token operator">:</span><span class="token string">"2022-07-15 16:46:00"</span><span class="token punctuation">,</span>timeStamp<span class="token operator">:</span><span class="token string">"1657874760"</span><span class="token punctuation">,</span>total_price<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">,</span>_id<span class="token operator">:</span><span class="token string">"5fd1ce998c16885a1972d20b"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">]</span>dtpepage<span class="token punctuation">.</span>data <span class="token operator">=</span> tobedetails<span class="token keyword">this</span><span class="token punctuation">.</span>orderdata <span class="token operator">=</span> dtpepage<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="商品评价（上）"><a href="#商品评价（上）" class="headerlink" title="商品评价（上）"></a>商品评价（上）</h4><p>在evaluated.vue组件中，点击评价后跳转到新的组件中，</p><p>在pages/order-details/<strong>新建pu-coments.vue文件</strong>，同时去page.json注册</p><p>静态布局：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 描述 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pu-coments-input"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>textarea  placeholder<span class="token operator">=</span><span class="token string">"宝贝满足你的期待吗？说说它的优点和美中不足的地方吧"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"tipsdata"</span> maxlength<span class="token operator">=</span><span class="token string">"200"</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 上传图片 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Upload-pictures"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Upload-button"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/uptu.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conteng"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conteng-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"http://h.thexxdd.cn/tianmao/public%5Cuploads%5C1606059327494-4142549.jpg"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span>  <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"uploadimg"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/guanbi.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"deleteimg"</span> @click<span class="token operator">=</span><span class="token string">"deteImg(index)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 提交 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Su-comments"</span> @click<span class="token operator">=</span><span class="token string">"subMit()"</span><span class="token operator">&gt;</span>提交评论<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>page<span class="token punctuation">{</span>background<span class="token operator">:</span> #eeeeee<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pu<span class="token operator">-</span>coments<span class="token operator">-</span>input<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">350</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pu<span class="token operator">-</span>coments<span class="token operator">-</span>input textarea<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span> color<span class="token operator">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!</span>important<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>rpx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">350</span>rpx<span class="token punctuation">;</span>overflow<span class="token operator">-</span>y<span class="token operator">:</span> auto<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>Upload<span class="token operator">-</span>button<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">130</span>rpx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">130</span>rpx<span class="token punctuation">;</span> padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span> padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">5</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>Upload<span class="token operator">-</span>button image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">130</span>rpx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">130</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>Upload<span class="token operator">-</span>pictures<span class="token punctuation">{</span>margin<span class="token operator">:</span> <span class="token number">15</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 上传图片 */</span><span class="token punctuation">.</span>conteng<span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>conteng<span class="token operator">-</span>img<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token operator">%</span> <span class="token operator">-</span> <span class="token number">10</span>rpx<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">150</span>rpx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span>position<span class="token operator">:</span> relative<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>conteng<span class="token operator">-</span>img image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">150</span>rpx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">6</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>deleteimg<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">33</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">33</span>upx <span class="token operator">!</span>important<span class="token punctuation">;</span>position<span class="token operator">:</span> absolute<span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">0</span>upx<span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 提交评论 */</span><span class="token punctuation">.</span>Su<span class="token operator">-</span>comments<span class="token punctuation">{</span>background<span class="token operator">-</span>color<span class="token operator">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>rpx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">100</span>rpx<span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="商品评价（下）"><a href="#商品评价（下）" class="headerlink" title="商品评价（下）"></a>商品评价（下）</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 描述 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"pu-coments-input"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>textarea  placeholder<span class="token operator">=</span><span class="token string">"宝贝满足你的期待吗？说说它的优点和美中不足的地方吧"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"tipsdata"</span> maxlength<span class="token operator">=</span><span class="token string">"200"</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 上传图片 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Upload-pictures"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用计算属性 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Upload-button"</span> @click<span class="token operator">=</span><span class="token string">"uploadImg()"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"upbutton"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/uptu.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conteng"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in upimg"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"conteng-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span>item mode<span class="token operator">=</span><span class="token string">"aspectFill"</span>  <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"uploadimg"</span>  @click<span class="token operator">=</span><span class="token string">"preImage(index,upimg)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/guanbi.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"deleteimg"</span> @click<span class="token operator">=</span><span class="token string">"deteImg(index)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 提交 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Su-comments"</span> @click<span class="token operator">=</span><span class="token string">"subMit()"</span><span class="token operator">&gt;</span>提交评论<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入预览图片js</span><span class="token keyword">const</span> <span class="token punctuation">{</span>Login<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../public/logic.js'</span><span class="token punctuation">)</span> <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">// 双向绑定的input框文本</span>tipsdata<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>upimg<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">//准备上传的图片信息</span>comming<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//接收上个组件的数据</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 上传图片 使用微信的接口</span><span class="token function">uploadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>wx<span class="token punctuation">.</span><span class="token function">chooseMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//图片张数</span>  mediaType<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">,</span><span class="token string">'video'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//文件类型</span>  sizeType<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'compressed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">//仅对 mediaType 为 image 时有效，是否压缩所选文件</span>  sourceType<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">,</span> <span class="token string">'camera'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//图片和视频选择的来源</span>  maxDuration<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span><span class="token comment">//拍摄视频最长拍摄时间，单位秒。时间范围为 3s 至 60s 之间。不限制相册。</span>  <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'等待上传'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//加载提示</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span><span class="token string">'拍摄或从手机相册中选择图片或视频'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cloudImg</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFiles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function-variable function">fail</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 微信提供 上传图片到服务器方法</span><span class="token function">cloudImg</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span><span class="token punctuation">{</span>wx<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'https://meituan.thexxdd.cn/api/potimg'</span><span class="token punctuation">,</span>filePath<span class="token operator">:</span>image<span class="token punctuation">,</span> <span class="token comment">//要上传文件资源的路径 (本地路径)</span>name<span class="token operator">:</span><span class="token string">'file'</span><span class="token punctuation">,</span>  <span class="token comment">//文件对应的 key，开发者在服务端可以通过这个 key 获取文件的二进制内容</span><span class="token function-variable function">success</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span><span class="token string">'上传图片到服务器'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>upimg<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'上传成功'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 预览图片</span><span class="token function">preImage</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>upimg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Login</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>upimg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">previewImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 删除图片</span><span class="token function">deteImg</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>upimg<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 提交评论</span><span class="token keyword">async</span> <span class="token function">subMit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'正在提交'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 拿到评论接口需要的参数</span><span class="token keyword">let</span> <span class="token punctuation">{</span>_id<span class="token punctuation">,</span>id<span class="token punctuation">,</span>size<span class="token punctuation">,</span>color<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>comming<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>orderid<span class="token operator">:</span>_id<span class="token punctuation">,</span>commid<span class="token operator">:</span>id<span class="token punctuation">,</span>size<span class="token punctuation">,</span>color<span class="token punctuation">,</span>comment<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>tipsdata<span class="token punctuation">,</span>commimage<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>upimg<span class="token punctuation">}</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>subcomm<span class="token punctuation">,</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token string">'提交评论'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'评论成功'</span><span class="token punctuation">,</span><span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span> <span class="token string">'../personal/personal'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//使用计算属性完成 当图片数量达到2时，隐藏上传入口</span>computed<span class="token operator">:</span><span class="token punctuation">{</span><span class="token function">upbutton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>upimg<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 接收上个组件传递的数据</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>comming <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>待评价页面进入商品详情页         <strong>order.vue</strong> 中的 <strong>去评价</strong> 功能</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>text <span class="token operator">==</span> <span class="token string">'去评价'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> <span class="token punctuation">{</span>_id<span class="token punctuation">,</span>id<span class="token punctuation">,</span>size<span class="token punctuation">,</span>color<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderdata<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>order<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">,</span>id<span class="token punctuation">,</span>size<span class="token punctuation">,</span>color<span class="token punctuation">}</span><span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../order-details/pu-coments?data='</span> <span class="token operator">+</span> data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 然后打开<strong>my文件夹下 my.vue</strong> 设置跳转到各个组件详情页方法</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 跳转到各板块组件 --详情页</span><span class="token function">myIng</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../personal/personal?index='</span> <span class="token operator">+</span> index<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="商品分类"><a href="#商品分类" class="headerlink" title="商品分类"></a>商品分类</h3><h4 id="商品一级分类"><a href="#商品一级分类" class="headerlink" title="商品一级分类"></a>商品一级分类</h4><p><strong>sort.vue组件 静态布局</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 左边 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-left"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-name"</span> <span class="token operator">&gt;</span>潮流男装<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 右边 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-right"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-name sort-title"</span><span class="token operator">&gt;</span>潮流男装<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-goods"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"iteming.name_image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span>图片<span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>外套<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>sort<span class="token operator">-</span>view <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sort<span class="token operator">-</span>left <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">150</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #f8f8f8<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>vh<span class="token punctuation">;</span>overflow<span class="token operator">-</span>y<span class="token operator">:</span> auto<span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sort<span class="token operator">-</span>right <span class="token punctuation">{</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>margin<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">150</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sort<span class="token operator">-</span>name <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>activesort <span class="token punctuation">{</span>background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* right */</span><span class="token punctuation">.</span>sort<span class="token operator">-</span>title <span class="token punctuation">{</span>text<span class="token operator">-</span>align<span class="token operator">:</span> left <span class="token operator">!</span>important<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sort<span class="token operator">-</span>flex <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sort<span class="token operator">-</span>flex image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> block<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sort<span class="token operator">-</span>goods text <span class="token punctuation">{</span>padding<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>sort<span class="token operator">-</span>goods <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">33.333</span><span class="token operator">%</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">40</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>完整逻辑</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 左边 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-left"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item, index) in comclass"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 动态的背景色：条件是下标值和num相等<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-name"</span> <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{ activesort: index == num }"</span> @click<span class="token operator">=</span><span class="token string">"sortSwitch(index,item.cid)"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>sort <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 右边 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-right"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item, index) in secondclass"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-name sort-title"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>sort <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-flex"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(iteming, indexs) in item.secon_classif"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"indexs"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sort-goods"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"iteming.name_image"</span> mode<span class="token operator">=</span><span class="token string">"aspectFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> iteming<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>comclass<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//左侧一级数据</span>secondclass<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//右侧二级数据</span>num<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// comclass</span><span class="token comment">// 请求商品一级分类接口</span><span class="token keyword">async</span> <span class="token function">sortRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token keyword">let</span> comclass <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>comclass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>comclass<span class="token punctuation">,</span> <span class="token string">'商品一级接口'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>comclass <span class="token operator">=</span> comclass<span class="token punctuation">.</span>data<span class="token punctuation">;</span><span class="token comment">// 进入页面默认请求选中的分类下的商品</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">seCond</span><span class="token punctuation">(</span>comclass<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 选中左侧菜单项</span><span class="token function">sortSwitch</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>cid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> index<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">seCond</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span> <span class="token comment">//每次点击左侧都会有不同的cid参数传入 二级请求方法</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 请求商品二级分类接口</span><span class="token keyword">async</span> <span class="token function">seCond</span><span class="token punctuation">(</span><span class="token parameter">cid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token keyword">let</span> secondclass <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>secondclass <span class="token operator">+</span> <span class="token string">'?cid='</span> <span class="token operator">+</span> cid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>secondclass<span class="token punctuation">,</span> <span class="token string">'商品二级接口'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>secondclass <span class="token operator">=</span> secondclass<span class="token punctuation">.</span>data<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sortRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="商品二级分类"><a href="#商品二级分类" class="headerlink" title="商品二级分类"></a>商品二级分类</h4><p>在pages下新建 <strong>class-goods文件夹</strong>，在其下新建<strong>goods.vue文件</strong></p><p><strong>静态布局如下：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 排序 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"condition-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>全部<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>销量<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>价格<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/jiantou.svg"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view style<span class="token operator">=</span><span class="token string">"height: 70rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Commodity <span class="token operator">:</span>commdata<span class="token operator">=</span><span class="token string">"commdata"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Commodity<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>page <span class="token punctuation">{</span>background<span class="token operator">:</span> #f4f4f4<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>condition<span class="token operator">-</span>view <span class="token punctuation">{</span>background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>around<span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>condition<span class="token operator">-</span>view image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>condition<span class="token operator">-</span>view text <span class="token punctuation">{</span>padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>condition<span class="token operator">-</span>view view <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">999</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>active <span class="token punctuation">{</span>color<span class="token operator">:</span> #dd2727 <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>admining <span class="token punctuation">{</span>transform<span class="token operator">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">180</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在sort.vue组件中，点击商品携带俩个参数到商品分类goods.vue组件中</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 点击商品跳转到分类详情页</span><span class="token function">sortIng</span><span class="token punctuation">(</span><span class="token parameter">cid<span class="token punctuation">,</span>name</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>cid<span class="token punctuation">,</span>name<span class="token punctuation">}</span><span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../class-goods/goods?data='</span> <span class="token operator">+</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>goods.vue组件中，onLoad（e）接收俩参数</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 二级分类详情组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 排序 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"condition-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in sorting"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{active : index == num}"</span> @click<span class="token operator">=</span><span class="token string">"sortImg(index)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">'item.image'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view style<span class="token operator">=</span><span class="token string">"height: 70rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Card <span class="token operator">:</span>commdata<span class="token operator">=</span><span class="token string">"commdata"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入公用的组件 --懒加载卡片</span><span class="token keyword">import</span> Card <span class="token keyword">from</span> <span class="token string">'../commponents/card.vue'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>components<span class="token operator">:</span><span class="token punctuation">{</span>Card<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>num<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>querydata<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">//查询值</span>sorting<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>text<span class="token operator">:</span><span class="token string">'全部'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>text<span class="token operator">:</span><span class="token string">'销量'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>text<span class="token operator">:</span><span class="token string">'价格'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">'/static/details/jiantou.svg'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>commdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//二级分类下的商品数据</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token function">sortImg</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> index<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 进入页面后执行的 查询二级分类下的商品</span><span class="token keyword">async</span> <span class="token function">goodsRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> <span class="token punctuation">{</span>cid<span class="token punctuation">,</span>name<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>querydata<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token string">'?cid='</span> <span class="token operator">+</span> cid <span class="token operator">+</span> <span class="token string">'&amp;name='</span> <span class="token operator">+</span> nameconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> queryclass <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>queryclass <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>queryclass<span class="token punctuation">,</span><span class="token string">'二级分类下的商品'</span><span class="token punctuation">)</span>                <span class="token comment">// 将接口拿到的数据 传递给卡片流组件</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> queryclass<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment">// 接收sort组件传递进来的数据并保存到data中</span><span class="token keyword">this</span><span class="token punctuation">.</span>querydata <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>querydata<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">goodsRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>默认展示的是全部的商品，接下来完成排序查询</strong></p><h4 id="按销量、按价格查询商品"><a href="#按销量、按价格查询商品" class="headerlink" title="按销量、按价格查询商品"></a>按销量、按价格查询商品</h4><p>思路：</p><p>通过切换按钮时，下标不同，就触发不同的请求方法</p><p>下标为0 <strong>全部 按钮执行 goodsRequest( )方法</strong></p><p>下标为1 <strong>销量 按钮执行 goodsRequest( )方法</strong></p><p>下标为2 <strong>价格 按钮执行 goodsRequest( )方法</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">sortImg</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> index<span class="token comment">// 当下标为0 即处于全部按钮 调用全部商品接口</span><span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">goodsRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 当下标为1 即处于 销量 按钮</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 每次点击销量按钮 值都会改变  1 或者 -1  --即升序或者降序排列</span><span class="token keyword">this</span><span class="token punctuation">.</span>savo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>savo <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">qsFun</span><span class="token punctuation">(</span><span class="token string">'001'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>savo<span class="token punctuation">)</span><span class="token comment">// 当下标为2 即处于 价格 按钮 </span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>rotate <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rotate <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token keyword">this</span><span class="token punctuation">.</span>pri <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pri <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">qsFun</span><span class="token punctuation">(</span><span class="token string">'002'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>pri<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> <strong>good.vue完整代码</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 二级分类详情组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 排序 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"condition-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in sorting"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{active : index == num}"</span> @click<span class="token operator">=</span><span class="token string">"sortImg(index)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text <span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">'item.image'</span> <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{admining : rotate}"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view style<span class="token operator">=</span><span class="token string">"height: 70rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Card <span class="token operator">:</span>commdata<span class="token operator">=</span><span class="token string">"commdata"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 引入公用的组件 --懒加载卡片</span><span class="token keyword">import</span> Card <span class="token keyword">from</span> <span class="token string">'../commponents/card.vue'</span><span class="token comment">// node.js 的 qs模块</span><span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>components<span class="token operator">:</span><span class="token punctuation">{</span>Card<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>num<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>querydata<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">//查询值</span>sorting<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>text<span class="token operator">:</span><span class="token string">'全部'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>text<span class="token operator">:</span><span class="token string">'销量'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>text<span class="token operator">:</span><span class="token string">'价格'</span><span class="token punctuation">,</span>image<span class="token operator">:</span><span class="token string">'/static/details/jiantou.svg'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>commdata<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//二级分类下的商品数据</span>savo<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 按销量默认为1 代表升序</span>pri<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 按价格</span>rotate<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//箭头默认朝下</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token function">sortImg</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> index<span class="token comment">// 当下标为0 即处于全部按钮 调用全部商品接口</span><span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">goodsRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 当下标为1 即处于 销量 按钮</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 每次点击销量按钮 值都会改变  1 或者 -1  --即升序或者降序排列</span><span class="token keyword">this</span><span class="token punctuation">.</span>savo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>savo <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">qsFun</span><span class="token punctuation">(</span><span class="token string">'001'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>savo<span class="token punctuation">)</span><span class="token comment">// 当下标为2 即处于 价格 按钮 </span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>rotate <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rotate <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token keyword">this</span><span class="token punctuation">.</span>pri <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pri <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">qsFun</span><span class="token punctuation">(</span><span class="token string">'002'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>pri<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 进入页面后执行的 查询二级分类下的商品</span><span class="token keyword">async</span> <span class="token function">goodsRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> <span class="token punctuation">{</span>cid<span class="token punctuation">,</span>name<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>querydata<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token string">'?cid='</span> <span class="token operator">+</span> cid <span class="token operator">+</span> <span class="token string">'&amp;name='</span> <span class="token operator">+</span> nameconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> queryclass <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>queryclass <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> queryclass<span class="token punctuation">.</span>dataconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata<span class="token punctuation">,</span><span class="token string">'二级分类下的商品数据'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 查询商品（按销量、价格）</span><span class="token function">qsFun</span><span class="token punctuation">(</span><span class="token parameter">spvalue<span class="token punctuation">,</span>number</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token string">'?cid='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>querydata<span class="token punctuation">.</span>cid <span class="token operator">+</span> <span class="token string">'&amp;name='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token comment">//  qs.stringify 把一个参数对象格式化为字符串 获得参数 param</span><span class="token keyword">const</span> param <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>cid<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>querydata<span class="token punctuation">.</span>cid<span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>querydata<span class="token punctuation">.</span>name<span class="token punctuation">,</span>spvalue<span class="token punctuation">,</span>spvalue<span class="token punctuation">,</span>number<span class="token punctuation">,</span>number<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span><span class="token string">'查询商品（按销量、按价格）'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">queryCod</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 调用查询商品接口</span><span class="token keyword">async</span> <span class="token function">queryCod</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> querycod <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>querycod <span class="token operator">+</span> <span class="token string">'?'</span> <span class="token operator">+</span> param<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>querycod<span class="token punctuation">,</span><span class="token string">'查询商品（按销量、按价格）'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>commdata <span class="token operator">=</span> querycod<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 接收到分类组件传递来的第一级分类数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>querydata <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>querydata<span class="token punctuation">,</span><span class="token string">'接收到分类组件传递来的第一级分类数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">goodsRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h3><p><strong>pages/shopping/shopping.vue组件中</strong></p><h4 id="静态布局"><a href="#静态布局" class="headerlink" title="静态布局"></a>静态布局</h4><p>代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"manage-tli"</span><span class="token operator">&gt;</span>完成<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view style<span class="token operator">=</span><span class="token string">"margin-bottom: 150rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-goods"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-goods-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>image  src<span class="token operator">=</span><span class="token string">"/static/details/xuanzhong.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image  src<span class="token operator">=</span><span class="token string">"/static/details/weixuan.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">""</span> mode<span class="token operator">=</span><span class="token string">"scaleToFill"</span><span class="token operator">&gt;</span>图片<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick-gight"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick-right"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>标题<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick-sku"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>尺码<span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>颜色<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/jiantou.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>¥<span class="token number">100</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-price-nums"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 底部结算 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/weixuan.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>image v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"selectall"</span> src<span class="token operator">=</span><span class="token string">"/static/details/xuanzhong.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> @click<span class="token operator">=</span><span class="token string">"selectAll('deall')"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-tips"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"total-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>总价合计<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>¥ <span class="token number">100</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-money"</span><span class="token operator">&gt;</span>结算<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-money"</span><span class="token operator">&gt;</span>删除<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> sku组件<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Addtocart ref<span class="token operator">=</span><span class="token string">"addto"</span> <span class="token operator">:</span>skudata<span class="token operator">=</span><span class="token string">"skudata"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Addtocart<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录界面 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loginpage ref<span class="token operator">=</span><span class="token string">"loginmen"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 购物车没有数据的提示<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"empty-cart"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!emcart"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/kongcart.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>购物车竟然是空的<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>emcart<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>page <span class="token punctuation">{</span>background<span class="token operator">:</span> #f2f2f2<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>view <span class="token punctuation">{</span>margin<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>manage<span class="token operator">-</span>tli <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">6</span>b6b6b<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">80</span>upx<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> right<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 商品 */</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>goods <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span><span class="token comment">/* height: 340upx; */</span>background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">20</span>upx <span class="token number">10</span>upx<span class="token punctuation">;</span>margin<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">15</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>goods<span class="token operator">-</span>Coupon <span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token number">70</span>upx<span class="token punctuation">;</span><span class="token comment">/* background: #4CD964; */</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> flex<span class="token operator">-</span>end<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>chick <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>chick image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>chick<span class="token operator">-</span>img <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">15</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>chick<span class="token operator">-</span>img image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>chick<span class="token operator">-</span>gight view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>display<span class="token operator">:</span> <span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token punctuation">;</span><span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token operator">-</span>orient<span class="token operator">:</span> vertical<span class="token punctuation">;</span><span class="token operator">-</span>webkit<span class="token operator">-</span>line<span class="token operator">-</span>clamp<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>overflow<span class="token operator">:</span> hidden<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>chick<span class="token operator">-</span>right image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">8</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>chick<span class="token operator">-</span>sku <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">25</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #<span class="token number">999999</span><span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #f9f9f9<span class="token punctuation">;</span>display<span class="token operator">:</span> inline<span class="token operator">-</span>flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>margin<span class="token operator">:</span> <span class="token number">17</span>upx <span class="token number">0</span><span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">5</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>price <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span><span class="token comment">/* background: #9ACD32; */</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>price view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>color<span class="token operator">:</span> #f75807<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>price<span class="token operator">-</span>nums <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>border<span class="token operator">:</span> <span class="token number">1</span>px solid #f9f9f9<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">200</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>price<span class="token operator">-</span>nums view <span class="token punctuation">{</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>price<span class="token operator">-</span>nums view<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>border<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">1</span>px solid #f9f9f9<span class="token punctuation">;</span>border<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">1</span>px solid #f9f9f9<span class="token punctuation">;</span>padding<span class="token operator">:</span> <span class="token number">0</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>goods<span class="token operator">-</span>view <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>shopp<span class="token operator">-</span>chick<span class="token operator">-</span>gight <span class="token punctuation">{</span>flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>Special<span class="token operator">-</span>rate <span class="token punctuation">{</span>color<span class="token operator">:</span> #ff5000<span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">50</span>upx<span class="token punctuation">;</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* 结算 */</span><span class="token punctuation">.</span>settlement<span class="token operator">-</span>view <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">28</span>upx<span class="token punctuation">;</span>background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>border<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">1</span>px solid #f2f2f2<span class="token punctuation">;</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>settlement<span class="token operator">-</span>img <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>settlement<span class="token operator">-</span>img image <span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">45</span>upx<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">20</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>total<span class="token operator">-</span>view <span class="token punctuation">{</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>total<span class="token operator">-</span>view text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>total<span class="token operator">-</span>view text<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>color<span class="token operator">:</span> #ff4401<span class="token punctuation">;</span>padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">10</span>upx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>settlement<span class="token operator">-</span>money <span class="token punctuation">{</span>background<span class="token operator">:</span> #fe0036<span class="token punctuation">;</span>height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">90</span>upx<span class="token punctuation">;</span>width<span class="token operator">:</span> <span class="token number">220</span>upx<span class="token punctuation">;</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">30</span>upx<span class="token punctuation">;</span>color<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>settlement<span class="token operator">-</span>tips <span class="token punctuation">{</span>text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="拉取购物车数据"><a href="#拉取购物车数据" class="headerlink" title="拉取购物车数据"></a>拉取购物车数据</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-view"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"emcart"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"manage-tli"</span> @click<span class="token operator">=</span><span class="token string">"adMinis()"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>editdata<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view style<span class="token operator">=</span><span class="token string">"margin-bottom: 150rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>block v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in mycarturl"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-goods"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 商品 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-goods-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 选中的圆圈样式 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 选中图标 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image  v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.choice"</span> src<span class="token operator">=</span><span class="token string">"/static/details/xuanzhong.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 未选中图标 <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>image v<span class="token operator">-</span><span class="token keyword">else</span> src<span class="token operator">=</span><span class="token string">"/static/details/weixuan.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"item.image"</span> mode<span class="token operator">=</span><span class="token string">"scaleToFill"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick-gight"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick-right"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick-sku"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/jiantou.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>¥<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-price-nums"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 底部结算 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/weixuan.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>image v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"selectall"</span> src<span class="token operator">=</span><span class="token string">"/static/details/xuanzhong.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> @click<span class="token operator">=</span><span class="token string">"selectAll('deall')"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-tips"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"settips"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"total-view"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>总价合计<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>¥ <span class="token number">100</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-money"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"settips"</span><span class="token operator">&gt;</span>结算<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-money"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"!settips"</span><span class="token operator">&gt;</span>删除<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> sku组件<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Addtocart ref<span class="token operator">=</span><span class="token string">"addto"</span> <span class="token operator">:</span>skudata<span class="token operator">=</span><span class="token string">"skudata"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Addtocart<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录界面 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>loginpage ref<span class="token operator">=</span><span class="token string">"loginmen"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loginpage<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 购物车没有数据的提示<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"empty-cart"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!emcart"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/kongcart.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>购物车竟然是空的<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用 全局引入的登录弹窗 组件<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>showmodal ref<span class="token operator">=</span><span class="token string">"show"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>showmodal<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>emcart<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>mycarturl<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">//购物车数据</span>editdata<span class="token operator">:</span><span class="token string">'管理'</span><span class="token punctuation">,</span>settips<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//默认展示右下角 结算还是删除</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 获取购物车数据</span><span class="token keyword">async</span> <span class="token function">ShoppingRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> mycarturl <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mycarturl<span class="token punctuation">,</span><span class="token string">'获取到的购物车数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>mycarturl<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 401 表示没有方法权限或者没有登录  使用 全局引入的登录弹窗 组件里的方法</span><span class="token comment">// 登陆这里传值过去 'coll' </span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>show<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token string">'coll'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>mycarturl<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 购物车没数据的情况</span><span class="token keyword">if</span><span class="token punctuation">(</span>mycarturl<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>mycarturl <span class="token operator">=</span> mycarturl<span class="token punctuation">.</span>data<span class="token comment">// 显示提示</span><span class="token keyword">this</span><span class="token punctuation">.</span>emcart <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>emcart <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 管理、完成与删除的切换 </span><span class="token function">adMinis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>editdata <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editdata <span class="token operator">==</span> <span class="token string">'管理'</span><span class="token operator">?</span> <span class="token string">'完成'</span> <span class="token operator">:</span> <span class="token string">'管理'</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>editdata <span class="token operator">==</span> <span class="token string">'完成'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 要不是趁年轻</span><span class="token keyword">this</span><span class="token punctuation">.</span>settips <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>editdata <span class="token operator">==</span> <span class="token string">'管理'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>settips <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ShoppingRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 当登录成功后刷新页面 </span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'mycart'</span><span class="token punctuation">,</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// res就是收到的值 这里是来自于loain-oage.vue中的 cart: "SUCCESS"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span><span class="token string">'我是收到的data'</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>cart <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 如果登录成功就 获取收货地址</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ShoppingRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>scrip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="计算已选中的合计总价"><a href="#计算已选中的合计总价" class="headerlink" title="计算已选中的合计总价"></a>计算已选中的合计总价</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 获取购物车数据</span><span class="token keyword">async</span> <span class="token function">ShoppingRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> mycarturl <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mycarturl<span class="token punctuation">,</span><span class="token string">'获取到的购物车数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>mycarturl<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>errcode <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 401 表示没有方法权限或者没有登录  使用 全局引入的登录弹窗 组件里的方法</span><span class="token comment">// 登陆这里传值过去 'coll' </span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>show<span class="token punctuation">.</span><span class="token function">showing</span><span class="token punctuation">(</span><span class="token string">'coll'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>mycarturl<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 购物车有数据的情况</span><span class="token keyword">if</span><span class="token punctuation">(</span>mycarturl<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>mycarturl <span class="token operator">=</span> mycarturl<span class="token punctuation">.</span>data <span class="token comment">//获取数据</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">coselect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 计算价格</span><span class="token keyword">this</span><span class="token punctuation">.</span>emcart <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">//不展示提示</span><span class="token comment">// 购物车没有数据的情况</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>emcart <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 显示提示</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 计算单个商品总价</span><span class="token function">coselect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 过滤出数组中 choice为 true的对象     filter会将目标对象放到新数组中</span><span class="token keyword">let</span> filselect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>choice<span class="token punctuation">)</span><span class="token comment">// 取出被选中的 数组中的的总价</span><span class="token keyword">this</span><span class="token punctuation">.</span>mapselect <span class="token operator">=</span> filselect<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>total_price<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>       <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>结算和删除按钮的功能</strong></p><p>通过计算属性，当勾选长度为0，没有勾选数据就返回一个disable值为false</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">computed<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//计算总价之和</span><span class="token function">total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 判断是否有勾选的数据 </span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mapselect<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>price<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>disable<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span>  <span class="token comment">//返回一个总价 值为0</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">let</span> numdata <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">this</span><span class="token punctuation">.</span>mapselect<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>numdata <span class="token operator">+=</span> item<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token punctuation">{</span>price<span class="token operator">:</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token punctuation">(</span>numdata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>disable<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token comment">//解决浮点数</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-money"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"settips"</span> @click<span class="token operator">=</span><span class="token string">"total.disable &amp;&amp; semEnt()"</span><span class="token operator">&gt;</span>结算<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-money"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"!settips"</span> @click<span class="token operator">=</span><span class="token string">"total.disable &amp;&amp; deLece()"</span><span class="token operator">&gt;</span>删除<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 结算</span><span class="token function">semEnt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'结算'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 删除</span><span class="token function">delece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="单个商品选中和取消选中"><a href="#单个商品选中和取消选中" class="headerlink" title="单个商品选中和取消选中"></a>单个商品选中和取消选中</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 选中的圆圈样式 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 选中图标 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image  v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"item.choice"</span> @click<span class="token operator">=</span><span class="token string">"seLect(item._id,'unchecked')"</span>  <span class="token number">1</span>src<span class="token operator">=</span><span class="token string">"/static/details/xuanzhong.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 未选中图标 <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>image v<span class="token operator">-</span><span class="token keyword">else</span>  @click<span class="token operator">=</span><span class="token string">"seLect(item._id,'select')"</span> src<span class="token operator">=</span><span class="token string">"/static/details/weixuan.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 单个商品选中或取消</span><span class="token keyword">async</span> <span class="token function">seLect</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>nums</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'请求中'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> selecting <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>selecting<span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token operator">:</span>id<span class="token punctuation">,</span>nums<span class="token operator">:</span>nums<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>selecting<span class="token punctuation">,</span><span class="token string">'单个商品选中或取消'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ShoppingRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="购物车加减商品数量"><a href="#购物车加减商品数量" class="headerlink" title="购物车加减商品数量"></a>购物车加减商品数量</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 价格 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-price"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>¥<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-price-nums"</span><span class="token operator">&gt;</span>        <span class="token comment">//当商品数量为1的时候静止点击减按钮</span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"item.many === 1 ? false : true &amp;&amp; reDuce(item._id,item.many,item.price)"</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>many<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view @click<span class="token operator">=</span><span class="token string">"pLus(item._id,item.many,item.price)"</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">//结算后边的数字 由 many 控制</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-money"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"settips"</span> @click<span class="token operator">=</span><span class="token string">"total.disable &amp;&amp; semEnt()"</span><span class="token operator">&gt;</span>结算<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">(</span>mapselect<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-money"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"!settips"</span> @click<span class="token operator">=</span><span class="token string">"total.disable &amp;&amp; deLece()"</span><span class="token operator">&gt;</span>删除<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 加减商品数量请求</span><span class="token keyword">async</span> <span class="token function">shoppingNumber</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>many<span class="token punctuation">,</span>price</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'请求中'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> pridec  <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pride<span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token operator">:</span>id<span class="token punctuation">,</span>many<span class="token operator">:</span>many<span class="token punctuation">,</span>price<span class="token operator">:</span>price<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ShoppingRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 减</span><span class="token function">reDuce</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>many<span class="token punctuation">,</span>price</span><span class="token punctuation">)</span><span class="token punctuation">{</span>many <span class="token operator">--</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">shoppingNumber</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>many<span class="token punctuation">,</span>price<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 加</span><span class="token function">pLus</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>many<span class="token punctuation">,</span>price</span><span class="token punctuation">)</span><span class="token punctuation">{</span>many <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">shoppingNumber</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>many<span class="token punctuation">,</span>price<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="全选和取消全选"><a href="#全选和取消全选" class="headerlink" title="全选和取消全选"></a>全选和取消全选</h4><p><strong>思路：</strong>在计算属性中，添加一个方法：</p><p><strong>判断之前过滤出选的中商品的数组长度 如果等于了购物车里数据长度  就表示全选了所有商品</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 控制全选和取消全选</span><span class="token function">selectall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 判断之前过滤出选中了的商品的数组的长度 如果等于了购物车里数据长度  就表示全选了所有商品</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mapselect<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>将计算属性返回的方法布尔值通过v-if分别绑定给未全选和全选。</strong></p><p><strong>同时给按钮（圆圈）添加点击事件，在点击事件中发起请求，并刷新页面</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-img"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 未全选 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!selectall"</span> @click<span class="token operator">=</span><span class="token string">"quanxuan('seall')"</span> src<span class="token operator">=</span><span class="token string">"/static/details/weixuan.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 全选 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"selectall"</span> @click<span class="token operator">=</span><span class="token string">"quanxuan('deall')"</span>  src<span class="token operator">=</span><span class="token string">"/static/details/xuanzhong.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span> <span class="token operator">&gt;</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 全选商品</span><span class="token keyword">async</span> <span class="token function">quanxuan</span><span class="token punctuation">(</span><span class="token parameter">idft</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'请求中'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> selectall  <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>selectall <span class="token operator">+</span> <span class="token string">'?idft='</span> <span class="token operator">+</span> idft<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>selectall<span class="token punctuation">,</span><span class="token string">'全选商品'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ShoppingRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="删除购物车商品"><a href="#删除购物车商品" class="headerlink" title="删除购物车商品"></a>删除购物车商品</h4><p>点击删除按钮，删除选中的商品</p><p>由接口可知，<strong>删除请求需要携带的参数是已经勾选的商品_id</strong>，所以将已经勾选的商品数组中的  _id单独 拿出存放到新数组中</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"settlement-money"</span> v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"!settips"</span> @click<span class="token operator">=</span><span class="token string">"total.disable &amp;&amp; deLece()"</span><span class="token operator">&gt;</span>删除<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>emcart<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>mycarturl<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">//购物车数据</span>editdata<span class="token operator">:</span><span class="token string">'管理'</span><span class="token punctuation">,</span>settips<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//默认展示右下角 结算还是删除</span>mapselect<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//存放已勾选单个商品的总价</span>cartdele<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//存放已经被勾选的商品 _id</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 计算单个商品总价</span><span class="token function">coselect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 过滤出数组中 choice为 true的对象  即已经勾选的商品   filter会将目标对象放到新数组中</span><span class="token keyword">let</span> filselect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>choice<span class="token punctuation">)</span><span class="token comment">// 取出被选中的 数组中的的总价</span><span class="token keyword">this</span><span class="token punctuation">.</span>mapselect <span class="token operator">=</span> filselect<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>total_price<span class="token punctuation">)</span><span class="token comment">// 将已经被勾选的商品, 购物车_id 单独存放出来</span><span class="token keyword">this</span><span class="token punctuation">.</span>cartdele <span class="token operator">=</span> filselect<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 删除</span><span class="token keyword">async</span> <span class="token function">deLece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'请求中'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> cartdelete  <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cartdelete<span class="token punctuation">,</span><span class="token punctuation">{</span>arrid<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>cartdele<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cartdelete<span class="token punctuation">,</span><span class="token string">'购物车删除商品'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ShoppingRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="购物车重选sku颜色尺码（上）"><a href="#购物车重选sku颜色尺码（上）" class="headerlink" title="购物车重选sku颜色尺码（上）"></a>购物车重选sku颜色尺码（上）</h4><p>思路：公共组件addtocart.vue，就是之前写好的sku组件，因此要引用到shopping.vue组件中，然后展示到页面中使用</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> sku组件<span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 为什么是skudata 因为 sku组件中 props接收父组件的 键值对k名称就是skudata <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Addtocart ref<span class="token operator">=</span><span class="token string">"addto"</span> <span class="token operator">:</span>skudata<span class="token operator">=</span><span class="token string">"skudata"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Addtocart<span class="token operator">&gt;</span><span class="token comment">// sku组件    引用到shopping.vue组件中</span><span class="token keyword">import</span> Addtocart <span class="token keyword">from</span> <span class="token string">'../commponents/addtocart.vue'</span><span class="token comment">// 弹出sku组件 直接弹出组件是没数据的因此要调用 相关接口</span><span class="token function">normsFun</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> mycarturl <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后给相应的位置添加点击事件，同时携带商品id传入请求方法中，同时通过ref控制sku组件中的showCou（）方法，将001传入，001代表的是</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 弹出sku组件 直接弹出组件是没数据的因此要调用 相关接口</span><span class="token keyword">async</span> <span class="token function">normsFun</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">let</span> cartsku <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cartsku <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cartsku<span class="token punctuation">,</span><span class="token string">'弹出sku组件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>skudata <span class="token operator">=</span> cartsku<span class="token punctuation">.</span>data<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>addto<span class="token punctuation">.</span><span class="token function">showCou</span><span class="token punctuation">(</span><span class="token string">'001'</span><span class="token punctuation">)</span>   <span class="token comment">// 显示组件</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在<strong>sku组件</strong>中，001表示调用001表示购物车重选</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 确定按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 利用计算属性 如果两个未选中静止使用确定按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '001'"</span> @click<span class="token operator">=</span><span class="token string">"skumen.ban &amp;&amp; detErmine()"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '002'"</span> @click<span class="token operator">=</span><span class="token string">"skumen.ban &amp;&amp; detErmine()"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '003'"</span> @click<span class="token operator">=</span><span class="token string">"skumen.ban &amp;&amp; purChase()"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 被其他组件调用显示sku组件  mean 等于 002代表加入购物车    003代表直接购买  001表示购物车重选</span><span class="token function">showCou</span><span class="token punctuation">(</span><span class="token parameter">mean</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>mean <span class="token operator">=</span> mean<span class="token keyword">this</span><span class="token punctuation">.</span>couponif <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>难点1</strong>：<strong>当在购物车组件中点击sku时候，展示的效果应该和购物车所选好的尺码颜色等信息相同</strong></p><p>思路：<strong>点击事件携带的参数，再加上从购物车获取到的本条商品的一些信息传递到sku组件</strong></p><p>在购物车组件中，点击normsFun方法，携带相关参数，使用id发起请求，将请求结果cartsku.data  和normsFun点击事件拿到的商品_id  尺码 颜色 商品数量一起传递到 sku组件addtocart中。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 点击调出sku组件 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopp-chick-sku"</span> @click<span class="token operator">=</span><span class="token string">"normsFun(item.id,item.id,item.size,item.color,item.many)"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/details/jiantou.svg"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 弹出sku组件 直接弹出组件是没数据的因此要调用 相关接口</span><span class="token keyword">async</span> <span class="token function">normsFun</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>_id<span class="token punctuation">,</span>size<span class="token punctuation">,</span>color<span class="token punctuation">,</span>many</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 购物车页面重选sku接口</span><span class="token keyword">let</span> cartsku <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cartsku <span class="token operator">+</span> <span class="token string">'?id='</span> <span class="token operator">+</span> id <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modeget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cartsku<span class="token punctuation">,</span><span class="token string">'购物车弹出的sku组件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>skudata <span class="token operator">=</span> cartsku<span class="token punctuation">.</span>data  <span class="token comment">//得到商品sku展示的所以商品尺码 颜色等信息</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>sku<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>skudata<span class="token punctuation">,</span>size<span class="token punctuation">,</span>color<span class="token punctuation">,</span>_id<span class="token punctuation">,</span>many<span class="token punctuation">}</span>  <span class="token comment">// 这里重新组合一个对象，传递到sku组件中用于修改弹出的商品信息</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>addto<span class="token punctuation">.</span><span class="token function">showCou</span><span class="token punctuation">(</span><span class="token string">'001'</span><span class="token punctuation">,</span>obj<span class="token punctuation">)</span>   <span class="token comment">// 显示组件同时传递 obj对象</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>sku组件addtocart，showCou方法的第二个参数，接收了数据，解构数据后进行了如下操作</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 被其他组件调用显示sku组件  mean 等于 002代表加入购物车    003代表直接购买  001表示购物车重选</span><span class="token function">showCou</span><span class="token punctuation">(</span><span class="token parameter">mean<span class="token punctuation">,</span>obj<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>mean <span class="token operator">=</span> mean<span class="token keyword">if</span><span class="token punctuation">(</span>mean <span class="token operator">==</span> <span class="token string">'001'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 解构接收到的值</span><span class="token keyword">let</span> <span class="token punctuation">{</span>sku<span class="token punctuation">,</span>size<span class="token punctuation">,</span>color<span class="token punctuation">,</span>_id<span class="token punctuation">,</span>many<span class="token punctuation">}</span> <span class="token operator">=</span> obj<span class="token comment">// 将这些值 替代sku组件中的值</span><span class="token keyword">this</span><span class="token punctuation">.</span>_id <span class="token operator">=</span> _id <span class="token comment">// 购物车选中的商品 _id</span><span class="token keyword">this</span><span class="token punctuation">.</span>momany <span class="token operator">=</span> many<span class="token comment">// 购物车选中的商品数量</span><span class="token comment">// 使用findIndex 方法，对购物车弹出的sku所展示的第0项商品信息进行遍历，找出尺码和购物车点击的尺码一样的下标</span><span class="token comment">// findIndex() 方法对数组中存在的每个元素执行一次函数，返回该符合数组元素的索引 否则返回 -1</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizenum <span class="token operator">=</span> sku<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">==</span> size<span class="token punctuation">)</span><span class="token comment">// 获取在购物车页面点击商品尺码哪里，已经展示的尺码对应的下标 并赋值给sku页面 所展示已经选中的尺码</span><span class="token keyword">this</span><span class="token punctuation">.</span>colornum <span class="token operator">=</span> sku<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>color <span class="token operator">==</span> color<span class="token punctuation">)</span> <span class="token comment">// 获取在购物车页面点击商品尺码哪里，已经展示的颜色对应的下标 并赋值给sku页面 所展示已经选中的颜色</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue <span class="token operator">=</span> color<span class="token comment">//这里是值下方的监听方法，监听到colorvalue值改变后进行改变颜色</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue <span class="token operator">=</span> size<span class="token comment">//同上监听方法</span><span class="token punctuation">}</span><span class="token keyword">this</span><span class="token punctuation">.</span>couponif <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="购物车重选sku颜色尺码（下）"><a href="#购物车重选sku颜色尺码（下）" class="headerlink" title="购物车重选sku颜色尺码（下）"></a>购物车重选sku颜色尺码（下）</h4><p><strong>难点</strong>：当用户从购物车点进sku组件时，重新选择了商品尺码和颜色后，</p><p>点击事件命名为 <strong>modifySku</strong></p><p>传入修改sku请求接口需要的参数 data 发起请求</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 确定按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 利用计算属性 如果两个未选中静止使用确定按钮 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '001'"</span> @click<span class="token operator">=</span><span class="token string">"skumen.ban &amp;&amp; modifySku()"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '002'"</span> @click<span class="token operator">=</span><span class="token string">"skumen.ban &amp;&amp; detErmine()"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"determine coup-anim"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"mean == '003'"</span> @click<span class="token operator">=</span><span class="token string">"skumen.ban &amp;&amp; purChase()"</span><span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token comment">// 购物车修改sku</span><span class="token keyword">async</span> <span class="token function">modifySku</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> <span class="token punctuation">{</span>image<span class="token punctuation">,</span>price<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>attribute<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>_id<span class="token punctuation">,</span>skuid<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizevalue<span class="token punctuation">,</span>color<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorvalue<span class="token punctuation">,</span>image<span class="token punctuation">,</span>price<span class="token punctuation">,</span>many<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>momany<span class="token punctuation">,</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 购物车修改sku接口  </span><span class="token keyword">let</span> skubase <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>skubase<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>skubase<span class="token punctuation">,</span><span class="token string">'购物车修改sku接口'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>skubase<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideCou</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//隐藏sku组件</span><span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'mycart'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>cart<span class="token operator">:</span>skubase<span class="token punctuation">.</span>msg<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 刷新购物车</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//TODO handle the exception</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="购物车结算"><a href="#购物车结算" class="headerlink" title="购物车结算"></a>购物车结算</h4><p><strong>思路：</strong>在购物车组件 <strong>shopping.vue</strong> 中，需要勾选了商品才能结算</p><p>提前在计算总价方法中存储已经勾选的商品数据，将其传递到付款组件中，注意因为JSON.parse识别不到某些特殊字符，因此使用 encodeURIComponent、decodeURIComponent方式</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 计算单个商品总价 (已经勾选的商品 filselect )</span><span class="token function">coselect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 过滤出数组中 choice 为 true的对象  即已经勾选的商品    filter会将目标对象放到新数组中</span><span class="token keyword">let</span> filselect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mycarturl<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>choice<span class="token punctuation">)</span><span class="token comment">// 取出被选中的 数组中的的总价</span><span class="token keyword">this</span><span class="token punctuation">.</span>mapselect <span class="token operator">=</span> filselect<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>total_price<span class="token punctuation">)</span><span class="token comment">// 将已经被勾选的商品, 购物车_id 单独存放出来</span><span class="token keyword">this</span><span class="token punctuation">.</span>cartdele <span class="token operator">=</span> filselect<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token comment">// 存储已经勾选的商品数据</span><span class="token keyword">this</span><span class="token punctuation">.</span>settlement <span class="token operator">=</span> filselect<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 结算</span><span class="token function">semEnt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'结算'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 数组，对象转换成字符串才能携带值</span><span class="token keyword">let</span> cartdata <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>settlement<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cartdata<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 跳转到下单页面</span>uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../payment-page/payment?cartdata='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>cartdata<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在付款组件，payment.vue中</strong>接收值</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// e就是路径上携带的值 来自于addtocart组件 purChase方法</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> cartdataing <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cartdata<span class="token punctuation">)</span><span class="token comment">// 将JSON字符串转化为js对象</span><span class="token keyword">this</span><span class="token punctuation">.</span>comminfo <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cartdataing<span class="token punctuation">)</span><span class="token comment">// 合计支付总价计算 numdata默认为0，使用forEach遍历</span><span class="token keyword">let</span> numdata <span class="token operator">=</span> <span class="token number">0</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cartdataing<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>numdata <span class="token operator">+=</span> item<span class="token punctuation">.</span>total_price<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 合计总价 小数点两位数</span><span class="token keyword">this</span><span class="token punctuation">.</span>Totalprice <span class="token operator">=</span> <span class="token function">Price</span><span class="token punctuation">(</span>numdata<span class="token punctuation">)</span> <span class="token comment">// 将需补0的数据传入方法</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  由于支付接口要求：如果是购物车商品结算，需要把购物车中每个商品的_id作为一个数组字符串存储起来，否则填写空数组</p><p>如果支付成功后，购物车里就删除这个商品id的商品</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// e就是路径上携带的值 来自于addtocart组件 purChase方法</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">let</span> cartdataing <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cartdata<span class="token punctuation">)</span>  <span class="token comment">//接收json字符串</span><span class="token keyword">this</span><span class="token punctuation">.</span>comminfo <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cartdataing<span class="token punctuation">)</span>  <span class="token comment">// 将JSON字符串转化为js对象</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>comminfo <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> numdata <span class="token operator">=</span> <span class="token number">0</span>   <span class="token comment">// 合计支付总价计算 numdata默认为0，使用forEach遍历</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cartdataing<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>numdata <span class="token operator">+=</span> item<span class="token punctuation">.</span>total_price<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 合计总价 小数点两位数</span><span class="token keyword">this</span><span class="token punctuation">.</span>Totalprice <span class="token operator">=</span> <span class="token function">Price</span><span class="token punctuation">(</span>numdata<span class="token punctuation">)</span> <span class="token comment">// 将需补0的数据传入方法</span><span class="token comment">// 存储购物车来的数据的商品_id</span><span class="token comment">// _id 都在数组 this.comminfo 里边 有可能不止一个商品 因此要 筛选取出</span><span class="token keyword">let</span> _id <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cartdataing<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>idcard <span class="token operator">=</span> _id<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时，当提交订单支付成功后，应该跳到待发货界面， 2-3步，因为没有商品号，所以注释掉，使用的虚拟支付接口</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 提交订单</span><span class="token keyword">async</span> <span class="token function">placeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 触发下单按钮后的提示</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span><span class="token string">'正在下单中'</span><span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showloading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//手动 弹窗</span><span class="token comment">// 商品数据 通过对comminfo数据进行map方法遍历，会返回一个新的数组对象</span><span class="token keyword">let</span> codata <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>comminfo<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">let</span> data <span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token operator">:</span>item<span class="token punctuation">.</span>id<span class="token punctuation">,</span>image<span class="token operator">:</span>item<span class="token punctuation">.</span>image<span class="token punctuation">,</span>title<span class="token operator">:</span>item<span class="token punctuation">.</span>title<span class="token punctuation">,</span>size<span class="token operator">:</span>item<span class="token punctuation">.</span>size<span class="token punctuation">,</span>color<span class="token operator">:</span>item<span class="token punctuation">.</span>color<span class="token punctuation">,</span>price<span class="token operator">:</span>item<span class="token punctuation">.</span>price<span class="token punctuation">,</span>many<span class="token operator">:</span>item<span class="token punctuation">.</span>many<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">return</span> data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 准备一个对象 将请求需要的参数放入</span><span class="token keyword">let</span> dataobj <span class="token operator">=</span> <span class="token punctuation">{</span>consignee<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>orderdata<span class="token punctuation">,</span> <span class="token comment">// 收货地址相关数据</span>commodity<span class="token operator">:</span>codata<span class="token punctuation">,</span><span class="token comment">// 商品相关数据</span>total_price<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>Totalprice<span class="token punctuation">,</span><span class="token comment">// 支付总价数据</span>idcard<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>idcard<span class="token punctuation">,</span><span class="token comment">// 购物车内所有商品的id相关数据</span><span class="token punctuation">}</span><span class="token comment">// 1.请求统一下单接口   </span><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token comment">// 微信支付: 统一下单接口</span><span class="token comment">// var wxpay = await new this.Request(this.Urls.m().wxpay,dataobj).modepost();</span><span class="token comment">// 因为个人没有认证微信商户号，这里使用的是虚拟支付接口 返回结果是"SUCCESS"</span><span class="token keyword">let</span> fictpay <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Urls<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fictpayurl<span class="token punctuation">,</span>dataobj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modepost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>fictpay<span class="token punctuation">.</span>msg <span class="token operator">==</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 存储商户订单号和订单id</span><span class="token comment">// this.outno = wxpayurl.data.out_trade_no</span><span class="token comment">// this.ide = wxpayurl.data.id</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>fictpay<span class="token punctuation">.</span>data<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token comment">// 关闭当前下单页面，跳转到代发货页面</span>uni<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'../personal/personal?index='</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// e就是throw 捕获的错误 </span><span class="token comment">// throw 用来捕获一个错误  </span><span class="token comment">//如果catch 中出现throw关键词，此时try catch 后边的代码将不会执行 即不会调用下边的微信接口</span><span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span></span><span class="token function">$Toast</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showtoast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//反馈 弹窗</span><span class="token keyword">throw</span> e <span class="token punctuation">}</span><span class="token comment">// 2.调用微信支付接口</span><span class="token comment">// try{</span><span class="token comment">// package：属于源码里的关键词</span><span class="token comment">// 从真正的微信支付接口中拿到返回结果，这五个数据用于调用微信支付接口时作为参数，</span><span class="token comment">// let { nonceStr,paySign,signType,timeStamp } = wxpay.data</span><span class="token comment">// 使用下方调用支付的方法</span><span class="token comment">// await this.wxPay({ nonceStr,paySign,signType,timeStamp,package:wxpay.data.package })</span><span class="token comment">// }catch(e){</span><span class="token comment">// new this.$Toast('支付失败','none').showtoast() //反馈 弹窗</span><span class="token comment">// uni.redirectTo({</span><span class="token comment">// url:'../personal/personal?index=' + 0</span><span class="token comment">// })</span><span class="token comment">// throw e</span><span class="token comment">// }</span><span class="token comment">// 3.查询订单是否支付成功 （去微信那边查询是否成功）</span><span class="token comment">// try{</span><span class="token comment">// let dataobj = {outno:this.outno,id:this.ide}</span><span class="token comment">// let queryorderurl = await new this.Request(this.Urls.m().queryorderurl,dataobj).modepost()</span><span class="token comment">// if(queryorderurl.data.msg == 'SUCCESS') {</span><span class="token comment">// new this.$Toast('支付成功').showtoast() //反馈 弹窗</span><span class="token comment">// uni.redirectTo({</span><span class="token comment">// url:'../personal/personal?index=' + 1</span><span class="token comment">// })</span><span class="token comment">// }</span><span class="token comment">// }catch(e){</span><span class="token comment">// new this.$Toast(e,'none').showtoast() //反馈 弹窗</span><span class="token comment">// }</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="项目优化"><a href="#项目优化" class="headerlink" title="项目优化"></a>项目优化</h3><p>在首页，点击商品后，应该出现一个正在加载的图标</p><p>在pages下新建 full-loading.vue 组件，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"full-loading"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"Loading"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>image src<span class="token operator">=</span><span class="token string">"/static/loading/loadtmall.gif"</span> mode<span class="token operator">=</span><span class="token string">"widthFix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>              <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>Loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">value <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>Loading <span class="token operator">=</span> value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span><span class="token punctuation">.</span>full<span class="token operator">-</span>loading<span class="token punctuation">{</span>position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>display<span class="token operator">:</span> flex<span class="token punctuation">;</span>align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>background<span class="token operator">:</span> #fff<span class="token punctuation">;</span>z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">999</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>full<span class="token operator">-</span>loading image<span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">100</span>rpx<span class="token punctuation">;</span> height<span class="token operator">:</span> <span class="token number">100</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再取main.js中引入</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 页面加载loading</span><span class="token keyword">import</span> loading <span class="token keyword">from</span> <span class="token string">'pages/commponents/full-loading.vue'</span>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'full-loading'</span><span class="token punctuation">,</span>loading<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>最后在想要加上加载效果的页面上如下添加</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 页面加载 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>full<span class="token operator">-</span>loading ref<span class="token operator">=</span><span class="token string">"fullload"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>full<span class="token operator">-</span>loading<span class="token operator">&gt;</span><span class="token comment">// 取消loading组件的加载效果</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>fullload<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>THE END</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;准备&quot;&gt;&lt;a href=&quot;#准备&quot; class=&quot;headerlink&quot; title=&quot;准备&quot;&gt;&lt;/a&gt;准备&lt;/h2&gt;&lt;h3 id=&quot;工具篇&quot;&gt;&lt;a href=&quot;#工具篇&quot; class=&quot;headerlink&quot; title=&quot;工具篇&quot;&gt;&lt;/a&gt;&lt;strong&gt;工具</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="项目" scheme="https://wuzimo233.github.io/tags/%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="小程序" scheme="https://wuzimo233.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>Axios新版学习大纲</title>
    <link href="https://wuzimo233.github.io/posts/16.html"/>
    <id>https://wuzimo233.github.io/posts/16.html</id>
    <published>2022-06-16T03:12:00.000Z</published>
    <updated>2022-06-16T03:36:19.652Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Axios入门"><a href="#Axios入门" class="headerlink" title="Axios入门"></a>Axios入门</h1><h2 id="HTTP相关"><a href="#HTTP相关" class="headerlink" title="HTTP相关"></a>HTTP相关</h2><h3 id="MDN文档"><a href="#MDN文档" class="headerlink" title="MDN文档"></a>MDN文档</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview</a></p><h3 id="HTTP请求报文"><a href="#HTTP请求报文" class="headerlink" title="HTTP请求报文"></a>HTTP请求报文</h3><h4 id="请求行"><a href="#请求行" class="headerlink" title="请求行"></a>请求行</h4><p>格式: method url</p><p>例如:  GET/product_detail?id=2  或  POST / login</p><h4 id="请求头（一般有多个请求头）"><a href="#请求头（一般有多个请求头）" class="headerlink" title="请求头（一般有多个请求头）"></a>请求头（一般有多个请求头）</h4><p>Host: <a href="http://www.baidu.com/">www.baidu.com</a></p><p>Cookie: BAIDUID=AD3B0FA706E;BIDUPSID=AD3B0FA706;</p><p>Content-Type: applicartion/x-www-from-urlencoded 或者 application/json</p><h4 id="请求体-get没有"><a href="#请求体-get没有" class="headerlink" title="请求体 (get没有)"></a>请求体 (get没有)</h4><p>username=tom&amp;pwd=123</p><p>{“username”:”tom”,”pwd”:123}</p><h3 id="HTTP响应报文"><a href="#HTTP响应报文" class="headerlink" title="HTTP响应报文"></a>HTTP响应报文</h3><h4 id="响应行"><a href="#响应行" class="headerlink" title="响应行"></a>响应行</h4><p>格式： status status Text</p><p>例如： 200 OK  或 404 Not Found</p><h4 id="响应头（一般有多个）"><a href="#响应头（一般有多个）" class="headerlink" title="响应头（一般有多个）"></a>响应头（一般有多个）</h4><p>Content-Type：text/html;charset=utf-8</p><p>Set-Cookie:BD_CK_SAM=1;PATH=/</p><h4 id="响应体"><a href="#响应体" class="headerlink" title="响应体"></a>响应体</h4><p>html/json/js/css/图片</p><h3 id="常见的状态码"><a href="#常见的状态码" class="headerlink" title="常见的状态码"></a>常见的状态码</h3><p>200    OK                                     请求成功.。一般用于GET/POST请求</p><p>201    Created                             已创建。成功请求并创建了新的资源</p><p>401    Unauthorized                   未授权/请求用户的身份证</p><p>404    Not Found                         服务器无法根据客户端请求找到资源</p><p>500    internal Serve Error         服务器内部错误，无法完成请求</p><h3 id="请求方式与请求参数"><a href="#请求方式与请求参数" class="headerlink" title="请求方式与请求参数"></a>请求方式与请求参数</h3><h4 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h4><p>GET（索取）：从服务端读取数据               —– 查（R –Retrieve）</p><p>POST（交差）：向服务端添加新数据         —– 增（C –Create）    </p><p>PUT：更新服务端已经存在的数据               —— 改（U –Update）</p><p>DELETE：删除服务器端数据                        —— 删（D –Delete）</p><h4 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h4><h5 id="query参数（查询字符串参数）"><a href="#query参数（查询字符串参数）" class="headerlink" title="query参数（查询字符串参数）"></a>query参数（查询字符串参数）</h5><ul><li>参数包含在请求地址中，格式为:/xxxx?name=tom&amp;age=18</li><li>敏感数据不要用query参数，因为参数是地址的一部分，比较危险</li><li>备注：query参数又称为查询字符串参数，编码方式为urlencoded</li></ul><h5 id="params参数"><a href="#params参数" class="headerlink" title="params参数"></a>params参数</h5><ul><li><p>参数包含在请求地址中，格式如下：</p><p><a href="http://localhost:3000/add_person/tom/18">http://localhost:3000/add_person/tom/18</a></p></li><li><p>敏感数据不要用params参数，因为参数是地址的一部分，比较危险</p></li></ul><h5 id="请求体参数（body）"><a href="#请求体参数（body）" class="headerlink" title="请求体参数（body）"></a>请求体参数（body）</h5><ul><li><p>参数包含在请求体中，可通过浏览器开发工具查看</p></li><li><p>常用的两种格式：</p><p>格式一：urlencoded格式</p><p>例如：name=tom&amp;age=18</p><p>对于请求头：Content-Type：application/x-www-from-urlencoded</p></li></ul><p>​    格式二：json格式</p><p>​    例如：{“name”:”tom”,”:age”:12}</p><p>​    对应请求头：Content-Type：application/json</p><h3 id="特别注意："><a href="#特别注意：" class="headerlink" title="特别注意："></a>特别注意：</h3><ul><li><p>GET请求不能携带请求体参数，因为GET请求没有请求体</p></li><li><p>理论上一次请求可以随意使用上述3种类型参数中的任何一种，甚至一次请求的3个参数可以用3种形式携带，但一般不这样做</p></li><li><p>一般来说我们有一些”约定俗成”的规矩:</p><p>(1):例如 from 表单发送 post 请求时，自动使用请求体参数，用urlencoded编码</p></li></ul><p>​    (2):例如 jQuery 发送ajax-post请求时，自动使用请求体参数，用urlencoded编码</p><ul><li>开发中请求到底发给谁？用什么方式？ 携带什么参数？ —要参考项目的API接口文档</li></ul><h2 id="API相关"><a href="#API相关" class="headerlink" title="API相关"></a>API相关</h2><h3 id="API的分类"><a href="#API的分类" class="headerlink" title="API的分类"></a>API的分类</h3><h4 id="REST-API（restful-风格的-API）"><a href="#REST-API（restful-风格的-API）" class="headerlink" title="REST API（restful 风格的 API）"></a>REST API（restful 风格的 API）</h4><ul><li><p>发送请求进行 CRUD（增查改删） 哪个操作由请求方式来决定</p></li><li><p>同一个请求路径可以进行多个操作</p></li><li><p>请求方式会用到 GET / POST / PUT / DELETE</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token comment">// 实例一个app服务对象</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/person'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'一些人的数据给你了'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/person'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'你成功的添加了一个人'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/person'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'你成功的修改了一个人'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/person'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'你成功的删除了一个人'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8090</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器开启成功了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="非-REST-API-restless-风格的-API"><a href="#非-REST-API-restless-风格的-API" class="headerlink" title="非 REST API (restless 风格的 API)"></a>非 REST API (restless 风格的 API)</h4><ul><li>请求方式不决定请求的 CRUD 操作</li><li>一个请求路径只对应一个操作</li><li>一般只有 GET / POST</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 早些年都这么写，两个请求有4个路径 --不能清晰表达要干嘛</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token comment">// 实例一个app服务对象</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get_person'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'一些人的数据给你了'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/add_person'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'你成功的添加了一个人'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/update_person'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'你成功的修改了一个人'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 请求方式不决定请求的 CRUD 操作</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/delete_person'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'你成功的删除了一个人'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8090</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器开启成功了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用-json-server-搭建-REST-API"><a href="#使用-json-server-搭建-REST-API" class="headerlink" title="使用 json-server 搭建 REST API"></a>使用 json-server 搭建 REST API</h3><h4 id="json-server是什么？"><a href="#json-server是什么？" class="headerlink" title="json-server是什么？"></a>json-server是什么？</h4><ul><li><strong>用来快速搭建REST API 风格的工具包</strong></li></ul><h4 id="使用-json-server"><a href="#使用-json-server" class="headerlink" title="使用 json-server"></a>使用 json-server</h4><ul><li><p>在线文档：http:github.com/typicode/json-serrver</p></li><li><pre><code>下载：npm install -g json-server<pre class="line-numbers language-none"><code class="language-none">- 目标根目录下创建数据库 **json** 文件：**db.json**<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>{"posts": [  { "id": 1, "title": "json-server", "author": "typicode" }],"comments": [  { "id": 1, "body": "some comment", "postId": 1 }],"profile": { "name": "typicode" }}<pre class="line-numbers language-none"><code class="language-none">- 启动服务器执行命令：json-server --watch db.json   (watch可以省略 db可以改为任意喜欢的名字)  #### 使用浏览器访问测试http://localhost:3000/postshttp://localhost:3000/commentshttp://localhost:3000/profile#### 使用postmon接口测试**json-server服务器注意：**- postmon测试中发送PUT请求，能在请求体携带id参数（或者使用params携带id），不能用query参数携带id- postmon测试中发送DELETE请求，只能使用params携带参数（json-server模拟的服务器，id都得通过params携带，其他有请求体就用请求体，没有就正常使用params或者query）  #### 一般 http 请求与 ajax 请求- ajax请求是一种特别http请求-  对服务器端来说，没有任何区别，区别在浏览器端- 浏览器端发请求：只有XHR或fetch发出得才是ajax请求。其他所有得都是非ajax请求- 浏览器端接收到响应  ​（1） 一般请求：浏览器一般会直接显示响应体数据，也就是我们常说得自动刷新/跳转页面  ​（2）ajax 请求：浏览器不会对界面进行任何更新操作，只是调用监视得回调函数传入响应相关数据  ## axios的理解和使用### axios是什么1.前端最流行的ajax请求库2.react/vue官方都推荐使用axios发ajax请求3.文档：https://github.com/axios/axios### axios特点1.基于Promise的异步ajax请求库2.浏览器端/node端都可以使用3.支持请求/响应拦截器4.支持请求取消5.请求/响应数据转换6.批量发送多个请求### 使用axios发送ajax请求- 终端打开准备好的server文件夹里使用api-doc工具制作的api文档- 新建 '1_axios的基本使用.html' 文件，同时新建一个js文件夹存放axios.mini.js文件,引入到html里**准备按钮、文本框**```html&lt;button id="btn1"&gt;点我获取所有人&lt;/button&gt;&lt;br&gt;&lt;br&gt;&lt;button id="btn2"&gt;点我获取某个人&lt;/button&gt;&lt;input id="person_id" type="text" placeholder="请输入一个人的id"&gt;&lt;br&gt;&lt;br&gt;&lt;button id="btn3"&gt;点我添加一个人&lt;/button&gt;&lt;input id="person_name" type="name" placeholder="请输入一个人的名字"&gt;&lt;input id="person_age" type="age" placeholder="请输入一个人的年龄"&gt;&lt;br&gt;&lt;br&gt;&lt;button id="btn4"&gt;点我更新一个人&lt;/button&gt;&lt;input id="person_update_id" type="text" placeholder="请输入一个人的id"&gt;&lt;input id="person_update_name" type="text" placeholder="请输入名字"&gt;&lt;input id="person_update_age" type="text" placeholder="请输入年龄"&gt;&lt;br /&gt;&lt;br /&gt;&lt;button id="btn5"&gt;点我删除一个人&lt;/button&gt;&lt;input id="person_delete_id" type="text" placeholder="请输入删除的id"&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></code></pre></li></ul><p><strong>获取按钮、文本框</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> btn1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token keyword">const</span> btn2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn2'</span><span class="token punctuation">)</span><span class="token keyword">const</span> btn3 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn3'</span><span class="token punctuation">)</span><span class="token keyword">const</span> personId <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'person_id'</span><span class="token punctuation">)</span><span class="token keyword">const</span> personName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'person_name'</span><span class="token punctuation">)</span><span class="token keyword">const</span> personAge <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'person_age'</span><span class="token punctuation">)</span><span class="token keyword">const</span> btn4 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn4'</span><span class="token punctuation">)</span><span class="token keyword">const</span> btn5 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn5'</span><span class="token punctuation">)</span><span class="token keyword">const</span> personUpdateId <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'person_update_id'</span><span class="token punctuation">)</span><span class="token keyword">const</span> personUpdateName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'person_update_name'</span><span class="token punctuation">)</span><span class="token keyword">const</span> personUpdateAge <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'person_update_age'</span><span class="token punctuation">)</span><span class="token keyword">const</span> personDeleteId <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'person_delete_id'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>获取所有人的信息 —发送GET请求 —不携带参数</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 获取所有人的信息 ---发送GET请求 ---不携带参数 </span>btn1<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 完整版</span>    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token operator">:</span> <span class="token string">'http://localhost:5000/persons'</span><span class="token punctuation">,</span> <span class="token comment">//请求地址</span>        method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token comment">//请求方式</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>        <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span> <span class="token punctuation">}</span>    <span class="token punctuation">)</span>        <span class="token comment">// 精简版</span>    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/persons'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>         <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>         <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">}</span>    <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 如果只想获取到成功的值 可以使用await 方法更简单</span>btn1<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/persons'</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用axios发送其他请求"><a href="#使用axios发送其他请求" class="headerlink" title="使用axios发送其他请求"></a>使用axios发送其他请求</h3><h4 id="发送GET请求"><a href="#发送GET请求" class="headerlink" title="发送GET请求"></a>发送GET请求</h4><p><strong>获取某个人—发送GET请求—携带query参数</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//获取某个人---发送GET请求---携带query参数</span>btn2<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 完整版</span>    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token operator">:</span> <span class="token string">'http://localhost:5000/person'</span><span class="token punctuation">,</span>        method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>        params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> personId<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token comment">//此处写的是params，但携带的是query参数</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>        <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功了'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token string">'请求失败了'</span><span class="token punctuation">,</span> error <span class="token punctuation">}</span>    <span class="token punctuation">)</span>        <span class="token comment">// 精简版</span>    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/person'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> personId<span class="token punctuation">.</span>value <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>        <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="发送POST请求"><a href="#发送POST请求" class="headerlink" title="发送POST请求"></a>发送POST请求</h4><p><strong>添加一个人—发送POST请求—携带json编码参数 或 urlencoded编码</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">btn3<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>     <span class="token comment">// 完整版</span>     url<span class="token operator">:</span><span class="token string">'http://localhost:5000/person'</span><span class="token punctuation">,</span>     method<span class="token operator">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>     data<span class="token operator">:</span><span class="token punctuation">{</span>name<span class="token operator">:</span>personName<span class="token punctuation">.</span>value<span class="token punctuation">,</span>age<span class="token operator">:</span>personAge<span class="token punctuation">.</span>value<span class="token punctuation">}</span> <span class="token comment">//携带请求体参数（json编码）</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>    <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功了'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败了'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token punctuation">)</span>    <span class="token comment">// 精简版</span>axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/person'</span><span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>personName<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;age=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>personAge<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token comment">// axios.post('http://localhost:5000/person',{name:personName.value,age:personAge.value}).then(</span>     <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">}</span>      <span class="token punctuation">)</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="发送PUT请求"><a href="#发送PUT请求" class="headerlink" title="发送PUT请求"></a>发送PUT请求</h4><p>   <strong>更新一个人—发送PUT请求—携带json编码参数 或 urlencoded编码</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">btn4<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 完整版</span>    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token operator">:</span> <span class="token string">'http://localhost:5000/person'</span><span class="token punctuation">,</span>        method<span class="token operator">:</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span>        data<span class="token operator">:</span> <span class="token punctuation">{</span>            id<span class="token operator">:</span>personUpdateId<span class="token punctuation">.</span>value<span class="token punctuation">,</span>             name<span class="token operator">:</span>personUpdateName<span class="token punctuation">.</span>value<span class="token punctuation">,</span>             age<span class="token operator">:</span>personUpdateAge<span class="token punctuation">.</span>value        <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>            <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功了'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败了'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">}</span>    <span class="token punctuation">)</span>        <span class="token comment">//精简版</span>    axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/person'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>        id<span class="token operator">:</span>personUpdateId<span class="token punctuation">.</span>value<span class="token punctuation">,</span>        name<span class="token operator">:</span>personUpdateName<span class="token punctuation">.</span>value<span class="token punctuation">,</span>        age<span class="token operator">:</span>personUpdateAge<span class="token punctuation">.</span>value    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>        <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功了'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败了'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token punctuation">}</span>    <span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="发送DELETE请求"><a href="#发送DELETE请求" class="headerlink" title="发送DELETE请求"></a>发送DELETE请求</h4><p><strong>删除一个人—发送DELETE请求—携带params参数</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">btn5<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>       <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>           url<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:5000/person/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>personDeleteId<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>           method<span class="token operator">:</span><span class="token string">'DELETE'</span><span class="token punctuation">,</span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>           <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>           <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>       <span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a><strong>结论</strong></h3><ul><li><p><strong>axios调用的返回值是Promise实例</strong></p></li><li><p><strong>成功的值叫response，失败的值叫error</strong></p></li><li><p><strong>axios成功的值是一个axios封装的response对象，服务器返回的真正数据在response.data中</strong></p></li><li><p><strong>携带query参数时，编写的配置项叫做params</strong></p></li><li><p><strong>携带params参数时，就需要自己手动拼在url中</strong></p></li></ul><h3 id="axios常用配置项"><a href="#axios常用配置项" class="headerlink" title="axios常用配置项"></a>axios常用配置项</h3><p>新建‘2_axios常用配置项.html’文件，引入‘axios.min.js’</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取所有人<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token operator">&gt;</span><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token comment">//给axios配置默认属性</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2000</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>school<span class="token operator">:</span><span class="token string">'atguigu'</span><span class="token punctuation">}</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'http://localhost:5000'</span>btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'/persons'</span><span class="token punctuation">,</span> <span class="token comment">//请求地址</span>method<span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token comment">//请求方式</span><span class="token comment">//params:{delay:3000},//配置query参数</span><span class="token comment">//data:{c:3,d:3},//配置请求体参数(json编码)</span><span class="token comment">//data:'e=5&amp;f=6',//配置请求体参数(urlencoded编码)</span><span class="token comment">//timeout:2000,//配置超时时间</span><span class="token comment">//headers:{school:'atguigu'} //配置请求头</span><span class="token comment">//responseType:'json'//配置响应数据的格式(默认值)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="axios常用语法"><a href="#axios常用语法" class="headerlink" title="axios常用语法"></a>axios常用语法</h3><p>新建’3_axios.create方法.html‘，引入‘axios.min.js’</p><h4 id="axios-create-config"><a href="#axios-create-config" class="headerlink" title="axios.create(config)"></a>axios.create(config)</h4><ul><li><p>根据指定配置创建一个新的axios, 也就是每个新axios都有自己的配置</p></li><li><p>新axios只是没有取消请求和批量发请求的方法, 其它所有语法都是一致的</p></li><li><p>为什么要设计这个语法?</p><p> <strong>需求: 项目中有部分接口需要的配置与另一部分接口需要的配置不太一样</strong></p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn3"</span><span class="token operator">&gt;</span>点我获取笑话信息<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token operator">&gt;</span><span class="token keyword">const</span> btn3 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn3'</span><span class="token punctuation">)</span><span class="token comment">// 创建一个新的axios </span><span class="token keyword">const</span> axios2 <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>timeout<span class="token operator">:</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token comment">//headers:{name:'tom'},</span>baseURL<span class="token operator">:</span><span class="token string">'https://api.apiopen.top/api'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">//给原axios配置默认属性</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2000</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>school<span class="token operator">:</span><span class="token string">'atguigu'</span><span class="token punctuation">}</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'http://localhost:5000'</span>btn3<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">axios2</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'/getImages'</span><span class="token punctuation">,</span>method<span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="拦截器函数-ajax请求-请求的回调函数"><a href="#拦截器函数-ajax请求-请求的回调函数" class="headerlink" title="拦截器函数/ajax请求/请求的回调函数"></a>拦截器函数/ajax请求/请求的回调函数</h4><p><strong>axios请求拦截器</strong><br>    1.是什么？<br>            在真正发请求前执行的一个回调函数<br>    2.作用：<br>            对所有的请求做统一的处理：追加请求头、追加参数、界面loading提示等等</p><p><strong>新建’4_axios中的拦截器.html‘，引入‘axios.min.js’</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取所有人<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token operator">&gt;</span><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token comment">//请求拦截器</span>axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求拦截器1执行了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 如果时间戳是偶数 就加上请求头</span><span class="token keyword">if</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token <span class="token operator">=</span> <span class="token string">'atguigu'</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> config<span class="token punctuation">}</span><span class="token punctuation">)</span>btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/persons'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>axios响应拦截器</strong><br>    1.是什么？<br>            得到响应之后执行的一组回调函数<br>    2.作用：<br>            若请求成功，对成功的数据进行处理<br>            若请求失败，对失败进行统一的操作     </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取所有人<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token operator">&gt;</span><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token comment">//响应拦截器</span>axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'响应拦截器成功的回调执行了'</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">'时间戳不是偶数，不能给你数据'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'响应拦截器失败的回调执行了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/persons2'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    </p><h4 id="取消请求"><a href="#取消请求" class="headerlink" title="取消请求"></a>取消请求</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取测试数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn2"</span><span class="token operator">&gt;</span>取消请求<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token operator">&gt;</span><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token keyword">const</span> btn2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn2'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">{</span>CancelToken<span class="token punctuation">}</span> <span class="token operator">=</span> axios <span class="token comment">//CancelToken能为一次请求“打标识”</span><span class="token keyword">let</span> cancelbtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'http://localhost:5000/test1?delay=3000'</span><span class="token punctuation">,</span>cancelToken<span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">//c是一个函数，调用c就可以关闭本次请求</span>cancel <span class="token operator">=</span> c<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>btn2<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>取消请求和拦截器配合使用</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取测试数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn2"</span><span class="token operator">&gt;</span>取消请求<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token operator">&gt;</span><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token keyword">const</span> btn2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn2'</span><span class="token punctuation">)</span><span class="token comment">// axios里面有个isCancel方法专门用于判断错误，还是用户取消请求导致的不合理。使用{}取出isCancel</span><span class="token keyword">const</span> <span class="token punctuation">{</span>CancelToken<span class="token punctuation">,</span>isCancel<span class="token punctuation">}</span> <span class="token operator">=</span> axios <span class="token comment">//CancelToken能为一次请求“打标识”</span><span class="token keyword">let</span> cancelbtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">// 每次点击按钮的时候都问一下外边是否有cancel 有没有值</span><span class="token keyword">if</span><span class="token punctuation">(</span>cancel<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span><span class="token string">'http://localhost:5000/test1?delay=3000'</span><span class="token punctuation">,</span>cancelToken<span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">//c是一个函数，调用c就可以关闭本次请求</span>cancel <span class="token operator">=</span> c<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isCancel</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//如果进入判断，证明：是用户取消了请求</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户取消了请求，原因是：'</span><span class="token punctuation">,</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>btn2<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'任性，就是不要了'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取测试数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn2"</span><span class="token operator">&gt;</span>取消请求<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token operator">&gt;</span><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token keyword">const</span> btn2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn2'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">{</span>CancelToken<span class="token punctuation">,</span>isCancel<span class="token punctuation">}</span> <span class="token operator">=</span> axios <span class="token comment">//CancelToken能为一次请求“打标识”</span><span class="token keyword">let</span> cancelaxios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>cancel<span class="token punctuation">)</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'取消了'</span><span class="token punctuation">)</span>config<span class="token punctuation">.</span>cancelToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> cancel<span class="token operator">=</span> c<span class="token punctuation">)</span><span class="token keyword">return</span> config<span class="token punctuation">}</span><span class="token punctuation">)</span>axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isCancel</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//如果进入判断，证明：是用户取消了请求</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户取消了请求，原因是：'</span><span class="token punctuation">,</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/test1?delay=3000'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>btn2<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'任性，就是不要了'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="批量的发送请求"><a href="#批量的发送请求" class="headerlink" title="批量的发送请求"></a>批量的发送请求</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token operator">&gt;</span><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>axios<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/test1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/test2?delay=3000'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/test3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Axios入门&quot;&gt;&lt;a href=&quot;#Axios入门&quot; class=&quot;headerlink&quot; title=&quot;Axios入门&quot;&gt;&lt;/a&gt;Axios入门&lt;/h1&gt;&lt;h2 id=&quot;HTTP相关&quot;&gt;&lt;a href=&quot;#HTTP相关&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Axios" scheme="https://wuzimo233.github.io/tags/Axios/"/>
    
  </entry>
  
  <entry>
    <title>Promise新版学习大纲</title>
    <link href="https://wuzimo233.github.io/posts/15.html"/>
    <id>https://wuzimo233.github.io/posts/15.html</id>
    <published>2022-06-16T03:10:00.000Z</published>
    <updated>2022-06-16T03:36:14.576Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h1><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="函数对象与实例对象"><a href="#函数对象与实例对象" class="headerlink" title="函数对象与实例对象"></a>函数对象与实例对象</h3><p>​    <strong>1.函数对象</strong>:  将函数作为对象使用时, 简称为函数对象。</p><p>​    <strong>2.实例对象</strong>:  new 构造函数或类产生的对象, 我们称之为实例对象。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//函数对象</span><span class="token keyword">function</span> <span class="token function">Person</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">}</span>Person<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">//将Person看成一个对象 这是给它添加一个a属性并且赋值为1</span><span class="token comment">//实例对象 --p1是Person的实例对象</span><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'老刘'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意：每一个函数对象有一个不可修改的属性叫name</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">Person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'tom'</span> <span class="token comment">//这是错误的  因为name值是函数的名（Person）</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="回调函数的分类"><a href="#回调函数的分类" class="headerlink" title="回调函数的分类"></a>回调函数的分类</h3><h4 id="什么是回调？"><a href="#什么是回调？" class="headerlink" title="什么是回调？"></a><strong>什么是回调？</strong></h4><p>​    —<strong>①我们定义的函数，②我们没有调用，③最终函数执行了。</strong></p><h4 id="两种回调函数"><a href="#两种回调函数" class="headerlink" title="两种回调函数"></a>两种回调函数</h4><h5 id="同步的回调函数"><a href="#同步的回调函数" class="headerlink" title="同步的回调函数:"></a>同步的回调函数:</h5><p>​              理解: 立即在主线程上执行, 不会放入回调队列中。</p><p>​              例子: <strong>数组遍历相关的回调函数</strong>  / Promise的executor函数</p><h5 id="异步的回调函数"><a href="#异步的回调函数" class="headerlink" title="异步的回调函数:"></a>异步的回调函数:</h5><p>​              理解: 不会立即执行, 会放入回调队列中以后执行（等主线程忙完）</p><p>​              例子: <strong>定时器回调 / ajax（成功、失败时）的回调</strong> </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//演示同步的回调函数</span><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span>arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'主线程的代码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//演示异步的回调函数</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'主线程'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="错误类型的说明"><a href="#错误类型的说明" class="headerlink" title="错误类型的说明"></a>错误类型的说明</h3><p> <strong>js中错误类型有详细的划分，这里进一步理解 JS 中的错误 (Error) 和错误处理</strong></p><p>  <code>mdn文档: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error</code></p><h4 id="错误的类型"><a href="#错误的类型" class="headerlink" title="错误的类型"></a>错误的类型</h4><p>​            <strong>Error</strong>: 所有错误的父类型  （当发生错误时，将显示下方的子错误类型）</p><p>​            <strong>ReferenceError</strong>: 引用的变量不存在</p><p>​            <strong>TypeError</strong>: 数据类型不正确</p><p>​            <strong>RangeError</strong>: 数据值不在其所允许的范围内–死循环</p><p>​            <strong>SyntaxError</strong>: 语法错误</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//演示：ReferenceError: 引用的变量不存在</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//演示：TypeError: 数据类型不正确 </span><span class="token comment">//（声明一个demo常量，并且赋值一个函数，demo函数是能够被调用的，值是undefined，然后undefined再调用函数,当然显示类型不正确）</span><span class="token keyword">const</span> <span class="token function-variable function">demo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//演示：RangeError: 数据值不在其所允许的范围内 </span><span class="token comment">//(声明一个变量demo并赋值一个函数给他，同时函数内部再调用自己（递归函数），然后执行demo函数，然后无限的执行就会超出栈范围)</span><span class="token keyword">const</span> <span class="token function-variable function">demo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//演示：SyntaxError: 语法错误</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="js中的错误处理"><a href="#js中的错误处理" class="headerlink" title="js中的错误处理"></a>js中的错误处理</h4><p>​            捕获错误: try{}catch(){}</p><p>​            抛出错误: throw error</p><p><strong>如何捕获一个错误？</strong></p><ul><li>try中放可能出现错误的代码，一旦出现错误立即停止try中代码的执行，调用catch，并携带错误信息</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">try</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//js引擎捕获到错误</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'代码执行出错了,错误的原因是：'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>js中的错误处理_抛出错误</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//如何抛出一个错误</span><span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">const</span> date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>date <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'偶数，可以正常工作'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'奇数，不可以工作！'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">debugger</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="错误对象"><a href="#错误对象" class="headerlink" title="错误对象"></a>错误对象</h4><p> message属性: 错误相关信息</p><p> stack属性: 记录信息</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//演示：ReferenceError: 引用的变量不存在</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//演示：TypeError: 数据类型不正确</span><span class="token keyword">const</span> <span class="token function-variable function">demo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//演示：RangeError: 数据值不在其所允许的范围内</span><span class="token keyword">const</span> <span class="token function-variable function">demo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//演示：SyntaxError: 语法错误</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Promise的理解和使用"><a href="#Promise的理解和使用" class="headerlink" title="Promise的理解和使用"></a>Promise的理解和使用</h2><h3 id="Promise是什么？"><a href="#Promise是什么？" class="headerlink" title="Promise是什么？"></a>Promise是什么？</h3><h4 id="抽象表达"><a href="#抽象表达" class="headerlink" title="抽象表达:"></a>抽象表达:</h4><p>​            (1).Promise是一门新的技术(ES6提出的)</p><p>​            (2).Promise是 JS 中<strong>异步编程的新方案 ** (旧方案是谁?  –**纯回调</strong>：只靠回调函数解决（ajax）)</p><h4 id="具体表达"><a href="#具体表达" class="headerlink" title="具体表达:"></a>具体表达:</h4><p>​            (1).从语法上来说: <strong>Promise是一个内置构造函数</strong></p><p>​           (2).从功能上来说: Promise的实例对象可以用来        封装一个异步操作，并可以获取其成功/失败的值</p><h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><ul><li><p>Promise不是回调函数，是一个内置的构造函数，是程序员自己new调用的。</p></li><li><p>new Promise的时候，要传入一个回调函数，它是同步的回调，会立即在主线程上执行，它被称为executor函数 –该函数将在构造这个新<code>Promise</code>对象过程中，被构造函数执行</p></li><li><p>每一个Promise<strong>实例都有3种状态</strong>：初始化(pending)、成功(fulfilled)、失败(rejected)</p></li><li><p>每一个Promise实例在刚被new出来的那一刻，状态都是初始化(pending)</p></li><li><p>executor函数会接收到2个参数，它们都是函数，分别用形参：resolve、reject接收</p></li></ul><p>​          1.调用resolve函数会：</p><p>​              (1).让Promise实例状态变为成功(fulfilled)</p><p>​              (2).可以指定成功的value   –resolve(‘ok’)</p><p>​          2.调用reject函数会：</p><p>​              (1).让Promise实例状态变为失败(rejected)</p><p>​              (2).可以指定失败的reason   –reject(‘失败的原因’)</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span><span class="token comment">//创建一个Promise实例对象</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">// resolve('ok')</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败的原因'</span><span class="token punctuation">)</span><span class="token comment">// console.log(resolve);</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//一般不把Promise实例做控制台输出  @ Promise {&lt;rejected&gt;: 'ok'}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Promise的基本使用"><a href="#Promise的基本使用" class="headerlink" title="Promise的基本使用"></a>Promise的基本使用</h3><h4 id="重要语法"><a href="#重要语法" class="headerlink" title="重要语法"></a>重要语法</h4><p>​            new Promise(executor) 构造函数</p><p>​            Promise.prototype.then 方法</p><h4 id="基本编码流程"><a href="#基本编码流程" class="headerlink" title="基本编码流程"></a>基本编码流程</h4><p>​          1.创建Promise的实例对象(pending状态), 传入executor函数</p><p>​          2.在executor中启动异步任务（定时器、ajax请求）</p><p>​          3.根据异步任务的结果，做不同处理：</p><p>​                3.1 如果异步任务成功了：</p><p>​                        我们调用resolve(value), 让Promise实例对象状态变为成功(fulfilled),同时指定成功的value</p><p>​                3.2 如果异步任务失败了：</p><p>​                        我们调用reject(reason), 让Promise实例对象状态变为失败(rejected),同时指定失败的reason</p><p>​          4.通过then方法为Promise的实例指定成功、失败的回调函数，来获取成功的value、失败的reason</p><p>​                注意：then方法所指定的：成功的回调、失败的回调，都是异步的回调。</p><h4 id="关于状态的注意点："><a href="#关于状态的注意点：" class="headerlink" title="关于状态的注意点："></a>关于状态的注意点：</h4><p>​          1.三个状态:</p><p>​                pending: 未确定的——初始状态</p><p>​                fulfilled: 成功的——调用resolve()后的状态</p><p>​                rejected: 失败的——-调用reject()后的状态</p><p>​          2.两种状态改变</p><p>​                pending ==&gt; fulfilled</p><p>​                pending ==&gt; rejected</p><p>​          3.状态只能改变一次！！</p><p>​          4.一个promise指定多个成功/失败回调函数, 都会调用吗?</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 1.声明变量p，将Promise实例对象赋值给它,并且里边传入一个执行器函数executor --里边有两个参数resolve、reject</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>            <span class="token comment">// 2.函数体</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'我是服务器返回的数据'</span><span class="token punctuation">)</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'我是一些错误信息'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>            <span class="token comment">// 3.成功和失败后的回调</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//成功的回调-异步</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>  <span class="token comment">//失败的回调-异步</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Promise与ajax配合使用"><a href="#Promise与ajax配合使用" class="headerlink" title="Promise与ajax配合使用"></a>Promise与ajax配合使用</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> ajax配合使用 <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>            <span class="token comment">// 真正开启一个异步任务</span><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">//readyState为4代表接收完毕，接收的可能是：服务器返回的成功数据、服务器返回的错误</span><span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'请求出错'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'https://api.apiopen.top/api/sentences'</span><span class="token punctuation">)</span>            <span class="token comment">// !!将服务器数据转为json格式</span>xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了1'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//成功的回调-异步</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了1'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>  <span class="token comment">//失败的回调-异步</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Promise封装ajax请求"><a href="#Promise封装ajax请求" class="headerlink" title="Promise封装ajax请求"></a>Promise封装ajax请求</h3><p>需求：</p><p>每次请求都要输入很多数据比较麻烦因此定义一个 <strong>sendAjax()</strong> 函数，对xhr的 <strong>GET</strong> 请求进行封装：</p><p>  1.该函数接收两个参数：url(请求地址)、data(参数对象)</p><p>  2.该函数返回一个Promise实例</p><p>​        (1).若ajax请求成功,则Promise实例成功,成功的value是返回的数据。</p><p>​        (2).若ajax请求失败,则Promise实例失败,失败的reason是错误提示。</p><p><strong>正常使用promise发送一个ajax请求：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1.声明变量p，将Promise实例对象赋值给它,并且里边传入一个执行器函数executor --里边有两个参数resolve、reject</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 2.实例化 xhr</span><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// 3.绑定监听</span>xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token keyword">else</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'请求出错'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'https://api.apiopen.top/api/getImages?page=0&amp;size=10'</span><span class="token punctuation">)</span>xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了1'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//成功的回调-异步</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了1'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">//失败的回调-异步</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>使用函数封装后：</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1.定义函数，并准备俩参数接收地址和参数（data是参数对象）</span><span class="token keyword">function</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 2.准备一个promise实例 </span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 3.实例化 xhr</span><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 4.绑定监听</span>xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'请求出了问题'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 5.整理参数 --需将 page=0&amp;size=10 这种形式转化为 {page:0,size:10}这种形式才能放进地址中作为参数</span><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>str <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span>str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url <span class="token operator">+</span> <span class="token string">'?'</span> <span class="token operator">+</span> str<span class="token punctuation">)</span>xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">return</span> p <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span>x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="封装ajax请求（纯回调方式）"><a href="#封装ajax请求（纯回调方式）" class="headerlink" title="封装ajax请求（纯回调方式）"></a>封装ajax请求（纯回调方式）</h3><p><em>需求：</em></p><p>定义一个sendAjax函数，对xhr的get请求进行封装</p><p>该函数接收4个参数：url(请求地址)、data(参数对象)、success(成功的回调)、error(失败的回调)</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token function">封装一个简单的ajax</span><span class="token punctuation">(</span>纯回调<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span><span class="token keyword">function</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span>data<span class="token punctuation">,</span>success<span class="token punctuation">,</span>error</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//实例xhr</span><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//绑定监听</span>xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token function">success</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'请求出了点问题'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">//整理参数</span><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>str <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span>str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span>url<span class="token operator">+</span><span class="token string">'?'</span><span class="token operator">+</span>str<span class="token punctuation">)</span>xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第1次失败了'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Promise的API"><a href="#Promise的API" class="headerlink" title="Promise的API"></a>Promise的API</h3><h4 id="Promise构造函数"><a href="#Promise构造函数" class="headerlink" title="Promise构造函数:"></a>Promise构造函数:</h4><p><strong>new Promise (executor) {}</strong></p><p>executor函数: 是同步执行的，(resolve, reject) =&gt; {}<br>resolve函数: 调用resolve将Promise实例内部状态改为成功(fulfilled)。<br>reject函数: 调用reject将Promise实例内部状态改为失败(rejected)。<br>说明: **excutor函数会在Promise内部立即同步调用,**异步代码放在excutor函数中。</p><h4 id="Promise-prototype-then方法"><a href="#Promise-prototype-then方法" class="headerlink" title="Promise.prototype.then方法:"></a>Promise.prototype.then方法:</h4><p><strong>Promise实例.then(onFulfilled,onRejected)</strong><br>onFulfilled: 成功的回调函数 (value) =&gt; {}<br>onRejected: 失败的回调函数 (reason) =&gt; {}<br>特别注意(难点)：<strong>then方法会返回一个新的Promise实例对象</strong></p><p><strong>验证then的返回值</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//验证：then方法会返回一个新的Promise实例对象。(暂且不研究返回的这个新Promise实例状态怎么变化)</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> x <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>   <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token parameter">reason</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'50'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// pomise {&lt;pending&gt;}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise-prototype-catch方法"><a href="#Promise-prototype-catch方法" class="headerlink" title="Promise.prototype.catch方法:"></a>Promise.prototype.catch方法:</h4><p> <strong>Promise实例.catch(onRejected)</strong><br>onRejected: 失败的回调函数 (reason) =&gt; {}<br>说明: <strong>catch方法是then方法的语法糖, 相当于: then(undefined, onRejected)</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//Promise.prototype.catch方法</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了1'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了1'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了2'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise-resolve方法"><a href="#Promise-resolve方法" class="headerlink" title="Promise.resolve方法:"></a>Promise.resolve方法:</h4><p> <strong>Promise.resolve(value)</strong><br>说明: 用于快速返回一个状态为fulfilled<strong>或rejected的</strong>Promise实例对象<br>备注：当状态为rejected是因为value的值可能是：</p><p>(1)<strong>非Promise值</strong>       – 100、’abc’、{}、[]</p><p> (2)<strong>Promise值</strong>          –  Promise实例（此时值是传入的promise实例，值成功或者失败）</p><p>例子：Promise.resolve方法生成了一个状态为失败的Promise对象实例 p</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//Promise.resolve</span><span class="token keyword">const</span> p0 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p0<span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise-reject方法"><a href="#Promise-reject方法" class="headerlink" title="Promise.reject方法:"></a>Promise.reject方法:</h4><p> <strong>Promise.reject方法(reason)</strong><br>说明: 用于<strong>快速返回一个状态必为rejected</strong>的Promise实例对象</p><p>例子：Promise.reject方法即使传入一个状态为成功的Promise对象实例值也是失败的 即失败的原因是那个成功的promise对象实例</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//Promise.reject</span><span class="token keyword">const</span> p0 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>p0<span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise-all方法"><a href="#Promise-all方法" class="headerlink" title="Promise.all方法:"></a>Promise.all方法:</h4><p><strong>Promise.all(promiseArr)</strong><br>promiseArr: 包含n个Promise实例的数组<br> 说明: <strong>返回一个新的Promise实例, 只有所有的promise都成功才成功, 只要有一个失败了就直接失败。</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//Promise.all</span><span class="token keyword">const</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>     <span class="token comment">//有一个失败了就直接失败。</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> x <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">)</span>x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise-race方法"><a href="#Promise-race方法" class="headerlink" title="Promise.race方法:"></a>Promise.race方法:</h4><p><strong>Promise.race(promiseArr)</strong><br>promiseArr: 包含n个Promise实例的数组<br>  说明: 返回一个新的Promise实例, 成功还是很失败？以最先出结果的promise为准。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//Promise.race</span><span class="token keyword">const</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> x <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p3<span class="token punctuation">,</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">]</span><span class="token punctuation">)</span>x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Promise的几个关键问题："><a href="#Promise的几个关键问题：" class="headerlink" title="Promise的几个关键问题："></a>Promise的几个关键问题：</h3><h4 id="如何改变Promise实例的状态？"><a href="#如何改变Promise实例的状态？" class="headerlink" title="如何改变Promise实例的状态？"></a>如何改变Promise实例的状态？</h4><ul><li><p>执行resolve(value): 如果当前是pending就会变为fulfilled</p></li><li><p>执行reject(reason): 如果当前是pending就会变为rejected</p></li><li><p>执行器函数(executor)抛出异常: 如果当前是pending就会变为rejected</p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token operator">&gt;</span><span class="token keyword">const</span> p  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//浏览器引擎抛异常</span><span class="token comment">// throw 900 //编码抛异常</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="改变Promise实例的状态和指定回调函数谁先谁后"><a href="#改变Promise实例的状态和指定回调函数谁先谁后" class="headerlink" title="改变Promise实例的状态和指定回调函数谁先谁后?"></a>改变Promise实例的状态和指定回调函数谁先谁后?</h4><ul><li>都有可能, 正常情况下是先指定回调再改变状态, 但也可以先改状态再指定回调</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//先指定回调，后改变状态（最常见）</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>如何先改状态再指定回调?</strong></p><ul><li>延迟一会再调用then()</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//先改状态，后指定回调</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Promise实例什么时候才能得到数据?</strong></p><ul><li>如果先指定的回调, 那当状态发生改变时, 回调函数就会调用, 得到数据</li><li>如果先改变的状态, 那当指定回调时, 回调函数就会调用, 得到数据</li></ul><h4 id="then如何链式调用？"><a href="#then如何链式调用？" class="headerlink" title="then如何链式调用？"></a>then如何链式调用？</h4><p>Promise实例.then()<strong>返回的是一个【新的Promise实例】</strong></p><p><strong>它的值和状态由什么决定?</strong></p><p>简单表达: <strong>由then()所指定的回调函数执行的结果决定</strong></p><p>详细表达:</p><ul><li>如果then所指定的回调返回的是非Promise值a:</li></ul><p>​              那么【新Promise实例】状态为：成功(fulfilled), 成功的value为a</p><ul><li>如果then所指定的回调返回的是一个Promise实例p:</li></ul><p>​              那么【新Promise实例】的状态、值，都与p一致</p><ul><li>如果then所指定的回调抛出异常:</li></ul><p>​              那么【新Promise实例】状态为rejected, reason为抛出的那个异常</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了1'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了1'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了2'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了2'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了3'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">throw</span> <span class="token number">900</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了3'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了4'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了4'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="纯回调会引起的问题？"><a href="#纯回调会引起的问题？" class="headerlink" title="纯回调会引起的问题？"></a>纯回调会引起的问题？</h4><p>如下：可以发现代码非常的混乱，不利于查阅，且当再多发几次的请求后更加难以查阅</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"> <span class="token comment">// 调用之前封装好的 sendAjax函数</span><span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//成功的回调1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第一次成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//成功的回调2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第二次成功了'</span> <span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>size<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//成功的回调3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第三次成功了'</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">// 失败的回调3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第三次失败了'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">// 失败的回调2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第二次失败了'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">// 失败的回调1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第1次失败了'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="使用then的链式调用解决回调地狱"><a href="#使用then的链式调用解决回调地狱" class="headerlink" title="使用then的链式调用解决回调地狱"></a>使用then的链式调用解决回调地狱</h4><p>注意：then方法会返回一个新的Promise实例对象 但是因为其成功的value回调里还返回了 sendAjax()方法，该方法的返回值也是Promise实例对象，所以then返回的新Promise实例的状态、值，都与sendAjax()方法返回的promise一致 （详情见上方 ‘<strong>then如何链式调用</strong>‘ ）</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 调用之前封装好的 sendAjax函数 （详情见上方 'Promise封装ajax请求'）</span><span class="token comment">//发送第1次请求</span><span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">/* 注意：then方法会返回一个新的Promise实例对象 但是因为其成功的value回调里还返回了 sendAjax()方法，该方法的返回值也是Promise实例对象，所以then返回的新Promise实例的状态、值，都与sendAjax()方法返回的promise一致 （详情见上方 'then如何链式调用' ）*/</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第1次请求成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送第2次请求 </span><span class="token keyword">return</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第1次请求失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第2次请求成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送第3次请求</span><span class="token keyword">return</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第2次请求失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第3次请求成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第3次请求失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="中断Promise链"><a href="#中断Promise链" class="headerlink" title="中断Promise链"></a>中断Promise链</h4><p><strong>原因：</strong></p><p>代码同上的时候，假如将发送第1次请求的地址写错后，第二次、第三次依然会因为种种原因继续执行。</p><p><strong>思路：</strong></p><p>当使用promise的then链式调用时, 在中间中断, 不再调用后面的回调函数。</p><p><strong>办法</strong>: </p><p>在失败的回调函数中返回一个pendding状态的Promise实例。在每次reason后加上 ‘ return new Promise(()<strong>=&gt;</strong>{}) ’  这样then返回的promise实例对象状态是pending就不会执行后边的value和reason</p><p>代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第1次请求成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送第2次请求 </span><span class="token keyword">return</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第1次请求失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第2次请求成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送第3次请求</span><span class="token keyword">return</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第2次请求失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第3次请求成功了'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第3次请求失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise的错误穿透"><a href="#Promise的错误穿透" class="headerlink" title="Promise的错误穿透"></a>Promise的错误穿透</h4><ul><li><p>当使用promise的then链式调用时, 可以在最后用catch指定一个失败的回调,</p></li><li><p>前面任何操作出了错误, 都会传到最后失败的回调中处理了</p></li></ul><p><strong>备注</strong>：如果不存在then的链式调用，就不需要考虑then的错误穿透。</p><p><strong>原理</strong>：底层帮我们在then里补上了一个失败的回调 reason =&gt; {throw reason}</p><p>又因为<strong>then所指定的回调抛出异常，那么新Promise实例状态为rejected</strong>, reason为抛出的那个异常</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//另一个例子演示错误的穿透</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了1'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token string">'b'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> reason<span class="token punctuation">}</span><span class="token comment">//底层帮我们补上的这个失败的回调</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了2'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">108</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> reason<span class="token punctuation">}</span><span class="token comment">//底层帮我们补上的这个失败的回调</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token comment">// reason =&gt; {throw reason}</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Promise的优势"><a href="#Promise的优势" class="headerlink" title="Promise的优势"></a>Promise的优势</h3><p><strong>优势：</strong></p><ul><li><strong>指定回调函数的方式更加灵活:</strong> </li></ul><p>​      旧的: 必须在启动异步任务前指定（如之前用jQuery封装的get请求，需要提前写好成功和失败的回调）</p><p>​      promise: 启动异步任务 <strong>=&gt;</strong> 返回promie对象 <strong>=&gt;</strong> 给promise对象绑定回调函数(甚至可以在异步任务结束后指定)</p><ul><li><strong>支持链式调用, 可以解决回调地狱问题</strong></li></ul><p>​      (1)什么是回调地狱：</p><p>​              回调函数嵌套调用, 外部回调函数异步执行的结果是嵌套的回调函数执行的条件</p><p>​      (2)回调地狱的弊病：</p><p>​              代码不便于阅读、不便于异常的处理</p><p>​      (3)一个不是很优秀的解决方案：</p><p>​              then的链式调用</p><p>​      (4)终极解决方案：</p><p>​              async/await（底层实际上依然使用then的链式调用）</p><h3 id="async-await的使用"><a href="#async-await的使用" class="headerlink" title="async/await的使用"></a>async/await的使用</h3><ul><li>注意:</li></ul><p>​    await<strong>必须写在async函数中</strong>, 但async函数中可以没有await</p><p>​    如果await的Promise实例对象失败了, 就会抛出异常, 需要通过try…catch来捕获处理</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// async function demo() {</span><span class="token comment">/*当Promise实例对象p状态为失败时，一旦try中的代码发生了抛异常，将会携带异常来到catch，此时err就是抛出的'a'*/</span><span class="token comment">//（记得前边加分号）</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// try中放可能存在错误的代码</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token keyword">const</span> result1 <span class="token operator">=</span> <span class="token keyword">await</span> p1console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span> result1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token keyword">await</span> p2console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span> result2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> result3 <span class="token operator">=</span> <span class="token keyword">await</span> p3console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">,</span> result3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="await的应用（解决链式调用）"><a href="#await的应用（解决链式调用）" class="headerlink" title="await的应用（解决链式调用）"></a>await的应用（解决链式调用）</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//准备好一个 Promise封装好的发送ajax get请求的函数 --sendAjax(url,data)</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment">// 如果wait右侧的表达式为Promise实例对象，await后的返回值是promise成功的值</span><span class="token keyword">const</span> result1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第1次请求成功了'</span><span class="token punctuation">,</span>result1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第2次请求成功了'</span><span class="token punctuation">,</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> result3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第3次请求成功了'</span><span class="token punctuation">,</span>result3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="async与await的规则"><a href="#async与await的规则" class="headerlink" title="async与await的规则"></a>async与await的规则</h4><ul><li>async修饰的函数</li></ul><p>​      函数的返回值为promise对象</p><p>​      Promise实例的结果由async函数执行的返回值决定</p><ul><li>await表达式</li></ul><p>​      await右侧的表达式一般为Promise实例对象, 但也可以是其它的值</p><p>​      (1).如果表达式是Promise实例对象, await后的返回值是promise成功的值</p><p>​      (2).如果表达式是其它值, 直接将此值作为await的返回值</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//测试async</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> p1console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="await原理"><a href="#await原理" class="headerlink" title="await原理"></a>await原理</h4><p> 若我们使用async配合await这种写法：</p><p> 1.表面上不出现任何的回调函数</p><p> 2.但实际上底层把我们写的代码进行了加工，把回调函数“还原”回来了。</p><p> 3.最终运行的代码是依然有回调的，只是程序员没有看见。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//程序员“轻松”的写法 </span><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> pconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//浏览器翻译后的代码</span><span class="token comment">/* p.then(result =&gt; {console.log(result);console.log(100);console.log(200);},) */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="宏队列与微队列"><a href="#宏队列与微队列" class="headerlink" title="宏队列与微队列"></a>宏队列与微队列</h3><p>宏队列:[宏任务1，宏任务2…..] –如主线程上定时器就是宏任务</p><p>微队列:[微任务1，微任务2…..]   –promise实例对象的then方法内就是微任务</p><p>规则：每次要执行宏队列里的一个任务之前，先看微队列里是否有待执行的微任务</p><p>   1.如果有，先执行微任务</p><p>   2.如果没有，按照宏队列里任务的顺序，依次执行</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//代码一</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>       <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功1'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>       <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功2'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'主线程'</span><span class="token punctuation">)</span>      <span class="token comment">// 控制台结果</span>主线程成功<span class="token number">1</span> <span class="token number">1</span>成功<span class="token number">2</span> <span class="token number">2</span>timeout<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//代码二</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout1'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout2'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>       <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功1'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>       <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败2'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// 控制台结果</span>成功<span class="token number">1</span> <span class="token number">1</span>失败<span class="token number">2</span> <span class="token number">2</span>timeout1timeout2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//代码三</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout1'</span><span class="token punctuation">)</span>  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>    <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了5'</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout2'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功了4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 控制台结果</span>成功了<span class="token number">3</span>成功了<span class="token number">4</span>timeout1成功了<span class="token number">5</span>timeout2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="经典面试题"><a href="#经典面试题" class="headerlink" title="经典面试题"></a>经典面试题</h3><p><strong>典型的先指定回调后改变状态</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">以下代码的执行流程：首先可以判断是先指定回调再改变状态主线程上的代码在飞速运行，<span class="token keyword">new</span> <span class="token class-name">Promise</span>后瞬间开始执行代码。然后执行器函数excuter是同步的回调函数，由于同步的回调函数不会往回调队列里边进，主线程上直接执行这些代码，瞬间开启一个定时器，那么setTimeout所指定的回调不是马上推入队列（除非到点了），而是放到浏览器的定时器管理模块，到点后定时器管理模块把setTimeout所指定的回调再推向宏队列，当主线程任务完成后才执行setTimeout所指定的回调。再来看主线程，<span class="token keyword">new</span> <span class="token class-name">Promise</span>在主线程上使用后，执行器函数也是在主线程上执行，定时器setTimeout内置函数也是在主线程上飞速的执行完毕（而最重要的是setTimeout其里边的函数体需要到点后再推向队列），然后主线程开始执行p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>这其中有成功和失败的两个函数参数，是挂在实例自身上了。可以理解为只要是Promise实例对象，那么一出生身上就有个类似 <span class="token constant">P</span><span class="token punctuation">.</span>list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>的结构，于是这里把成功和失败的回调推向这个里边（不是推向队列，因为还不知到上方状态的结果，除非是知道状态才去调用成功<span class="token operator">/</span>失败的回调）一旦setTimeout内函数体从宏队列拉出执行，才发现状态是否成功。然后去自身找到之前缓存的成功<span class="token operator">/</span>失败的回调。<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">// 函数体</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>   <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>典型的先改状态后指定回调</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* 典型的先改状态后指定回调这个Promise实例对象一出生瞬间变为成功的状态，然后指定回调。即成功后直接把成功的回调推向了微队列。（记住要执行的时候才进队列，等着主线程将它勾出来去执行）*/</span><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>   <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> <strong>面试题</strong></p><p>判断出控制台的输出结果？</p><p>注意：分析方法的注释是按照1~9顺序排列</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1、立马反应setTimeout立即调用，但是不能进主线程而是进宏队列  宏队列保存 0</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// 2、当主线程执行到此时，控制台输出 1，并且new一个Promise 判断出它是一个同步的回调 立刻马上输出1 且瞬间状态切换为成功 </span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 3、状态成功后执行 .then()方法里的回调，但是！！这是属于异步回调，需要先推入微队列  微队列保存 2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">/*        6、主线程分析完后,接着开始分析微队列       此时将2输出到控制台，此刻控制台为 1、7、2  此时微队列抹去 2        又 new了一个Promise，执行器在主线程运行马上输出3，同时resolve()将状态变为成功了 此刻控制台为 1、7、2、3       状态成功后，在.then()方法里有一个为其指定得成功得回调 ，!!注意这个回调也先得推入微队列,即把4所在回调推入微队列.此时队列保存8、4       下一个.then()也是为左侧.then()返回得新Promise实例对象指定得回调,但是前一个实例的状态是由4所在的回调来定义,而4目前还未执行，所以5就挂在了自身上不推入队列       此刻当前花括号内代码执行完毕,程序默认给Promise返回的值为undefined    */</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">/*        9、接着将4所在的回调拉入主线程执行 输出4  此刻控制台为 1、7、2、3、8、4       如果4所在的回调执行了,那么就说明所在的.then的状态就敲定了,返回undefined       因为.then()左侧有了结果,就把 5 推入微队列 ,此时微队列保存6、5       接着将6(所在的回调)拿出队列,推入主线程,此刻控制台为 1、7、2、3、8、4、6       接着将5(所在的回调)拿出队列,推入主线程,此刻控制台为 1、7、2、3、8、4、6、5       最后 把宏队列的0(所在的回到)推入主线程,此刻控制台为 1、7、2、3、8、4、6、5、0    */</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">/*        4、这里的.then()不会推入队列，是因为它左侧的Promise实例还没有执行没有返回出结果，这里当然不能执行，而是暂存放到左侧Promise实例身上    */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">/*       7、因为.then左侧返回undefined,所以新Promise实例状态为成功, 成功的value为undefined         因为.then()左侧有了结果,就把 6 推入微队列 ,此时队列保存8、4、6    */</span>     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">/*        5、又 new了一次Promise 此时控制台先输出 1、7 ，因为直接改变状态为成功，意味着要去调用后边  的.then()方法，当然得先把.then()方法推向微队列 此时队列保存 2 8     */</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">// 8、接着将8从队列拉出,此刻控制台为 1、7、2、3、8 此时队列保存4、6</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="包管理器的对比："><a href="#包管理器的对比：" class="headerlink" title="包管理器的对比："></a>包管理器的对比：</h2><p>仅用cnpm的仓库地址</p><p>使用yarn的命令</p><p>偶尔yarn网络不好，使用npm</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Promise&quot;&gt;&lt;a href=&quot;#Promise&quot; class=&quot;headerlink&quot; title=&quot;Promise&quot;&gt;&lt;/a&gt;Promise&lt;/h1&gt;&lt;h2 id=&quot;准备&quot;&gt;&lt;a href=&quot;#准备&quot; class=&quot;headerlink&quot; title=&quot;准</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Promise" scheme="https://wuzimo233.github.io/tags/Promise/"/>
    
  </entry>
  
  <entry>
    <title>AJAX新版学习大纲</title>
    <link href="https://wuzimo233.github.io/posts/14.html"/>
    <id>https://wuzimo233.github.io/posts/14.html</id>
    <published>2022-06-16T03:08:00.000Z</published>
    <updated>2022-06-16T03:36:07.277Z</updated>
    
    <content type="html"><![CDATA[<h1 id="AJAX-入门"><a href="#AJAX-入门" class="headerlink" title="AJAX 入门"></a>AJAX 入门</h1><h2 id="AJAX-简介"><a href="#AJAX-简介" class="headerlink" title="AJAX 简介"></a>AJAX 简介</h2><ul><li>AJAX全称为Asynchronous Javascript And XML，就是异步的 JS 和 XML。</li><li>通过AJAX可以在浏览器中向服务器发送异步请求，最大的优势：<strong>页面无刷新获取数据</strong>。</li><li>AJAX不是新的编程语言，而是一种将现有的标准组合在一起使用的新方式。</li><li>ajax也是属于原生js的http请求，可以说是一种特殊的http请求。</li></ul><p>在以往提交表单一般是这样子</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.baidu.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pad<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- button按钮会触发表单的提交 --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="XML简介"><a href="#XML简介" class="headerlink" title="XML简介"></a>XML简介</h3><ul><li><p>XML：可扩展标记语言</p></li><li><p>XML：被设计用来 <strong>传输和存储数据</strong></p><p>比方说<strong>客户端（client）</strong>与 <strong>服务器（serve）</strong>前后台进行数据交互的时候，你想获取十条新闻，服务器就要给你十条新闻，那么关键是用的什么方式给你？</p><p>于是服务器可以用XML这种字符串形式给你，XML本质就是字符串，不过有很多的规矩。</p></li><li><p>XML和HTML类似都是可扩展的标记语言，不同点：<strong>HTML中都是预定义标签</strong>，<strong>XML中没有预定义标签</strong>，<strong>全是自定义标签</strong>，用来表示一些数据</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">例：用xml表示学生数据<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>student</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>孙悟空<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>age</span><span class="token punctuation">&gt;</span></span>18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>age</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gender</span><span class="token punctuation">&gt;</span></span>男<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gender</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>student</span><span class="token punctuation">&gt;</span></span>可以发现体积较大了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>现在已被JSON取代</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">例：用JSON表示学生数据{"name":"孙悟空","age":18,gender:"男"}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h3 id="AJAX-的特点"><a href="#AJAX-的特点" class="headerlink" title="AJAX 的特点"></a>AJAX 的特点</h3><h4 id="AJAX-的优点"><a href="#AJAX-的优点" class="headerlink" title="AJAX 的优点"></a>AJAX 的优点</h4><ol><li>可以 **无需刷新页面与服务端进行通信 **获取数据</li><li>允许你根据用户事件来更新部分页面内容（例如淘宝鼠标移动到某个区域页面不刷新，但是部分区域内容更新）</li></ol><h4 id="AJAX-的缺点"><a href="#AJAX-的缺点" class="headerlink" title="AJAX 的缺点"></a>AJAX 的缺点</h4><ol><li>没有浏览历史，不能回退</li><li><strong>存在跨域问题（同源）</strong>–面试高频问题</li><li>SEO不友好（爬虫获取不到信息）</li></ol><h3 id="AJAX-的使用"><a href="#AJAX-的使用" class="headerlink" title="AJAX 的使用"></a>AJAX 的使用</h3><h4 id="核心对象-XMLHttpRequest"><a href="#核心对象-XMLHttpRequest" class="headerlink" title="核心对象:XMLHttpRequest"></a>核心对象:XMLHttpRequest</h4><p>AJAX的所有操作都是通过该对象进行的</p><h4 id="搭建测试ajax的服务器"><a href="#搭建测试ajax的服务器" class="headerlink" title="搭建测试ajax的服务器"></a>搭建测试ajax的服务器</h4><p>新建任意名的文件夹（最好不用数字开头，不能有大写字母）</p><p>接着<code>使用 yarn  init （或者 npm init）</code>将当前项目文件夹变成符合npm规范的包</p><p>使用 <code>yarn express</code> 安装express </p><p>项目文件夹下新建一个serve.js用来当作服务器</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1. 引入express</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token comment">// 2.创建一个app实例对象</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 4.配置一个路由 （比如想响应get请求，就起一个 'test_get' 的名字 ,里面有两个对象，请求和响应）</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test_get'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">// 函数体</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello_test_get!!!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 3.绑定监听    端口号（一般4位数字） + 回调（err是错误对象，如果没有错误对象就证明服务器开启成功）</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试ajax请求的服务器开启成功了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>启动服务器（三种方式）：node serve  / nodemon  .\serve.js   / 使用第三方插件 Code Runner（右键 点击Run Code开启，快捷键 ctrl+alt+m 关闭服务）</p><p>浏览器地址栏输入查看：localhost:8080/test_get  (浏览器默认是get请求)</p><h4 id="ajax小试牛刀"><a href="#ajax小试牛刀" class="headerlink" title="ajax小试牛刀"></a>ajax小试牛刀</h4><p>ajax也是属于原生js的http请求，可以说是一种特殊的http请求。</p><p>项目根目录新建文件夹src，下新建 ‘1_ajax小试牛刀.html’文件，右键文件使用vscode的Live Server打开</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//...</span>    <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>        #content <span class="token punctuation">{</span>            width<span class="token operator">:</span> <span class="token number">300</span>px<span class="token punctuation">;</span>            height<span class="token operator">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>            border<span class="token operator">:</span> <span class="token number">1</span>px solid black<span class="token punctuation">;</span>            margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是测试：ajax小试牛刀<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我发送请求（原生js里的ajax的<span class="token constant">GET</span>请求）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token comment">// 获取按钮</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token comment">// 给按钮绑定监听</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 发送ajax请求 有如下几步：</span>                <span class="token comment">// 1.创建xhr实例对象</span>                <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// 2.指定发送请求的：method、url</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://localhost:8080/test_get'</span><span class="token punctuation">)</span>                <span class="token comment">// 3.发送请求</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当点击按钮后控制台会报错，出现经典的跨域问题。（如果提示有…the serve responded with a status of 404 :5050/favicon.ico:1 (Not Found) 那么需要找一个ico图片放到项目文件根目录下即可）</p><p><strong>解决跨域：</strong></p><p>服务器中暴露静态资源</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1.引入express</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token comment">// 2.创建app实例对象</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 5.解决跨域:暴露静态资源</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">'/src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 4.配置一个路由 （比如想响应get请求，就起一个 'test_get' 的名字 ,里面有两个对象，请求和响应）</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test_get'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">// 函数体</span>    <span class="token comment">// 这里设置一句话，检查是否有人请求了</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求test_get了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello_test_get!!!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 3.监听</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试ajax请求的服务器开启成功了!测试地址如下'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/1_ajax小试牛刀.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在html文件中将发送请求的url改成 ‘ <a href="http://127.0.0.1:8080/test_get">http://127.0.0.1:8080/test_get</a> ‘，然后不使用vscode的Live Server打开，而是复制到浏览器使用serve.js的 ‘<a href="http://127.0.0.1:8080/1_ajax%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80.html%E2%80%99">http://127.0.0.1:8080/1_ajax小试牛刀.html’</a> 地址，同时要看到请求是否成功需要借助xhr的状态state来将xhr.response的结果返回给div中</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>该页面是测试：ajax小试牛刀<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>点我发送请求（原生js里的ajax的GET请求）<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">        <span class="token comment">// 获取按钮</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        <span class="token comment">// 给按钮绑定监听</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 发送ajax请求 有如下几步：</span>                <span class="token comment">// 1.创建xhr实例对象</span>                <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                        content<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h3&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>xhr<span class="token punctuation">.</span>response<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h3&gt;</span><span class="token template-punctuation string">`</span></span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment">// 2.指定发送请求的：method、url</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/test_get'</span><span class="token punctuation">)</span>                <span class="token comment">// 3.发送请求</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="xhr的5种状态（了解）"><a href="#xhr的5种状态（了解）" class="headerlink" title="xhr的5种状态（了解）"></a>xhr的5种状态（了解）</h4><p>复制’1_ajax小试牛刀.html’文件，改名为‘2_xhr的5种状态.html’，其他步骤和1文件类似方法打开</p><p>注意服务器需要再写一行</p><p>//方便复制</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 4.监听</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试ajax请求的服务器开启成功了!测试地址如下'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/1_ajax小试牛刀.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/2_xhr的5种状态.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//方便复制</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>页面html文件代码如下：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">//...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>该页面是测试：xhr的5种状态.html<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>点我发送请求（原生js里的ajax的GET请求）<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">        <span class="token comment">// 获取按钮</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        <span class="token comment">// 给按钮绑定监听</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 发送ajax请求 有如下几步：</span>                <span class="token comment">// 1.创建xhr实例对象</span>                <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// xhr实例对象在实例出来的那一刻就是0,随着请求变化不断变化</span>                <span class="token comment">/*                    xhr内部有5种状态,5种状态值分别为:0、1、2、3、4                    0:实例出来的那一刻就是0,初始状态                    1:open已经调用,但是send没有调用,此时可以修改请求头内容                    2:send已经调用了,已经无法修改请求头                    3:已经回来部分数据,小的数据会在此阶段一次性接收完毕,较大的数据有待进一步接收,响应头回来了.                    4:数据全部接收完毕                   // getAllResponseHeaders获取所有响应头                */</span>                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">// xhr的请求头api setRequestHeader //配置请求头:请求头中增加 key:value</span>                        <span class="token comment">// xhr.setRequestHeader('demo',123)</span>                        <span class="token comment">// alert('@')</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">// xhr.setRequestHeader('demo',123) //配置请求头:报错 因为2阶段无法修改请求头了</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3时接收到的数据'</span><span class="token punctuation">,</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3时接收到的响应头'</span><span class="token punctuation">,</span>xhr<span class="token punctuation">.</span><span class="token function">getAllResponseHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token punctuation">}</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                        content<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h3&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>xhr<span class="token punctuation">.</span>response<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h3&gt;</span><span class="token template-punctuation string">`</span></span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment">// 2.指定发送请求的：method、url</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/test_get'</span><span class="token punctuation">)</span>                <span class="token comment">// 3.发送请求</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意：请求成功的判断最好详细一点</p><p><code>if(xhr.readyState === 4 &amp;&amp; (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300)){</code></p><p>​    <code>//......</code></p><p><code>}</code>    </p><h4 id="ajax的get请求（掌握）"><a href="#ajax的get请求（掌握）" class="headerlink" title="ajax的get请求（掌握）"></a>ajax的get请求（掌握）</h4><p>复制’2_xhr的5种状态.html’文件，改名为‘3_ajax_get请求.html’，其他步骤和2文件类似方法打开</p><p>页面html文件代码:</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//...</span><span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是测试：ajax_get请求<span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我发送请求（原生js里的ajax的<span class="token constant">GET</span>请求）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token comment">// 获取按钮</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        <span class="token comment">// 给按钮绑定监听</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 发送ajax请求 有如下几步：</span>                <span class="token comment">// 1.创建xhr实例对象</span>                <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// 绑定监听</span>                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                            content<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h3&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>xhr<span class="token punctuation">.</span>response<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h3&gt;</span><span class="token template-punctuation string">`</span></span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment">// 2.指定发送请求的：method、url、参数</span>                <span class="token comment">/*                    1.形如：key=value&amp;key=value 就是query参数的urlencoded编码形式                    2.形如：/xx/xxx/老刘/18 就是params参数                */</span>                <span class="token comment">// xhr.open('GET','http://127.0.0.1:8080/test_get?name=老刘&amp;age=18')   //携带query参数</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/test_get2/老刘/18'</span><span class="token punctuation">)</span>            <span class="token comment">//携带params参数</span>                <span class="token comment">// 3.发送请求</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务器代码</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1.引入express</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token comment">// 2.创建app实例对象</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 5.解决跨域:暴露静态资源</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">'/src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 3.响应GET请求 -query参数</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test_get'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">// 函数体</span>    <span class="token comment">// 这里设置一句话，检查是否有人请求了</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求test_get了--携带的query参数是：'</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello_test_get!!!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 3.响应GET请求 -params参数</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test_get2/:name/:age'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">// 函数体</span>    <span class="token comment">// 这里设置一句话，检查是否有人请求了</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求test_get2了--携带的params参数是：'</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello_test_get2!!!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 4.监听</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试ajax请求的服务器开启成功了!测试地址如下'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/3_ajax_get请求.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ajax的post请求（掌握）"><a href="#ajax的post请求（掌握）" class="headerlink" title="ajax的post请求（掌握）"></a>ajax的post请求（掌握）</h4><p>复制’3_ajax_get请求.html’文件，改名为‘4_ajax_post请求.html’，其他步骤和3文件类似方法打开</p><p>页面html文件代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//...</span><span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是测试：ajax_post请求<span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我发送请求（原生js里的ajax的<span class="token constant">POST</span>请求）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token comment">// 获取按钮</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        <span class="token comment">// 给按钮绑定监听</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 发送ajax请求 有如下几步：</span>                <span class="token comment">// 1.创建xhr实例对象</span>                <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// 绑定监听</span>                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                            content<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h3&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>xhr<span class="token punctuation">.</span>response<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h3&gt;</span><span class="token template-punctuation string">`</span></span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment">// 2.指定发送请求的：method、url、参数</span>                                <span class="token comment">// post 可以携带query params参数 和请求体body（body有两种编码形式 urlencoded 、json）</span>                <span class="token comment">// xhr.open('POST','http://127.0.0.1:8080/test_post?name=tom&amp;age=18')       // 携带query参数      </span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/test_post'</span><span class="token punctuation">)</span>                          <span class="token comment">// 不带参数   (参数放到下方请求体发送)      </span>                <span class="token comment">// 追加响应头用于标识携带请求体参数的编码形式 --urlencoded 形式 </span>                <span class="token comment">// xhr.setRequestHeader('Content-type','application/x-www-form-urlencoded')  </span>                                <span class="token comment">// 追加响应头用于标识携带请求体参数的编码形式 --json 形式</span>                xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span><span class="token string">'application/json'</span><span class="token punctuation">)</span>                                                   <span class="token comment">// 3.发送请求 （post请求可以携带query、params参数，但是一般不带，而是放到请求体里面） 请求体里用urlencoded / json编码形式</span>                <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>                    name<span class="token operator">:</span><span class="token string">'老刘'</span><span class="token punctuation">,</span>                    age<span class="token operator">:</span><span class="token number">18</span>                <span class="token punctuation">}</span>                <span class="token comment">// xhr.send('name=老刘&amp;age=18')     //携带 urlencoded 编码形式的请求体参数</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//携带 json 编码形式的请求体参数 --使用JSON.stringify()方法将对象转为json格式</span>        <span class="token punctuation">}</span>       <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务器代码：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1.引入express</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token comment">// 2.创建app实例对象</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 使用中间件express.urlencoded() 解析urlencoded编码形式的请求体参数</span><span class="token comment">// 简单说：如果想用express框架接收post请求所携带的请求体参数，需要借助中间件 express.urlencoded</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 使用中间件解析json编码形式的请求体参数</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 5.解决跨域:暴露静态资源</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">'/src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 3.响应POST请求 -请求体参数(后端需要占位符) </span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/test_post'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求test_post了,携带的请求体参数是:'</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello_test_post!!!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 4.监听</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试ajax请求的服务器开启成功了!测试地址如下'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/4_ajax_post请求.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="git相关操作"><a href="#git相关操作" class="headerlink" title="git相关操作"></a>git相关操作</h2><p><strong>克隆仓库</strong></p><p>例：在一个名为student_ajax文件夹右键打开Git Bush Here 使用 git clone ‘仓库地址’，拿到公司代码 （此时克隆下来的文件里面有.git文件夹，该文件夹里边配置的是克隆的远程仓库的地址）</p><p>本地环境yarn 下载依赖</p><p>git add *   –将文件放到暂存区</p><p>git commit -m ‘描述干啥事情了’    –对刚才的操作进行注释</p><p>目前文件仅在本地git仓库里，还需要推送到线上仓库</p><p>git push origin master</p><p>当线上主线文件更新了之后，支线需要下载主线的最新版本，使用</p><p>git pull origin master 拉取代码 </p><p>那么这样拉取后本地文件将被线上文件覆盖，所以建议单独新建个文件夹存放克隆的的仓库，每次线上有更新就拉取代码到本地该文件夹里</p><p>借助vscode去操作git</p><h2 id="ajax解析json数据（了解）"><a href="#ajax解析json数据（了解）" class="headerlink" title="ajax解析json数据（了解）"></a>ajax解析json数据（了解）</h2><p><strong>推荐安装FeHelper(前端助手)插件到浏览器。</strong></p><p>新建’5_ajax_解析json数据.html’</p><p>页面html文件代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// ...</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是：解析json数据<span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我发送请求（原生js里的ajax的<span class="token keyword">get</span>请求）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 1.实例化xhr对象</span>            <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">// 2.绑定监听</span>            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 将json格式解析成对象 然后使用解构赋值</span>                       <span class="token comment">// 因为不知道后端那边的数据格式，假如后端是对象，直接使用JSON.parse（）就会报错 在3下方使用 xhr.responseType = 'json'解决</span>                        <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>                        content<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">                            &lt;ul&gt;                                    &lt;li&gt;姓名：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                        &lt;li&gt;年龄：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                        &lt;li&gt;性别：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                    &lt;/ul&gt;                        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment">// 3.指定发送请求的：method、url (这里暂时不加参数)</span>            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/get_person'</span><span class="token punctuation">)</span>            <span class="token comment">// 因为不知道后端那边的数据格式， responseType用于指定返回数据的格式</span>            xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>            <span class="token comment">// 4.发送请求</span>            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>     <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务器代码：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1.引入express</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token comment">// 2.创建app实例对象</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 使用中间件express.urlencoded() 解析urlencoded编码形式的请求体参数</span><span class="token comment">// 简单说：如果想用express框架接收post请求所携带的请求体参数，需要借助中间件 express.urlencoded</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 使用中间件解析json编码形式的请求体参数</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 5.解决跨域:暴露静态资源</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">'/src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 3.响应get请求 </span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get_person'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求get_person了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'老刘'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token string">'18'</span><span class="token punctuation">,</span>sex<span class="token operator">:</span><span class="token string">'女'</span><span class="token punctuation">}</span>     response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">//response.send('hello')</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 4.监听</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试ajax请求的服务器开启成功了!测试地址如下'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/5_ajax_解析json数据.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="连续解构赋值"><a href="#连续解构赋值" class="headerlink" title="连续解构赋值"></a>连续解构赋值</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Document<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>        <span class="token comment">// 例子 想要得到c ？？</span>                <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>            a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>            b<span class="token operator">:</span><span class="token punctuation">{</span>                c<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token comment">// 方法1 --标准的解构赋值得到 2</span>        <span class="token comment">// const {c} = (obj.b)</span>        <span class="token comment">// console.log(c);   /</span>        <span class="token comment">// 方法2 --连续解构赋值</span>        <span class="token comment">// const {b:{c}} = obj</span>        <span class="token comment">// console.log(c); // 得到 2</span>        <span class="token comment">// 新需求不喜欢用c名称，改为value </span>        <span class="token comment">//  连续解构赋值 + 重命名</span>        <span class="token keyword">const</span> <span class="token punctuation">{</span>b<span class="token operator">:</span><span class="token punctuation">{</span>c<span class="token operator">:</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">=</span> obj        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 得到 2</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="处理IE浏览器-get请求缓存问题（了解）"><a href="#处理IE浏览器-get请求缓存问题（了解）" class="headerlink" title="处理IE浏览器-get请求缓存问题（了解）"></a>处理IE浏览器-get请求缓存问题（了解）</h2><p>协商缓存 –一般浏览器中，当页面第一次向服务器发起请求后，服务器返回数据给页面，在控制台终端Network中可以看到请求的状态码是200。此时，当服务器中的数据更新（改变）后，页面第二次向服务器发起请求，页面数据随之变化，但是第三次点击按钮，控制台终端的状态码显示304（因为这次和上一次请求的地址都没有变化，浏览器会认为返回的信息依然和之前一样，但还是会问一问服务器，数据是否有变化，此时若服务器返回没有变化，那么浏览器会从自己缓存中读取数据，304就出现了） 所以也叫协商缓存。</p><p>但是！<strong>IE浏览器</strong>，在遇到该问题时候非常武断，直接不问服务器直接拿之前的数据给页面用。–IE的强缓存机制</p><p>解决方式：加上了时间戳参数，忽悠IE浏览器每次的请求地址不同。即使服务器接口没有参数，默认不处理请求来的参数。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 指定发送请求的：method、url (这里暂时不加参数)</span>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/get_person?t='</span><span class="token operator">+</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="请求异常与超时的处理"><a href="#请求异常与超时的处理" class="headerlink" title="请求异常与超时的处理"></a>请求异常与超时的处理</h2><p>新建’ 7_ajax请求的异常与超时处理.html ‘文件</p><p>页面html文件代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"> <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是：ajax请求的异常与超时处理<span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我发送请求（原生js里的ajax的<span class="token keyword">get</span>请求）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// 1.实例化xhr对象</span>            <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">// 2.绑定监听</span>            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">}</span> <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response                        content<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">                            &lt;ul&gt;                                &lt;li&gt;姓名：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                    &lt;li&gt;年龄：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                    &lt;li&gt;性别：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                &lt;/ul&gt;                        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment">// 3.指定发送请求的：method、url (这里暂时不加参数)</span>            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/get_person_delay?t='</span><span class="token operator">+</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment">// 因为不知道后端那边的数据格式， responseType用于指定返回数据的格式</span>            xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>            <span class="token comment">// 网络不好的处理 --配置出错的回调</span>            xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'请求出错了，可能当前网络不稳定请稍后再试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">//超时时间 --这个api意思是仅请求2秒，2秒后没有数据返回就取消请求</span>            xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2000</span>            <span class="token comment">// 超时后的回调</span>            xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'网速不给力，请切换网络'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>             <span class="token comment">// 4.发送请求</span>            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>     <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务器代码</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 3.响应get请求 --延时响应</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get_person_delay'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求get_person了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'海峰6'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token string">'18'</span><span class="token punctuation">,</span>sex<span class="token operator">:</span><span class="token string">'女'</span><span class="token punctuation">}</span>    <span class="token comment">// 3秒后返回数据</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>        response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ajax取消请求（掌握）"><a href="#ajax取消请求（掌握）" class="headerlink" title="ajax取消请求（掌握）"></a>ajax取消请求（掌握）</h2><p>新建  ’ 8_ajax取消请求.html ‘ </p><p>页面html文件代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// ...</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是：ajax取消请求<span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我发送请求（原生js里的ajax的<span class="token keyword">get</span>请求）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn2"</span><span class="token operator">&gt;</span>取消请求<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> btn2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn2'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        <span class="token keyword">let</span> xhr        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// 1.实例化xhr对象</span>            xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">// 2.绑定监听</span>            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">}</span> <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response                        content<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">                            &lt;ul&gt;                                &lt;li&gt;姓名：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                    &lt;li&gt;年龄：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                    &lt;li&gt;性别：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                &lt;/ul&gt;                        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment">// 3.指定发送请求的：method、url (这里暂时不加参数)</span>            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/get_person_delay?t='</span><span class="token operator">+</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment">// 因为不知道后端那边的数据格式， responseType用于指定返回数据的格式</span>            xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>            <span class="token comment">// 网络不好的处理 --配置出错的回调</span>            xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'请求出错了，可能当前网络不稳定请稍后再试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">//超时时间 --这个api意思是仅请求2秒，2秒后没有数据返回就取消请求</span>            xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2000</span>            <span class="token comment">// 超时后的回调</span>            xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'网速不给力，请切换网络'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>             <span class="token comment">// 4.发送请求</span>            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">// xhr.abort() //这里只要发送请求的次数多还是有概率会取消不了</span>        <span class="token punctuation">}</span> <span class="token comment">//点击第二个按钮后触发取消请求</span>        btn2<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务端代码：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 3.响应get请求</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get_person_delay'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求get_person了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'海峰6'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token string">'18'</span><span class="token punctuation">,</span>sex<span class="token operator">:</span><span class="token string">'女'</span><span class="token punctuation">}</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="如何避免用户发送重复请求（掌握）"><a href="#如何避免用户发送重复请求（掌握）" class="headerlink" title="如何避免用户发送重复请求（掌握）"></a>如何避免用户发送重复请求（掌握）</h2><p>新建  ’ 9_避免多次重复请求.html ‘ </p><p>页面html文件代码如下：</p><p>思路：点击按钮前，定义一个isLoading变量</p><p>代码执行顺序：当第一次点击按钮后，先判断isLoading变量，为假就取消。然后实例化xhr，指定发送请求的格式参数，发送请求，接着关键一点就是将isLoading变量变为真，（这样当下次点击按钮时候，isLoading变量为真就会取消下次的请求）然后判断服务器那边的状态码将isLoading变量变为假。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// ...</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是：避免多次重复请求<span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我发送请求（原生js里的ajax的<span class="token keyword">get</span>请求）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        <span class="token keyword">let</span> xhr        <span class="token comment">// 声明一个变量，假如它为真代表正在发送请求中，就可以在之后取消请求</span>        <span class="token keyword">let</span> isLoading        <span class="token comment">// 每次点击按钮 xhr将被重新实例化，即每次都被替换成新的xhr对象</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment">// 这里代表第一次点击按钮 由于isLoading为undefin 所以不会取消请求</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// 1.实例化xhr对象</span>                xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// 4. 这是判断服务器那边的状态码 （绑定监听）</span>                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            isloading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">}</span> <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response                            content<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">                                &lt;ul&gt;                                    &lt;li&gt;姓名：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                        &lt;li&gt;年龄：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                        &lt;li&gt;性别：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;                                    &lt;/ul&gt;                            </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment">// 2.指定发送请求的：method、url (这里暂时不加参数)</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/get_person_delay'</span><span class="token punctuation">)</span>                <span class="token comment">// 因为不知道后端那边的数据格式， responseType用于指定返回数据的格式</span>                xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>                <span class="token comment">// 3.发送请求</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                isLoading <span class="token operator">=</span> <span class="token boolean">true</span>                      <span class="token punctuation">}</span>     <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务端代码:</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 3.响应get请求 --延时响应</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get_person_delay'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求get_person了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'海峰6'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token string">'18'</span><span class="token punctuation">,</span>sex<span class="token operator">:</span><span class="token string">'女'</span><span class="token punctuation">}</span>    <span class="token comment">// 3秒后返回数据</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>        response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="jQuery封装的ajax（了解）"><a href="#jQuery封装的ajax（了解）" class="headerlink" title="jQuery封装的ajax（了解）"></a>jQuery封装的ajax（了解）</h2><p>新建 ‘10_jquery封装的ajax.html’</p><p>打开浏览器 –下载好jquerymini.js放到文件中引入</p><p>页面html文件代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// ...</span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"./js/jquery.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是：jQuery封装的ajax<span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn1"</span><span class="token operator">&gt;</span>点我发送请求（jQuery<span class="token operator">-</span>ajax<span class="token operator">-</span><span class="token keyword">get</span>）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn2"</span><span class="token operator">&gt;</span>点我发送请求（jQuery<span class="token operator">-</span>ajax<span class="token operator">-</span>post）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token keyword">const</span> btn1 <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btn1'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> btn2 <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btn2'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#content'</span><span class="token punctuation">)</span>        btn1<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 使用jQyuery发送get请求 --完整版写法</span>            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                url<span class="token operator">:</span> <span class="token string">'http://127.0.0.1:8080/test_jquery_get'</span><span class="token punctuation">,</span> <span class="token comment">//请求地址</span>                method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>                                <span class="token comment">//请求方式 --不写的话默认也是get</span>                data<span class="token operator">:</span> <span class="token punctuation">{</span> school<span class="token operator">:</span> <span class="token string">'麻省理工学院'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>              <span class="token comment">//携带的数据</span>                dataType<span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>                             <span class="token comment">//配置响应数据格式 --将服务器拿到的json数据类型转换成对象</span>                timeout<span class="token operator">:</span><span class="token string">'2000'</span><span class="token punctuation">,</span>                               <span class="token comment">//指定超时的时间</span>                <span class="token comment">// 成功的回调函数</span>                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> responseText<span class="token punctuation">,</span> xhr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token comment">//第二个参数 responseText --代表本次响应（成功与否）的文字 第三个参数是xhr</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> responseText<span class="token punctuation">,</span> xhr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    content<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;汽车名：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,价格：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>price<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token comment">// 失败的回调</span>                <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">xhr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                           <span class="token comment">//里边可以有 xhr参数</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token comment">// 使用jQyuery发送get请求 携带query参数 --简版写法</span>            <span class="token comment">// 如果是params请求  /test_jquery_get/bilibili</span>            <span class="token comment">// $.get('http://127.0.0.1:8080/test_jquery_get',{school: '麻省理工学院' },(data)=&gt;{</span>            <span class="token comment">//     console.log(data);</span>            <span class="token comment">// },'json')</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>        btn2<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 使用jQyuery发送 post请求 --完整版写法</span>            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                url<span class="token operator">:</span> <span class="token string">'http://127.0.0.1:8080/test_jquery_post'</span><span class="token punctuation">,</span> <span class="token comment">//请求地址</span>                method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>                                <span class="token comment">//请求方式 --不写的话默认也是get</span>                data<span class="token operator">:</span> <span class="token punctuation">{</span> school<span class="token operator">:</span> <span class="token string">'麻省理工学院'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>              <span class="token comment">//携带的数据</span>                dataType<span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>                             <span class="token comment">//配置响应数据格式 --将服务器拿到的json数据类型转换成对象</span>                timeout<span class="token operator">:</span><span class="token string">'2000'</span><span class="token punctuation">,</span>                               <span class="token comment">//指定超时的时间</span>                <span class="token comment">// 成功的回调函数</span>                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> responseText<span class="token punctuation">,</span> xhr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token comment">//第二个参数 responseText --代表本次响应（成功与否）的文字 第三个参数是xhr</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> responseText<span class="token punctuation">,</span> xhr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    content<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;汽车名：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,价格：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>price<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token comment">// 失败的回调</span>                <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">xhr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                           <span class="token comment">//里边可以有 xhr参数</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token comment">// 使用jQyuery发送post请求 携带query参数 --简版写法</span>            <span class="token comment">// 如果是params请求  /test_jquery_post/bilibili</span>            <span class="token comment">//$.post('http://127.0.0.1:8080/test_jquery_post',{school: '麻省理工学院' },(data)=&gt;{</span>                <span class="token comment">//console.log(data);</span>                <span class="token comment">//content.append(`&lt;div&gt;汽车名：${data.name},价格：${data.price}&lt;/div&gt;`)</span>            <span class="token comment">//},'json')</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务端代码</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 响应GET请求 --为jQuery准备： 接收query参数  如果是params参数 --'/test_jquery_get/:school' console.log('有人请求test_jquery_get了',request.params);</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test_jquery_get'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求test_jquery_get了'</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> car<span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'马自达.阿特兹'</span><span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token string">'25w'</span><span class="token punctuation">}</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>car<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 响应POST请求 --为jQuery准备： 响应体：request.body</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/test_jquery_post'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求test_jquery_post了'</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> car<span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'马自达.阿特兹'</span><span class="token punctuation">,</span>price<span class="token operator">:</span><span class="token string">'25w'</span><span class="token punctuation">}</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>car<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="演示回调地狱（了解）"><a href="#演示回调地狱（了解）" class="headerlink" title="演示回调地狱（了解）"></a>演示回调地狱（了解）</h2><p>新建 ’ 11_演示回调地狱.html ‘</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token number">11</span>_演示回调地狱<span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"./js/jquery.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是：演示回调地狱<span class="token punctuation">.</span>html（看代码）<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>需求：点击按钮<span class="token number">1</span>之后发送一条请求，成功后发第二条，第二条成功后再发第三条，<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn1"</span><span class="token operator">&gt;</span>点我发送请求（jQuery<span class="token operator">-</span>ajax<span class="token operator">-</span><span class="token keyword">get</span>）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token keyword">const</span> btn1 <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btn1'</span><span class="token punctuation">)</span>        btn1<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 使用jQyuery发送get请求 携带query参数 --简版写法</span>            $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/test_jquery_get'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>school<span class="token operator">:</span> <span class="token string">'麻省理工学院'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                        $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/test_jquery_get'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>school<span class="token operator">:</span> <span class="token string">'麻省理工学院'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                                    $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/test_jquery_get'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>school<span class="token operator">:</span> <span class="token string">'麻省理工学院'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'json'</span><span class="token punctuation">)</span>                        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'json'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'json'</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="跨域问题与同源策略总结："><a href="#跨域问题与同源策略总结：" class="headerlink" title="跨域问题与同源策略总结："></a>跨域问题与同源策略总结：</h2><h3 id="为什么有跨域问题？"><a href="#为什么有跨域问题？" class="headerlink" title="为什么有跨域问题？"></a>为什么有跨域问题？</h3><ul><li><p>原因是浏览器为了安全，而采用的同源策略。</p><p>浏览器中有一个ajax引擎，只要xhr请求必须走ajax引擎，ajax引擎听一个叫同源策略的话，当前后端的端口不同时，浏览器阻止页面收到请求。</p></li></ul><h3 id="什么是同源策略？"><a href="#什么是同源策略？" class="headerlink" title="什么是同源策略？"></a>什么是同源策略？</h3><ul><li><p>同源策略是由<strong>Netscape</strong>（网景公司）提出的一个著名安全策略，现在所有支持JavaScript的浏览器都会使用这个策略。</p></li><li><p>Web是构建同源策略协议基础之上的，浏览器只是针对同源策略的一种实现。</p></li><li><p>所谓同源是指：<strong>协议、域名（IP），端口必须要完全相同。</strong></p></li></ul><p>​        即：协议、域名（IP）、端口都相同，才能算是在<strong>同一个域里</strong></p><p><strong>备注：</strong>规则举例如下（假设已有网站地址为：<a href="http://study.cn/">http://study.cn</a>  不写端口号时，http会使用默认的）</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">请求地址：形式 结果http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>study<span class="token punctuation">.</span>cn<span class="token operator">/</span>test<span class="token operator">/</span>a<span class="token punctuation">.</span>html协议、域名、端口均相同      成功http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>study<span class="token punctuation">.</span>cn<span class="token operator">/</span>user<span class="token operator">/</span>a<span class="token punctuation">.</span>html协议、域名、端口均相同   成功http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>study<span class="token punctuation">.</span>cn<span class="token operator">/</span>user<span class="token operator">/</span>a<span class="token punctuation">.</span>html域名不同      失败http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>study<span class="token punctuation">.</span>cn<span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>tset<span class="token operator">/</span>a<span class="token punctuation">.</span>html域名不同      失败http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>study<span class="token punctuation">.</span>cn<span class="token operator">/</span>user<span class="token operator">/</span>a<span class="token punctuation">.</span>html协议、域名、端口均相同   成功https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>study<span class="token punctuation">.</span>cn<span class="token operator">/</span>tset<span class="token operator">/</span>a<span class="token punctuation">.</span>html协议不同      失败<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="没有同源策略的危险场景："><a href="#没有同源策略的危险场景：" class="headerlink" title="没有同源策略的危险场景："></a>没有同源策略的危险场景：</h3><p>危险场景：</p><p>​        有一天，你刚睡醒，收到一封邮件，说你的银行账号有风险，赶紧点进<a href="http://www.yinghang.com改密码.你着急的赶紧点击进去,还是熟悉的银行登陆界面,你果断输入账号密码后,还没准备看里边的余额,睡眼朦胧的你想起了平时访问的银行网站是/">www.yinghang.com改密码。你着急的赶紧点击进去，还是熟悉的银行登陆界面，你果断输入账号密码后，还没准备看里边的余额，睡眼朦胧的你想起了平时访问的银行网站是</a> <a href="http://www.yinhang.com,不是现在访问这个。随后你收到短信，钱没了，这个钓鱼网站做了什么呢？">www.yinhang.com,不是现在访问这个。随后你收到短信，钱没了，这个钓鱼网站做了什么呢？</a> 大概是如下思路：</p><p>新建 ’ 12_演示没有同源策略的危险场景.html ‘</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>iframe id<span class="token operator">=</span><span class="token string">"baidu"</span> src<span class="token operator">=</span><span class="token string">"https://www.baidu.com"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>iframe<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>      <span class="token keyword">const</span> iframe <span class="token operator">=</span> window<span class="token punctuation">.</span>frames<span class="token punctuation">[</span><span class="token string">'baidu'</span><span class="token punctuation">]</span>      <span class="token keyword">const</span> inputNode <span class="token operator">=</span> iframe<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'输入铭感信息的input的id'</span><span class="token punctuation">)</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inputNode<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="非同源受到哪些限制？"><a href="#非同源受到哪些限制？" class="headerlink" title="非同源受到哪些限制？"></a>非同源受到哪些限制？</h3><ul><li><p>Cookie不能读取；</p></li><li><p>DOM无法获得；</p></li><li><p>Ajax请求不能获取数据；</p></li></ul><h2 id="JSONP解决跨域（掌握）"><a href="#JSONP解决跨域（掌握）" class="headerlink" title="JSONP解决跨域（掌握）"></a>JSONP解决跨域（掌握）</h2><p><strong>JSONP是什么</strong></p><p>JSONP (JSON with Padding)，是一个非官方的跨域解决方案，纯粹凭借程序员的聪明才智开发出来，只支持get请求</p><p>同源策略限制了xhr、Cookie、DOM，但是在网页有一些<strong>标签</strong>具有跨域能力，比如：img, link, iframe, scriptJ。SONP就是利用<strong>script</strong>标签的跨域能力来发送请求的</p><p>新建文件‘13_jsonp解决跨域.html’</p><p>代码如下：</p><p>一切的前提是定义了demo()，当点击按钮后创建一个script节点并且src属性为请求的地址，将节点放入页面，最后在给window添加demo方法。</p><p>解决的原理是绕开了xhr，借助script标签发请求不收同源策略的限制。有一种前端定义函数，后端调用函数的感觉。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 这里的jquery可以发送跨域请求 <span class="token operator">--</span>因为是在script的src下支持跨域 <span class="token operator">--</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 1.创建script节点</span>            <span class="token keyword">const</span> scriptNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>            <span class="token comment">// 2.给节点指定src属性（请求地址）</span>            scriptNode<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://localhost:8080/test_jsonp'</span>            <span class="token comment">// 3.将节点放入页面</span>            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>scriptNode<span class="token punctuation">)</span>            <span class="token comment">// 4.准备好一个函数</span>            window<span class="token punctuation">.</span><span class="token function-variable function">demo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务端代码：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 响应get请求 --为jsonp跨域准备</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test_jsonp'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'tpm'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span>    <span class="token comment">// 想将一个对象变成字符有两种方式：</span>    <span class="token comment">// 1、toString() 方法         但是人类一般接受不了 --demo([object object])</span>    <span class="token comment">// 2、JSON.stringify() 方法</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">demo(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="完善JSONP"><a href="#完善JSONP" class="headerlink" title="完善JSONP"></a>完善JSONP</h2><p>优化：</p><p>1、 假如前端的函数名更改了，后端也要更改一次就很麻烦     –需要优化写法</p><p>2、前边每次点击按钮都会动态创建了一个script标签               –需要移除已经使用过的script节点</p><p>页面代码：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 这里的jquery可以发送跨域请求 <span class="token operator">--</span>因为是在script的src下支持跨域 <span class="token operator">--</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>当前页面一定不要用服务器去打开，因为要制造跨域问题，用jsonp解决问题<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 1.创建script节点</span>            <span class="token keyword">const</span> scriptNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>            <span class="token comment">// 2.给节点指定src属性（请求地址） 这里的key使用callback命名是因为前端请求，后端返回的数据是一段可以执行的js代码，这段代码触发了peiqi函数的调用</span>            scriptNode<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://localhost:8080/test_jsonp?callback=peiqi'</span>             <span class="token comment">// 3.将节点放入页面</span>            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>scriptNode<span class="token punctuation">)</span>            <span class="token comment">// 4.准备好一个函数</span>            window<span class="token punctuation">.</span><span class="token function-variable function">peiqi</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">// 5.（优化）移除已经使用过的script节点</span>            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>scriptNode<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务端代码：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 响应get请求 --为jsonp跨域准备</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test_jsonp'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>callback<span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>query    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'tpm'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'jery'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token string">'16'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>    <span class="token comment">// 这样写的优势是前端的函数名随便更改，后端这里不需要改</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>callback<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="JSONP面试问题："><a href="#JSONP面试问题：" class="headerlink" title="JSONP面试问题："></a><strong>JSONP面试问题：</strong></h3><h4 id="JSON-和-JSONP有关系吗？"><a href="#JSON-和-JSONP有关系吗？" class="headerlink" title="JSON 和 JSONP有关系吗？"></a><strong>JSON 和 JSONP有关系吗？</strong></h4><p>有一定关系，但是他俩是两回事儿。JSON是一种存储和交互的一种格式，JSONP是后端一种解决跨域的方式。他俩的关系是因为后端返回数据的时候，必须将数据变为JSON字符串。</p><h4 id="用JSONP去解决跨域也是用到了xhr对吗？"><a href="#用JSONP去解决跨域也是用到了xhr对吗？" class="headerlink" title="用JSONP去解决跨域也是用到了xhr对吗？"></a><strong>用JSONP去解决跨域也是用到了xhr对吗？</strong></h4><p>不对，JSONP解决跨域根本没用到xhr</p><h4 id="JSONP解决跨域有什么缺点？"><a href="#JSONP解决跨域有什么缺点？" class="headerlink" title="JSONP解决跨域有什么缺点？"></a><strong>JSONP解决跨域有什么缺点？</strong></h4><p>后端需要配合前端去拿到callback函数名，后端需要配合前端将数据变成JSON格式，后端需要配合前端写成函数调用的形式，简单来说前后端都挺麻烦。</p><h2 id="jQuery封装的JSONP（了解）"><a href="#jQuery封装的JSONP（了解）" class="headerlink" title="jQuery封装的JSONP（了解）"></a>jQuery封装的JSONP（了解）</h2><p><strong>用jQuery去发送一个JSONP请求</strong>：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token number">14</span>_jQuery封装的<span class="token constant">JSONP</span><span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"./js/jquery.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>当前页面一定不要用服务器去打开，因为要制造跨域问题，用jQuery封装的<span class="token constant">JSONP</span>解决<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span>        btn<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>            $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8080/test_jsonp?callback=?'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="CORS-（后端技术）解决跨域（掌握）"><a href="#CORS-（后端技术）解决跨域（掌握）" class="headerlink" title="CORS （后端技术）解决跨域（掌握）"></a>CORS （后端技术）解决跨域（掌握）</h2><h4 id="CORS-是什么？"><a href="#CORS-是什么？" class="headerlink" title="CORS 是什么？"></a>CORS 是什么？</h4><p>​        CORS (Cross-Origin Resource Sharing), 跨域资源共享。CORS 是官方的跨域解决方案，它的特点是不需要在客户端做任何特殊的操作，完全在服务器中进行处理，支持 get 和 post 等请求。跨域资源共享标准新增了一组 HTTP  首部字段（响应头），允许服务器声明哪些源站通过浏览器有权限访问哪些资源</p><h4 id="CORS-怎么工作的？"><a href="#CORS-怎么工作的？" class="headerlink" title="CORS 怎么工作的？"></a>CORS 怎么工作的？</h4><p>​        CORS 是通过设置一个响应头来告诉浏览器，该请求允许跨域，浏览器收到该响应以后就会对响应放行。</p><h4 id="CORS-的使用"><a href="#CORS-的使用" class="headerlink" title="CORS 的使用"></a>CORS 的使用</h4><p>新建 ‘ 15_测试cors解决跨域.html ’文件</p><p>代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// ...</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>当前页面一定不要用服务器去打开，因为要制造跨域问题，测试cors解决跨域<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我获取数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token comment">// 获取按钮</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        <span class="token comment">// 给按钮绑定监听</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 发送ajax请求 有如下几步：</span>                <span class="token comment">// 1.创建xhr实例对象</span>                <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span><span class="token function">getAllResponseHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment">// 2.指定发送请求的：method、url</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/test_get'</span><span class="token punctuation">)</span>                <span class="token comment">// 3.发送请求</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​        主要是服务端的设置：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 3.响应GET请求 -可以接收query 参数   request,response --请求、响应对象</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test_get'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有人请求test_get了--携带的query参数是：'</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:5500'</span><span class="token punctuation">)</span> <span class="token comment">// 只允许这个 http://127.0.0.1:5500 网站进行跨域请求</span>    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Expose-Headers'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token comment">// 把所有的响应头都交给跨域的网站</span>    <span class="token comment">// response.setHeader('Access-Control-Allow-Origin','*') // '*' 任何网站都可以来这个接口拿数据</span>    <span class="token comment">// 这里设置一句话，检查是否有人请求了</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello_test_get!!!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="发送-put-请求"><a href="#发送-put-请求" class="headerlink" title="发送 put 请求"></a>发送 put 请求</h2><p>新建文件 ‘16_ajax_put请求.html’</p><p>文件代码为：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// ...</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>该页面是测试：ajax_put请求<span class="token punctuation">.</span>html<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我发送请求（原生js里的ajax的<span class="token constant">PUT</span>请求）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>        <span class="token comment">// 获取按钮</span>        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>        <span class="token comment">// 给按钮绑定监听</span>        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 发送ajax请求 有如下几步：</span>                <span class="token comment">// 1.创建xhr实例对象</span>                <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// 绑定监听</span>                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                            content<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h3&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>xhr<span class="token punctuation">.</span>response<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h3&gt;</span><span class="token template-punctuation string">`</span></span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'PUT'</span><span class="token punctuation">,</span><span class="token string">'http://127.0.0.1:8080/test_put'</span><span class="token punctuation">)</span>                           <span class="token comment">// 3.发送请求</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务端代码：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 响应 put请求</span>app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/test_put'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Expose-Headers'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token comment">// 把所有的响应头都交给跨域的网站</span>    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span>   <span class="token comment">// '*' 任何网站都可以来这个接口拿数据</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello_tset_put'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>假如此时使用 open with live serve打开文件，将会显示跨域问题，即仅仅如上设置服务端是没有解决 put请求的跨域问题   –(预请求失败)</p><p>因为get、put属于http里的简单请求，不存在嗅探请求（也叫预请求 –在请求真正发出之前要进行一个预请求的动作  预解析 –在代码真正执行之前有人扫了一遍代码），put和delete有预请求这种嗅探请求。同时复杂请求可以检查服务器的性能，使用HTTP的OPTIONS方法，因此目前服务端没有写这个方法就会失败。所以可以在服务端的put请求之前再写一个options请求</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 预请求的方式</span>app<span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token string">'/test_put'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span>   <span class="token comment">// '*' 任何网站都可以来这个接口拿数据</span>    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Expose-Headers'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token comment">// 把所有的响应头都交给跨域的网站</span>    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Methods'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span>   <span class="token comment">// 预请求 这里代表哪些请求可以跨域 '*'代表任何请求都可以</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'我性能很好'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 响应 put请求</span>app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/test_put'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Expose-Headers'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token comment">// 把所有的响应头都交给跨域的网站</span>    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span>   <span class="token comment">// '*' 任何网站都可以来这个接口拿数据</span>    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello_tset_put'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>总结：掌握的需要掌握，了解的需要了解</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;AJAX-入门&quot;&gt;&lt;a href=&quot;#AJAX-入门&quot; class=&quot;headerlink&quot; title=&quot;AJAX 入门&quot;&gt;&lt;/a&gt;AJAX 入门&lt;/h1&gt;&lt;h2 id=&quot;AJAX-简介&quot;&gt;&lt;a href=&quot;#AJAX-简介&quot; class=&quot;headerlink</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Ajax" scheme="https://wuzimo233.github.io/tags/Ajax/"/>
    
  </entry>
  
  <entry>
    <title>Vuex学习</title>
    <link href="https://wuzimo233.github.io/posts/13.html"/>
    <id>https://wuzimo233.github.io/posts/13.html</id>
    <published>2022-05-26T07:00:00.000Z</published>
    <updated>2022-06-16T03:36:01.192Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Vuex学习"><a href="#Vuex学习" class="headerlink" title="Vuex学习"></a>Vuex学习</h1><h2 id="1、Vuex是什么？"><a href="#1、Vuex是什么？" class="headerlink" title="1、Vuex是什么？"></a>1、Vuex是什么？</h2><p>1.介绍</p><p>​        Vuex 是一个专为 Vue.js 应用程序开发的<strong>状态管理模式</strong>。它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。</p><p>2.说明：</p><p>​        Vuex是vue组件之间数据传递的方式，任意组件都可以使用-类似大仓库  </p><p>一般来说某个组件要用数据，可以调用<strong>Render读取</strong>Vuex中的数据，然后使用Dispatch调用<strong>Actions修改</strong>页面的数据，当然还有许多其他步骤，这只是最经典的动作（<strong>先读再操作</strong>）。Actions操作后会利用中间转接人<strong>Mutations去修改State</strong>，</p><p><img src="https://v3.vuex.vuejs.org/vuex.png" alt="vuex"></p><h2 id="2、安装Vuex"><a href="#2、安装Vuex" class="headerlink" title="2、安装Vuex"></a>2、安装Vuex</h2><ol><li><p>安装：</p><p><code>cnpm install vuex --save</code> 目前默认安装的是Vue3的vuex4版本，vue2需要安装指定版本，我使用的npm i <a href="mailto:vuex@3.6.2">vuex@3.6.2</a></p></li><li><p>main.js 全局引入</p><p><code>import Vue from 'vue'</code><br><code>import Vuex from 'vuex'</code><br><code>Vue.use(Vuex)</code></p></li></ol><p>​    3.创建store仓库<br>​            每一个 Vuex 应用的核心就是 store（仓库）。“store”基本上就是一个容器，它包含着你的应用中大部分的状态 (state)</p><p>​            <strong>Vuex 和单纯的全局对象有以下两点不同：</strong></p><p>​        1. Vuex 的状态存储是响应式的，当 Vue 组件从 store 中读取状态的时候，若 store 中的状态发生变化，那么相应的组件也会相应地得到高效更新。</p><p>​        2. 你不能直接改变 store 中的状态。改变 store 中的状态的唯一途径就是显式地提交 (commit) mutation</p><p><strong>最简单的 Store</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token comment">// 1.引入Vuex</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment">// 2.使用Vuex</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token comment">// 3.创建Vuex仓库</span><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment">// 4.共享的数据</span>    state<span class="token operator">:</span><span class="token punctuation">{</span>      user<span class="token operator">:</span><span class="token string">'admin'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  router<span class="token punctuation">,</span>  <span class="token comment">// 5.仓库放到（挂载）Vue实例上去</span>  store<span class="token punctuation">,</span>  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3、Vuex核心概念"><a href="#3、Vuex核心概念" class="headerlink" title="3、Vuex核心概念"></a>3、Vuex核心概念</h2><h3 id="State"><a href="#State" class="headerlink" title="State"></a>State</h3><h5 id="1-介绍："><a href="#1-介绍：" class="headerlink" title="1.介绍："></a>1.介绍：</h5><p>​        1. Vuex 使用单一状态树——是的，用一个对象就包含了全部的应用层级状态。</p><p>​        2.说明：state就是存储数据仓库 容器 </p><h5 id="2-获取state数据"><a href="#2-获取state数据" class="headerlink" title="2.获取state数据"></a>2.获取state数据</h5><h6 id="1、this-直接获取"><a href="#1、this-直接获取" class="headerlink" title="1、this 直接获取"></a>1、this 直接获取</h6><p>​        <strong><code>this.$store.state.xxx</code></strong></p><p>​        假如某个组件想获取刚才定义在Vuex中store仓库里state中的user数据，就可以通过this下的$store来找到</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是home<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>vuex<span class="token operator">-</span>直接获取state数据：<span class="token punctuation">{</span><span class="token punctuation">{</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//'admin'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="2、mapState-辅助函数获取"><a href="#2、mapState-辅助函数获取" class="headerlink" title="2、mapState 辅助函数获取"></a>2、mapState 辅助函数获取</h6><h6 id="了解三个使用方式："><a href="#了解三个使用方式：" class="headerlink" title="了解三个使用方式："></a>了解三个使用方式：</h6><p>三个辅助函数使用方法，不必掌握因为比较麻烦且不能复用计算属性</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是home<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>vuex<span class="token operator">-</span>直接获取state数据：<span class="token punctuation">{</span><span class="token punctuation">{</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>mapState辅助函数 箭头函数 写法获取state数据：<span class="token punctuation">{</span><span class="token punctuation">{</span> user1 <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>mapState辅助函数 字符串 写法获取state数据：<span class="token punctuation">{</span><span class="token punctuation">{</span> user2 <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>mapState辅助函数 普通函数方法 写法获取state数据：<span class="token punctuation">{</span><span class="token punctuation">{</span> user3 <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 1.导入辅助函数</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span><span class="token string">'你好'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 2.使用计算属性获取state方法---了解</span>  computed<span class="token operator">:</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      <span class="token comment">// 方式1、箭头函数写法（代码更简练）</span>      <span class="token function-variable function">user1</span><span class="token operator">:</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>      <span class="token comment">// 方式2、传字符串参数 'count' 等同于 `state =&gt; state.count`</span>      user2<span class="token operator">:</span><span class="token string">'user'</span><span class="token punctuation">,</span>      <span class="token comment">// 方式3、为了能够使用 `this` 获取局部状态，必须使用常规函数</span>      <span class="token function">user3</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> state<span class="token punctuation">.</span>user<span class="token operator">+</span><span class="token string">'----'</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="需要掌握的使用方式："><a href="#需要掌握的使用方式：" class="headerlink" title="需要掌握的使用方式："></a>需要掌握的使用方式：</h6><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是home<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>vuex<span class="token operator">-</span>直接获取state数据：<span class="token punctuation">{</span><span class="token punctuation">{</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token comment">// 4.直接使用</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>mapState辅助函数 字符串数组写法 获取state数据：<span class="token punctuation">{</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">--</span><span class="token punctuation">{</span><span class="token punctuation">{</span> count <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 1.导入辅助函数</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span><span class="token string">'你好'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 2.使用计算属性获取state方法---掌握</span>  computed<span class="token operator">:</span><span class="token punctuation">{</span>      <span class="token comment">//3.mapState 传一个字符串数组方法 ——名称要和vuex仓库里的数据名一致  因为是数据所以放在计算属性里 注意别和data里数据名重复</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">,</span><span class="token string">'count'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然直接把vuex放到main.js中不合适，可以单独在项目根下创建一个叫做store文件夹，里面创建一个index.js的文件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1. 引入Vue</span><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment">// 2.引入Vuex</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token comment">// 3.使用Vuex</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token comment">// 4.创建Vuex仓库</span><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment">// 5.共享的数据</span>    state<span class="token operator">:</span><span class="token punctuation">{</span>      user<span class="token operator">:</span><span class="token string">'admin'</span><span class="token punctuation">,</span>      count<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 6.导出</span><span class="token keyword">export</span> <span class="token keyword">default</span> store<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后再在main.js中导入引入store</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>   <span class="token comment">//路由挂载到vue实例</span>  router<span class="token punctuation">,</span>  <span class="token comment">// 仓库放到（挂载到）Vue实例</span>  store<span class="token punctuation">,</span>  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations"></a>Mutations</h3><h5 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h5><p>​    更改 Vuex 的 store 中的状态的唯一方法是提交 mutation<br>​     Vuex 中的 mutation 非常类似于事件：每个 mutation 都有一个字符串的 事件类型 (type) 和 一个 回调函数 (handler)。这个回调函数就是我们实际进行状态更改的地方，并且它会接受 state 作为第一个参数</p><h5 id="2-语法"><a href="#2-语法" class="headerlink" title="2.语法"></a>2.语法</h5><p>4-2 处定义一个mutations对象，里面包含想修改state数据的方法</p><p><strong>mutations里的方法有两个参数，比如</strong> addCount(state,payload)  –其中state是固定的state数据，payload是要携带的参数可以省略(参数可以是对象、字符串、数字)</p><p><strong>无参数版</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1. 引入Vue</span><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment">// 2.引入Vuex</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token comment">// 3.使用Vuex</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token comment">// 4.创建Vuex仓库</span><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment">// 4-1.共享的数据 说明：state状态 任意类型</span>    state<span class="token operator">:</span><span class="token punctuation">{</span>      user<span class="token operator">:</span><span class="token string">'admin'</span><span class="token punctuation">,</span>      count<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 4-2.修改state仓库数据 里面包含的是方法-修改state数据</span>    mutations<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            state<span class="token punctuation">.</span>count <span class="token operator">++</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">reduceCount</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            state<span class="token punctuation">.</span>count <span class="token operator">-=</span> <span class="token number">10</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 5.导出</span><span class="token keyword">export</span> <span class="token keyword">default</span> store<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>有参数版</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">mutations<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>num</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//增加了一个参数需要在使用的组件里添加具体参数</span>            state<span class="token punctuation">.</span>count <span class="token operator">+=</span> num         <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">reduceCount</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            state<span class="token punctuation">.</span>count <span class="token operator">-=</span> num        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>以下是其他组件需要使用muaations时携带参数的方法<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是home<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>mutations修改state数据<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"add"</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"reduce"</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// 使用commit()方法调用mutations里的方法去修改state数据 同时将参数10代入</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'addCount'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">//即当前每次点击增加10</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'reduceCount'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>            num<span class="token operator">:</span><span class="token number">8</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-操作方法："><a href="#3-操作方法：" class="headerlink" title="3.操作方法："></a>3.操作方法：</h5><h6 id="1、直接操作mutations"><a href="#1、直接操作mutations" class="headerlink" title="1、直接操作mutations"></a>1、直接操作mutations</h6><p>直接使用commit()方法调用mutations里的方法去修改state数据</p><p>在需要修改的组件里使用  this.$store.commit(state,payload)  –state是定义在mutations里的方法名，payload是参数需要看mutations里的方法是否可以省略</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是home<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>mutations修改state数据<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"add"</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"reduce"</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// 注意：不能直接修改 仓库不会同步视图</span>        <span class="token comment">// this.$store.state.count = 200</span>        <span class="token comment">// 使用commit()方法调用mutations里的方法去修改state数据</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'addCount'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'reduceCount'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="2、辅助函数操作"><a href="#2、辅助函数操作" class="headerlink" title="2、辅助函数操作"></a>2、辅助函数操作</h6><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是home<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>mutations修改state数据<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"add2"</span><span class="token operator">&gt;</span>辅助函数<span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"reduce2"</span><span class="token operator">&gt;</span>辅助函数<span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 1.引入辅助函数</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token comment">// 2.mapMutations 是方法所以放在methods里</span>    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'addCount'</span><span class="token punctuation">,</span><span class="token string">'reduceCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">add2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment">// 3.操作辅助函数</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addCount</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">reduce2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reduceCount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        num<span class="token operator">:</span><span class="token number">20</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="3、Mutation-必须是同步函数"><a href="#3、Mutation-必须是同步函数" class="headerlink" title="3、Mutation 必须是同步函数"></a>3、Mutation 必须是同步函数</h6><p>一条重要的原则就是要记住 mutation 必须是同步函数</p><h6 id="4、-Mutation-需遵守-Vue-的响应规则"><a href="#4、-Mutation-需遵守-Vue-的响应规则" class="headerlink" title="4、 Mutation 需遵守 Vue 的响应规则"></a>4、 Mutation 需遵守 Vue 的响应规则</h6><p> Vuex 中的 mutation 也需要与使用 Vue 一样遵守一些注意事项：<br>       1. 最好提前在你的 store 中初始化好所有所需属性。<br>    1. 当需要在对象上添加新属性时，你应该<br>        使用 Vue.set(obj, ‘newProp’, 123), 或者<br>        以新对象替换老对象。例如，利用对象展开运算符 (opens new window)我们可以这样写：<br>        state.obj = { …state.obj, newProp: 123 }</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">mutations<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            state<span class="token punctuation">.</span>count <span class="token operator">+=</span> num        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">reduceCount</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            state<span class="token punctuation">.</span>count <span class="token operator">-=</span> num        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment">// 修改已经存在的属性</span>        <span class="token function">changeUserinfo</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            state<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span>uname <span class="token operator">=</span> payload<span class="token punctuation">.</span>uname        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment">// 添加数据</span>        <span class="token function">addUserinfo</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// 直接增加属性 数据会修改 但是视图不同步</span>            <span class="token comment">// state.userinfo.love = payload.love;</span>                        <span class="token comment">// 解决方式：</span>            <span class="token comment">// 1.提前定义好属性</span>            <span class="token comment">// 2.Vue.set(obj,'属性','值')</span>            <span class="token comment">// 3.{...}</span>            <span class="token comment">// 4.Object.assign()</span>            Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>userinfo<span class="token punctuation">,</span><span class="token string">'love'</span><span class="token punctuation">,</span>payload<span class="token punctuation">.</span>love<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>组件中使用：</strong>  当添加一个没有存在的属性 state会添加成功但是页面不会显示，因为对象里的属性地址是没有改变的vue检测不到</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"about"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是about<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>获取userinfo数据<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>userinfo<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"addobj"</span><span class="token operator">&gt;</span>对象添加一个不存在的属性<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vuex"</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>  computed<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'userinfo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment">// 直接修改state数据</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'changeUserinfo'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>        uname<span class="token operator">:</span><span class="token string">'zimo'</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 当添加一个没有存在的属性 state会添加成功但是页面不会显示，因为对象里的属性地址是没有改变的vue检测不到</span>    <span class="token function">addobj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'addUserinfo'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>        love<span class="token operator">:</span><span class="token string">'擦擦擦'</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="5、-使用常量替代-Mutation-事件类型"><a href="#5、-使用常量替代-Mutation-事件类型" class="headerlink" title="5、 使用常量替代 Mutation 事件类型"></a>5、 使用常量替代 Mutation 事件类型</h6><p>使用常量替代 mutation中 事件类型（即方法的名称）在各种 Flux 实现中是很常见的模式。这样可以使 linter 之类的工具发挥作用，同时把这些常量放在单独的文件中可以让你的代码合作者对整个 app 包含的 mutation 一目了然：</p><p>首先在store下新建js文件，里边写一个对象暴露出去</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** 定义mutations事件类型：函数名称定义常量*/</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADDCOUNT</span> <span class="token operator">=</span> <span class="token string">'ADDCOUNT'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id=""><a href="#" class="headerlink" title=""></a></h6><p>在需要用到mutations的组件里这样使用</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是home<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>mutations修改state数据<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"add"</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"reduce"</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"add2"</span><span class="token operator">&gt;</span>辅助函数<span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"reduce2"</span><span class="token operator">&gt;</span>辅助函数<span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">// 辅助函数</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span>mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token comment">//1. 导入常量js</span><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ADDCOUNT</span><span class="token punctuation">,</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../store/mutation-types.js'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">,</span><span class="token string">'count'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token comment">// 2.辅助函数里也改成定义的常量名</span>    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">ADDCOUNT</span><span class="token punctuation">,</span><span class="token string">'reduceCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// 3.使用commit()方法调用mutations里的方法也要改为常量名</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token constant">ADDCOUNT</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'reduceCount'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>          num<span class="token operator">:</span><span class="token number">8</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">add2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">//4. 其他直接使用辅助函数＋的地方也改为常量名</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">ADDCOUNT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">reduce2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reduceCount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        num<span class="token operator">:</span><span class="token number">20</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="-1"><a href="#-1" class="headerlink" title=""></a></h6><h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><h5 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h5><p>​        Action 类似于 mutation，不同在于：</p><ul><li><p><strong>Action 提交的是 mutation，而不是直接变更状态。</strong></p></li><li><p><strong>Action 可以包含任意异步操作。</strong></p></li></ul><h5 id="2、例子"><a href="#2、例子" class="headerlink" title="2、例子"></a>2、例子</h5><p>注册一个简单的 action：</p><p>action 函数接受一个与 store 实例具有相同方法和属性的 context 对象，因此你可以调用 <code>context.commit</code> 提交一个 mutation，或者通过 <code>context.state</code> 和 <code>context.getters</code> 来获取 state 和 getters。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  state<span class="token operator">:</span> <span class="token punctuation">{</span>    count<span class="token operator">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      state<span class="token punctuation">.</span>count<span class="token operator">++</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  actions<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3、操作Action"><a href="#3、操作Action" class="headerlink" title="3、操作Action"></a>3、操作Action</h5><h6 id="1-直接获取actions"><a href="#1-直接获取actions" class="headerlink" title="1.直接获取actions"></a>1.直接获取actions</h6><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'actions里的函数名'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h6 id="2-辅助函数获取actions"><a href="#2-辅助函数获取actions" class="headerlink" title="2.辅助函数获取actions"></a>2.辅助函数获取actions</h6><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1.引入mapActions辅助函数</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token comment">// ...</span>    <span class="token comment">//2.在方法里面调用</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'increment'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">//3.使用辅助函数里的方法</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4、实际上手练习"><a href="#4、实际上手练习" class="headerlink" title="4、实际上手练习"></a>4、实际上手练习</h5><h6 id="1-定义actions对象"><a href="#1-定义actions对象" class="headerlink" title="1.定义actions对象"></a>1.定义actions对象</h6><p>首先在vuex文件下定义actions对象（4-3），准备一个异步函数，第一个参数context与 store 实例具有相同方法和属性，第二个参数是因为mutstions里减法函数需要一个对象参数num，使用context.commit()方法，第一个参数是mutations里的方法名称，第二个参数是接收上边传递的参数</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1. 引入Vue</span><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment">// 2.引入Vuex</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token comment">// 3.使用Vuex</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token comment">// 4.创建Vuex仓库</span><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment">// 4-1.共享的数据 说明：state状态 任意类型</span>    state<span class="token operator">:</span><span class="token punctuation">{</span>      count<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 4-2.修改state仓库数据 里面包含的是方法-修改state数据</span>    mutations<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token function">reduceCount</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            state<span class="token punctuation">.</span>count <span class="token operator">-=</span> num        <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 4-3. actions操作异步 执行mutations</span>    actions<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token comment">// 定义函数-异步</span>        <span class="token function">asyncReduceCount</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//模拟异步请求 5秒后操作上面的mutations里的减法函数 reduceCount</span>            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'reduceCount'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 5.导出</span><span class="token keyword">export</span> <span class="token keyword">default</span> store<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="2-在组件上使用"><a href="#2-在组件上使用" class="headerlink" title="2.在组件上使用"></a>2.在组件上使用</h6><p>1、组件里<strong>直接调用actions</strong></p><p>使用<code>this.$store.dispatch（'想要调用的actions里的方法名称',’需要传递的num值‘）</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"about"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是about<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>操作actions<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>vuex<span class="token operator">-</span>count<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"jian"</span><span class="token operator">&gt;</span>actions 直接调用<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>  methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token function">jian</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'asyncReduceCount'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>        num<span class="token operator">:</span><span class="token number">10</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2、组件里使用<strong>辅助函数方法调用actions</strong> </p><p>例子1</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"about"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是about<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>操作actions<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>vuex<span class="token operator">-</span>count<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"jian2"</span><span class="token operator">&gt;</span>actions 辅助函数调用<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token punctuation">{</span>mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vuex"</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>  methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'asyncReduceCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">jian</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">//直接调用actions</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'asyncReduceCount'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>        num<span class="token operator">:</span><span class="token number">10</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">jian2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment">// 辅助函数方法调用actions</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">asyncReduceCount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>num<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>例子2 </p><p>组件获取state里的用户名</p><p>安装一下axios</p><p><code>cnpm i axios  - S</code></p><p>然后在vuex文件下store仓库的代码如下</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    state<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token comment">//1.定义一个空的用户名</span>      user<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    mutations<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token comment">// 2.定义一个修改state的user函数</span>        <span class="token function">changeUser</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>uname</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            state<span class="token punctuation">.</span>user <span class="token operator">=</span> uname        <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    actions<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token comment">// 3.定义一个异步请求--用户名的函数</span>        <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://iwenwiki.com/api/blueberrypai/getIndexBanner.php'</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>banner<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 4.数据获取成功后，解析出来想要的数据格式 --再利用mutations来修改状态state</span>                <span class="token comment">// 5.操作-mutations可以使用contxet.commit('要操作的方法名','其他参数')来修改用户名</span>                context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'changeUser'</span><span class="token punctuation">,</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>banner<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在组件里的代码如下</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"about"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是about<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>用户名<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"getUser1"</span><span class="token operator">&gt;</span>获取用户名<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span>mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vuex"</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>  computed<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'userinfo'</span><span class="token punctuation">,</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'asyncReduceCount'</span><span class="token punctuation">,</span><span class="token string">'getUser'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">getUser1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h3><h5 id="1、介绍-1"><a href="#1、介绍-1" class="headerlink" title="1、介绍"></a>1、介绍</h5><p>​        Vuex 允许我们在 store 中定义“getter”（可以认为是 store 的计算属性）。就像计算属性一样，getter 的返回值会根据它的依赖被缓存起来，且只有当它的依赖值发生了改变才会被重新计算。对数据缓存和过滤处理。</p><h5 id="2、如何访问"><a href="#2、如何访问" class="headerlink" title="2、如何访问"></a>2、如何访问</h5><h6 id="1-直接获取getters"><a href="#1-直接获取getters" class="headerlink" title="1.直接获取getters"></a>1.直接获取getters</h6><p>​                this.$store.getters.属性        </p><h6 id="2-辅助函数访问"><a href="#2-辅助函数访问" class="headerlink" title="2.辅助函数访问"></a>2.辅助函数访问</h6><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>   <span class="token comment">// ...</span>   computed<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token comment">// 使用对象展开运算符将 getter 混入 computed 对象中</span>       <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token string">'doneTodosCount'</span><span class="token punctuation">,</span><span class="token string">'anotherGetter'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3、例子"><a href="#3、例子" class="headerlink" title="3、例子"></a>3、例子</h5><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    state<span class="token operator">:</span><span class="token punctuation">{</span>      user<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    mutations<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    actions<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    getters<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token function-variable function">userName</span><span class="token operator">:</span><span class="token parameter">state</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> state<span class="token punctuation">.</span>user <span class="token operator">+</span><span class="token string">'vip用户'</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其他组件使用</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"about"</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是about<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>getters使用<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>用户名<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>新的用户名直接读取：<span class="token punctuation">{</span><span class="token punctuation">{</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>新的用户名辅助函数读取：<span class="token punctuation">{</span><span class="token punctuation">{</span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>  <span class="token comment">//1. 导入辅助函数</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span>mapActions<span class="token punctuation">,</span>mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vuex"</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">// 2.计算属性中使用辅助函数</span>  computed<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'userinfo'</span><span class="token punctuation">,</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'userName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="-2"><a href="#-2" class="headerlink" title=""></a></h4><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="1、vuex仓库数据-state-getters"><a href="#1、vuex仓库数据-state-getters" class="headerlink" title="1、vuex仓库数据 state getters"></a>1、vuex仓库数据 state getters</h4><h5 id="1-state-获取："><a href="#1-state-获取：" class="headerlink" title="1.state 获取："></a>1.state 获取：</h5><p>​        1、直接获取</p><p>​        this.$store.state.xx</p><p>​        2、辅助函数获取</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//引入辅助函数...</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vuex"</span>computed<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-getters获取"><a href="#2-getters获取" class="headerlink" title="2.getters获取:"></a>2.getters获取:</h5><p>​        1、直接获取<br>​        this.$store.getters.xx</p><p>​        2、辅助函数获取</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//引入辅助函数...</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vuex"</span>computed<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2、操作修改state-–mutations-actions"><a href="#2、操作修改state-–mutations-actions" class="headerlink" title="2、操作修改state –mutations actions"></a>2、操作修改state –mutations actions</h4><h5 id="1-mutations操作"><a href="#1-mutations操作" class="headerlink" title="1.mutations操作"></a>1.mutations操作</h5><p>​        1、直接获取<br>​        this.$store.commit(‘函数名字’,’参数’)</p><p>​        2、辅助函数获取</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//引入辅助函数...</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vuex"</span>computed<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-actions操作"><a href="#2-actions操作" class="headerlink" title="2.actions操作"></a>2.actions操作</h5><p>​        1、直接获取<br>​        this.$store.dispatch(‘函数名字’,’参数’)</p><p>​        2、辅助函数获取</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//引入辅助函数...</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vuex"</span>computed<span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h3><h5 id="1、介绍："><a href="#1、介绍：" class="headerlink" title="1、介绍："></a>1、介绍：</h5><p>由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，store 对象就有可能变得相当臃肿。为了解决以上问题，Vuex 允许我们将 store 分割成模块（module）。每个模块拥有自己的 state、mutation、action、getter、甚至是嵌套子模块</p><p><strong>简单来说store还有一个modules属性对象里面可以单独存储入</strong>：用户信息、城市数据、购物车数据、搜索数据等等</p><h5 id="2、命名空间"><a href="#2、命名空间" class="headerlink" title="2、命名空间:"></a>2、命名空间:</h5><p>​        <strong>如果希望你的模块具有更高的封装度和复用性，你可以通过添加 namespaced: true 的方式使其成为带命名空间的模块。</strong></p><h5 id="3、modules的使用："><a href="#3、modules的使用：" class="headerlink" title="3、modules的使用："></a>3、modules的使用：</h5><p>4-5 处写一个modules对象，添加一个模块名称的属性对象，里面可以包含state，mutations，actions，getters</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1. 引入Vue</span><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment">// 2.引入Vuex</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ADDCOUNT</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./mutation-types.js'</span><span class="token comment">// 3.使用Vuex</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token comment">// 4.创建Vuex仓库</span><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment">// 4-1.共享的数据 说明：state状态 任意类型</span>    state<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 4-2.修改state仓库数据 里面包含的是方法-修改state数据</span>    mutations<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 4-3. actions操作异步 执行mutations</span>    actions<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 4-4. getters 处理state数据进行加工</span>    getters<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment">// 4-5. modules 模块 分类存储很多信息</span>    modules<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token comment">// 1、例：存城市数据</span>        cityModule<span class="token operator">:</span><span class="token punctuation">{</span>            <span class="token comment">// 开启了命名空间 让actions mutations getters的作用域是当前的模块下而不是挂载到全局</span>            namespaced<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>            state<span class="token operator">:</span><span class="token punctuation">{</span>                cityName<span class="token operator">:</span><span class="token string">'成都'</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            mutations<span class="token operator">:</span><span class="token punctuation">{</span>                <span class="token function">changeCity</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    state<span class="token punctuation">.</span>cityName <span class="token operator">=</span> payload                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            actions<span class="token operator">:</span><span class="token punctuation">{</span>                <span class="token comment">// 也可以写成这种格式 getCity({commit},city)</span>                <span class="token function">getCity</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span>city</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'changeCity'</span><span class="token punctuation">,</span>city<span class="token punctuation">)</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 5.导出</span><span class="token keyword">export</span> <span class="token keyword">default</span> store<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在需要用到的模块组件下使用：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>城市模块的使用<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>state<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>当前城市<span class="token operator">--</span>直接读取：<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>cityModule<span class="token punctuation">.</span>cityName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>当前城市<span class="token operator">--</span>辅助函数读取：<span class="token punctuation">{</span><span class="token punctuation">{</span>cityName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>mutations<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"getCity1"</span><span class="token operator">&gt;</span>修改城市城名<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"getCity2"</span><span class="token operator">&gt;</span>辅助函数修改城市城名<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>actions<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"updateCity1"</span><span class="token operator">&gt;</span>actions<span class="token operator">-</span>修改城市城名<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"updateCity2"</span><span class="token operator">&gt;</span>actions<span class="token operator">-</span>辅助函数修改城市城名<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>getters<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> getters这里不能直接打点调用下面的方法，而是用中括号加引号 <span class="token operator">--</span><span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>getters<span class="token operator">--</span>获取数据：cityVal<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">[</span><span class="token string">'cityModule/cityVal'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>getters<span class="token operator">--</span>辅助函数获取数据：cityVal<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>cityVal<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span>mapMutations<span class="token punctuation">,</span>mapActions<span class="token punctuation">,</span>mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    methods<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">'cityModule'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'changeCity'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token string">'cityModule'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'getCity'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">getCity1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// 1、直接获取模块下的mutations</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'cityModule/changeCity'</span><span class="token punctuation">,</span><span class="token string">'南京'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">getCity2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// 2、辅助函数获取模块下的mutations下的changeCity方法</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeCity</span><span class="token punctuation">(</span><span class="token string">'南京'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">updateCity1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">//1、直接使用actions模块下的getCity方法</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cityModule/getCity'</span><span class="token punctuation">,</span><span class="token string">'北京'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">updateCity2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// 2、辅助函数获取模块下的actions的getCity</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token string">'北京'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    computed<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token comment">// ...mapState('模块名称',['模块里的变量'])</span>        <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">'cityModule'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'cityName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">'cityModule'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'cityVal'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4、带命名空间的模块内访问全局内容"><a href="#4、带命名空间的模块内访问全局内容" class="headerlink" title="4、带命名空间的模块内访问全局内容"></a>4、带命名空间的模块内访问全局内容</h5><h6 id="1-在getter对象里的四个参数"><a href="#1-在getter对象里的四个参数" class="headerlink" title="1.在getter对象里的四个参数"></a>1.在getter对象里的四个参数</h6><p>如果你希望使用全局 state 和 getter，<code>rootState</code> 和 <code>rootGetters</code> 会作为第三和第四参数传入 getter，也会通过 <code>context</code> 对象的属性传入 action</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">    <span class="token comment">// 4-5. modules 模块 分类存储很多信息</span>modules<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token comment">// 1、例：存城市数据</span>        cityModule<span class="token operator">:</span><span class="token punctuation">{</span>            <span class="token comment">// 开启了命名空间 让actions mutations getters的作用域是当前的模块下而不是挂载到全局</span>            namespaced<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>            state<span class="token operator">:</span><span class="token punctuation">{</span>                cityName<span class="token operator">:</span><span class="token string">'成都'</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            getters<span class="token operator">:</span><span class="token punctuation">{</span>                <span class="token function-variable function">cityVal</span><span class="token operator">:</span><span class="token parameter">state</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> state<span class="token punctuation">.</span>cityName <span class="token operator">+</span> <span class="token string">'好去处'</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token comment">// getGlobalCity方法 --getter数据处理的时候，获取全局的getters state数据</span>                <span class="token function">getGlobalCity</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>getters<span class="token punctuation">,</span>rootState<span class="token punctuation">,</span>rootGetters</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token comment">// state 获取当前模块的状态-state </span>                    <span class="token comment">// getters 获取当前模块的所有的getterrs</span>                    <span class="token comment">// rootState 获取根上的state数据 可以获取其他模块的数据</span>                    <span class="token comment">// rootGetters 获取根上所有的getters 全局的和所有模块的getters</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span>getters<span class="token punctuation">,</span>rootState<span class="token punctuation">,</span>rootGetters<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            mutations<span class="token operator">:</span><span class="token punctuation">{</span>                <span class="token function">changeCity</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    state<span class="token punctuation">.</span>cityName <span class="token operator">=</span> payload                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            actions<span class="token operator">:</span><span class="token punctuation">{</span>                <span class="token comment">// 也可以写成这种格式 getCity({commit},city)</span>                <span class="token function">getCity</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span>city</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'changeCity'</span><span class="token punctuation">,</span>city<span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token comment">//  注意：局部模块的context对象可以访问全局对象 state getters mutations getters 包括其他模块 ！</span>                <span class="token function">getGlobalCityAction</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>组件中使用 如下，    // 同时局部模块的context对象可以访问全局对象 state getters mutations getters 包括其他模块</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>模块内访问全局的数据state getters<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"getGetters"</span> <span class="token operator">&gt;</span>访问getters<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"getGlobalCityAction1"</span> <span class="token operator">&gt;</span>访问局部模块的context对象<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span>mapMutations<span class="token punctuation">,</span>mapActions<span class="token punctuation">,</span>mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    methods<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">'cityModule'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'changeCity'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token string">'cityModule'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'getCity'</span><span class="token punctuation">,</span><span class="token string">'getGlobalCityAction'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">getGetters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// console.log(this.getGlobalCity);</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>getGlobalCity        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">getGlobalCityAction1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getGlobalCityAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    computed<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token comment">// ...mapState('模块名称',['模块里的变量'])</span>        <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">'cityModule'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'cityName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">'cityModule'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'cityVal'</span><span class="token punctuation">,</span><span class="token string">'getGlobalCity'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="2-root-true-第三参数"><a href="#2-root-true-第三参数" class="headerlink" title="2.{ root: true } 第三参数"></a>2.{ root: true } 第三参数</h6><p>需要在全局命名空间内分发  (<strong>触发</strong>) action 或提交 mutation，将 { root: true } 作为第三参数传给 dispatch 或 commit 即可</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">actions方法接收一个context对象，使用context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法能操作mutation，第一个参数是mutations里的方法名称，第二个参数是接收上边传递的参数<span class="token punctuation">,</span>所以当第三个参数是<span class="token punctuation">{</span> root<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> 的时候，将可以访问到全局下的mutation，同理dispatch下能访问到全局下的action里的xx方法<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li><p>解释：就是在命名的模块内想要访问全局的actions或者mutaitons里面的函数</p></li><li><p>语法：actions里面: context.commit(‘changeUser’,null,{root:true})</p><p>例如：在命名的模块下，如果对象想访问全局的actions 或者是全局的mutations 都是可以的</p></li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//  modules 模块 分类存储很多信息</span>modules<span class="token operator">:</span><span class="token punctuation">{</span>           mutations<span class="token operator">:</span><span class="token punctuation">{</span>                <span class="token function">changeCity</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    state<span class="token punctuation">.</span>cityName <span class="token operator">=</span> payload                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            actions<span class="token operator">:</span><span class="token punctuation">{</span>                <span class="token comment">// 局部模块的context对象可以访问全局对象 state getters mutations getters 包括其他模块</span>                <span class="token comment">// context对象里面包含了={dispatch:'',commit:'',state:'',getters:'',rootState:'',rootGetters:''}</span>                <span class="token function">getGlobalCityAction</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 如果对象想访问全局的actions 或者是全局的mutations 都是可以的 这里访问全局的mutations方法修改全局state数据</span>                    context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'changeUser'</span><span class="token punctuation">,</span><span class="token string">'局部修改全局的user'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>root<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="！！注意："><a href="#！！注意：" class="headerlink" title="！！注意："></a><strong>！！注意</strong>：</h3><h5 id="1、commit"><a href="#1、commit" class="headerlink" title="1、commit"></a>1、commit</h5><p>actions里的方法能够使用commit去调用mutations里的方法，</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">actions方法接收一个context对象，使用context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法能操作mutation，第一个参数是mutation里的方法名称，第二个参数是接收上边传递的参数<span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="2、dispatch"><a href="#2、dispatch" class="headerlink" title="2、dispatch"></a>2、dispatch</h5><p>能够使用dispatch调用action里面的方法</p><h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><h5 id="1、规则"><a href="#1、规则" class="headerlink" title="1、规则"></a>1、规则</h5><p>虽然vuex设计并不限制你的代码结构，但是，它规定了一些需要遵守的规则：</p><p>​        a: 应用层级的状态应该集中到单个 store 对象中。（所有的数据都要在 new Vuex.Store中）<br>​        b: 提交 mutation 是更改状态的唯一方法，并且这个过程是同步的。（想改state数据只能通过mutation的方法去修改）<br>​        c: 异步逻辑都应该封装到 action 里面。</p><p>只要你遵守以上规则，如何组织代码随你便。</p><h5 id="2、项目结构实例"><a href="#2、项目结构实例" class="headerlink" title="2、项目结构实例"></a>2、项目结构实例</h5><p>通过上方的学习后会发现vuex文件已经有一百多行代码，看起来较为麻烦。vuex设计了只需将 action、mutation 和 getter 分割到单独的文件。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">项目结构示例└── store  ├── index<span class="token punctuation">.</span>js          # 我们组装模块并导出 store 的地方  ├── actions<span class="token punctuation">.</span>js        # 根级别的 action  ├── mutations<span class="token punctuation">.</span>js      # 根级别的 mutation  └── modules      ├── cart<span class="token punctuation">.</span>js       # 购物车模块      └── products<span class="token punctuation">.</span>js   # 产品模块<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在store文件夹下新建state 、mutations 、actions 、getterrs 后辍为.js的文件，模块文件需要单独在store下新建modules文件夹放入各个 模块名.js,然后将原store里的代码移动过去，并暴露出来，重新将项目分割后如下:</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1. 引入Vue</span><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment">// 2.引入Vuex</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token comment">// 拆分后：引入state mutations actions getterrs 和命名空间模块cityModule、loginModule</span><span class="token keyword">import</span> state <span class="token keyword">from</span> <span class="token string">'./state'</span><span class="token keyword">import</span> mutations <span class="token keyword">from</span> <span class="token string">'./mutations'</span><span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">'./actions'</span><span class="token keyword">import</span> getters <span class="token keyword">from</span> <span class="token string">'./getters'</span><span class="token keyword">import</span> cityModule <span class="token keyword">from</span> <span class="token string">'./modules/cityModule'</span><span class="token keyword">import</span> loginModule <span class="token keyword">from</span> <span class="token string">'./modules/loginModule'</span><span class="token comment">// 3.使用Vuex</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token comment">// 4.创建Vuex仓库</span><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment">// 4-1.共享的数据 说明：state状态 任意类型</span>    state<span class="token operator">:</span>state<span class="token punctuation">,</span>    <span class="token comment">// 4-2.修改state仓库数据 里面包含的是方法-修改state数据</span>    mutations<span class="token operator">:</span>mutations<span class="token punctuation">,</span>    <span class="token comment">// 4-3. actions操作异步 执行mutations</span>    actions<span class="token operator">:</span>actions<span class="token punctuation">,</span>    <span class="token comment">// 4-4. getters 处理state数据进行加工</span>    getters<span class="token operator">:</span>getters<span class="token punctuation">,</span>    <span class="token comment">// 4-5. modules 模块 分类存储很多信息</span>    modules<span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token comment">// 1、例：存城市数据</span>        cityModule<span class="token operator">:</span>cityModule<span class="token punctuation">,</span>        <span class="token comment">// 2、例：存用户的数据</span>        loginModule<span class="token operator">:</span>loginModule<span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 5.导出</span><span class="token keyword">export</span> <span class="token keyword">default</span> store<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Vuex学习&quot;&gt;&lt;a href=&quot;#Vuex学习&quot; class=&quot;headerlink&quot; title=&quot;Vuex学习&quot;&gt;&lt;/a&gt;Vuex学习&lt;/h1&gt;&lt;h2 id=&quot;1、Vuex是什么？&quot;&gt;&lt;a href=&quot;#1、Vuex是什么？&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Vuex" scheme="https://wuzimo233.github.io/tags/Vuex/"/>
    
  </entry>
  
  <entry>
    <title>Uni-app学习</title>
    <link href="https://wuzimo233.github.io/posts/12.html"/>
    <id>https://wuzimo233.github.io/posts/12.html</id>
    <published>2022-05-04T15:17:00.000Z</published>
    <updated>2022-06-16T03:35:57.945Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h1><ul><li>有vue基础</li></ul><h1 id="什么是uni-app"><a href="#什么是uni-app" class="headerlink" title="什么是uni-app"></a>什么是uni-app</h1><ul><li>uni-app 是DCloud公司打造的一个使用 Vue.js 开发所有前端应用的框架，开发者编写一套代码，可发布到iOS、Android、Web（响应式）、以及各种小程序（微信/支付宝/百度/头条/飞书/QQ/快手/钉钉/淘宝）、快应用等多个平台。</li></ul><h2 id="HTML结构-简单了解"><a href="#HTML结构-简单了解" class="headerlink" title="HTML结构(简单了解)"></a>HTML结构(简单了解)</h2><ol><li>View容器–类似于div</li><li>text文本–包裹文本</li><li>swiper–轮播图</li><li>img–图片</li><li>video–视频</li><li>button–按钮</li></ol><h2 id="CSS样式"><a href="#CSS样式" class="headerlink" title="CSS样式"></a>CSS样式</h2><ol><li>属性<ul><li>字体</li><li>大小</li><li>布局：float</li></ul></li><li>选择器<br> class</li><li>取值与单位<ul><li>px</li><li>color</li><li>rpx 自动根据屏幕大小比例进行适配</li></ul></li><li>盒子模型<br> margin:外边距<br> padding:内边距<br> border:边框</li><li>弹性盒子模型<br> 更好的布局</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;前置条件&quot;&gt;&lt;a href=&quot;#前置条件&quot; class=&quot;headerlink&quot; title=&quot;前置条件&quot;&gt;&lt;/a&gt;前置条件&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;有vue基础&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;什么是uni-app&quot;&gt;&lt;a href=&quot;#什么是uni-a</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="uni-app" scheme="https://wuzimo233.github.io/tags/uni-app/"/>
    
  </entry>
  
  <entry>
    <title>Vue-图书管理案例</title>
    <link href="https://wuzimo233.github.io/posts/11.html"/>
    <id>https://wuzimo233.github.io/posts/11.html</id>
    <published>2022-04-26T04:00:00.000Z</published>
    <updated>2022-06-16T03:35:50.634Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h1><ul><li>安装Visual Studio Code（代码编辑器）</li><li>电脑已安装node.js</li><li>配置好vue相关文件</li></ul><h1 id="开始构建"><a href="#开始构建" class="headerlink" title="开始构建"></a>开始构建</h1><ul><li><p>电脑任意位置新建文件夹命名为”Vue-图书管理”</p></li><li><p>新建文件index.html 并创建基本html结构</p></li><li><p>因为是局部使用vue ，需要cdn方式引入Vue</p><pre class="line-numbers language-none"><code class="language-none">&lt;script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"&gt;&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>开始 new vue实例 并赋值为vm，在其内部构建</p><pre class="line-numbers language-none"><code class="language-none">&lt;script&gt;    const vm = new Vue({      el:'#app', //获取vue的边界element元素 即展示的区域      data:{      },      methods:{                      }    })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>将data里放入图书的数组数据</p><pre class="line-numbers language-none"><code class="language-none">data:{    books: [        {            id: 1,            name: "三国演义",            price: "12",        },        {            id: 2,            name: "水浒传",            price: "20",        },        {            id: 3,            name: "红楼梦",            price: "20512",        },        {            id: 4,            name: "西游记",            price: "212",        },    ],},<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>布局基本html样式</p><pre class="line-numbers language-none"><code class="language-none">&lt;h2&gt;图书管理&lt;/h2&gt;&lt;div id="app"&gt;    &lt;div &gt;        编号：&lt;input type="text" v-model="obj.id"&gt;        名称：&lt;input type="text" v-model="obj.name"&gt;         价格：&lt;input type="text" v-model="obj.price"&gt;        &lt;button type="submit" @click="submit"&gt;提交&lt;/button&gt;    &lt;/div&gt;    &lt;p&gt;图书总数: {{num}}&lt;/p&gt;    &lt;table border="1" cellspacing='0' width="300px"&gt;        &lt;tr&gt;            &lt;th&gt;编号&lt;/th&gt;            &lt;th&gt;名称&lt;/th&gt;            &lt;th&gt;价格&lt;/th&gt;            &lt;th&gt;操作&lt;/th&gt;        &lt;/tr&gt;        &lt;tr v-for="(item,index) in books" :key="item.id"&gt;            &lt;td&gt;{{item.id}}&lt;/td&gt;            &lt;td&gt;{{item.name}}&lt;/td&gt;            &lt;td&gt;{{item.price}}&lt;/td&gt;            &lt;td&gt;                &lt;a href=""&gt;编辑&lt;/a&gt; |                &lt;a href=""&gt;删除&lt;/a&gt;            &lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;&lt;/div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>增加添加图书功能</p><pre class="line-numbers language-none"><code class="language-none">&lt;script&gt;      const vm = new Vue({          el:'#app', //获取vue的边界element元素 即展示的区域          data:{              obj:{                  id:'',                  name:'',                  price:'',              },              newobj:'',              num:'',              books: [                  {                      id: 1,                      name: "三国演义",                      price: "12",                  },                  {                      id: 2,                      name: "水浒传",                      price: "20",                  },                  {                      id: 3,                      name: "红楼梦",                      price: "21",                  },                  {                      id: 4,                      name: "西游记",                      price: "22",                  },              ],          },          methods:{              submit(){                  // 1.获取用户输入的信息 并保存到data里的obj里                  this.newobj = this.o                      // 2. 追加数组 将obj对象推入data中 books里                  this.books.push(this.newob                      // 3. 清空输入框的信息                  this.obj = {                      id:'',                      name:'',                      price:'',                  }              },          }      })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>编辑图书功能</p><pre class="line-numbers language-none"><code class="language-none">&lt;body&gt;    &lt;h2&gt;图书管理&lt;/h2&gt;    &lt;div id="app"&gt;        &lt;div &gt;            编号：&lt;input type="text" v-model="obj.id" :disabled="isDisabled"&gt;            名称：&lt;input type="text" v-model="obj.name"&gt;             价格：&lt;input type="text" v-model="obj.price"&gt;            &lt;button type="submit" @click="submit" :disabled="noSubmit"&gt;提交&lt;/button&gt;        &lt;/div&gt;        &lt;p&gt;图书总数: {{num}}&lt;/p&gt;        &lt;table border="1" cellspacing='0' width="300px"&gt;            &lt;tr&gt;                &lt;th&gt;编号&lt;/th&gt;                 &lt;th&gt;名称&lt;/th&gt;                &lt;th&gt;价格&lt;/th&gt;                &lt;th&gt;操作&lt;/th&gt;            &lt;/tr&gt;            &lt;tr v-for="(item,index) in books" :key="item.id"&gt;                &lt;td&gt;{{item.id}}&lt;/td&gt;                &lt;td&gt;{{item.name}}&lt;/td&gt;                &lt;td&gt;{{item.price}}&lt;/td&gt;                &lt;td&gt;                    &lt;a href="##" @click.prevent="editor(index)"&gt;编辑&lt;/a&gt; |                    &lt;a href="##"&gt;删除&lt;/a&gt;                &lt;/td&gt;            &lt;/tr&gt;        &lt;/table&gt;    &lt;/div&gt;    &lt;script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"&gt;&lt;/script&gt;        &lt;script&gt;        Vue.config.productionTip= false;        const vm = new Vue({            el:'#app', //获取vue的边界element元素 即展示的区域            data:{                noSubmit:false, //禁止提交按钮的状态                isDisabled:false, //默认可以点击                indexData:'', //存储index标识                obj:{                    id:'',                    name:'',                    price:'',                },                newobj:'',                num:'2',                books: [                    {                        id: 1,                        name: "三国演义",                        price: "12",                    },                    {                        id: 2,                        name: "水浒传",                        price: "20",                    },                    {                        id: 3,                        name: "红楼梦",                        price: "21",                    },                    {                        id: 4,                        name: "西游记",                        price: "22",                    },                ],            },            methods:{                // 提交按钮                submit(){                    // 判断是否是提交新数据还是修改旧数据                    if(this.isDisabled) {                        //编辑功能:                        // 方法 1： 获取index 找操作的行元素 修改它                        // console.log('编辑');                        // console.log('编辑的当前行',this.books[this.indexData]);                        // this.books[this.indexData].name = this.obj.name                        // this.books[this.indexData].price = this.obj.price                                                // 方法 2： 找id  获取编辑的id == books里面的id                        // 使用方法 some 查找原数组里是否有某元素 如果有返回true                        // ele 可以获取books数组的每一项                        this.books.some( (ele) =&gt; {                           if( ele.id == this.obj.id){ //这个ele就是编辑的数据                            ele.name = this.obj.name                            ele.price = this.obj.price                            return true                           }                        })                        // 释放禁止按钮                        this.isDisabled = false;                    }else { //添加功能                        // 1.获取用户输入的信息 并保存到data里的obj里                        this.newobj = this.obj                            // 2. 追加数组 将obj对象推入data中 books里                        this.books.push(this.newobj)                        }                    // 3. 清空输入框的信息                    this.obj = {                        id:'',                        name:'',                        price:'',                    }                },                // 编辑按钮                editor(index){                    //1 获取当前行的数据  渲染到文本框中                    console.log(this.books[index]);                    // this.obj.id = this.books[index].id                    // this.obj.name = this.books[index].name                    // this.obj.price = this.books[index].price                    this.obj = this.books[index]                    // 2. 编辑的时候--编号禁止操作                    this.isDisabled = true;                    // 3. 存储index下标---目的：提交的时候 修改的是哪个数据用                    this.indexData = index;                }            },            //侦听器            watch:{               "obj.name":function(val){                    console.log('监听了数据变化',val);                    var flag = this.books.some(ele =&gt; {                        return ele.name == val                    })                    if(flag) {                        this.noSubmit = true                        alert('已经存在相同名称书籍')                    } else {                        this.noSubmit = false                    }                                       }            }        })    &lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;前置条件&quot;&gt;&lt;a href=&quot;#前置条件&quot; class=&quot;headerlink&quot; title=&quot;前置条件&quot;&gt;&lt;/a&gt;前置条件&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;安装Visual Studio Code（代码编辑器）&lt;/li&gt;
&lt;li&gt;电脑已安装node.js&lt;/li&gt;
&lt;</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="vue案例" scheme="https://wuzimo233.github.io/tags/vue%E6%A1%88%E4%BE%8B/"/>
    
  </entry>
  
  <entry>
    <title>Vue路由拦截</title>
    <link href="https://wuzimo233.github.io/posts/9.html"/>
    <id>https://wuzimo233.github.io/posts/9.html</id>
    <published>2022-04-20T17:28:00.000Z</published>
    <updated>2022-06-16T03:35:46.873Z</updated>
    
    <content type="html"><![CDATA[<h1 id="路由拦截案例："><a href="#路由拦截案例：" class="headerlink" title="路由拦截案例："></a>路由拦截案例：</h1><h2 id="从零开始创建一个新的项目"><a href="#从零开始创建一个新的项目" class="headerlink" title="从零开始创建一个新的项目"></a>从零开始创建一个新的项目</h2><h3 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h3><h4 id="安装Visual-Studio-Code"><a href="#安装Visual-Studio-Code" class="headerlink" title="安装Visual Studio Code"></a>安装Visual Studio Code</h4><ul><li>官网地址：(<a href="https://code.visualstudio.com/)%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85">https://code.visualstudio.com/)下载安装</a></li><li>Visual Studio Code(VS Code)是微软2015年推出的一个轻量但功能强大的源代码编辑器，基于 Electron 开发，支持 Windows、Linux 和 macOS 操作系统。内置了对JavaScript，TypeScript和Node.js的支持并且具有丰富的其它语言和扩展的支持，功能超级强大。</li><li>简单来说就是我们编写代码的必备工具</li></ul><h4 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h4><ul><li><p>Node 是一个让 JavaScript 运行在服务端的开发平台，它让 JavaScript 成为与PHP、Python、Perl、Ruby 等服务端语言平起平坐的脚本语言。发布于2009年5月，由Ryan Dahl开发，实质是对Chrome V8引擎进行了封装。</p></li><li><p>通俗点讲 Node.js是一个JavaScript编程语言的运行环境，在没有node.js之前，JavaScript代码几乎只能在浏览器中运行，通过浏览器解释执行。浏览器其实也是JavaScript的一个运行环境，JavaScript在浏览器中运行主要是面向客户端这方面的。后来node.js诞生了，JavaScript就可以在node.js中来运行了，JavaScript可以基于node.js环境做服务端开发。<strong>所以node.js也是JavaScript的服务端运行环境</strong>。</p></li><li><p>官方下载地址(<a href="https://nodejs.org/en/">https://nodejs.org/en/</a>) 或者中文网站(<a href="https://nodejs.org/zh-cn/download/">https://nodejs.org/zh-cn/download/</a>)</p></li><li><p>一般选LTS长期稳定版嘛 基本功能都差不多，点击下载并安装</p></li><li><p>安装时，安装路径可以自由更改，最后英文路径或者默认，其它点下一步</p></li><li><p>安装后，打开Win+R，输入cmd，窗口中输入：node -v 或 npm -v 查看版本号</p></li></ul><h4 id="安装vue脚手架（vue-cli）"><a href="#安装vue脚手架（vue-cli）" class="headerlink" title="安装vue脚手架（vue-cli）"></a>安装vue脚手架（vue-cli）</h4><p>官网地址：(<a href="https://cli.vuejs.org/zh/guide/installation.html">https://cli.vuejs.org/zh/guide/installation.html</a>)</p><ul><li>Window + R键打开运行界面，并输入cmd，点击确定。</li><li>输入命令：npm install -g @vue/cli  安装脚手架</li><li>或者 yarn global add @vue/cli 安装（前提先安装yarn 使用： npm i yarn -g）</li><li>vue –version 或 vue -V 查看当前版本号</li></ul><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><h4 id="配置下载地址"><a href="#配置下载地址" class="headerlink" title="配置下载地址"></a>配置下载地址</h4><blockquote><p>（如果出现Unexpected token .. in JSON at position …. 那么执行）</p></blockquote><ul><li>下载慢可以切换成淘宝的国内镜像：<br>npm config set registry <a href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org/</a> </li><li>查看是否切换成功<br>npm config get registry </li><li>强制清除npm缓存：<br>npm cache clean –force</li><li>再执行安装npm：<br>npm install -g npm</li></ul><h4 id="通过命令创建"><a href="#通过命令创建" class="headerlink" title="通过命令创建"></a>通过命令创建</h4><ul><li>任选一个文件夹位置创建，例如桌面的一个新建文件夹里</li><li>将新建文件夹拖入vscode里面 将鼠标移动到该文件夹上 右键终端打开</li><li>输入 vue create xxx  (xxx是项目的名称为小写英文)</li><li>后续就根据项目配置进行选择，上下箭头是移动，空格是确认选择，回车是执行。如果没有，直接回车</li></ul><h4 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h4><ul><li>进入项目目录！！！</li><li>npm run serve 运行或者 yarn serve</li></ul><h2 id="配置路由组件"><a href="#配置路由组件" class="headerlink" title="配置路由组件"></a>配置路由组件</h2><ul><li>配置路由组件 – login登录界面 layout-布局界面（首页-新闻-我的）</li><li>简单说就是 layout组件里包含首页、新闻、我的 等界面，而在login组件里包含登录，且login和layout是平级的关系</li></ul><ol><li>删除HomeView.vue里的默认信息改名为Home，添加 <h1>首页</h1> </li><li>AboutView.vue组件改名About，里面 h1信息This is an about page改为 我的</li><li>添加News.vue组件，添加h1新闻界面</li><li>在views下新建Login组件，添加h1登录界面</li><li>在views下新建Layout组件</li><li>配置路由router下的index.js</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;路由拦截案例：&quot;&gt;&lt;a href=&quot;#路由拦截案例：&quot; class=&quot;headerlink&quot; title=&quot;路由拦截案例：&quot;&gt;&lt;/a&gt;路由拦截案例：&lt;/h1&gt;&lt;h2 id=&quot;从零开始创建一个新的项目&quot;&gt;&lt;a href=&quot;#从零开始创建一个新的项目&quot; class=&quot;</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="vue案例" scheme="https://wuzimo233.github.io/tags/vue%E6%A1%88%E4%BE%8B/"/>
    
  </entry>
  
  <entry>
    <title>TEST</title>
    <link href="https://wuzimo233.github.io/posts/10.html"/>
    <id>https://wuzimo233.github.io/posts/10.html</id>
    <published>2022-04-20T08:15:00.000Z</published>
    <updated>2022-04-20T17:27:34.667Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用hexo发布文章遇到的问题"><a href="#使用hexo发布文章遇到的问题" class="headerlink" title="使用hexo发布文章遇到的问题"></a>使用hexo发布文章遇到的问题</h2><p>使用两个花括号报错</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;使用hexo发布文章遇到的问题&quot;&gt;&lt;a href=&quot;#使用hexo发布文章遇到的问题&quot; class=&quot;headerlink&quot; title=&quot;使用hexo发布文章遇到的问题&quot;&gt;&lt;/a&gt;使用hexo发布文章遇到的问题&lt;/h2&gt;&lt;p&gt;使用两个花括号报错&lt;/p&gt;
</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="JS" scheme="https://wuzimo233.github.io/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>JS进阶学习</title>
    <link href="https://wuzimo233.github.io/posts/8.html"/>
    <id>https://wuzimo233.github.io/posts/8.html</id>
    <published>2022-04-18T13:53:00.000Z</published>
    <updated>2022-06-16T03:35:43.223Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ES6高级"><a href="#ES6高级" class="headerlink" title="ES6高级"></a>ES6高级</h2><p><strong>待更新。。。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ES6高级&quot;&gt;&lt;a href=&quot;#ES6高级&quot; class=&quot;headerlink&quot; title=&quot;ES6高级&quot;&gt;&lt;/a&gt;ES6高级&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;待更新。。。&lt;/strong&gt;&lt;/p&gt;
</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="JS" scheme="https://wuzimo233.github.io/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>Vue进阶知识学习</title>
    <link href="https://wuzimo233.github.io/posts/6.html"/>
    <id>https://wuzimo233.github.io/posts/6.html</id>
    <published>2022-04-18T13:42:00.000Z</published>
    <updated>2022-06-16T03:35:35.680Z</updated>
    
    <content type="html"><![CDATA[<p>该页面假设你已经阅读过了组件基础。如果你还对组件不太了解，推荐你先阅读它。</p><h1 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h1><h2 id="局部组件"><a href="#局部组件" class="headerlink" title="局部组件"></a>局部组件</h2><ol><li>创建一个组件Mycomp.vue</li><li>在需要用到的地方引入：<pre class="line-numbers language-none"><code class="language-none">import Mycomp from './components/Mycomp.vue'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>注册组件<pre class="line-numbers language-none"><code class="language-none">export default { name: 'App', components: {     Mycomp }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>使用组件在 template <pre class="line-numbers language-none"><code class="language-none">&lt;Mycomp&gt;&lt;/Mycomp&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h2 id="组件组成"><a href="#组件组成" class="headerlink" title="组件组成"></a>组件组成</h2><ol><li>template 视图</li><li>script 逻辑</li><li>style  样式</li></ol><h2 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h2><ol><li><p>注册全局组件 在Vue对象身上有个Vue.component() 注册全局组件 在所有的组件中 不需要引入 可以直接使用</p></li><li><p>语法：<br>Vue.component(‘my-component-name’, {</p><pre><code>  // ... 选项 ...</code></pre><p>  })</p></li><li><p>代码演示</p><pre class="line-numbers language-none"><code class="language-none">// import Vue from 'vue'//运行时：vue.runtime.js import Vue from 'vue/dist/vue'/注册全局组件(放到main.js)// Vue.component('组件名称',{内容配置})Vue.component('my-comp',{    //视图 template :template作为属性使用 必须vue.js （完整版的vue.js）  默认引入-运行时-vue.runtime.js     template:'&lt;div&gt; &lt;h2&gt;我是一个全局组件&lt;/h2&gt; &lt;p&gt;{{ msg }}&lt;/p&gt;&lt;/div&gt;',    //数据    data(){        return {            msg:'hello vue全局组件'        }    },    //方法    methods:{    }})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="全局组件–可以挂载创建好的局部组件-注册全局"><a href="#全局组件–可以挂载创建好的局部组件-注册全局" class="headerlink" title="全局组件–可以挂载创建好的局部组件 注册全局"></a>全局组件–可以挂载创建好的局部组件 注册全局</h2><p>import MyBanner from ‘./components/MyBanner.vue’<br>// Vue.component(‘MyBanner’,MyBanner)<br>Vue.component(MyBanner.name,MyBanner)</p></li></ol><h1 id="组件中的data为什么是函数"><a href="#组件中的data为什么是函数" class="headerlink" title="组件中的data为什么是函数"></a>组件中的data为什么是函数</h1><p>答案<br>避免组件中的数据互相影响。同一个组件被复用多次会创建多个实例，如果 data 是一个对象的话，这些实例用的是同一个构造函数。为了保证组件的数据独立，要求每个组件都必须通过 data 函数返回一个对象作为组件的状态。</p><h1 id="computed和watch的区别"><a href="#computed和watch的区别" class="headerlink" title="computed和watch的区别"></a>computed和watch的区别</h1><h1 id="action-与-mutation-的区别"><a href="#action-与-mutation-的区别" class="headerlink" title="action 与 mutation 的区别"></a>action 与 mutation 的区别</h1><ul><li>mutation 是同步更新， $watch 严格模式下会报错</li><li>action 是异步操作，可以获取数据后调用 mutation 提交最终数据</li></ul><h1 id="Vue-组件通讯有哪几种方式"><a href="#Vue-组件通讯有哪几种方式" class="headerlink" title="Vue 组件通讯有哪几种方式"></a>Vue 组件通讯有哪几种方式</h1><p><strong>父传子</strong><br>通过props传递<br>父亲提供数据通过属性 props传给儿子；儿子通过 $on 绑父亲的事件，再通过 $emit 触发自己的事件（发布订阅）<br>利用父子关系 $parent 、 $children </p><p><strong>子传父</strong><br>在父组件中给子组件绑定一个自定义的事件，子组件通过$emit()触发该事件并传值。<br>父组件： &lt;child @receive = ‘receive’ /&gt;<br>子组件: this.$emit(‘receive’,’传递的数据’)</p><p><strong>兄弟组件传值</strong><br>通过中央通信 let bus = new Vue()<br>prop 验证，和默认值</p><h1 id="v-for-为什么要加-key"><a href="#v-for-为什么要加-key" class="headerlink" title="v-for 为什么要加 key"></a>v-for 为什么要加 key</h1><h1 id="v-model-原理"><a href="#v-model-原理" class="headerlink" title="v-model 原理"></a>v-model 原理</h1><h1 id="怎样理解-Vue-的单向数据流"><a href="#怎样理解-Vue-的单向数据流" class="headerlink" title="怎样理解 Vue 的单向数据流"></a>怎样理解 Vue 的单向数据流</h1><h1 id="Vue2-x响应式数据-双向绑定原理"><a href="#Vue2-x响应式数据-双向绑定原理" class="headerlink" title="Vue2.x响应式数据/双向绑定原理"></a>Vue2.x响应式数据/双向绑定原理</h1><p>整体思路是数据劫持+观察者模式<br>Vue 数据双向绑定主要是指：数据变化更新视图，视图变化更新数据。其中，View变化更新Data，可以通过事件监听的方式来实现，所以 Vue数据双向绑定的工作主要是如何根据Data变化更新View。</p><h1 id="虚拟-DOM-是什么-有什么优缺点"><a href="#虚拟-DOM-是什么-有什么优缺点" class="headerlink" title="虚拟 DOM 是什么 有什么优缺点"></a>虚拟 DOM 是什么 有什么优缺点</h1><hr><h1 id="谈一下对-vuex-的个人理解"><a href="#谈一下对-vuex-的个人理解" class="headerlink" title="谈一下对 vuex 的个人理解"></a>谈一下对 vuex 的个人理解</h1><h1 id="vuex是什么"><a href="#vuex是什么" class="headerlink" title="vuex是什么"></a>vuex是什么</h1><p>Vuex 是一个专为 Vue.js应用程序开发的状态管理模式。它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。Vuex 也集成到 Vue 的官方调试工具 devtools extension，提供了诸如零配置的 time-travel 调试、状态快照导入导出等高级调试功能。</p><h1 id="怎么使用vuex"><a href="#怎么使用vuex" class="headerlink" title="怎么使用vuex"></a>怎么使用vuex</h1><h1 id="vuex中有几个核心属性，分别是什么？"><a href="#vuex中有几个核心属性，分别是什么？" class="headerlink" title="vuex中有几个核心属性，分别是什么？"></a>vuex中有几个核心属性，分别是什么？</h1><ol><li>一共有5个核心属性，分别是:</li></ol><ul><li>state 唯一数据源,Vue 实例中的 data 遵循相同的规则</li><li>getters 可以认为是 store 的计算属性,就像计算属性一样，getter 的返回值会根据它的依赖被缓存起来，且只有当它的依赖值发生了改变才会被重新计算。Getter 会暴露为 store.getters 对象，你可以以属性的形式访问这些值.</li><li>mutation 更改 Vuex 的 store 中的状态的唯一方法是提交 mutation,非常类似于事件,通过store.commit 方法触发</li><li>action Action 类似于 mutation，不同在于Action 提交的是 mutation，而不是直接变更状态，Action 可以包含任意异步操作</li><li>module 由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，store 对象就有可能变得相当臃肿。为了解决以上问题，Vuex 允许我们将 store 分割成模块（module）。</li></ul><hr><h1 id="路由页面管理（vue-router）"><a href="#路由页面管理（vue-router）" class="headerlink" title="路由页面管理（vue-router）"></a>路由页面管理（vue-router）</h1><h1 id="什么是vue-router"><a href="#什么是vue-router" class="headerlink" title="什么是vue-router"></a>什么是vue-router</h1><h1 id="怎么使用vue-router"><a href="#怎么使用vue-router" class="headerlink" title="怎么使用vue-router"></a>怎么使用vue-router</h1><h1 id="怎么定义vue-router的动态路由？怎么获取传过来的动态参数？"><a href="#怎么定义vue-router的动态路由？怎么获取传过来的动态参数？" class="headerlink" title="怎么定义vue-router的动态路由？怎么获取传过来的动态参数？"></a>怎么定义vue-router的动态路由？怎么获取传过来的动态参数？</h1><h1 id="vue-router-路由钩子函数是什么-执行顺序是什么"><a href="#vue-router-路由钩子函数是什么-执行顺序是什么" class="headerlink" title="vue-router 路由钩子函数是什么 执行顺序是什么"></a>vue-router 路由钩子函数是什么 执行顺序是什么</h1><h1 id="路由拦截方法"><a href="#路由拦截方法" class="headerlink" title="路由拦截方法"></a>路由拦截方法</h1><p><strong>待更新。。。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;该页面假设你已经阅读过了组件基础。如果你还对组件不太了解，推荐你先阅读它。&lt;/p&gt;
&lt;h1 id=&quot;注册&quot;&gt;&lt;a href=&quot;#注册&quot; class=&quot;headerlink&quot; title=&quot;注册&quot;&gt;&lt;/a&gt;注册&lt;/h1&gt;&lt;h2 id=&quot;局部组件&quot;&gt;&lt;a href=&quot;#局部组件</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="vue" scheme="https://wuzimo233.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>JS基础知识</title>
    <link href="https://wuzimo233.github.io/posts/7.html"/>
    <id>https://wuzimo233.github.io/posts/7.html</id>
    <published>2022-04-17T17:00:00.000Z</published>
    <updated>2022-06-16T03:35:39.267Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JavaScript基础知识点"><a href="#JavaScript基础知识点" class="headerlink" title="JavaScript基础知识点"></a>JavaScript基础知识点</h1><h2 id="了解-JavaScript"><a href="#了解-JavaScript" class="headerlink" title="了解 JavaScript"></a>了解 JavaScript</h2><h3 id="JavaScript是什么"><a href="#JavaScript是什么" class="headerlink" title="JavaScript是什么"></a>JavaScript是什么</h3><ul><li>JavaScript是一种运行在客户端（浏览器）高级的、解释型的编程语言的，实现人机交互效果</li><li>由ECMA（欧洲电脑制造商协会）通过ECMAScript实现语言的标准化。被世界上的绝大多数网站所使用，也被世界主流浏览器（Chrome、IE、Firefox、Safari、Opera）支持</li><li>JavaScript乍一听与Java在名字上相似，但其实是雷锋与雷锋塔、老婆和老婆饼的关系hhh</li><li>一般简称JS，以下都以JS称呼</li></ul><h3 id="JS的作用（做什么）"><a href="#JS的作用（做什么）" class="headerlink" title="JS的作用（做什么）"></a>JS的作用（做什么）</h3><ul><li>网页特效 （监听用户的一些行为让网页做出对应的反馈） </li><li>表单验证 （针对表单数据的合法性进行判断）</li><li>数据交互 （获取后台的数据，渲染到前端页面）</li><li>服务端编程（node.js） </li></ul><h3 id="JS的组成（有什么）"><a href="#JS的组成（有什么）" class="headerlink" title="JS的组成（有什么）"></a>JS的组成（有什么）</h3><p>JS 是由ECMAScript和WebApi 组成。WebApi又由DOM（页面文档对象模型）和BOM（浏览器对象模型）构成</p><ul><li>ECMAScript是由网景的布兰登·艾克开发的一种脚本语言的标准化规范；最初命名为Mocha，后来改名为LiveScript，最后重命名为JavaScript[1]。</li><li>DOM 操作文档，比如对页面元素进行移动、大小、添加删除等操作</li><li>Bom 操作浏览器，比如页面弹窗，检测窗口宽度，存储数据到浏览器等</li></ul><h3 id="JS的位置"><a href="#JS的位置" class="headerlink" title="JS的位置"></a>JS的位置</h3><h4 id="内部引入"><a href="#内部引入" class="headerlink" title="内部引入"></a>内部引入</h4><ul><li>直接在HTML文件中引入（一般在标签的底部使用）<pre class="line-numbers language-none"><code class="language-none">&lt;script&gt;    alert('我是内部引入的JS')&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="外部引入"><a href="#外部引入" class="headerlink" title="外部引入"></a>外部引入</h4><ul><li>是指将JS文件外置在HTML文件的外部，在head标签内引入相对路径中的JS文件</li><li>使代码更加有序，易于复用，且没有了脚本的混合，HTML也会更加易读<pre class="line-numbers language-none"><code class="language-none">&lt;head&gt;    &lt;script src="./my.js"&gt;&lt;/script&gt;&lt;/head&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="内联使用"><a href="#内联使用" class="headerlink" title="内联使用"></a>内联使用</h4><ul><li>在标签内部使用<pre class="line-numbers language-none"><code class="language-none">&lt;button onclick="alert('我是内联JS')"&gt;我是按钮&lt;/button&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="JS注释"><a href="#JS注释" class="headerlink" title="JS注释"></a>JS注释</h3><ul><li>单行注释 // xxx</li><li>多行注释 /* xxx */</li></ul><h3 id="字面量"><a href="#字面量" class="headerlink" title="字面量"></a>字面量</h3><ul><li>了解什么是字面量前，先知道什么是语法？<blockquote><p>是人和计算机打交道的规则—我们按照这个规则去敲代码</p></blockquote></li><li>比如输入语法：<pre class="line-numbers language-none"><code class="language-none">document.write('输出的文字-文字展示到页面')document.write('&lt;h1&gt;我是嵌套的h1标签&lt;/h1&gt;')alert('要输出的内容-弹框形式展示到页面')console.log('控制台打印的内容')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>在计算机科学中，字面量（literal）是在计算机中描述 事/物<br>比如:</li><li>初级前端开发薪水是：8k 此时8k就是数字字面量</li><li>‘hello world’ ：这是字符串字面量</li><li>还有其他数组字面量、对象字面量</li></ul><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="变量是什么？"><a href="#变量是什么？" class="headerlink" title="变量是什么？"></a>变量是什么？</h3><ul><li>通俗来讲：变量是计算机存储数据的“容器”</li><li>白话：变量就是一个装东西的盒子</li><li>变量不是数据本身，它们仅仅是一个用于存储数值的容器，可以理解为是一个个用来装东西的盒子~<br>例如：用户在网页输入自己姓名或者电话等信息时候，就是通过变量存储。</li></ul><h3 id="变量的声明方式"><a href="#变量的声明方式" class="headerlink" title="变量的声明方式"></a>变量的声明方式</h3><p>在JS中<strong>创建变量被称为声明变量</strong>，JS中变量声明又分为显示声明和隐式声明。其中显示声明中，声明关键字有var、let、const、function、class、import </p><ul><li><strong>let 变量名</strong></li><li>语法：声明关键字 + 变量名</li><li>let 即关键字（let：允许、让、要），所谓关键字是系统提供的专门用来声明（定义）变量的词语</li><li>注意let不能多次声明一个变量名 </li><li>可以一次声明多个变量 let age=18,name=’zimo’;<pre class="line-numbers language-none"><code class="language-none">// 声明关键字 + 变量名let age;age = 18;   // 变量声明后一般会赋值 也可以连写let age = 18;age = 19;   // 变量可以更新值  document.write(age);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><ol><li>案例：用户输入姓名后，页面显示刚才用户输入的姓名<pre class="line-numbers language-none"><code class="language-none">&lt;script&gt;   let name = (prompt('请输入您的姓名'))   document.write(name)&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>案例：交换变量的值<br>需求：2个不同变量的变量去交换其值。<pre class="line-numbers language-none"><code class="language-none">&lt;script&gt;    let num1 = 10    let num2 = 20    let num3 = ''    num3 = num1    num1 = num2    num2 = num3    console.log(num1,num2);&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="变量本质"><a href="#变量本质" class="headerlink" title="变量本质"></a>变量本质</h3><p>先了解一下内存：是计算机存储数据的地方，相当于一个空间<br>变量：是程序在内存中申请的一块用来存放数据的小空间</p><h3 id="变量的命名规则与规范"><a href="#变量的命名规则与规范" class="headerlink" title="变量的命名规则与规范"></a>变量的命名规则与规范</h3><ul><li>不能用关键字<br>比如：let var if for等</li><li>只能使用下划线、字母、数字、$组成，且数字不能开头</li><li>字母严格区分大小写</li><li>起名要有意义</li><li>遵守小驼峰命名法 （第一个单词首字母小写，后面每个单词首字母大写，如：UserName）</li></ul><h3 id="拓展-let-与-var-区别"><a href="#拓展-let-与-var-区别" class="headerlink" title="拓展 let 与 var 区别"></a>拓展 let 与 var 区别</h3><ul><li>let为了解决var的一些问题</li><li>var可以先使用 在声明（不合理）</li><li>var声明过的变量可以重复声明（不合理）</li><li>比如变量提升、全局变量、没有块级作用域等等</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;JavaScript基础知识点&quot;&gt;&lt;a href=&quot;#JavaScript基础知识点&quot; class=&quot;headerlink&quot; title=&quot;JavaScript基础知识点&quot;&gt;&lt;/a&gt;JavaScript基础知识点&lt;/h1&gt;&lt;h2 id=&quot;了解-JavaScript</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="JS" scheme="https://wuzimo233.github.io/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>Vue基础知识学习</title>
    <link href="https://wuzimo233.github.io/posts/5.html"/>
    <id>https://wuzimo233.github.io/posts/5.html</id>
    <published>2022-04-17T11:47:00.000Z</published>
    <updated>2022-06-16T03:35:29.705Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Vue的安装"><a href="#Vue的安装" class="headerlink" title="Vue的安装"></a>Vue的安装</h2><h3 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h3><h4 id="安装Visual-Studio-Code"><a href="#安装Visual-Studio-Code" class="headerlink" title="安装Visual Studio Code"></a>安装Visual Studio Code</h4><ul><li>官网地址：(<a href="https://code.visualstudio.com/)%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85">https://code.visualstudio.com/)下载安装</a></li><li>Visual Studio Code(VS Code)是微软2015年推出的一个轻量但功能强大的源代码编辑器，基于 Electron 开发，支持 Windows、Linux 和 macOS 操作系统。内置了对JavaScript，TypeScript和Node.js的支持并且具有丰富的其它语言和扩展的支持，功能超级强大。</li><li>简单来说就是我们编写代码的必备工具</li></ul><h4 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h4><ul><li><p>Node 是一个让 JavaScript 运行在服务端的开发平台，它让 JavaScript 成为与PHP、Python、Perl、Ruby 等服务端语言平起平坐的脚本语言。发布于2009年5月，由Ryan Dahl开发，实质是对Chrome V8引擎进行了封装。</p></li><li><p>通俗点讲 Node.js是一个JavaScript编程语言的运行环境，在没有node.js之前，JavaScript代码几乎只能在浏览器中运行，通过浏览器解释执行。浏览器其实也是JavaScript的一个运行环境，JavaScript在浏览器中运行主要是面向客户端这方面的。后来node.js诞生了，JavaScript就可以在node.js中来运行了，JavaScript可以基于node.js环境做服务端开发。<strong>所以node.js也是JavaScript的服务端运行环境</strong>。</p></li><li><p>官方下载地址(<a href="https://nodejs.org/en/">https://nodejs.org/en/</a>) 或者中文网站(<a href="https://nodejs.org/zh-cn/download/">https://nodejs.org/zh-cn/download/</a>)</p></li><li><p>一般选LTS长期稳定版嘛 基本功能都差不多，点击下载并安装</p></li><li><p>安装时，安装路径可以自由更改，最后英文路径或者默认，其它点下一步</p></li><li><p>安装后，打开Win+R，输入cmd，窗口中输入：node -v 或 npm -v 查看版本号</p></li></ul><h4 id="安装vue脚手架（vue-cli）"><a href="#安装vue脚手架（vue-cli）" class="headerlink" title="安装vue脚手架（vue-cli）"></a>安装vue脚手架（vue-cli）</h4><p>官网地址：(<a href="https://cli.vuejs.org/zh/guide/installation.html">https://cli.vuejs.org/zh/guide/installation.html</a>)</p><ul><li>Window + R键打开运行界面，并输入cmd，点击确定。</li><li>输入命令：npm install -g @vue/cli  安装脚手架</li><li>或者 yarn global add @vue/cli 安装（前提先安装yarn 使用： npm i yarn -g）</li><li>vue –version 或 vue -V 查看当前版本号</li></ul><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><h4 id="配置下载地址"><a href="#配置下载地址" class="headerlink" title="配置下载地址"></a>配置下载地址</h4><blockquote><p>（如果出现Unexpected token .. in JSON at position …. 那么执行）</p></blockquote><ul><li>下载慢可以切换成淘宝的国内镜像：<br>npm config set registry <a href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org/</a> </li><li>查看是否切换成功<br>npm config get registry </li><li>强制清除npm缓存：<br>npm cache clean –force</li><li>再执行安装npm：<br>npm install -g npm</li></ul><h4 id="通过命令创建"><a href="#通过命令创建" class="headerlink" title="通过命令创建"></a>通过命令创建</h4><ul><li>任选一个文件夹位置创建，例如桌面的一个新建文件夹里</li><li>将新建文件夹拖入vscode里面 将鼠标移动到该文件夹上 右键终端打开</li><li>输入 vue create xxx  (xxx是项目的名称为小写英文)</li><li>后续就根据项目配置进行选择，上下箭头是移动，空格是确认选择，回车是执行。如果没有，直接回车</li></ul><h4 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h4><ul><li>进入项目目录！！！</li><li>npm run serve 运行或者 yarn serve</li></ul><h2 id="Vue介绍"><a href="#Vue介绍" class="headerlink" title="Vue介绍"></a>Vue介绍</h2><ol><li>Vue是渐进式（渐进式：项目中可以逐步使用vue框架 可以使用一部分 或者是整个项目） JavaScript 框架</li><li>框架为单页面的应用程序 （Vue项目入口：只有一个页面 index.html ）</li><li>跳转的页面路由功能-  路由 （其他页面组件）</li><li>框架里面使用的是虚拟DOM 没有js BOM DOM </li></ol><p>特点： MVVM 模式；代码简洁体积小，运行效率高，适合移动PC端开发；本身只关注 UI （和 react 相似），可以轻松引入 Vue 插件或其他的第三方库进行开发。</p><h2 id="Vue的优缺点"><a href="#Vue的优缺点" class="headerlink" title="Vue的优缺点"></a>Vue的优缺点</h2><p><strong>优点：</strong></p><blockquote><p><strong>轻量级框架</strong>：只关注视图层，是一个构建数据的视图集合，大小只有几十kb；简单易学：国人开发，中文文档，不存在语言障碍 ，易于理解和学习；<br><strong>双向数据绑定</strong>：保留了angular的特点，在数据操作方面更为简单；<br><strong>组件化</strong>：保留了react的优点，实现了html的封装和重用，在构建单页面应用方面有着独特的优势；<br><strong>视图，数据，结构分离</strong>：使数据的更改更为简单，不需要进行逻辑代码的修改，只需要操作数据就能完成相关操作；<br><strong>虚拟DOM</strong>：dom操作是非常耗费性能的，不再使用原生的dom操作节点，极大解放dom操作，但具体操作的还是dom不过是换了另一种方式；<br><strong>运行速度更快</strong>:相比较与react而言，同样是操作虚拟dom，就性能而言，vue存在很大的优势。<br><strong>缺点：</strong></p></blockquote><ol><li>单页面应用程序，首页加载速度慢  </li><li>不利于搜索引擎优化  </li></ol><h2 id="Vue的使用"><a href="#Vue的使用" class="headerlink" title="Vue的使用"></a>Vue的使用</h2><h3 id="局部使用Vue"><a href="#局部使用Vue" class="headerlink" title="局部使用Vue"></a>局部使用Vue</h3><ol><li>引入 Vue 的cnd网址 或者是下载到本地js文件  （类似：jquery.js）</li><li>创建vue实例  </li><li>代码演示<pre class="line-numbers language-none"><code class="language-none">&lt;head&gt;    //引入js文件夹里的vue    &lt;script src="./JS/vue.js"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;    &lt;!-- 使用vue --&gt;    &lt;div id="app"&gt;        &lt;p&gt;这是vue的区域了 app--&lt;/p&gt;        &lt;p&gt;获取vue的信息：{{msg}}&lt;/p&gt;    &lt;/div&gt;    &lt;!-- 创建vue实例 --&gt;    &lt;script&gt;        const vm = new Vue({            el:'#app',//获取element元素            data:{                msg:'hello vue',            }        })    &lt;/script&gt;&lt;/body&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="搭建vue项目"><a href="#搭建vue项目" class="headerlink" title="搭建vue项目"></a>搭建vue项目</h3><p><strong>1.兼容性</strong><br>Vue 不支持 IE8 及以下版本，因为 Vue 使用了 IE8 无法模拟的 ECMAScript 5 特性。但它支持所有兼容 ECMAScript 5 的浏览器。</p><p><strong>2.安装nodejs</strong></p><ul><li>Node 是一个让 JavaScript 运行在服务端的开发平台，它让 JavaScript 成为与PHP、Python、Perl、Ruby 等服务端语言平起平坐的脚本语言。发布于2009年5月，由Ryan Dahl开发，实质是对Chrome V8引擎进行了封装。</li><li>通俗点讲 Node.js是一个JavaScript编程语言的运行环境，在没有node.js之前，JavaScript代码几乎只能在浏览器中运行，通过浏览器解释执行。浏览器其实也是JavaScript的一个运行环境，JavaScript在浏览器中运行主要是面向客户端这方面的。后来node.js诞生了，JavaScript就可以在node.js中来运行了，JavaScript可以基于node.js环境做服务端开发。<strong>所以node.js也是JavaScript的服务端运行环境</strong>。</li><li>官方下载地址(<a href="https://nodejs.org/en/">https://nodejs.org/en/</a>) 或者中文网站(<a href="https://nodejs.org/zh-cn/download/">https://nodejs.org/zh-cn/download/</a>)</li><li>一般选LTS长期稳定版嘛 基本功能都差不多，点击下载并安装</li><li>安装时，安装路径可以自由更改，最后英文路径或者默认，其它点下一步</li><li>安装后，打开Win+R，输入cmd，窗口中输入：node -v 或 npm -v 查看版本号</li></ul><p><strong>3.安装vue 命令行工具 (CLI)</strong></p><ul><li>介绍：Vue 提供了一个官方的 CLI，为单页面应用 (SPA) 快速搭建繁杂的脚手架。CLI是一个全局安装的 npm 包，提供了终端里的 vue 命令。它可以通过 vue create 快速搭建一个新项。</li><li>网址：<a href="https://cli.vuejs.org/zh/">https://cli.vuejs.org/zh/</a></li><li>版本：Vue CLI 4.x 需要 Node.js v8.9 或更高版本 (推荐 v10 以上)</li><li>先安装yarn:  npm i yarn -g (推荐)</li><li>安装vue-cli：<br> npm install -g @vue/cli   （下载模块：npm  install 模块 ）<br>   或者<br> yarn global add @vue/cli   （下载模块：yarn add  模块 ）</li><li>检查其版本是否正确<br>vue –version</li></ul><p><strong>4.创建一个vue项目–通过脚手架vue-cli</strong> </p><ol><li>创建vue项目： vue create vue-project<br>说明：vue项目名称最好是英文 不能包含驼峰命名法</li><li>按需项目需要的依赖配置</li><li>进入项目<br>cd 项目名称</li><li>启动项目<br>npm run serve<br>或者<br>yarn serve </li><li>打包项目<br>npm run build </li></ol><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><blockquote><p>node_moudles   安装包依赖 –模块<br>public         单页面入口 - index.html<br>src             资源文件 – 前端<br>– – assets     静态文件资源 - 放置 css js images<br>– – components 公共组件 - 组件化 （样式 布局 效果）<br>– – App.vue    根组件<br>– – main.js    入口配置文件<br>.browserslistrc 浏览器配置<br>.gitignore      上传git仓库 忽略的文件配置<br>babel.config.js babel配置<br>package.json    项目配置文件 （查看项目安装的依赖 版本 名称… ）<br>readme.md       项目说明文件<br>yarn.lock       配置信息 忽略</p></blockquote><h2 id="Vue组件组成"><a href="#Vue组件组成" class="headerlink" title="Vue组件组成"></a>Vue组件组成</h2><ol><li><p>组成-三部分</p><ol><li>template  视图标签  （template标签不会被渲染 只是包裹作用） 必写</li><li>script    逻辑代码  </li><li>style     样式   lang=’less/scss’ scoped </li></ol></li><li><p>创建组件 </p><ol><li>xxx.vue  后缀.vue结尾</li><li>三部分组件  快捷键 vue</li></ol></li><li><p>组件使用</p><ol><li>引入组件 </li><li>注册组件</li><li>使用组件<pre class="line-numbers language-none"><code class="language-none">&lt;script&gt;    //1. 引入组件    import Banner from './components/Banner.vue'    export default {        name: 'App',        //2. 注册组件        components: {            Banner,        }    }&lt;/script&gt; &lt;!-- 3. 使用组件 --&gt;&lt;Banner&gt;&lt;/Banner&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li></ol><h2 id="vue基础语法"><a href="#vue基础语法" class="headerlink" title="vue基础语法"></a>vue基础语法</h2><p><strong>指令：就是以 v-指令=’js环境’ 具体特定的工具 ，指令。</strong></p><h3 id="插值操作-模板语法"><a href="#插值操作-模板语法" class="headerlink" title="插值操作 (模板语法)"></a>插值操作 (模板语法)</h3><ol><li>作用：获取vue数据 显示视图 模板语法来声明式地将数据渲染进 DOM </li><li>语法：</li></ol><p><strong>Mustache</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;div id="app"&gt;  &lt;h2&gt;{{message}}&lt;/h2&gt;  &lt;h2&gt;{{message}}, 李银河!&lt;/h2&gt;  &lt;!--mustache语法中,不仅仅可以直接写变量,也可以写简单的表达式--&gt;  // 获取data里的数据  &lt;h2&gt;{{firstName + lastName}}&lt;/h2&gt;  &lt;h2&gt;{{firstName + ' ' + lastName}}&lt;/h2&gt;  &lt;h2&gt;{{firstName}} {{lastName}}&lt;/h2&gt;  &lt;h2&gt;{{counter * 2}}&lt;/h2&gt;&lt;/div&gt;&lt;script src="../js/vue.js"&gt;&lt;/script&gt;&lt;script&gt;  const app = new Vue({    el: '#app',    // 提供数据    data: {      message: '你好啊',      firstName: 'kobe',      lastName: 'bryant',      counter: 100    },  })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="指令介绍"><a href="#指令介绍" class="headerlink" title="指令介绍"></a>指令介绍</h3><h4 id="v-once"><a href="#v-once" class="headerlink" title="v-once"></a>v-once</h4><p>在某些情况下，我们可能不希望界面随意的跟随改变<br>这个时候，我们就可以使用一个Vue的指令<br>v-once:<br>该指令后面不需要跟任何表达式(比如之前的v-for后面是由跟表达式的)<br>该指令表示元素和组件(组件后面才会学习)只渲染一次，不会随着数据的改变而改变。<br>代码如下：</p><pre class="line-numbers language-none"><code class="language-none">&lt;div id="app"&gt;  &lt;h2&gt;{{message}}&lt;/h2&gt;  &lt;h2 v-once&gt;{{message}},李银河&lt;/h2&gt;&lt;/div&gt;&lt;script src="../js/vue.js"&gt;&lt;/script&gt;&lt;script&gt;  const app = new Vue({    el: '#app',    data: {      message: '你好啊'    }  })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="v-html-原生HTML"><a href="#v-html-原生HTML" class="headerlink" title="v-html -原生HTML"></a>v-html -原生HTML</h4><p>某些情况下，我们从服务器请求到的数据本身就是一个HTML代码<br>如果我们直接通过插值语法来输出，会将HTML代码也一起输出<br>但是我们可能希望的是按照HTML格式进行解析，并且显示对应的内容<br>可以使用v-html指令<br>该指令后面往往会跟上一个string类型<br>会将string的html解析出来并且进行渲染</p><pre class="line-numbers language-none"><code class="language-none">&lt;div id="app"&gt;  &lt;h2&gt;{{url}}&lt;/h2&gt;  &lt;h2 v-html="url"&gt;&lt;/h2&gt;&lt;/div&gt;&lt;script src="../js/vue.js"&gt;&lt;/script&gt;&lt;script&gt;  const app = new Vue({    el: '#app',    data: {      message: '你好啊',      url: '&lt;a href="http://www.baidu.com"&gt;百度一下&lt;/a&gt;'    }  })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="v-text"><a href="#v-text" class="headerlink" title="v-text"></a>v-text</h4><p>v-text作用和Mustache比较相似：<strong>都是用于将数据显示在界面中</strong><br>v-text<strong>通常情况下，接受一个string类型</strong><br>缺点是不够灵活：第二个h2不会显示李银河</p><pre class="line-numbers language-none"><code class="language-none">&lt;div id="app"&gt;  &lt;h2&gt;{{message}}, 李银河!&lt;/h2&gt;  &lt;h2 v-text="message"&gt;, 李银河!&lt;/h2&gt;&lt;/div&gt;&lt;script src="../js/vue.js"&gt;&lt;/script&gt;&lt;script&gt;  const app = new Vue({    el: '#app',    data: {      message: '你好啊'    }  })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="v-pre"><a href="#v-pre" class="headerlink" title="v-pre"></a>v-pre</h4><p>v-pre用于跳过这个元素和它子元素的编译过程，用于显示原本的Mustache语法。<br>比如下面的代码<br>第一个h2元素中的内容会被编译解析出来对应的内容<br>第二个h2元素中会直接显示</p><pre class="line-numbers language-none"><code class="language-none">&lt;div id="app"&gt;   &lt;h2&gt;{{message}}&lt;/h2&gt; //你好啊  &lt;h2 v-pre&gt;{{message}}&lt;/h2&gt; //{{message}}&lt;/div&gt;&lt;script src="../js/vue.js"&gt;&lt;/script&gt;&lt;script&gt;  const app = new Vue({    el: '#app',    data: {      message: '你好啊'    }  })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="v-cloak"><a href="#v-cloak" class="headerlink" title="v-cloak"></a>v-cloak</h4><p>在某些情况下，我们浏览器可能会直接显然出未编译的Mustache标签<br>cloak: “斗篷”</p><pre class="line-numbers language-none"><code class="language-none">&lt;div id="app" v-cloak&gt;  &lt;h2&gt;{{message}}&lt;/h2&gt;&lt;/div&gt;&lt;script src="../js/vue.js"&gt;&lt;/script&gt;&lt;script&gt;  // 在vue解析之前, div中有一个属性v-cloak  // 在vue解析之后, div中没有一个属性v-cloak  setTimeout(function () {    const app = new Vue({      el: '#app',      data: {        message: '你好啊'      }    })  }, 1000)&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h3><h4 id="条件渲染-v-if-（v-else、v-else-if）"><a href="#条件渲染-v-if-（v-else、v-else-if）" class="headerlink" title="条件渲染- v-if  （v-else、v-else-if）"></a>条件渲染- v-if  （v-else、v-else-if）</h4><ol><li>作用：是否显示元素/  true 显示 false 隐藏 </li></ol><p><strong>语法：</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;span v-if="boolean表达式"&gt;&lt;/span&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>v-else</strong><br>作用：是对 v-if=’’的结果取反 </p><pre class="line-numbers language-none"><code class="language-none">&lt;span v-if="boolean表达式"&gt;&lt;/span&gt;&lt;span v-else&gt;xxxx &lt;/span&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>v-else-if</strong><br>作用：是否显示元素  与v-if  v-else-if 多语句判断</p><pre class="line-numbers language-none"><code class="language-none">&lt;span v-if="boolean表达式"&gt;&lt;/span&gt;&lt;span v-else-if="boolean表达式"&gt;&lt;/span&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>案例：</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;条件渲染 vue-if&lt;/h2&gt;     &lt;!-- v-if='boolean' --&gt;    &lt;p&gt;v-if的值：{{flag}}&lt;/p&gt;    &lt;p v-if="flag"&gt;我是v-if为true显示的&lt;/p&gt;    &lt;h4 v-else&gt;我是v-else控制显示&lt;/h4&gt;    &lt;button @click="change()"&gt;点我控制v-if的值&lt;/button&gt;    &lt;!-- 多语句 --&gt;    &lt;p v-if="number&gt;5"&gt; number&gt;5 &lt;/p&gt;    &lt;p v-else-if=" 2&lt; number &lt;=5"&gt; number大于2小于等于5 &lt;/p&gt;    &lt;p v-else&gt; number小于2 &lt;/p&gt;    &lt;input type="text" placeholder="请输入数字来判断number" v-model="number"&gt;    &lt;br&gt;     &lt;span&gt;{{number}}&lt;/span&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {    data(){        return{            flag:false,            number:"",                    }    },    methods:{        change(){            this.flag=!this.flag        }    }}&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h4><ol><li>作用：是否显示元素/ true 显示 false 隐藏 </li></ol><p><strong>语法：</strong><br><strong>特点：</strong><br>控制元素的 display:block/none</p><pre class="line-numbers language-none"><code class="language-none">&lt;span v-show="boolean表达式"&gt;&lt;/span&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="列表渲染-v-for"><a href="#列表渲染-v-for" class="headerlink" title="列表渲染- v-for"></a>列表渲染- v-for</h3><p><strong>1. 遍历数组</strong><br><strong>语法：</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;li v-for="(item,index) in arr" :key=""&gt;    {{ item }}&lt;/li&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>属性</li><li>item 第一个元素 表示数组的每一项内容</li><li>index 第二个元素 表示数组的下标 0 1 </li><li>arr  数组数据(或者对象)</li><li>:key其实是 v-bind属性  作用：做当前数据的唯一标识  一般写的是id  不推荐 index </li></ul><p><strong>2. 遍历对象</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;div v-for="(value, key, index) in object"&gt;    {{ index }}. {{ key }}: {{ value }}&lt;/div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>value 对象里每个键值对的值({key:value}中的value)</li><li>key 对象里每个键值对的键名({key:value}中的key)</li><li>index 下标0 1</li><li>object 要遍历的对象名</li></ul><p><strong>案例：</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;数组遍历- v-for&lt;/h2&gt;    &lt;p&gt;直接获取数组数据：arr{{ arr }}&lt;/p&gt;    &lt;p&gt;遍历数组&lt;/p&gt;    &lt;ul&gt;      &lt;li v-for="(item, index) in arr" :key="item.id"&gt;        每一项 {{ item }} -- 下标 {{ index }}      &lt;/li&gt;    &lt;/ul&gt;--------------------------------------------------    &lt;p&gt;遍历内部是对象的数组&lt;/p&gt;    &lt;ul&gt;      &lt;li v-for="(item, index) in books" :key="index"&gt;        &lt;h3&gt;书名：{{ item.name }}&lt;/h3&gt;        &lt;p&gt;价格：{{ item.price }}&lt;/p&gt;      &lt;/li&gt;    &lt;/ul&gt;----------------------------------------------------    &lt;p&gt;遍历对象&lt;/p&gt;    &lt;ul&gt;        &lt;li v-for="(ele,key) in obj " :key="key"&gt;            &lt;p&gt;{{key}}：：{{ele}}&lt;/p&gt;            &lt;!-- &lt;p&gt;姓名：{{ele.uname}}&lt;/p&gt;            &lt;p&gt;年龄：{{ele.age}}&lt;/p&gt; --&gt;        &lt;/li&gt;    &lt;/ul&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  data() {    return {      arr: [1, 2, 3, 4],      books: [        {          id: 1,          name: "三国",          price: 20,        },        {          id: 2,          name: "西游记",          price: 30,        },        {          id: 3,          name: "红楼梦",          price: 40,        },      ],      obj: {        uname: "张三",        age: 20,      },    };  },};&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>3. v-for 与 v-if 一同使用</strong></p><ol><li>注意不推荐在同一元素上使用 v-if 和 v-for 、v-for 的优先级比 v-if 更高</li></ol><p><strong>解决办法：</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h4&gt;4 v-for 与 v-if 一同使用, v-for 的优先级比 v-if 更高&lt;/h4&gt;    &lt;h4&gt;今天上架了什么水果：&lt;/h4&gt;    &lt;ul&gt;        &lt;template v-for="(item) in zaoshi"&gt;            &lt;li  :key="item.id" v-if="item.flag"&gt;                种类：{{item.fruit}}             &lt;/li&gt;        &lt;/template&gt;    &lt;/ul&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  data() {    return {      zaoshi:[          {              id:100,              fruit:'苹果',              flag:true,          },          {              id:101,              fruit:'香蕉',              flag:false,          },          {              id:102,              fruit:'阳光玫瑰',              flag:true,          },          {              id:103,              fruit:'车厘子',              flag:false,          },      ]    };  },};&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="Vue-事件处理"><a href="#Vue-事件处理" class="headerlink" title="Vue 事件处理"></a>Vue 事件处理</h3><ol><li>介绍<br>可以用 v-on 指令监听 DOM 事件，并在触发时运行一些 JavaScript 代码</li><li>定义事件<br>语法：&lt;div&nbsp;v-on:事件名=’dosomething’&gt;<br>函数dosomething定义的位置：<br>要求定义mothds属性中</li><li>事件：<br>this指向：事件的this指向 当前组件实例对象<br>事件传递参数：事件传递参数  v-on:click=’canshu(1,2)’<br>事件对象event：</li></ol><ul><li>函数不带参数  第一个参数默认是事件对象 event </li><li>函数带参数    事件对象需要手动传递 $event<br>v-on:事件名=’函数’<br>简写：<br>@事件名=’函数’</li></ul><ol start="4"><li>事件修饰符<br>Vue.js 为 v-on 提供了事件修饰符。修饰符是由点开头的指令后缀来表示的。<blockquote><p>.stop<br>.prevent<br>.capture<br>.self<br>.once<br>.passive</p></blockquote></li></ol><pre class="line-numbers language-none"><code class="language-none">&lt;!-- 阻止单击事件继续传播 --&gt;&lt;a v-on:click.stop="doThis"&gt;&lt;/a&gt;&lt;!-- 提交事件不再重载页面 --&gt;&lt;form v-on:submit.prevent="onSubmit"&gt;&lt;/form&gt;&lt;!-- 修饰符可以串联 --&gt;&lt;a v-on:click.stop.prevent="doThat"&gt;&lt;/a&gt;&lt;!-- 只有修饰符 --&gt;&lt;form v-on:submit.prevent&gt;&lt;/form&gt;&lt;!-- 添加事件监听器时使用事件捕获模式 --&gt;&lt;!-- 即内部元素触发的事件先在此处理，然后才交由内部元素进行处理 --&gt;&lt;div v-on:click.capture="doThis"&gt;...&lt;/div&gt;&lt;!-- 只当在 event.target 是当前元素自身时触发处理函数 --&gt;&lt;!-- 即事件不是从内部元素触发的 --&gt;&lt;div v-on:click.self="doThat"&gt;...&lt;/div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;      &lt;h2&gt;vue事件处理&lt;/h2&gt;      &lt;!-- 事件修饰符 --&gt;      &lt;div @click="parent"&gt; //父元素          我是小头爸爸          &lt;button @click.stop="child"&gt;我是大头儿子&lt;/button&gt; //子元素      &lt;/div&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {    methods:{        parent(){            console.log('父元素');        },        child(){            console.log('子元素');        },    }}&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>按键修饰符<br>在监听键盘事件时，我们经常需要检查详细的按键。Vue 允许为 v-on 在监听键盘事件时添加按键修饰符：<br>.enter  *<br>.tab<br>.delete (捕获“删除”和“退格”键)<br>.esc<br>.space<br>.up<br>.down<br>.left<br>.right</li></ol><pre class="line-numbers language-none"><code class="language-none">&lt;!-- 只有在 `key` 是 `Enter` 时调用 `vm.submit()` --&gt;&lt;input v-on:keyup.enter="submit"&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;      &lt;!-- 按键修饰符 --&gt;      &lt;input type="text" v-on:keyup.enter='getInput'&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {    methods:{        getInput(e){        //if(e.keyCode == 13) {        //    console.log('按下了回车键--触发是搜索。。。');        //}        console.log('按下了回车键--触发是搜索。。。');                   }    }}&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li><p>系统修饰键<br>可以用如下修饰符来实现仅在按下相应按键时才触发鼠标或键盘事件的监听器。<br>.ctrl<br>.alt<br>.shift<br>.meta</p><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;!-- 系统修饰键 --&gt;    &lt;!-- 可以按下ctrl+回车键触发  --&gt;    &lt;textarea @keyup.ctrl.enter="send" cols="30" rows="10"&gt;&lt;/textarea&gt;    &lt;button @click="send"&gt;发送&lt;/button&gt; //  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  methods: {    // 系统修饰键    send(){        console.log('系统修饰键--发送了聊天信息');    }  },};&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>鼠标按钮修饰符<br>.left<br>.right<br>.middle</p></li></ol><hr><h2 id="Vue中key属性的作用-（考点）"><a href="#Vue中key属性的作用-（考点）" class="headerlink" title="Vue中key属性的作用 （考点）"></a>Vue中key属性的作用 （考点）</h2><ol><li>作用：key的作用主要是为了高效的更新虚拟DOM</li><li>高效的Diff算法 <pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;vue中遍历数据v-foe是否添加key 功能&lt;/h2&gt;    &lt;p&gt;key作用：提高更新虚拟DOM速度 --底层diff算法--查思路&lt;/p&gt;    &lt;!-- 默认不带key的遍历 --&gt;    &lt;ul&gt;      &lt;li v-for="item in arr"&gt;{{ item }}&lt;/li&gt;      &lt;button @click="addF"&gt;插入F元素&lt;/button&gt;    &lt;/ul&gt;    &lt;!-- 带key的遍历 --&gt;    &lt;ul&gt;      &lt;li v-for="item in arr" :key="item"&gt;{{ item }}&lt;/li&gt;      &lt;button @click="addF"&gt;插入F元素&lt;/button&gt;    &lt;/ul&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  data() {    return {      arr: ["A", "B", "C", "D", "E"],    };  },  methods: {    addF() {      //  增加 F （给数组添加元素 arr.splice(下标,删除的个数,添加的值)）      this.arr.splice(2, 0, "F");    },  },};&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="数组更新检测"><a href="#数组更新检测" class="headerlink" title="数组更新检测"></a>数组更新检测</h2><ol><li>说明：在列表渲染中，如果遍历是数组，当数组数据发生改变时，页面什么时候能自动更新(页面重新渲染)</li><li>实现数组视图同步更新</li></ol><ul><li><p>变更方法 （修改了原数组）<br>push()<br>pop()<br>shift()<br>unshift()<br>splice()<br>sort()<br>reverse()</p></li><li><p>替换数组（修改后返回新的数组 原数据不修改 视图想同步更新 覆盖原数组）<br>filter()、concat() 和 slice()</p></li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;数组更新同步&lt;/h2&gt;    &lt;p&gt;arr:{{ arr }}&lt;/p&gt;    &lt;button @click="addArr"&gt;追加数组&lt;/button&gt;    &lt;button @click="sliceArr"&gt;切割数组&lt;/button&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  data() {    return {      arr: [1, 2, 3],    };  },  methods: {    addArr() {      // this.arr.push(100)      this.arr.reverse();    },    sliceArr() {      //slice() 返回新的数组 n ce(1);      console.log(newArr);      //替换      this.arr = newArr;    },  },};&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="对象更新检测"><a href="#对象更新检测" class="headerlink" title="对象更新检测"></a>对象更新检测</h2><ol><li>说明：对象修改后 视图同步更新视图 – 内存：栈内存 堆内存 </li><li>实现对象视图同步更新<pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;对象同步更新&lt;/h2&gt;    &lt;p&gt;对象obj:{{ obj }}&lt;/p&gt;    &lt;button @click="changeUname"&gt;修改对象已存在的属性&lt;/button&gt;    &lt;button @click="obj = { user: 'admin' }"&gt;修改整个obj对象&lt;/button&gt;    &lt;!-- //视图检测不到变化 --&gt;    &lt;button @click="addAttribute"&gt;给obj添加不存在的属性&lt;/button&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {    data(){        return{            obj:{                uname:'张三',                age:20            }        }    },    methods:{        changeUname(){            this.obj.uname = '拉拉'        },        addAttribute(){            // this.obj.love = '女'             // 问题: 视图检测不到变化 vue认为obj没有修改            // 方法一:对象中的扩展运算符(...)用于取出参数对象中的所有可遍历属性，拷贝到当前对象之中            // this.obj = {...this.obj}            // 方法二: es6合并对象 Object.assign({},{},{})            // this.obj = Object.assign({},this.obj)            // 方法三: vue官网解决方法            // Vue.set( target, propertyName/index, value )            /**参数：             {对象 | 数组} target 目标元素            {string | number} propertyName/index (要添加的属性)数据类型名字或者index            {any} value  属性的值            用法：向响应式对象中添加一个 property(属性)，并确保这个新 property             同样是响应式的，且触发视图更新。它必须用于向响应式对象上添加新             property，因为 Vue 无法探测普通的新增 property              (比如 this.myObject.newProperty = 'hi')            **/                       //这里没有引入Vue了,因为组件实例对象vm身上有$set()方法            this.$set(this.obj,'love','女')                    //删除 同步视图 删除对象的 property。如果对象是响应式的，确保删除能触发更新视图。            this.$delete(this.obj,'age')        }     }}&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="Class-与-Style-绑定"><a href="#Class-与-Style-绑定" class="headerlink" title="Class 与 Style 绑定"></a>Class 与 Style 绑定</h2><p>介绍：动态的添加class或者是style样式<br><strong>1.绑定 HTML Class</strong></p><ul><li>直接绑定变量 <pre class="line-numbers language-none"><code class="language-none">&lt;div v-bind:class='变量'&gt;&lt;/div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>对象语法 (最常用)<pre class="line-numbers language-none"><code class="language-none">&lt;div v-bind:class="{类名: 表达式-true显示类名、false隐藏 ,类名:boolean}"&gt;&lt;/div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>数组语法<pre class="line-numbers language-none"><code class="language-none">&lt;div v-bind:class="[变量1,变量2, {类名：boolean}]"&gt;&lt;/div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p><strong>2.绑定内联样式</strong><br>v-bind:style 的对象语法十分直观——看着非常像 CSS，但其实是一个 JavaScript 对象。CSS property 名可以用驼峰式 (camelCase) 或短横线分隔 (kebab-case，记得用引号括起来) 来命名</p><ul><li>对象语法 <pre class="line-numbers language-none"><code class="language-none">&lt;div v-bind:style="{css样式:变量,... }"&gt;&lt;/div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>数组语法<pre class="line-numbers language-none"><code class="language-none">&lt;div v-bind:style="[baseStyles, overridingStyles]"&gt;&lt;/div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>直接变量<pre class="line-numbers language-none"><code class="language-none">&lt;div v-bind:style="styleObject"&gt;&lt;/div&gt; data: {     styleObject: {         color: 'red',         fontSize: '13px'     } }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>完整练习案例:</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;动态绑定样式class 和 style&lt;/h2&gt;    &lt;h4&gt;动态绑定样式class&lt;/h4&gt;    &lt;!-- 绑定变量 --&gt;    &lt;button @click="active = 'box2'"&gt;切换颜色-绑定变量&lt;/button&gt;    &lt;div v-bind:class="active"&gt;动态绑定样式class&lt;/div&gt;    &lt;hr /&gt;    &lt;!-- 对象语法 --&gt;    &lt;div v-bind:class="{ box: flag }"&gt;对象语法&lt;/div&gt;    &lt;button @click="flag = !flag"&gt;修改flag-对象语法&lt;/button&gt;    &lt;hr /&gt;    &lt;!-- 数组语法 --&gt;    &lt;div class="aa" v-bind:class="[active, { box2: true }]"&gt;数组语法&lt;/div&gt;    &lt;hr /&gt;    &lt;h2&gt;动态绑定内联样式&lt;/h2&gt;    &lt;p&gt;0. 默认的内联写法&lt;/p&gt;    &lt;div style="width: 100px; height: 100px; background: orange"&gt;      默认的内联写法    &lt;/div&gt;    &lt;p&gt;1. 直接变量&lt;/p&gt;    &lt;div v-bind:style="styleObject"&gt;      对象语法    &lt;/div&gt;    &lt;p&gt;2. 对象语法&lt;/p&gt;    &lt;div v-bind:style="{color:'green',fontSize:'30px', width:'100px',height: '100px',backgroundColor:'blue'}"&gt;      对象语法    &lt;/div&gt;    &lt;p&gt;3. 数组语法&lt;/p&gt;    &lt;div :style="[styleObject,{border:'5px solid #333'}]"&gt;数组语法&lt;/div&gt;  &lt;/div&gt;&lt;/template&gt; &lt;script&gt;export default {  data() {    return {      active: "box",      flag: "true",      styleObject:{        width: '100px',        height: '100px',        background: 'orange',      }    };  },  methods: {    changeColor() {      this.active = "box2";    },  },};&lt;/script&gt;&lt;style&gt;.box {  width: 200px;  height: 200px;  background-color: pink;}.box2 {  width: 200px;  height: 200px;  background-color: rgb(21, 226, 253);}&lt;/style&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Vue-tab栏切换练习"><a href="#Vue-tab栏切换练习" class="headerlink" title="Vue-tab栏切换练习"></a>Vue-tab栏切换练习</h3><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;Vue-tab切换&lt;/h2&gt;    &lt;ul class="nav"&gt;      &lt;li v-for="(item,index) in arr" :key='item' :class="{active:index == num}" @click="changeNav(index)"&gt;          {{item}}-{{index}}    &lt;/li&gt;    &lt;/ul&gt;    &lt;div class="box1"&gt;      &lt;div v-for="(ele,n) in content " :key="ele" :class="{show:n == num}"&gt;{{ele}}&lt;/div&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  data() {    return {      num: 0,      arr: ["选项1", "选项2", "选项3"],      content: ["111", "222", 333],    };  },  methods: {      changeNav(index){          this.num = index                }  },};&lt;/script&gt;&lt;style lang="less" scoped&gt;.nav {  overflow: hidden;  list-style: none;  li {      display: inline;      width: 100px;      height: 40px;      line-height: 40px;      margin-right: 10px;  }  .active{      background: lightblue;  }}.box1 {  margin: auto;  width: 400px;  height: 200px;  border: 1px solid #000;  &gt;div {      display: none;  }  .show {      display: block;  }}&lt;/style&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="表单输入绑定-v-modele"><a href="#表单输入绑定-v-modele" class="headerlink" title="表单输入绑定 (v-modele)"></a>表单输入绑定 (v-modele)</h2><p><strong>1.介绍</strong><br>你可以用 v-model 指令在表单 input、textarea 及 select 元素上创建双向数据绑定<br>通过指令 v-model=’’ 获取表单输入的信息数据 实现双向数据绑定</p><p><strong>2.语法:</strong><br>会将文本框输入的数据实时传递给绑定到data里的msg中</p><pre class="line-numbers language-none"><code class="language-none">&lt;input type='text' v-model='msg' /&gt;data(){    return{        msg:''    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>案例:</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;表单输入绑定&lt;/h2&gt;    &lt;!-- &lt;input type="text" :value="msg" name="" id=""&gt; --&gt;    &lt;!-- 1. 文本/密码 v-model=''--&gt;    &lt;input type="text" placeholder="请输入" v-model="formData.msg" @keyup.enter="send" name="" id="" /&gt;    &lt;p&gt;msg:{{formData.msg}}&lt;/p&gt;    &lt;!-- 2. 多行文本 --&gt;    &lt;!-- 3. 单选按钮 --&gt;    性别:    &lt;input type="radio" v-model="formData.sex" name="aa" value="1" /&gt;男    &lt;input type="radio" v-model="formData.sex" name="aa" value="2" /&gt;女    &lt;p&gt;选择的性别:{{ formData.sex }}&lt;/p&gt;     &lt;!-- 爱好: --&gt;    &lt;input type="checkbox" v-model="formData.arr" value="a" /&gt;吃    &lt;input type="checkbox" v-model="formData.arr" value="b" /&gt;喝    &lt;input type="checkbox" v-model="formData.arr" value="c" /&gt;玩    &lt;p&gt;选择的爱好:{{ formData.arr }}&lt;/p&gt;    &lt;!-- 城市: --&gt;    &lt;select name="" id="" v-model="formData.select"&gt;      &lt;option value=""&gt;请选择&lt;/option&gt;      &lt;option value="beijing"&gt;北京&lt;/option&gt;      &lt;option value="shanghai"&gt;上海&lt;/option&gt;      &lt;option value="gaungzhou"&gt;广州&lt;/option&gt;    &lt;/select&gt;    &lt;p&gt;城市选择:{{ formData.select }}&lt;/p&gt;      &lt;button @click="submit"&gt;注册信息&lt;/button&gt;      &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  data() {    return {        msg:'初始值',        sex:'',        //对象的语法--------存储表单数据      formData: {        msg: "", //输入框        sex: 1, //性别        arr: [],         select: "",      },    };  },  methods:{    send() {      console.log("输入的数据为:", this.msg);    },    submit() {      //点击按钮--发送输入的数据给后台-- data -- msg  sex arr ...      console.log("提交注册信息表单",this.formData);    },  }};&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>3.修饰符</strong></p><ul><li>lazy&nbsp;  只有当input失去焦点时才更新数据</li><li>number 把input标签中输入的内容转成数字，调用是parseFloat  (Nunber())</li><li>trim   去除左右空格</li></ul><p><strong>案例：</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h3&gt;表单修饰符 -修饰符 &lt;/h3&gt;    &lt;!-- .lazy 失去焦点或者回车 获取数据 --&gt;    &lt;input type="text" v-model.lazy="search"&gt;    &lt;p&gt;search:{{ search }}&lt;/p&gt;    &lt;input type="text" v-model.trim="msg" name="" id=""&gt;    &lt;p&gt;去空格:{{msg}}&lt;/p&gt;      &lt;!-- .number  转数字 --&gt;    &lt;input type="number" v-model.number="num" name="" id=""&gt;    &lt;p&gt;num:{{ num }}&lt;/p&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  data() {    return {        msg:'',        sex:'',      search:'',      num:'只能输入数字',    };  },  methods:{  }};&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>4.v-model实现原理</strong><br>v-model只不过是一个语法糖而已,真正的实现靠的还是<br>v-bind:绑定响应式数据<br>触发oninput 事件并传递数据<br>v-model&nbsp;是什么。语法糖&nbsp;:value&nbsp;+&nbsp;@input。还要分为两种情况</p><pre class="line-numbers language-none"><code class="language-none">&lt;input v-model="val"&gt;&lt;!-- 基本等价于，因为内部还有一些其他的处理 --&gt;// $event是事件对象，$event.target.value表示input框中的输入值&lt;input :value="val" @input="val = $event.target.value"&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>案例：</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;!-- v-model实现的原理 --&gt;    &lt;input type="text" v-model="inp" name="" id=""&gt;    &lt;p&gt;inp:{{inp}}&lt;/p&gt;     &lt;!-- v-model == v-bind:value='' @input='函数' --&gt;    表单值:&lt;input type="text" :value="val" @input="changeVal" name="" id=""&gt;    &lt;p&gt;val:{{val}}&lt;/p&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  data() {    return {        val:'请输入',        msg:'',        inp:'',        sex:'',      search:'',      num:'只能输入数字',    };  },  methods:{    changeVal(e){        console.log(e); //表单的事件对象        console.log(e.target.value); //表单里的文本框内容        this.val = e.target.value; //将文本框内容 赋值给 data里的val 即使用v-bind又让数据进行双向绑定了    }  }};&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="计算属性和侦听器"><a href="#计算属性和侦听器" class="headerlink" title="计算属性和侦听器"></a>计算属性和侦听器</h2><p><strong>1. 计算属性</strong></p><ul><li>介绍: 处理数据后把数据缓存起来 使用数据的时候使用的缓存的数据,但是如果原数据修改了重新计算</li><li>语法<pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;计算属性computed&lt;/h2&gt;    &lt;!-- 如果是字符串 取反操作实现 --&gt;    &lt;p&gt;字符串:{{ msg }}&lt;/p&gt;    &lt;!-- 不推荐: 模板语法里面写很多方法  多次使用不方便 --&gt;    // split-先转换为数组， reverse-然后取反， join-最后转为字符串    &lt;p&gt;字符串-取反:{{ msg.split("").reverse().join("") }}&lt;/p&gt;    &lt;p&gt;封装函数-取反:{{qufan()}}&lt;/p&gt;    &lt;p&gt;封装函数-取反:{{qufan()}}&lt;/p&gt;    &lt;p&gt;封装函数-取反:{{qufan()}}&lt;/p&gt;    &lt;p&gt;计算属性-取反：{{msg2}}&lt;/p&gt;    &lt;p&gt;计算属性-取反：{{msg2}}&lt;/p&gt;    &lt;p&gt;计算属性-取反：{{msg2}}&lt;/p&gt;    &lt;p&gt;计算属性-取反：{{msg2}}&lt;/p&gt;    &lt;button @click="msg = 'how are you'"&gt;修改msg&lt;/button&gt;    &lt;!-- 例子: v-for='' v-if不能在同一个元素使用 -- computed处理数据 --&gt;    &lt;h4&gt;早市水果更新:&lt;/h4&gt;     &lt;ul&gt;        &lt;li v-for="item in zaoshi2" :key='item.id'&gt;            {{item.fruit}}        &lt;/li&gt;    &lt;/ul&gt;      &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  data() {    return {      msg: "hello vue",      zaoshi: [        {          id: 100,          fruit: "苹果",          flag: false,        },        {          id: 101,          fruit: "阳光玫瑰",          flag: true,        },        {          id: 102,          fruit: "车厘子",          flag: false,        },        {          id: 103,          fruit: "榴莲",          flag: true,        },      ],    };  },  methods: {    qufan() {      console.log("执行了一次取反方法");      return this.msg.split("").reverse().join("");    },  },  //计算属性: 对数据进行加工处理  缓存数据  computed: {    msg2() {      console.log("计算属性: 对数据进行加工处理  缓存数据");      return this.msg.split("").reverse().join("");    },    //处理数据    zaoshi2(){        //过滤方法 返回的满足条件的数组  比如:[1,2,3,4]  =&gt;[3,4]        return this.zaoshi.filter((item)=&gt;{            // if(item.flag == true) {            //     return item.flag            // }            return item.flag        })    }  },};&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>2. 侦听器</strong></p><ul><li>介绍: Vue 通过 watch 选项提供了一个更通用的方法，来响应数据的变化 <pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;  &lt;div&gt;      &lt;h2&gt;侦听器-watch&lt;/h2&gt;      &lt;p&gt;功能:监听数据修改了,然后做业务逻辑&lt;/p&gt;      &lt;input type="text" v-model="inp"  name="" id=""&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {    data(){        return{            inp:'',            arr:[]        }    },    //侦听器--数据变化 (当前监听的是inp变化)    watch:{        inp:function(n,o){            console.log('新值:',n ,'旧值:',o);            //业务逻辑  比如输入东西后 网络请求            //模糊查询                    }    }}&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>3. computed和watch区别 （考点）</strong> </p><ul><li>相同：computed和watch都是观察页面的数据变化的。</li><li>不同：<br>computed：是计算属性，依赖其它属性值:</li><li>支持缓存，只有依赖数据发生改变，才会重新进行计算</li><li>不支持异步，当computed内有异步操作时无效，无法监听数据的变化<br>watch：没有缓存性，更多的是「观察」的作用，类似于某些数据的监听回调 ，每当监听的数据变化时都会执行回调进行后续操作；</li><li>不支持缓存，数据变，直接会触发相应的操作；</li><li>watch支持异步；</li></ul><h2 id="Vue-的生命周期方法有哪些-一般在哪一步发请求"><a href="#Vue-的生命周期方法有哪些-一般在哪一步发请求" class="headerlink" title="Vue 的生命周期方法有哪些 一般在哪一步发请求"></a>Vue 的生命周期方法有哪些 一般在哪一步发请求</h2><p><strong>生命周期</strong>：事物从诞生到消亡的过程<br>Vue生命周期：<br><img src="https://s1.ax1x.com/2022/04/19/L06cp4.png"></p><h2 id="v-if-和-v-show-的区别"><a href="#v-if-和-v-show-的区别" class="headerlink" title="v-if 和 v-show 的区别"></a>v-if 和 v-show 的区别</h2><p>v-if: 控制元素的渲染或者销毁<br>v-show:控制元素的 display:block/none</p><blockquote><p>场景：<br>频繁切换： v-show<br>初次渲染优化：v-if </p></blockquote><h2 id="Vue-修饰符有哪些"><a href="#Vue-修饰符有哪些" class="headerlink" title="Vue 修饰符有哪些"></a>Vue 修饰符有哪些</h2><h2 id="v-for-为什么要加-key"><a href="#v-for-为什么要加-key" class="headerlink" title="v-for 为什么要加 key"></a>v-for 为什么要加 key</h2><h2 id="理解-Vue-的单向-双向-数据流"><a href="#理解-Vue-的单向-双向-数据流" class="headerlink" title="理解 Vue 的单向/双向 数据流"></a>理解 Vue 的单向/双向 数据流</h2><h3 id="首先了解一下数据绑定"><a href="#首先了解一下数据绑定" class="headerlink" title="首先了解一下数据绑定"></a>首先了解一下数据绑定</h3><p>什么是绑定？<br>比如当前href属性值取决于表达式school.url.toUpperCase()的结果，这两者之间就是有绑定关系，且通过v-bind指令完成数据绑定。</p><pre class="line-numbers language-none"><code class="language-none">&lt;a v-bind:href="school.url.toUpperCase()" v-bind:x="hello"&gt;点我去{{school.name}}学习&lt;/a&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="v-bind-单向数据原理"><a href="#v-bind-单向数据原理" class="headerlink" title="v-bind 单向数据原理"></a>v-bind 单向数据原理</h3><p>前面学习的指令主要作用是将值插入到模板的内容当中<br>但除了内容需要动态来决定外，某些属性也希望动态来绑定<br><strong>作用：动态绑定属性</strong><br>缩写：**:**<br>预期：any (with argument) | Object (without argument)<br>参数：attrOrProp (optional)<br><strong>v-bind用于绑定一个或多个属性值，或者向另一个组件传递props值</strong>(这个学到Vue进阶时介绍)<br>在开发中，一般有哪些属性需要动态进行绑定呢？<br>比如图片的链接src、网站的链接href、动态绑定一些类、样式等等<br>例子：通过Vue实例中的data绑定元素的src和href，代码如下：</p><h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><p>很多时候，我们希望动态的来切换class，比如：<br>当数据为某个状态时，字体显示红色。<br>当数据另一个状态时，字体显示黑色。</p><pre class="line-numbers language-none"><code class="language-none">&lt;div id="app"&gt;  &lt;!-- 错误的做法: 这里不可以使用mustache语法--&gt;  &lt;!--&lt;img src="{{imgURL}}" alt=""&gt;--&gt;  &lt;!-- 正确的做法: 使用v-bind指令 --&gt;  &lt;img v-bind:src="imgURL" alt=""&gt;  &lt;a v-bind:href="aHref"&gt;百度一下&lt;/a&gt;  &lt;!--&lt;h2&gt;{{}}&lt;/h2&gt;--&gt;  &lt;!--语法糖的写法--&gt;  &lt;img :src="imgURL" alt=""&gt;  &lt;a :href="aHref"&gt;百度一下&lt;/a&gt;&lt;/div&gt;&lt;script src="../js/vue.js"&gt;&lt;/script&gt;&lt;script&gt;  const app = new Vue({    el: '#app',    data: {      message: '你好啊',      imgURL: 'https://img11.360buyimg.com/mobilecms/s350x250_jfs/t1/20559/1/1424/73138/5c125595E3cbaa3c8/74fc2f84e53a9c23.jpg!q90!cc_350x250.webp',      aHref: 'http://www.baidu.com'    }  })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="v-bind动态绑定class-对象语法"><a href="#v-bind动态绑定class-对象语法" class="headerlink" title="v-bind动态绑定class(对象语法)"></a>v-bind动态绑定class(对象语法)</h4><ul><li>绑定方式：对象语法<br>含义是:class后面跟的是一个对象</li></ul><ol><li>直接通过{}绑定一个类<pre class="line-numbers language-none"><code class="language-none">&lt;h2 :class="{'active': isActive}"&gt;Hello World&lt;/h2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>也可以通过判断，传入多个值<pre class="line-numbers language-none"><code class="language-none">&lt;h2 :class="{'active': isActive, 'line': isLine}"&gt;Hello World&lt;/h2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>和普通的类同时存在，并不冲突<br>注：如果isActive和isLine都为true，那么会有title/active/line三个类<pre class="line-numbers language-none"><code class="language-none">&lt;h2 class="title" :class="{'active': isActive, 'line': isLine}"&gt;Hello World&lt;/h2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>如果过于复杂，可以放在一个methods或者computed中<br>注：classes是一个计算属性<pre class="line-numbers language-none"><code class="language-none">&lt;h2 class="title" :class="classes"&gt;Hello World&lt;/h2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p><strong>比如ul的li标签点击某个标签变颜色</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;div id="app"&gt;  &lt;!-- 当布尔值为true 这个类名1即 active 就会被添加到标签上 --&gt;  &lt;!-- 一个 { } 表示对象 --&gt;  &lt;h2 class="title" v-bind:class="{active: isActive, line: isLine}"&gt;{{message}}&lt;/h2&gt;  &lt;h2 class="title" v-bind:class="getClasses()"&gt;{{message}}&lt;/h2&gt;  &lt;button v-on:click="btnClick"&gt;按钮&lt;/button&gt;&lt;/div&gt;&lt;script&gt;  const app = new Vue({    el: '#app',    data: {      message: '你好啊',      isActive: true,      isLine: true    },    methods: {      btnClick: function () {        this.isActive = !this.isActive      },      getClasses: function () {        return {active: this.isActive}      }    }  })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="v-bind动态绑定class-数组语法"><a href="#v-bind动态绑定class-数组语法" class="headerlink" title="v-bind动态绑定class(数组语法)"></a>v-bind动态绑定class(数组语法)</h4><ul><li>数组语法的含义是:class后面跟的是一个数组。</li></ul><ol><li>直接通过{}绑定一个类<pre class="line-numbers language-none"><code class="language-none">&lt;h2 :class="['active']"&gt;Hello World&lt;/h2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>也可以传入多个值<pre class="line-numbers language-none"><code class="language-none">&lt;h2 :class=“[‘active’, 'line']"&gt;Hello World&lt;/h2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>和普通的类同时存在，并不冲突<br>注：会有title/active/line三个类<pre class="line-numbers language-none"><code class="language-none">&lt;h2 class="title" :class=“[‘active’, 'line']"&gt;Hello World&lt;/h2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>如果过于复杂，可以放在一个methods或者computed中<br>注：classes是一个计算属性<pre class="line-numbers language-none"><code class="language-none">&lt;h2 class="title" :class="classes"&gt;Hello World&lt;/h2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p><strong>例如：</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;div id="app"&gt;  &lt;h2 class="title" :class="[active, line]"&gt;{{message}}&lt;/h2&gt;  &lt;h2 class="title" :class="getClasses()"&gt;{{message}}&lt;/h2&gt;&lt;/div&gt;&lt;script src="../js/vue.js"&gt;&lt;/script&gt;&lt;script&gt;  const app = new Vue({    el: '#app',    data: {      message: '你好啊',      active: 'aaaaaa',      line: 'bbbbbbb'    },    methods: {      getClasses: function () {        return [this.active, this.line]      }    }  })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="小案例-点击li标签变色（默认第一li为红色）"><a href="#小案例-点击li标签变色（默认第一li为红色）" class="headerlink" title="小案例 点击li标签变色（默认第一li为红色）"></a>小案例 点击li标签变色（默认第一li为红色）</h4><p>分析：</p><ol><li>v-for绑定给li标签，同时v-on添加点击事件，并且li标签的class用v-bind动态绑定 </li><li>使用v-for绑定到li标签上，自动遍历data中的数据，将下标（index）和每一项内容（item）用插值语法显示到页面</li><li>在data中添加一个isRed属性值为0，想让class样式显示，需要v-bind绑定的red值为true，即该值可以等等于index,因为index的第一个值就是0</li><li>v-on点击事件点击某一个li，将下标的值赋值给isRed，即当前点击的li标签的class样式显示 end~<pre class="line-numbers language-none"><code class="language-none">&lt;style&gt;    .red {      color: red;    }&lt;/style&gt;&lt;!--作业需求: 点击列表中的哪一项, 那么该项的文字变成红色--&gt;&lt;div id="app"&gt;    &lt;ul&gt;      &lt;!-- &lt;li v-for="每一项,下标 in 数据源"&gt;{{item}}&lt;/li&gt; --&gt;      &lt;li v-for="(item,index) in movie"  v-on:click="getColor(index)"       v-bind:class="{red:isRed==index}" &gt;{{index}}--{{item}}&lt;/li&gt;    &lt;/ul&gt;&lt;/div&gt;&lt;script&gt;    const app = new Vue({      el:'#app',      data:{        isRed:0,        movie:['海王','海尔兄弟','火影忍者','进击的巨人']      },      methods:{        getColor: function (index){           this.isRed = index           console.log(this.isRed);        }      },    })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="v-bind绑定style-一"><a href="#v-bind绑定style-一" class="headerlink" title="v-bind绑定style 一"></a>v-bind绑定style 一</h4><p>利用v-bind:style来绑定一些CSS内联样式<br>在写CSS属性名的时候，比如font-size<br>可以使用驼峰式 (camelCase)  fontSize<br>或短横线分隔 (kebab-case，记得用单引号括起来) ‘font-size’</p><h2 id="v-model-双向数据原理"><a href="#v-model-双向数据原理" class="headerlink" title="v-model 双向数据原理"></a>v-model 双向数据原理</h2><h2 id="Vue2-x响应式数据-双向绑定原理"><a href="#Vue2-x响应式数据-双向绑定原理" class="headerlink" title="Vue2.x响应式数据/双向绑定原理"></a>Vue2.x响应式数据/双向绑定原理</h2><p>整体思路是数据劫持+观察者模式<br>Vue 数据双向绑定主要是指：数据变化更新视图，视图变化更新数据。其中，View变化更新Data，可以通过事件监听的方式来实现，所以 Vue数据双向绑定的工作主要是如何根据Data变化更新View。<br><strong>Vue中有两种数据绑定的方式：</strong></p><ol><li>单向绑定(v-bind)：数据只能从data流向页面。</li><li>双向绑定(v-model)：数据不仅能从data流向页面，还可以从页面流向data。<br>备注：</li><li>双向绑定一般都应用在表单类元素上（如：input、select等）</li><li>v-model:value 可以简写为 v-model，因为v-model默认收集的就是value值。<pre class="line-numbers language-none"><code class="language-none">&lt;!-- 准备好一个容器--&gt;&lt;div id="root"&gt;&lt;!-- 普通写法 --&gt;&lt;!-- 单向数据绑定：&lt;input type="text" v-bind:value="name"&gt;双向数据绑定：&lt;input type="text" v-model:value="name"&gt;&lt;!-- 简写 --&gt;单向数据绑定：&lt;input type="text" v-bind:value="name"&gt;双向数据绑定：&lt;input type="text" v-model:value="name"&gt;&lt;!-- 如下代码是错误的，因为v-model只能应用在表单类元素（输入类元素）上 --&gt;&lt;!-- &lt;h2 v-model:x="name"&gt;你好啊&lt;/h2&gt; --&gt;&lt;/div&gt;&lt;script type="text/javascript"&gt;Vue.config.productionTip = false //阻止 vue 在启动时生成生产提示。  new Vue({  el:'#root',  data:{  name:'哔哩哔哩',  }  })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="虚拟-DOM-是什么-有什么优缺点"><a href="#虚拟-DOM-是什么-有什么优缺点" class="headerlink" title="虚拟 DOM 是什么 有什么优缺点"></a>虚拟 DOM 是什么 有什么优缺点</h2><h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p>全称： Model-View-ViewModel ， Model 表示数据模型层。 view 表示视图层， ViewModel 是 View 和 Model 层的桥梁，数据绑定到 viewModel 层并自动渲染到页面中，视图变化通知 viewModel 层更新数据。</p><ul><li>Model层：</li></ul><p><strong>数据层</strong><br>数据可能是我们固定的死数据，更多的是来自我们服务器，从网络上请求下来的数据。</p><ul><li>View层：</li></ul><p><strong>视图层</strong><br>在我们前端开发中，通常就是DOM层。<br>主要的作用是给用户展示各种信息。</p><ul><li>VueModel层：</li></ul><p><strong>视图模型层</strong><br>视图模型层是View和Model沟通的桥梁。<br>一方面它实现了Data Binding，也就是数据绑定，将Model的改变实时的反应到View中<br>另一方面它实现了DOM Listener，也就是DOM监听，当DOM发生一些事件(点击、滚动、touch等)时，可以监听到，并在需要的情况下改变对应的Data。</p><ol><li>M：模型(Model) ：对应 data 中的数据</li><li>V：视图(View) ：模板</li><li>VM：视图模型(ViewModel) ： Vue 实例对象<br>Vm（Vue实例对象）把左边的View和右边Model进行连接在一起<br><img src="https://s1.ax1x.com/2022/04/18/LdwQa9.png"></li></ol><p><strong>观察发现：</strong></p><ol><li>data中所有的属性，最后都出现在了vm身上。</li><li>VM身上所有的属性 及 Vue原型上所有属性，在Vue模板中都可以直接使用。</li></ol><p><strong>执行过程</strong> ：数据在data中经过 VM视图模型放到了页面View上页面上如果有地方需要更改要映射回数据就再给VM视图模型，然后视图模型再给data里的数据 </p><pre class="line-numbers language-none"><code class="language-none">&lt;!-- 1 准备好一个容器 也就是 view 视图 模板代码--&gt; &lt;div id="root"&gt;&lt;h1&gt;学校名称：{{name}}&lt;/h1&gt;&lt;h1&gt;学校地址：{{address}}&lt;/h1&gt;&lt;!-- &lt;h1&gt;测试一下1：{{1+1}}&lt;/h1&gt;&lt;h1&gt;测试一下2：{{$options}}&lt;/h1&gt;&lt;h1&gt;测试一下3：{{$emit}}&lt;/h1&gt;&lt;h1&gt;测试一下4：{{_c}}&lt;/h1&gt; --&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt;Vue.config.productionTip = fal    se //阻止 vue 在启动时生成生产提示const vm = new Vue({// 2 VM 视图模型ViewModelel:'#root',data:{ // 3 data里的是模型 modelname:"b站大学",address:"成都",}}) console.log(vm)&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Vue的数据代理"><a href="#Vue的数据代理" class="headerlink" title="Vue的数据代理"></a>Vue的数据代理</h2><h3 id="首先学习下-Object-defineProperty-方法"><a href="#首先学习下-Object-defineProperty-方法" class="headerlink" title="首先学习下 Object.defineProperty()方法"></a>首先学习下 Object.defineProperty()方法</h3><p>Object.defineProperty() 方法直接在一个对象上定义一个新属性，或者修改一个已经存在的属性， 并返回这个对象。<br><strong>defineProperty()参数</strong></p><pre class="line-numbers language-none"><code class="language-none">Object.defineProperty(obj, prop, descriptor)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>obj 需要定义属性的对象</li><li>prop 需被定义或修改的属性名</li><li>descriptor 需被定义或修改的属性的描述符</li></ul><p>例子：定义了一个person对象，里面包含name、sex属性和其它属性值。<br>注意：age属性是通过defineProperty方法中</p><pre class="line-numbers language-none"><code class="language-none">&lt;script type="text/javascript"&gt;let number = 19let person = {name: '张三',sex: '男',}Object.defineProperty(person, 'age', {value:19,        enumerable:true, //控制属性是否可以枚举，默认值是falsewritable:true, //控制属性是否可以被修改，默认值是falseconfigurable:true //控制属性是否可以被删除，默认值是false//当有人读取person的age属性时，get函数(getter)就会被调用，且返回值就是age的值get() {console.log('有人读取age属性了')return number},//当有人修改person的age属性时，set函数(setter)就会被调用，且会收到修改的具体值set(value) {console.log('有人修改了age属性，且值是', value)number = value}}) console.log(Object.keys(person))// Object.keys方法传入一个对象作为参数，可以把传入对象所有属性的属性名提取出来变成数组console.log(person)&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Vue中的数据代理"><a href="#Vue中的数据代理" class="headerlink" title="Vue中的数据代理"></a>Vue中的数据代理</h2><h3 id="什么是数据代理"><a href="#什么是数据代理" class="headerlink" title="什么是数据代理"></a>什么是数据代理</h3><p>数据代理：通过一个对象代理对另一个对象中属性的操作（读/写）</p><pre class="line-numbers language-none"><code class="language-none">&lt;script type="text/javascript" &gt;let obj = {x:100 }let obj2 = {y:200Object.defineProperty(obj2,'x',{get(){return obj.x},set(value){obj.x = value}})&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="vue常用ui库"><a href="#vue常用ui库" class="headerlink" title="vue常用ui库"></a>vue常用ui库</h2><p><strong>移动端</strong></p><ul><li>mint-ui （<a href="http://mint-ui.github.io/#!/zh-cn%EF%BC%89">http://mint-ui.github.io/#!/zh-cn）</a></li><li>Vant（<a href="https://youzan.github.io/vant/#/zh-CN/home%EF%BC%89">https://youzan.github.io/vant/#/zh-CN/home）</a></li><li>VUX (<a href="https://vux.li/">https://vux.li/</a>)</li></ul><p><strong>pc端</strong></p><ul><li>element-ui（<a href="https://element.eleme.cn/2.13/#/zh-CN/component/installation%EF%BC%89">https://element.eleme.cn/2.13/#/zh-CN/component/installation）</a></li><li>Ant Design of Vue（<a href="https://www.antdv.com/docs/vue/introduce-cn/%EF%BC%89">https://www.antdv.com/docs/vue/introduce-cn/）</a></li><li>Avue (<a href="https://avuejs.com/">https://avuejs.com/</a>)</li></ul><h2 id="常用webpack配置"><a href="#常用webpack配置" class="headerlink" title="常用webpack配置"></a>常用webpack配置</h2><p><strong>待更新。。。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Vue的安装&quot;&gt;&lt;a href=&quot;#Vue的安装&quot; class=&quot;headerlink&quot; title=&quot;Vue的安装&quot;&gt;&lt;/a&gt;Vue的安装&lt;/h2&gt;&lt;h3 id=&quot;安装环境&quot;&gt;&lt;a href=&quot;#安装环境&quot; class=&quot;headerlink&quot; title=&quot;安</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="vue" scheme="https://wuzimo233.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>axios学习</title>
    <link href="https://wuzimo233.github.io/posts/4.html"/>
    <id>https://wuzimo233.github.io/posts/4.html</id>
    <published>2022-04-17T06:12:00.000Z</published>
    <updated>2022-06-16T03:35:21.712Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p><strong>已经学习过ajax、Promise</strong><br>准备json-server包，快速搭建HTTP服务（用axios的时候需要向服务端发送请求即需要服务端这个角色来与axios结合做实践）</p><ul><li>json-server用于模拟服务端接口数据，可以根据json数据建立一个完整的web服务</li><li>1安装json-server<pre class="line-numbers language-none"><code class="language-none">npm install -g json-server//查看版本号，安装成功json-server -v<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>2在文件夹下创建一个db.json文件，存放一些数据。<pre class="line-numbers language-none"><code class="language-none">{  "posts": [            //文章    {      "id": 1,      "title": "json-server",      "author": "typicode"    },    {      "id": 2,      "title": "《b站大学》",      "author": "吴老师"    }  ],  "comments": [        //评论    {      "id": 1,      "body": "some comment",      "postId": 1    },    {      "body": "喜大普奔",      "postId": 2,      "id": 2    }  ],  "profile": {        //个人信息    "name": "typicode"  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>3 启动服务<br>进入终端。执行启动json-server命令:<pre class="line-numbers language-none"><code class="language-none">json-server --watch .\db.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><hr><h2 id="认识axios"><a href="#认识axios" class="headerlink" title="认识axios"></a>认识axios</h2><h3 id="axios-是什么"><a href="#axios-是什么" class="headerlink" title="axios 是什么?"></a>axios 是什么?</h3><p>axios是目前前端使用非常广泛的基于 promise 的 HTTP 网络请求库，包括Vue/React也是推荐使用axios；<br><strong>本质是XMLHttpRequests请求 即ajax请求</strong></p><h3 id="axios-特性："><a href="#axios-特性：" class="headerlink" title="axios 特性："></a><strong>axios 特性：</strong></h3><ol><li>从浏览器中创建 XMLHttpRequests （浏览器中发送xml请求）</li><li>从 node.js 创建 http 请求 （在node.js中发送http请求）</li><li>支持 Promise API 相关操作</li><li>拦截请求和响应</li><li>转换请求数据和响应数据（对请求和响应的数据作转换）</li><li>取消请求</li><li>自动将结果转换成 JSON 数据</li><li>客户端支持防御 XSRF （阻止跨站攻击）</li></ol><h3 id="axios安装"><a href="#axios安装" class="headerlink" title="axios安装"></a>axios安装</h3><ul><li>1 使用 npm安装:<pre class="line-numbers language-none"><code class="language-none">$ npm install axios<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>2 使用 yarn安装:<pre class="line-numbers language-none"><code class="language-none">$ yarn add axios<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>3 使用 jsDelivr CDN安装:<pre class="line-numbers language-none"><code class="language-none">&lt;script src="https://cdn.bootcdn.net/ajax/libs/axios/0.26.1/axios.min.js"&gt;&lt;/script&gt; console.log(axios);  //ƒ() {for(var n=new Array(arguments.length),r=0;r&lt;n.length;r++)n[r]=arguments[r];return e.apply(t,n)} //建议使用国内CDN网速较快  //去这个网站引入 https://www.bootcdn.cn/axios/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="axios的基本使用"><a href="#axios的基本使用" class="headerlink" title="axios的基本使用"></a>axios的基本使用</h2></li></ul><p><strong>前置：引入了axios</strong><br><strong>准备四个按钮发送不同的请求</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;div class="container"&gt;    &lt;h2 class="page-header"&gt;基本使用&lt;/h2&gt;    &lt;button class="btn btn-primary"&gt; 发送GET请求 &lt;/button&gt;    &lt;button class="btn btn-warning"&gt; 发送POST请求 &lt;/button&gt;    &lt;button class="btn btn-success"&gt; 发送 PUT 请求 &lt;/button&gt;    &lt;button class="btn btn-danger"&gt; 发送 DELETE 请求 &lt;/button&gt;&lt;/div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="GET请求"><a href="#GET请求" class="headerlink" title="GET请求"></a>GET请求</h3><pre class="line-numbers language-none"><code class="language-none">//获取按钮const btns = document.querySelectorAll('button');//第一个 （get 查询功能）btns[0].onclick = function () {    //发送ajax请求     axios({        //请求类型        method: 'GET',        //请求地址 刚启动好的json-server地址 且id为2的那篇文章        url: ' http://localhost:3000/posts/2'    }).then(response =&gt; {        console.log(response);    })}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h3><pre class="line-numbers language-none"><code class="language-none">//添加一篇新的文章 （post 添加功能）btns[1].onclick = function () {    //发送ajax请求    axios({        method: 'POST',                       //请求类型        url: ' http://localhost:3000/posts',  //请求地址        data: {            "title": "招聘摄影",               //请求体            "author": "小吴"            }    }).then(response =&gt; {        console.log(response);    })}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="PUT请求"><a href="#PUT请求" class="headerlink" title="PUT请求"></a>PUT请求</h3><pre class="line-numbers language-none"><code class="language-none">//更新文章 需要在url里加上id 比如这里要更新的是id为3的文章（put 更新功能）btns[2].onclick = function () {    //发送ajax请求    axios({        method: 'PUT',                          //请求类型        url: ' http://localhost:3000/posts/3',  //请求地址        data: {                                             "title": "招聘程序员吗",             //修改请求体的数据            "author": "小瑶酱"        }    }).then(response =&gt; {        console.log(response);    })}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="DELETE请求"><a href="#DELETE请求" class="headerlink" title="DELETE请求"></a>DELETE请求</h3><pre class="line-numbers language-none"><code class="language-none">//删除文章 （delete 删除功能）btns[3].onclick = function () {    //发送ajax请求    axios({        //请求类型        method: 'DELETE',        //请求地址        url: ' http://localhost:3000/posts/3',    }).then(response =&gt; {        console.log(response);    })}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="axios的其他发送请求"><a href="#axios的其他发送请求" class="headerlink" title="axios的其他发送请求"></a>axios的其他发送请求</h3><h4 id="使用request方法-发送-GET-请求-（接收一个对象类型参数）"><a href="#使用request方法-发送-GET-请求-（接收一个对象类型参数）" class="headerlink" title="使用request方法 发送 GET 请求 （接收一个对象类型参数）"></a>使用request方法 发送 GET 请求 （接收一个对象类型参数）</h4><pre class="line-numbers language-none"><code class="language-none">//获取按钮const btns = document.querySelectorAll('button');btns[0].onclick = function(){    // axios()    axios.request({        method:'GET',        url:'  http://localhost:3000/posts',    // 返回结果依然是Promise对象 用then指定成功的回调    }).then((response) =&gt; {        console.log(response);    })    ;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="使用POST方法-发送post请求-增加数据"><a href="#使用POST方法-发送post请求-增加数据" class="headerlink" title="//使用POST方法  发送post请求 增加数据"></a>//使用POST方法  发送post请求 增加数据</h4><pre class="line-numbers language-none"><code class="language-none">//获取按钮const btns = document.querySelectorAll('button');        btns[1].onclick = function(){            // axios()            axios.post(                'http://localhost:3000/comments',                 {                    "body": "喜大普奔",                    "postId": 2                }).then(response =&gt; {                    console.log(response);                })        }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="axios配置对象"><a href="#axios配置对象" class="headerlink" title="axios配置对象"></a>axios配置对象</h2><pre class="line-numbers language-none"><code class="language-none">{   // `url` 是用于请求的服务器 URL  url: '/user',  // `method` 是创建请求时使用的方法  method: 'get',  // `baseURL` 将自动加在 `url` 前面，除非 `url` 是一个绝对 URL。  baseURL: 'https://some-domain.com/api/',  // `transformRequest` 对请求的数据做处理，处理后将结果像服务器发送  // 只能用在 'PUT', 'POST' 和 'PATCH' 这几个请求方法  // 后面数组中的函数必须返回一个字符串，或 ArrayBuffer，或 Stream  transformRequest: [function (data, headers) {    // 对 data 进行任意转换处理    return data;  }],  // `transformResponse` 对响应的结果做一些改变，改变之后我们用自定义的回调去处理结果  transformResponse: [function (data) {    // 对 data 进行任意转换处理    return data;  }],  // `headers` 对请求头信息做一个配置（身份校验）  headers: {'X-Requested-With': 'XMLHttpRequest'},  // `params` 是即将与请求一起发送的 URL 参数  // 必须是一个无格式对象(plain object)或 URLSearchParams 对象  params: {    ID: 12345  },  // `data` 是作为请求体的设置  // 只适用于这些请求方法 'PUT', 'POST', 和 'PATCH'  // 在没有设置 `transformRequest` 时，必须是以下类型之一：  // - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams  // - 浏览器专属：FormData, File, Blob  // - Node 专属： Stream  data: {    firstName: 'Fred'  },  // `timeout` 指定请求超时的毫秒数(0 表示无超时时间)  // 如果请求话费了超过 `timeout` 的时间，请求将被中断  timeout: 1000,  // `withCredentials` 表示跨域请求时对coken的携带设置  withCredentials: false,  //不携带  // `adapter` 对请求的适配器做设置  // 有两种一种是ajax、一种是node.js里发送http请求的  adapter: function (config) {    /* ... */  },  // `auth` 对请求基础的验证设置用户名和密码   auth: {    username: 'janedoe',    password: 's00pers3cret'  },  // `responseType` 表示服务器响应的数据类型，可以是 'arraybuffer', 'blob', 'document', 'json', 'text', 'stream'  responseType: 'json', // 默认  // 响应结果的编码  responseEncoding: 'utf8',   // `xsrfCookieName` 跨域请求标识对cookie的名称设置  xsrfCookieName: 'XSRF-TOKEN',   // `xsrfHeaderName`  是承载 xsrf token 的值的 HTTP 头的名称  xsrfHeaderName: 'X-XSRF-TOKEN', // default  // `onUploadProgress` 上传的一些回调  onUploadProgress: function (progressEvent) {    // 对原生进度事件的处理  },  // `onDownloadProgress` 下载时的一些回调  onDownloadProgress: function (progressEvent) {    // 对原生进度事件的处理  },  // `maxContentLength` 定义允许的响应内容的最大尺寸  maxContentLength: 2000,  // `validateStatus`  对响应结果的成功做一个设置 什么情况下是成功的呢？默认值为响应状态码 大于等于200 小于300  validateStatus: function (status) {    return status &gt;= 200 &amp;&amp; status &lt; 300; // default  },  // `maxRedirects` 最大跳转的次数 默认5次 即向一个服务发送请求，它作了跳转后呢，我们是否需要让它继续往前进行请求   maxRedirects: 5, // 默认的  // 设置socket 文件的位置 作用是像docker的守护进程发送请求的  socketPath: null, // default  // 对客户端的一些信息做一些设置  httpAgent: new http.Agent({ keepAlive: true }),  httpsAgent: new https.Agent({ keepAlive: true }),  // 设置代理   // `auth` 表示 HTTP 基础验证应当用于连接代理，并提供凭据  // 这将会设置一个 `Proxy-Authorization` 头，覆写掉已有的通过使用 `header` 设置的自定义 `Proxy-Authorization` 头。   proxy: {    host: '127.0.0.1',    port: 9000,    auth: {      username: 'mikeymike',      password: 'rapunz3l'    }  },  // `cancelToken` 对ajax请求作一个取消的设置  cancelToken: new CancelToken(function (cancel) {  })}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="axios的默认配置"><a href="#axios的默认配置" class="headerlink" title="axios的默认配置"></a>axios的默认配置</h3><p>例子：点击按钮发送get请求<br>//<strong>没有做默认配置时，每次访问都比较麻烦</strong></p><pre class="line-numbers language-none"><code class="language-none">&lt;div class="container"&gt;    &lt;h2 class="page-header"&gt;基本使用&lt;/h2&gt;    &lt;button class="btn btn-primary"&gt; 发送GET请求 &lt;/button&gt;    &lt;button class="btn btn-warning"&gt; 发送POST请求 &lt;/button&gt;    &lt;button class="btn btn-success"&gt; 发送 PUT 请求 &lt;/button&gt;    &lt;button class="btn btn-danger"&gt; 发送 DELETE 请求 &lt;/button&gt;&lt;/div&gt;&lt;script&gt;    // 获取按钮    const btns = document.querySelectorAll('button');    btns[0].onclick = function(){        axios({            method:'GET',            url: 'http://localhost:3000/posts'        }).then(response =&gt; {            console.log(response);        })    }&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用默认配置后</p><pre class="line-numbers language-none"><code class="language-none">//默认配置axios.defaults.method = 'GET';  //设置默认的请求类型为 GETaxios.defaults.baseURL = 'http://localhost:3000' //设置基础urlbtns[0].onclick = function () {    axios({        url: '/posts',    }).then(response =&gt; {        console.log(response);    })//还有其他的默认配置项// axios.defaults.params = {id:100}; 默认的请求url参数 即url后增加 ?id=100// axios.defaults.timeout = 3000;  超时时间<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="axios创建实例对象"><a href="#axios创建实例对象" class="headerlink" title="axios创建实例对象"></a>axios创建实例对象</h3><p>主要用于：项目中接口数据服务不是来自于单一的服务器，比如有两个服务器A、B，都提供了数据服务。在发送请求时，比如给A发，就要去设置A的协议域名端口，如果用默认方法做只能满足一个服务器，</p><pre class="line-numbers language-none"><code class="language-none">&lt;div class="container"&gt;    &lt;h2 class="page-header"&gt;基本使用&lt;/h2&gt;    &lt;button class="btn btn-primary"&gt; 发送GET请求 &lt;/button&gt;    &lt;button class="btn btn-warning" &gt; 发送POST请求 &lt;/button&gt;    &lt;br&gt;&lt;/div&gt;&lt;script&gt;    //获取按钮    const btns = document.querySelectorAll('button');    //创建实例对象 /getJoke    const duanzi = axios.create({        baseURL:'https://api.apiopen.top',        timeout:2000    });    //这里duanzi 与 axios 对象的功能几近是一样的     duanzi({        url:'/getJoke',    }).then((response)=&gt;{        console.log(response);    })    duanzi.get('/getJoke').then((response) =&gt; {        console.log(response.data);    })    const another = axios.create({        baseURL:'http:b.com',        timeout:2000    })<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="axios拦截器"><a href="#axios拦截器" class="headerlink" title="axios拦截器"></a>axios拦截器</h2><p>在请求或响应被 then 或 catch 处理前拦截它们。<br>在发送请求之前，借助一些函数对请求的参数和内容作一些处理和检测。如果说都没有问题再去发送请求，有问题的话这个请求就停止或者取消。<br>当服务器返回结果之后，可以通过自己指定的回调处理结果。那么响应拦截器可以在我们处理响应结果之前先对结果做一些预处理。如：失败了就对失败结果做一些提醒或者记录，还能对数据接口做一些格式化的处理。然后再交由我们自己自定义的回调来处理。如果有问题在响应拦截器中就处理掉了。<br>执行顺序是，当用户发送请求后先执行请求拦截器成功/失败的回调，然后走响应拦截器成功/失败的回调，然后再走自定义的成功/失败的回调</p><h3 id="一般情况"><a href="#一般情况" class="headerlink" title="一般情况"></a>一般情况</h3><pre class="line-numbers language-none"><code class="language-none">// Promise相关// 设置请求拦截器  config 配置对象axios.interceptors.request.use(function (config) {    console.log('请求拦截器 成功');    return config;}, function (error) {    console.log('请求拦截器 失败 ');    return Promise.reject(error);});// 设置响应拦截器axios.interceptors.response.use(function (response) {    console.log('响应拦截器 成功');    return response;    // return response;}, function (error) {    console.log('响应拦截器 失败')    return Promise.reject(error);});//发送请求axios({    method: 'GET',    url: 'http://localhost:3000/posts'}).then(response =&gt; {    console.log('自定义回调处理成功的结果');    console.log(response);});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="其他情况：请求拦截器成功但抛出错误，响应拦截器失败，自定义失败回调"><a href="#其他情况：请求拦截器成功但抛出错误，响应拦截器失败，自定义失败回调" class="headerlink" title="其他情况：请求拦截器成功但抛出错误，响应拦截器失败，自定义失败回调"></a><strong>其他情况：请求拦截器成功但抛出错误，响应拦截器失败，自定义失败回调</strong></h3><pre class="line-numbers language-none"><code class="language-none">// Promise相关// 设置请求拦截器  config 配置对象axios.interceptors.request.use(function (config) {    console.log('请求拦截器 成功');    // return config;    throw '参数出了问题'     //如果这里抛出错误即失败了，返回一个失败的Promise，    //在执行后续的响应回调时就只能走失败的回调了，}, function (error) {    console.log('请求拦截器 失败 ');    return Promise.reject(error);});// 设置响应拦截器axios.interceptors.response.use(function (response) {    console.log('响应拦截器 成功');    return response;    // return response;}, function (error) {    console.log('响应拦截器 失败')    return Promise.reject(error);});//发送请求axios({    method: 'GET',    url: 'http://localhost:3000/posts'}).then(response =&gt; {    console.log('自定义回调处理成功的结果');    console.log(response);}).catch(reason =&gt; {    console.log('自定义回调处理失败的结果');    console.log(reason);})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="多个请求、响应的结果顺序"><a href="#多个请求、响应的结果顺序" class="headerlink" title="多个请求、响应的结果顺序"></a><strong>多个请求、响应的结果顺序</strong></h3><p>请求拦截器 成功 2号<br>请求拦截器 成功 1号<br>响应拦截器 成功 1号<br>响应拦截器 成功 2号<br>自定义回调处理成功的结果<br>{data: Array(2), status: 200, statusText: ‘OK’, headers: {…}, config: {…},&nbsp;…}</p><pre class="line-numbers language-none"><code class="language-none">// Promise相关// 设置请求拦截器  config 配置对象axios.interceptors.request.use(function (config) {    console.log('请求拦截器 成功 1号');    //修改 config 中的参数    // config.params = {a:100};    return config;}, function (error) {    console.log('请求拦截器 失败 1号');    return Promise.reject(error);});axios.interceptors.request.use(function (config) {    console.log('请求拦截器 成功 2号');    //修改 config 中的参数    config.timeout = 2000;    return config;}, function (error) {    console.log('请求拦截器 失败 2号');    return Promise.reject(error);});// 设置响应拦截器axios.interceptors.response.use(function (response) {    console.log('响应拦截器 成功 1号');    return response;    // return response;}, function (error) {    console.log('响应拦截器 失败 1号')    return Promise.reject(error);});axios.interceptors.response.use(function (response) {    console.log('响应拦截器 成功 2号')    return response;}, function (error) {    console.log('响应拦截器 失败 2号')    return Promise.reject(error);});//发送请求axios({    method: 'GET',    url: 'http://localhost:3000/posts'}).then(response =&gt; {    console.log('自定义回调处理成功的结果');    console.log(response);}).catch(reason =&gt; {    console.log('自定义回调处理失败的结果');    console.log(reason);})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="axios取消请求"><a href="#axios取消请求" class="headerlink" title="axios取消请求"></a>axios取消请求</h2><ol><li><p>基本流程<br>配置 cancelToken 对象<br>缓存用于取消请求的 cancel 函数<br>在后面特定时机调用 cancel 函数取消请求<br>在错误回调中判断如果 error 是 cancel, 做相应处理</p></li><li><p>实现功能<br>点击按钮, 取消某个正在请求中的请求</p></li><li><p>在请求一个接口前, 取消前面一个未完成的请求</p></li></ol><p>使用 canceltoken 取消请求<br>Axios 的 cancel token API 基于cancelable promises proposal<br>可以使用 CancelToken.source 工厂方法创建 cancel token，像这样：</p><pre class="line-numbers language-none"><code class="language-none">&lt;div class="container"&gt;    &lt;h2 class="page-header"&gt;axios取消请求&lt;/h2&gt;    &lt;button class="btn btn-primary"&gt; 发送请求 &lt;/button&gt;    &lt;button class="btn btn-warning" &gt; 取消请求 &lt;/button&gt;&lt;/div&gt;&lt;script&gt;    //获取按钮    const btns = document.querySelectorAll('button');    //2.声明全局变量    let cancel = null;    //发送请求    btns[0].onclick = function(){        // 防止用户疯狂点击按钮发送请求        //检测上一次的请求是否已经完成         if(cancel !== null){            //取消上一次的请求            cancel();        }        axios({            method: 'GET',            url: 'http://localhost:3000/posts',            //1. 添加配置对象的属性            cancelToken: new axios.CancelToken(function(c){                //3. 将 c 的值赋值给 cancel                cancel = c;            })        }).then(response =&gt; {            console.log(response);            //将 cancel 的值初始化            cancel = null;        })    }    //绑定第二个事件取消请求    btns[1].onclick = function(){        cancel();    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="axios源码文件结构说明"><a href="#axios源码文件结构说明" class="headerlink" title="axios源码文件结构说明"></a>axios源码文件结构说明</h2><p><img src="https://s1.ax1x.com/2022/04/18/Ldltuq.png"></p><pre class="line-numbers language-none"><code class="language-none">├──  /dist/       # 项目打包后的文件即最终输出的axios整体文件├── /lib/         # 项目源码目录│     ├── /adapters/    # 定义请求的适配器 xhr、http│     │     ├── http.js                 # 用来在node.js中向   远端服务发送HTTP请求的│     │     └── xhr.js                  # 实现 xhr 适配器(包装 xhr 对象)│     ├── /cancel/      # 定义取消功能│     ├── /core/        # 一些核心功能│     │     ├── Axios.js                # axios 的核心主类 构造函数│     │     ├── dispatchRequest.js      # 用来调用 http 请求适配器方法发送请求的函数│     │     ├── InterceptorManager.js   # 拦截器的管理器│     │     └── settle.js               # 根据 http 响应状态，改变 Promise 的状态│     ├── /helpers/     # 一些辅助方法│     ├── axios.js      # 对外暴露接口│     ├── defaults.js   # axios 的默认配置│     └── utils.js      # 公用工具├── package.json  # 项目信息├── index.d.ts    # 配置 TypeScript 的声明文件└── index.js      # 入口文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="axios的创建过程"><a href="#axios的创建过程" class="headerlink" title="axios的创建过程"></a>axios的创建过程</h2><h2 id="axios对象创建过程模拟实现"><a href="#axios对象创建过程模拟实现" class="headerlink" title="axios对象创建过程模拟实现"></a>axios对象创建过程模拟实现</h2><h2 id="axios发送请求过程详解"><a href="#axios发送请求过程详解" class="headerlink" title="axios发送请求过程详解"></a>axios发送请求过程详解</h2><h2 id="模拟实现axios发送请求"><a href="#模拟实现axios发送请求" class="headerlink" title="模拟实现axios发送请求"></a>模拟实现axios发送请求</h2><h2 id="axios拦截器工作原理"><a href="#axios拦截器工作原理" class="headerlink" title="axios拦截器工作原理"></a>axios拦截器工作原理</h2><h2 id="模拟实现axios拦截器功能"><a href="#模拟实现axios拦截器功能" class="headerlink" title="模拟实现axios拦截器功能"></a>模拟实现axios拦截器功能</h2><h2 id="axios-取消请求工作原理"><a href="#axios-取消请求工作原理" class="headerlink" title="axios 取消请求工作原理"></a>axios 取消请求工作原理</h2><h2 id="模拟实现axios取消请求功能"><a href="#模拟实现axios取消请求功能" class="headerlink" title="模拟实现axios取消请求功能"></a>模拟实现axios取消请求功能</h2><h2 id="axios源码分析总结"><a href="#axios源码分析总结" class="headerlink" title="axios源码分析总结"></a>axios源码分析总结</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前置条件&quot;&gt;&lt;a href=&quot;#前置条件&quot; class=&quot;headerlink&quot; title=&quot;前置条件&quot;&gt;&lt;/a&gt;前置条件&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;已经学习过ajax、Promise&lt;/strong&gt;&lt;br&gt;准备json-server包，快速搭建HTTP服</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Axios" scheme="https://wuzimo233.github.io/tags/Axios/"/>
    
  </entry>
  
  <entry>
    <title>Promise学习</title>
    <link href="https://wuzimo233.github.io/posts/3.html"/>
    <id>https://wuzimo233.github.io/posts/3.html</id>
    <published>2022-04-14T06:30:00.000Z</published>
    <updated>2022-06-16T03:35:15.395Z</updated>
    
    <content type="html"><![CDATA[<h2 id="认识-Promise"><a href="#认识-Promise" class="headerlink" title="认识 Promise"></a>认识 Promise</h2><ul><li><h3 id="什么是-Promise"><a href="#什么是-Promise" class="headerlink" title="什么是 Promise"></a>什么是 Promise</h3></li></ul><ol><li>抽象表达:<blockquote><p>Promise 是一门新的技术(ES6 规范)<br>Promise 是 JS 中进行异步编程的新解决方案<br>备注：旧方案是单纯使用回调函数</p></blockquote></li><li>具体表达:<blockquote><p>语法上来说: Promise 是一个构造函数<br>从功能上来说: promise 对象用来封装一个异步操作并可以获取其成功/失败的结果值</p></blockquote></li></ol><h3 id="为什么要用-Promise"><a href="#为什么要用-Promise" class="headerlink" title="为什么要用 Promise"></a>为什么要用 Promise</h3><h4 id="指定回调函数的方式更加灵活"><a href="#指定回调函数的方式更加灵活" class="headerlink" title="指定回调函数的方式更加灵活"></a>指定回调函数的方式更加灵活</h4><ol><li>旧的: 必须在启动异步任务前指定</li><li>promise: 启动异步任务 =&gt; 返回 promie 对象 =&gt; 给 promise 对象绑定回调函<br>数(甚至可以在异步任务结束后指定/多个)</li></ol><h4 id="支持链式调用-可以解决回调地狱问题"><a href="#支持链式调用-可以解决回调地狱问题" class="headerlink" title="支持链式调用, 可以解决回调地狱问题"></a>支持链式调用, 可以解决回调地狱问题</h4><blockquote><ol><li>什么是回调地狱?<br> 回调函数嵌套调用, 外部回调函数异步执行的结果是嵌套的回调执行的条件<br> <img src="https://s1.ax1x.com/2022/04/14/LlRNPf.jpg" alt="回调地狱"></li><li>回调地狱的缺点?<br> 不便于阅读<br> 不便于异常处理</li><li>解决方案?<br> promise 链式调用</li><li>终极解决方案?<br> async/await</li></ol></blockquote><h3 id="如何使用-Promise"><a href="#如何使用-Promise" class="headerlink" title="如何使用 Promise"></a>如何使用 Promise</h3><h4 id="Promise-语法结构"><a href="#Promise-语法结构" class="headerlink" title="Promise 语法结构"></a>Promise 语法结构</h4><blockquote><p>语法结构： new Promise((resolve, reject) =&gt; { } 里面是一个函数类型的参数，参数里面的两个参数也是函数<br>在花括号{ }里边包含一个异步操作,如果成功则调用 resolve ，同时只要 resolve 调用就会将 promise 对象 p 的状态设置为『成功』，<br>如果失败则调用 reject，调完 reject 后会将 promise 对象 p 的状态设置为『失败』（即这两个可以修改 promise&gt;对象的状态）<br>接着 promise 对象通过调用 then()方法去指定成功和失败时的回调<br>如果成功就执行第一个回调函数，失败则执行第二个回调函数<br>Promise 除了可以封装异步操作之外，还能获取异步操作里成功和失败的结果值 即下方<strong>Promise 形式实现</strong>案例的 n 值<br>然后可以将 n 值传递给 resolve 和 reject 函数<br>最后下方的 then 方法里的两个回调都能拿到这个结果值作为参数使用</p></blockquote><h4 id="Promise-初体验"><a href="#Promise-初体验" class="headerlink" title="Promise 初体验"></a>Promise 初体验</h4><blockquote><p><strong>案例：需求——点击抽奖按钮两秒后，告诉用户是否中奖，中奖的概率是百分之 30。如果中奖在页面中弹框告知恭喜中奖，没有就弹出再接再厉。</strong></p></blockquote><p><code>一般方法实现</code></p><pre class="line-numbers language-none"><code class="language-none">&lt;div class="container"&gt;    &lt;h2 class="page-header"&gt;Promise 初体验&lt;/h2&gt;    &lt;button class="btn btn-primary" id="btn"&gt;点击抽奖&lt;/button&gt;&lt;/div&gt;&lt;script&gt;    //生成随机数    function rand(m,n){        return Math.ceil(Math.random() * (n-m+1)) + m-1;    }    //获取元素对象    const btn = document.querySelector('#btn');    //绑定单击事件    btn.addEventListener('click', function(){        // 定时器       setTimeout(() =&gt; {           //获取从1 - 100的一个随机数           let n = rand(1, 100);           //判断           if(n &lt;= 30){               alert(n+'恭喜恭喜, 奖品为 10万 RMB 劳斯莱斯优惠券');           }else{               alert(n+'再接再厉');           }       }, 1000);    })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> <code>Promise 形式实现 </code></p><pre class="line-numbers language-none"><code class="language-none">&lt;div class="container"&gt;    &lt;h2 class="page-header"&gt;Promise 初体验&lt;/h2&gt;    &lt;button class="btn btn-primary" id="btn"&gt;点击抽奖&lt;/button&gt;&lt;/div&gt;&lt;script&gt;      //生成随机数    function rand(m,n){        return Math.ceil(Math.random() * (n-m+1)) + m-1;    }      //获取元素对象    const btn = document.querySelector('#btn');      //绑定单击事件    btn.addEventListener('click', function(){          // 使用 new Promise(接收一个函数参数) 创建实例          // resolve 解决  函数类型的数据 --成功时调用          // reject  拒绝  函数类型的数据 --失败时调用          const p = new Promise((resolve, reject) =&gt; {              // promise对象可以包裹一个异步操作（直接将上方定时器拿过来）              setTimeout(() =&gt; {                  //30%  1-100  1 2 30                  //获取从1 - 100的一个随机数                  let n = rand(1, 100);                  //判断                  if(n &lt;= 30){                      // Promise除了可以封装异步操作之外，还能获取异步操作里成功和失败的结果值 即这里的n值                      // 可以将n值传递给resolve 和 reject函数                      // 那么下方的then方法里的两个回调都能拿到这个结果值作为参数                      resolve(n); //  调完resolve后会将 promise 对象 p 的状态设置为『成功』                  }else{                      reject(n); // 调完reject后会将 promise 对象 p 的状态设置为『失败』                  }              }, 1000);          });          console.log(p);          //调用 then（里边有两个回调函数参数） 方法 --- 每个promise对象上都有then方法          // 第一个回调是对象状态为成功时的回调，第二个是对象状态失败时的回调函数          // value 值          // reason 理由          p.then((value) =&gt; {              alert('恭喜恭喜, 奖品为 10万 RMB 劳斯莱斯优惠券, 您的中奖数字为 ' + value);          }, (reason) =&gt; {              alert('再接再厉, 您的号码为 ' + reason);          });      })&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="实践练习-Promise-封装-AJAX"><a href="#实践练习-Promise-封装-AJAX" class="headerlink" title="实践练习 Promise 封装 AJAX"></a>实践练习 Promise 封装 AJAX</h4><pre class="line-numbers language-none"><code class="language-none">// 需求点击按钮发送ajax请求拿到段子接口的数据&lt;div class="container"&gt;    &lt;h2 class="page-header"&gt;Promise 封装 AJAX 操作&lt;/h2&gt;    &lt;button class="btn btn-primary" id="btn"&gt;点击发送 AJAX&lt;/button&gt;&lt;/div&gt;&lt;script&gt;    //接口地址 https://api.apiopen.top/getJoke    //获取元素对象    const btn = document.querySelector('#btn');    // 给按钮绑定点击事件    btn.addEventListener('click', function(){        //首先创建 Promise 对象  p        const p = new Promise((resolve, reject) =&gt; {            //1.创建对象            const xhr = new XMLHttpRequest();            //2. 初始化 get请求 给后边的接口发送            xhr.open('GET', 'https://api.apiopen.top/getJoke');            //3. 发送            xhr.send();            //4. 处理响应结果            xhr.onreadystatechange = function(){                if(xhr.readyState === 4){                    //判断响应状态码 2xx                       if(xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300){                        //控制台输出响应体                        resolve(xhr.response);                    }else{                        //控制台输出响应状态码                        reject(xhr.status);                    }                }            }        });        //调用then方法        p.then(value=&gt;{            console.log(value);        }, reason=&gt;{            console.warn(reason);        });    });&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise的状态-『PromiseState』-的改变"><a href="#Promise的状态-『PromiseState』-的改变" class="headerlink" title="Promise的状态 『PromiseState』 的改变"></a>Promise的状态 『PromiseState』 的改变</h4><p>状态是Promise实例对象当中的一个属性，属性叫做 promiseState 有三种状态</p><ol><li>pending 值未决定的、初始化的默认值</li><li>pending 变为 resolved / fullfilled 即成功</li><li>pending 变为 rejected 即失败<br>说明: pending变化只有这 2 种情况, 且一个 promise 对象只能改变一次<br>无论变为成功还是失败, 都会有一个结果数据<br>成功的结果数据一般称为 value, 失败的结果数据一般称为 reason</li></ol><h4 id="Promise对象-『PromiseResult』的值"><a href="#Promise对象-『PromiseResult』的值" class="headerlink" title="Promise对象 『PromiseResult』的值"></a>Promise对象 『PromiseResult』的值</h4><p>保存着异步任务『成功/失败』的结果<br>以下函数能够修改这个属性的值：</p><ul><li>resolve</li><li>reject </li></ul><h4 id="Promise的基本流程"><a href="#Promise的基本流程" class="headerlink" title="Promise的基本流程"></a>Promise的基本流程</h4><p><img src="https://s1.ax1x.com/2022/04/16/LJc5NR.png" alt="LJcang.md.png"></p><p>首先通过new Promise 创造一个对象，在Promise内部封装异步操作。如果异步操作成功则调用resolve函数，resolve函数调用后会把Promise对象状态改为成功，成功在调用then方法时将调用的是第一个回调函数参数，返回一个新的promise对象<br>如果在Promise内部封装的异步操作失败，则调用reject 函数，reject函数调用后会把Promise对象状态改为失败，失败之后调用的是then方法中的第二个回调函数参数，并且返回一个新的Promise对象</p><h3 id="Promise的Api"><a href="#Promise的Api" class="headerlink" title="Promise的Api"></a>Promise的Api</h3><h4 id="执行器函数"><a href="#执行器函数" class="headerlink" title="执行器函数"></a><strong>执行器函数</strong></h4><p><strong>Promise 构造函数: Promise (excutor) {}</strong><br>//new实例化对象需要接收一个参数，参数是一个函数类型的参数（<strong>也称之为执行器函数</strong>），而且函数当中有两个形参也是函数类型参数resolve、reject，这俩函数是内部定义的，异步任务成功就会调用resolve函数，失败就会调用reject函数。<br>(1) executtor 函数: 执行器 (resolve, reject) =&gt; {}<br>(2) resolve 函数: 内部定义成功时我们调用的函数 value =&gt; {}<br>(3) reject 函数: 内部定义失败时我们调用的函数 reason =&gt; {}<br>说明: 执行器函数 executor 会在 Promise 内部立即同步调用,异步操作在执行器中执行</p><pre class="line-numbers language-none"><code class="language-none">let p = new Promise((resolv, reject) =&gt;     // resolve('ok');    console.log(111);})console.log(222);//结果控制台先打印111 ，后打印222。表明 p对象内部的代码是同步调用的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise-then方法"><a href="#Promise-then方法" class="headerlink" title="Promise.then方法"></a><strong>Promise.then方法</strong></h4><p><strong>Promise.prototype.then 方法: (onResolved, onRejected) =&gt; {}</strong><br>// 说明: then方法是用于指定回调的，传递两个参数，第一个参数是传递成功时的回调，第二个参数是传递失败时的回调。返回一个新的 promise 对象<br>(1) onResolved 函数: 成功的回调函数 (value) =&gt; {}<br>(2) onRejected 函数: 失败的回调函数 (reason) =&gt; {}</p><h4 id="Promise-catch方法"><a href="#Promise-catch方法" class="headerlink" title="Promise.catch方法"></a><strong>Promise.catch方法</strong></h4><p><strong>Promise.prototype.catch 方法: (onRejected) =&gt; {}</strong><br>// 说明: catch() 方法是 then()的语法糖, 相当于: then(undefined, onRejected)<strong>，即只能指定失败的回调。</strong></p><ol><li>onRejected 函数: 失败的回调函数 (reason) =&gt; {<pre class="line-numbers language-none"><code class="language-none">let p = new Promise((resolv, reject) =&gt;     // 修改Promise对象的状态    reject('error 失败了');})//  执行catch方法p.catch(reason =&gt; {    console.log(reason);})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise-resolve方法"><a href="#Promise-resolve方法" class="headerlink" title="Promise.resolve方法"></a><strong>Promise.resolve方法</strong></h4></li></ol><p><strong>Promise.resolve 方法: (value) =&gt; {}</strong><br>// 说明：它<strong>属于Promise函数对象</strong>，不是实例对象。接收一个参数，返回一个成功或失败的对象<br>// 作用：就是<strong>快速得到一个Promise对象</strong>，还能封装一个值，将这个值转化为Promise对象</p><ol><li>value: 成功的数据或 promise 对象</li></ol><pre class="line-numbers language-none"><code class="language-none">//如果传入的参数为 非Promise类型的对象, 则返回的结果为成功promise对象//如果传入的参数为 Promise 对象, 则参数的结果决定了 resolve 的结果let zimo = Promise.resolve("I Love You");console.log(zimo); // Promise&nbsp;{&lt;fulfilled&gt;: 'I Love You'let p1 = Promise.resolve(new Promise((resolve, reject) =&gt; {    resolve('OK');    // reject('Error');}));p1.then((value) =&gt; {    console.log(value); //ok},(reason)=&gt;{    console.log(reason);})console.log(p1);  // Promise&nbsp;{&lt;fulfilled&gt;: 'OK'}let p2 = Promise.resolve(p1);console.log(p2);  // Promise&nbsp;{&lt;fulfilled&gt;: 'OK'}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise-reject方法"><a href="#Promise-reject方法" class="headerlink" title="Promise.reject方法"></a><strong>Promise.reject方法</strong></h4><p><strong>Promise.reject 方法: (reason) =&gt; {}</strong><br>说明: <strong>快速返回一个失败的 promise 对象</strong><br>即便传入成功的Promise对象结果也是失败</p><ol><li>reason: 失败的原因<pre class="line-numbers language-none"><code class="language-none">let p1 = Promise.reject(520);p1.catch((reason) =&gt;{    console.log(reason);  // Promise&nbsp;{&lt;rejected&gt;: 520}})console.log(p1);          // 520let p2 = Promise.reject('iloveyou');let p3 = Promise.reject(new Promise((resolve, reject) =&gt; {    resolve('OK');}));console.log(p2);        // Promise&nbsp;{&lt;rejected&gt;: 'iloveyou'}console.log(p3);        //Promise&nbsp;{&lt;rejected&gt;: Promise}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="Promise-all-方法"><a href="#Promise-all-方法" class="headerlink" title="Promise.all 方法"></a>Promise.all 方法</h4><p><strong>Promise.all 方法: (promises) =&gt; {}</strong></p><ol><li>promises: 包含 n 个 promise 的数组<br>说明: <strong>接收一个参数，参数一般是Promise组成的数组</strong>，返回一个新的 promise, 只有所有的 promise 都成功才成功, 只要有一个失败了就直接失败。<pre class="line-numbers language-none"><code class="language-none">let p1 = new Promise((resolve, reject) =&gt; {    resolve('OK');})// let p2 = Promise.resolve('Success');let p2 = Promise.reject('Error');let p3 = Promise.resolve('Oh Yeah');const result = Promise.all([p1, p2, p3]);console.log(result); //[PromiseState]]: "rejected"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="Promise-race-方法"><a href="#Promise-race-方法" class="headerlink" title="Promise.race 方法"></a>Promise.race 方法</h4><p><strong>Promise.race 方法: (promises) =&gt; {}</strong></p><ol><li>promises: 包含 n 个 promise 的数组<br>说明: <strong>接收一个参数，参数一般是Promise组成的数组</strong>，返回一个新的 promise, 第一个改变状态的 promise对象就是最终的结果状态。<pre class="line-numbers language-none"><code class="language-none">let p1 = new Promise((resolve, reject) =&gt; {        setTimeout(() =&gt; {            resolve('OK');        }, 1000);    })let p3 = Promise.resolve('Oh Yeah');let p2 = Promise.resolve('Success');//调用const result = Promise.race([p1, p3, p2]); console.log(result);  // [[PromiseState]]: "fulfilled"  // [[PromiseResult]]: "Oh Yeah"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="Promise的几个关键问题"><a href="#Promise的几个关键问题" class="headerlink" title="Promise的几个关键问题"></a>Promise的几个关键问题</h2><h3 id="如何改变-promise-的状态"><a href="#如何改变-promise-的状态" class="headerlink" title="如何改变 promise 的状态?"></a>如何改变 promise 的状态?</h3><ol><li><strong>第一种方式 调用 resolve 函数</strong>: 如果当前Promise对象是 pending状态就会变为fulfilled(resolve)</li><li><strong>第二种方式 调用 reject 函数</strong>: 如果当前Promise对象是 pending状态就会变为 rejected</li><li><strong>第三种方式 抛出异常</strong>: 如果当前是 pending 就会变为 rejected<pre class="line-numbers language-none"><code class="language-none">let p = new Promise((resolve, reject) =&gt; { //初始化状态是pending    //第一种方式  调用 resolve 函数    // resolve('ok'); // pending   =&gt; fulfilled (resolved)    //第二种方式  调用 reject 函数    // reject("error");// pending  =&gt;  rejected     //3. 抛出错误    throw '出问题了'; //pending  =&gt;  rejected });console.log(p);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="一个-promise-指定多个成功-失败回调函数-都会调用吗"><a href="#一个-promise-指定多个成功-失败回调函数-都会调用吗" class="headerlink" title="一个 promise 指定多个成功/失败回调函数, 都会调用吗?"></a>一个 promise 指定多个成功/失败回调函数, 都会调用吗?</h3><p>简单说问题是：用then方法为一个Promise对象去指定多个回调，这些回调是否都会执行？<br><strong>答案：当 promise 改变为对应状态时都会调用</strong></p><pre class="line-numbers language-none"><code class="language-none">let p = new Promise((resolve, reject) =&gt; {    resolve('OK');});///指定回调 - 1p.then(value =&gt; {    console.log(value);});//指定回调 - 2p.then(value =&gt; {    alert(value);}); <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="改变-promise-状态和指定回调函数谁先谁后"><a href="#改变-promise-状态和指定回调函数谁先谁后" class="headerlink" title="改变 promise 状态和指定回调函数谁先谁后?"></a>改变 promise 状态和指定回调函数谁先谁后?</h3><p>答案： 都有可能 <strong>正常情况下是先指定回调再改变状态, 但也可以先改状态再指定回调</strong><br><strong>当这个执行器函数是异步任务时候时then方法先执行，但then方法需要在Promise对象改变状态后才执行</strong></p><pre class="line-numbers language-none"><code class="language-none">let p = new Promise((resolve, reject) =&gt; {    setTimeout(() =&gt; {        resolve('OK');    }, 1000); //当这个执行器函数是异步任务时候时then方法先执行，但then方法需要在Promi对象改变状态后才执行});p.then(value =&gt; {    console.log(value);},reason=&gt;{    })<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>如何先改状态再指定回调?<br>① 在执行器中直接调用 resolve()/reject()<br>② 延迟更长时间才调用 then()</li><li>什么时候才能得到数据?<br>① 如果先指定的回调, 那当状态发生改变时, 回调函数就会调用, 得到数据<br>② 如果先改变的状态, 那当指定回调时, 回调函数就会调用, 得到数据</li></ol><h3 id="promise-then-返回的新-promise-的结果状态由什么决定"><a href="#promise-then-返回的新-promise-的结果状态由什么决定" class="headerlink" title="promise.then()返回的新 promise 的结果状态由什么决定?"></a>promise.then()返回的新 promise 的结果状态由什么决定?</h3><p>(1) 简单表达: 由 then()指定的回调函数执行的结果决定<br>(2) 详细表达:<br>① 如果抛出异常, 新 promise 变为 rejected, reason 为抛出的异常<br>② 如果返回的是非 promise 的任意值, 新 promise 变为 resolved, value 为返回的值<br>③ 如果返回的是另一个新 promise, 此 promise 的结果就会成为新 promise 的结果</p><h3 id="promise-如何串连多个操作任务"><a href="#promise-如何串连多个操作任务" class="headerlink" title="promise 如何串连多个操作任务?"></a>promise 如何串连多个操作任务?</h3><p>(1) promise 的 then()返回一个新的 promise, 即可以在后边接着调用then()方法，可以看成 then()方法的链式调用<br>(2) 通过 then 的链式调用串连多个同步/异步任务</p><pre class="line-numbers language-none"><code class="language-none">let p = new Promise((resolve, reject) =&gt; {    setTimeout(() =&gt; {        resolve('OK');    }, 1000); //异步任务});p.then(value =&gt; {                  return new Promise((resolve, reject) =&gt; {        resolve("success");    });}).then(value =&gt; {            //这里的Promise状态由他指定的回调函数的返回值绝定，此处回调函数没写返回值即为Undefined 所以这里的then方法返回结果就是一个成功的Promise且成功的结果就是回调函数返回的结果Undefined，因为成功了所以后边的then方法也会执行第一个回调函数，并且输出前边成功的结果所以依然是Undefined    console.log(value);       // success}).then(value =&gt; {          console.log(value);       //undefined})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="promise-异常传透"><a href="#promise-异常传透" class="headerlink" title="promise 异常传透?"></a>promise 异常传透?</h3><p>(1) 当使用 promise 的 then 链式调用时, 可以在最后指定失败的回调,<br>(2) 前面任何操作出了异常, 都会传到最后失败的回调中处理<br>例如：下方启动了一个Promise，后续用then方法又进行了几个其他的任务，这时候只需要在最后的位置去指定失败的回调就可以。</p><pre class="line-numbers language-none"><code class="language-none">let p = new Promise((resolve, reject) =&gt; {    setTimeout(() =&gt; {        resolve('OK');        // reject('Err');    }, 1000);});p.then(value =&gt; {    // console.log(111);    throw '失败啦!';}).then(value =&gt; {    console.log(222);}).then(value =&gt; {    console.log(333);}).catch(reason =&gt; {    console.warn(reason); //失败啦!});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="中断-promise-链"><a href="#中断-promise-链" class="headerlink" title="中断 promise 链?"></a>中断 promise 链?</h3><p>(1) 当使用 promise 的 then 链式调用时, 在中间中断, 不再调用后面的回调函数<br>(2) 办法: 在回调函数中返回一个 pendding 状态的 promise 对象</p><pre class="line-numbers language-none"><code class="language-none">let p = new Promise((resolve, reject) =&gt; {    setTimeout(() =&gt; {        resolve('OK');    }, 1000);});p.then(value =&gt; {    console.log(111);           // 111    //有且只有一个方式 返回一个pending状态的Promise对象    return new Promise(() =&gt; {});  //下方的then方法因为没有发现前边的Promise对象状态发生改变所以就不执行了}).then(value =&gt; {    console.log(222);}).then(value =&gt; {    console.log(333);}).catch(reason =&gt; {    console.warn(reason);});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="自定义（手写）Promise-后续学习"><a href="#自定义（手写）Promise-后续学习" class="headerlink" title="自定义（手写）Promise(后续学习)"></a>自定义（手写）Promise(后续学习)</h2><h3 id="定义整体结构"><a href="#定义整体结构" class="headerlink" title="定义整体结构"></a>定义整体结构</h3><h3 id="Promise-构造函数的实现"><a href="#Promise-构造函数的实现" class="headerlink" title="Promise 构造函数的实现"></a>Promise 构造函数的实现</h3><h3 id="promise-then-catch-的实现"><a href="#promise-then-catch-的实现" class="headerlink" title="promise.then()/catch()的实现"></a>promise.then()/catch()的实现</h3><h3 id="Promise-resolve-reject-的实现"><a href="#Promise-resolve-reject-的实现" class="headerlink" title="Promise.resolve()/reject()的实现"></a>Promise.resolve()/reject()的实现</h3><h3 id="Promise-all-race-的实现"><a href="#Promise-all-race-的实现" class="headerlink" title="Promise.all/race()的实现"></a>Promise.all/race()的实现</h3><h3 id="Promise-resolveDelay-rejectDelay-的实现"><a href="#Promise-resolveDelay-rejectDelay-的实现" class="headerlink" title="Promise.resolveDelay()/rejectDelay()的实现"></a>Promise.resolveDelay()/rejectDelay()的实现</h3><h3 id="ES5-function-完整版本"><a href="#ES5-function-完整版本" class="headerlink" title="ES5 function 完整版本"></a>ES5 function 完整版本</h3><h3 id="ES6-class-完整版本"><a href="#ES6-class-完整版本" class="headerlink" title="ES6 class 完整版本"></a>ES6 class 完整版本</h3><hr><h2 id="async-与-await"><a href="#async-与-await" class="headerlink" title="async 与 await"></a>async 与 await</h2><h3 id="async-函数"><a href="#async-函数" class="headerlink" title="async 函数"></a>async 函数</h3><ol><li>函数的返回结果为 promise 对象</li><li>promise 对象的结果由 async 函数执行的返回值决定<pre class="line-numbers language-none"><code class="language-none">//和then方法返回规则一摸一样async function main(){    //1. 如果返回值是一个非Promise类型的数据    // return 521;    //2. 如果返回的是一个Promise对象    // return new Promise((resolve, reject) =&gt; {    //     // resolve('OK');    //     reject('Error');    // });    //3. 抛出异常    throw "Oh NO"; //[PromiseState]]: "rejected" [PromiseResult]]: "Oh NO"}let result = main();console.log(result);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="await-表达式"><a href="#await-表达式" class="headerlink" title="await 表达式"></a>await 表达式</h3><ol><li>await 右侧的表达式一般为 promise 对象, 但也可以是其它的值</li><li>如果表达式是 promise 对象, await 返回的是 promise 成功的值</li><li>如果表达式是其它值, 直接将此值作为 await 的返回值</li></ol><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol><li>await 必须写在 async 函数中, 但 async 函数中可以没有 await</li><li>如果 await 的 promise 失败了, 就会抛出异常, 需要通过 try…catch 捕获处理</li></ol><pre class="line-numbers language-none"><code class="language-none">async function lala(){    let p = new Promise((resolve, reject) =&gt; {        // resolve('OK');        reject('Error');    })    //1. 右侧为promise的情况 await 返回的是 promise 成功的值即 'ok'    // let res = await p;    // console.log(res);        //ok    //2. 右侧为其他类型的数据    //let res2 = await 20;    //console.log(res2);        //20    //3. 如果promise是失败的状态    try{        let res3 = await p;     }catch(e){        console.log(e);          //抛出一个错误 使用try...catch    }}lala()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="async与await结合"><a href="#async与await结合" class="headerlink" title="async与await结合"></a>async与await结合</h3><pre class="line-numbers language-none"><code class="language-none">/** * 读取同级目录resource文件夹下 有1.html  2.html 3.html 的文件内容 想去读取到 */const fs = require('fs');const util = require('util');// util里有个方法可以将api转换成一个Promise形态的函数const mineReadFile = util.promisify(fs.readFile);//回调函数的方式// fs.readFile('./resource/1.html', (err, data1) =&gt; {//     if(err) throw err;//     fs.readFile('./resource/2.html', (err, data2) =&gt; {//         if(err) throw err;//         fs.readFile('./resource/3.html', (err, data3) =&gt; {//             if(err) throw err;//             console.log(data1 + data2 + data3); //读取到文件信息//         });//     });// });//async 与 await方式 就用不到回调函数// 1.首先写一个async函数async function main(){    try{        //2.读取第一个文件的内容        let data1 = await mineReadFile('./resource/1x.html');        let data2 = await mineReadFile('./resource/2.html');        let data3 = await mineReadFile('./resource/3.html');        console.log(data1 + data2 + data3);    }catch(e){        // console.log(e);   // Error: ENOENT: no such file or directory......        console.log(e.code); // ENOENT    }}main();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="async与await结合发送AJAX"><a href="#async与await结合发送AJAX" class="headerlink" title="async与await结合发送AJAX"></a>async与await结合发送AJAX</h3><pre class="line-numbers language-none"><code class="language-none">&lt;button id="btn"&gt;点击获取段子&lt;/button&gt;&lt;script&gt;    //一般使用axios封装好的    function sendAJAX(url){        return new Promise((resolve, reject) =&gt; {            const xhr = new XMLHttpRequest();            xhr.responseType = 'json';            xhr.open("GET", url);            xhr.send();            //处理结果            xhr.onreadystatechange = function(){                if(xhr.readyState === 4){                    //判断成功                    if(xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300){                        //成功的结果                        resolve(xhr.response);                    }else{                        reject(xhr.status);                    }                }            }        });    }    //段子接口地址 https://api.apiopen.top/getJoke    let btn = document.querySelector('#btn');    btn.addEventListener('click',async function(){        //获取段子信息          let duanzi = await sendAJAX('https://api.apiopen.top/getJoke'); //发送ajax请求的函数返回的结果是一个Promise对象        console.log(duanzi);    });&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;认识-Promise&quot;&gt;&lt;a href=&quot;#认识-Promise&quot; class=&quot;headerlink&quot; title=&quot;认识 Promise&quot;&gt;&lt;/a&gt;认识 Promise&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;h3 id=&quot;什么是-Promise&quot;&gt;&lt;a href=&quot;#什</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Promise" scheme="https://wuzimo233.github.io/tags/Promise/"/>
    
  </entry>
  
  <entry>
    <title>Ajax学习</title>
    <link href="https://wuzimo233.github.io/posts/2.html"/>
    <id>https://wuzimo233.github.io/posts/2.html</id>
    <published>2022-04-14T02:22:11.000Z</published>
    <updated>2022-06-16T03:35:06.667Z</updated>
    
    <content type="html"><![CDATA[<h2 id="认识-Ajax"><a href="#认识-Ajax" class="headerlink" title="认识 Ajax"></a>认识 Ajax</h2><h3 id="什么是-Ajax"><a href="#什么是-Ajax" class="headerlink" title="什么是 Ajax"></a>什么是 Ajax</h3><blockquote><p>Ajax 是一种异步请求数据的 web 开发技术，对于改善用户的体验和页面性能很有帮助。<br>刚好回顾下什么是异步同步，大部分的请求是同步的，就是说我必须等待后台请求给我返回结果了才能往下操作。通俗讲的话，我要去烧水、水热了后去洗碗、扫地。同步来做的话就是依次等待水烧热后我再去洗碗，洗了碗后我再去扫地。异步做的话我把水壶接通电源（发送请求）、接着水壶它烧它的，我去扫地了，可能扫完地后水热了，再用水壶的水来洗碗。<br>还可以说我今天一天没有逛朋友圈，晚上终于有空翻朋友圈，好不容易翻到了上午的朋友圈，突然觉得某个动态有意思我想评论一下或者点赞，如果页面上有刷新，那我点赞后直接就刷新了朋友圈，我又得从新翻很久才能回到刚才的动态页面。如果是不会刷新，即点赞后马上就显示了点赞记录。这就是无刷新技术通过Dom操作来实现的效果。所以Ajax通常会结合Dom一起操作。<br>简单地说，在不需要重新刷新整个页面的情况下，Ajax 通过异步请求加载后台数据，能在网页的局部更新数据。<br>常见运用场景有表单验证是否登入成功、百度搜索下拉框提示和快递单号查询等等。<br><strong>Ajax 的目的是提高用户体验，较少网络数据的传输量。</strong>同时，由于 AJAX 请求获取的是数据而不是 HTML 文档，因此它也节省了网络带宽，让互联网用户的网络冲浪体验变得更加顺畅。<br><strong>AJAX=Asynchronous JavaScript and XML(异步的 JavaScript 和 XML)</strong><br>Ajax 不是一门编程语言，而是一种用于创建更好更快以及交互性更强的 Web 应用程序的技术</p></blockquote><ul><li>传统的网页(即不用 ajax 技术的网页)，想要更新内容或者提交一个表单，都需要重新加载整个网页。</li><li>使用 ajax 技术的网页，通过在后台服务器进行少量的数据交换，就可以实现异步局部更新。</li><li>使用 Ajax，用户可以创建接近本地桌面应用的直接、高可用、更丰富、更动态的 Web 用户界面。</li><li>增加 B/S 体验性 （B/S 未来的主流，持续增长）</li></ul><hr><h3 id="Ajax-原理是什么"><a href="#Ajax-原理是什么" class="headerlink" title="Ajax 原理是什么"></a>Ajax 原理是什么</h3><p>在解释 Ajax 原理之前，我们不妨先举个 “领导想找小李汇报一下工作” 例子，领导想找小李问点事，就委托秘书去叫小李，自己就接着做其他事情，直到秘书告诉他小李已经到了，最后小李跟领导汇报工作。<br><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/12/18/167bd019240a457b~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="图源网络侵删"></p><p>Ajax 请求数据流程与“领导想找小李汇报一下工作”类似。其中最核心的依赖是浏览器提供的 XMLHttpRequest 对象，它扮演的角色相当于秘书，使得浏览器可以发出 HTTP 请求与接收 HTTP 响应。浏览器接着做其他事情，等收到 XHR 返回来的数据再渲染页面。</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/12/18/167bd023855c0bf7~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="图源网络侵删"></p><p><strong>理解了 Ajax 的工作原理后，接下来我们探讨下如何使用 Ajax</strong></p><hr><h3 id="利用-AJAX-可以做："><a href="#利用-AJAX-可以做：" class="headerlink" title="利用 AJAX 可以做："></a>利用 AJAX 可以做：</h3><p>注册时，输入用户名自动检测用户已经存在<br>登陆时，提示用户密码错误<br>删除数据时，将行 ID 发送到后台，后台在数据库中删除，数据库删除成功后，在页面 DOM 中将数据行也删除<br>我们可以使用前端的一个标签来伪造一个 ajax 的样子。iframe 标签</p><pre class="line-numbers language-none"><code class="language-none">&lt;!-- iframe 元素会创建包含另外一个文档的内联框架（即行内框架） --&gt;    &lt;div&gt;        &lt;p&gt;请输入要加载的地址：&lt;span id="currentTime"&gt;&lt;/span&gt;&lt;/p&gt;        &lt;p&gt;            &lt;input id="url" type="text" value="https://www.baidu.com/" /&gt;            &lt;input type="button" value="提交" onclick="LoadPage()"&gt;        &lt;/p&gt;    &lt;/div&gt;    &lt;div&gt;        &lt;h3&gt;加载页面位置：&lt;/h3&gt;        &lt;iframe id="iframePosition" style="width: 100%;height: 500px;"&gt;&lt;/iframe&gt;    &lt;/div&gt;    &lt;script type="text/javascript"&gt;        window.onload = function () {            var myDate = new Date(); //获取当前时间 并传递给p标签里的span            document.getElementById('currentTime').innerText = myDate.getTime();        };        function LoadPage() {            var targetUrl = document.getElementById('url').value; //获取input框的网址            console.log(targetUrl);            document.getElementById("iframePosition").src = targetUrl; //把网址传给内联标签iframe标签的src属性        }    &lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>这里简单的制造了一个在当前页面打开其他页面不刷新整体页面的场景，ajax 可以实现更多更高级的类似功能</strong></p><hr><h2 id="Ajax-的使用"><a href="#Ajax-的使用" class="headerlink" title="Ajax 的使用"></a>Ajax 的使用</h2><h3 id="原生Ajax-的使用"><a href="#原生Ajax-的使用" class="headerlink" title="原生Ajax 的使用"></a>原生Ajax 的使用</h3><p><strong>1.创建 Ajax 核心对象 XMLHttpRequest(记得考虑兼容性)</strong></p><pre class="line-numbers language-none"><code class="language-none">var xhr=null;if (window.XMLHttpRequest) {    // 兼容 IE7+, Firefox, Chrome, Opera, Safari    xhr=new XMLHttpRequest();} else {  // 兼容 IE6, IE5  xhr=new ActiveXObject("Microsoft.XMLHTTP");}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2.向服务器发送请求</strong></p><pre class="line-numbers language-none"><code class="language-none">xhr.open(method,url,async);  send(string);//post请求时才使用字符串参数，否则不用带参数。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>。。。太麻烦了 后期再学原生吧</p><h3 id="jQuery-ajax-的使用"><a href="#jQuery-ajax-的使用" class="headerlink" title="jQuery.ajax 的使用"></a>jQuery.ajax 的使用</h3><p><strong>浏览器中提供的 XMLHttpRequest 用法比较复杂，所以 jQuery 对 XMLHttpRequest 进行了封装，提供了一系列 Ajax 相关的函数，极大地降低了 Ajax 的使用难度。</strong><br><strong>jQuery Ajax 本质就是 XMLHttpRequest，对他进行了封装，方便调用！</strong><br>纯 JS 原生实现 Ajax 暂时不去了解了，直接使用 jquery 提供的，方便学习和使用，避免重复造轮子，有空再去了解下 JS 原生 的XMLHttpRequest把···<br>Ajax 的核心是<strong>XMLHttpRequest</strong>对象(XHR)。XHR 为向服务器发送请求和解析服务器响应提供了接口，<strong>能够以异步方式从服务器获取新数据。</strong></p><p>使用 jQuery 需要先从官网下载jQuery.js并导入到文件<br>就可以使用$符号，它是jquery中代表jquery对象的引用,“jQuery”是核心对象。通过该对象可以获取jQuery对象，调用jQuery提供的方法等。$ &lt;==&gt; jQuery</p><p><strong>通过 jQuery AJAX 方法，能够从远程服务器上请求文本、HTML、XML 或 JSON – 同时能够把这些外部数据直接载入网页的被选元素中。</strong></p><blockquote><p>jQuery 中发起 Ajax 请求最常用的三个方法如下：<br>$.get()<br>$.post()<br>$.ajax()</p></blockquote><h4 id="get-函数的语法"><a href="#get-函数的语法" class="headerlink" title="$.get()函数的语法"></a>$.get()函数的语法</h4><ul><li><p>jQuery 中 $.get() 函数的功能单一，专门用来发起 get 请求</p></li><li><p><strong>将服务器上的资源请求到客户端来进行使用。</strong></p><pre class="line-numbers language-none"><code class="language-none">$.get(url, [data], [callback])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th align="center">参数名</th><th align="center">参数类型</th><th align="center">是否必选</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">url</td><td align="center">string</td><td align="center">是</td><td align="center">要请求的资源地址</td></tr><tr><td align="center">data</td><td align="center">object</td><td align="center">否</td><td align="center">请求资源期间要携带的参数</td></tr><tr><td align="center">callback</td><td align="center">function</td><td align="center">否</td><td align="center">请求成功时的回调函数</td></tr></tbody></table></li><li><p>$.get()发起不带参数的请求<br>使用 $.get() 函数发起不带参数的请求时，直接提供请求的 URL 地址和请求成功之后的回调函数即可，示例代码如下：</p><pre class="line-numbers language-none"><code class="language-none">$.get('http://www.liulongbin.top:3006/api/getbooks', function(res) {    console.log(res) // 这里的 res 是服务器返回的数据})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>$.get()发起带参数的请求<br>使用 $.get() 函数发起带参数的请求时，示例代码如下：</p><pre class="line-numbers language-none"><code class="language-none">$.get('http://www.liulongbin.top:3006/api/getbooks', { id: 1 }, function(res) {    console.log(res)})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="post-函数的语法"><a href="#post-函数的语法" class="headerlink" title="$.post()函数的语法"></a>$.post()函数的语法</h4><ul><li>jQuery 中 $.post() 函数的功能单一，专门用来发起 post 请求，从而<strong>向服务器提交数据。</strong></li></ul><p>$.post() 函数的语法如下：</p><pre class="line-numbers language-none"><code class="language-none">$.post(url, [data], [callback])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th align="center">参数名</th><th align="center">参数类型</th><th align="center">是否必选</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">url</td><td align="center">string</td><td align="center">是</td><td align="center">提交数据的地址</td></tr><tr><td align="center">data</td><td align="center">object</td><td align="center">否</td><td align="center">要提交的数据</td></tr><tr><td align="center">callback</td><td align="center">function</td><td align="center">否</td><td align="center">数据提交成功时的回调函数</td></tr></tbody></table><p>使用 $post() 向服务器提交数据的示例代码如下：</p><pre class="line-numbers language-none"><code class="language-none">$.post(   'http://www.liulongbin.top:3006/api/addbook', // 请求的URL地址   { bookname: '水浒传', author: '施耐庵', publisher: '上海图书出版社' }, // 提交的数据   function(res) { // 回调函数      console.log(res)   })<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ajax-函数的语法"><a href="#ajax-函数的语法" class="headerlink" title="$.ajax()函数的语法"></a><strong>$.ajax()函数的语法</strong></h4><ul><li>相比于$.get()和$.post() 函数，jQuery 中提供的 $.ajax() 函数，是一个功能比较综合的函数</li><li>它允许我们对 Ajax 请求进行更详细的配置</li></ul><p>$.ajax() 函数的基本语法如下：</p><pre class="line-numbers language-none"><code class="language-none">$.ajax({   type: '', // 请求的方式，例如 GET 或 POST   url: '',  // 请求的 URL 地址   data: { },// 这次请求要携带的数据   success: function(res) { } // 请求成功之后的回调函数})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>使用$.ajax()发起GET请求</strong><br>使用 $.ajax() 发起 GET 请求时，只需要将 type 属性的值设置为 ‘GET’ 即可：</p><pre class="line-numbers language-none"><code class="language-none">$.ajax({   type: 'GET', // 请求的方式   url: 'http://www.liulongbin.top:3006/api/getbooks',  // 请求的 URL 地址   data: { id: 1 },// 这次请求要携带的数据   success: function(res) { // 请求成功之后的回调函数       console.log(res)   }})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>使用$.ajax()发起POST请求</strong><br>使用 $.ajax() 发起 POST 请求时，只需要将 type 属性的值设置为 ‘POST’ 即可：</p><pre class="line-numbers language-none"><code class="language-none">$.ajax({   type: 'POST', // 请求的方式   url: 'http://www.liulongbin.top:3006/api/addbook',  // 请求的 URL 地址   data: { // 要提交给服务器的数据      bookname:&nbsp;'水浒传',      author:&nbsp;'施耐庵',      publisher:&nbsp;'上海图书出版社'    },   success: function(res) { // 请求成功之后的回调函数       console.log(res)   }})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>jQuery.ajax(…)<br>       部分参数：<br>              url：请求地址（待载入页面的URL地址）<br>             data：要发送的数据（待发送给后台的值key/value参数）<br>          success：载入成功之后执行的回调函数(全局)<br>             type：请求方式，GET、POST（1.9.0之后用method）<br>          // 下边的了解下不常用<br>          headers：请求头<br>      contentType：即将发送信息至服务器的内容编码类型(默认: “application/x-www-form-urlencoded; charset=UTF-8”)<br>            async：是否异步<br>          timeout：设置请求超时时间（毫秒）<br>       beforeSend：发送请求前执行的函数(全局)<br>         complete：完成之后执行的回调函数(全局)<br>            error：失败之后执行的回调函数(全局)<br>          accepts：通过请求头发送给服务器，告诉服务器当前客户端可接受的数据类型<br>         dataType：将服务器端返回的数据转换成指定类型<br>            “xml”: 将服务器端返回的内容转换成xml格式<br>           “text”: 将服务器端返回的内容转换成普通文本格式<br>           “html”: 将服务器端返回的内容转换成普通文本格式，在插入DOM中时，如果包含JavaScript标签，则会尝试去执行。<br>         “script”: 尝试将返回值当作JavaScript去执行，然后再将服务器端返回的内容转换成普通文本格式<br>           “json”: 将服务器端返回的内容转换成相应的JavaScript对象<br>          “jsonp”: JSONP 格式使用 JSONP 形式调用函数时，如 “myurl?callback=?” jQuery 将自动替换 ? 为正确的函数名，以执行回调函数</p></blockquote><hr><h2 id="接口相关知识"><a href="#接口相关知识" class="headerlink" title="接口相关知识"></a>接口相关知识</h2><ul><li><h3 id="接口的概念"><a href="#接口的概念" class="headerlink" title="接口的概念"></a>接口的概念</h3><blockquote><ul><li>使用 Ajax 请求数据时，被请求的 URL 地址，就叫做数据接口（简称接口）。同时，每个接口必须有请求方式。<br>例如：<br><a href="http://www.liulongbin.top:3006/api/getbooks">www.liulongbin.top:3006/api/getbooks</a> 获取图书列表的接口(GET请求)<br><a href="http://www.liulongbin.top:3006/api/addbook">www.liulongbin.top:3006/api/addbook</a> 添加图书的接口（POST请求）</li></ul></blockquote></li><li><h3 id="分析接口的请求过程"><a href="#分析接口的请求过程" class="headerlink" title="分析接口的请求过程"></a>分析接口的请求过程</h3></li></ul><p>通过GET方式请求接口的过程<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b198025f2e648b4b58d2df1d8673536~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt="图源网络侵删"></p><p>通过POST方式请求接口的过程<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20019a7779564e18a12c0c66668f9422~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt="图源网络侵删"></p><h2 id="Ajax的优缺点"><a href="#Ajax的优缺点" class="headerlink" title="Ajax的优缺点"></a>Ajax的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>1.无刷新更新数据。<br>AJAX最大优点就是能在不刷新整个页面的前提下与服务器通信维护数据。这使得Web应用程序更为迅捷地响应用户交互，并避免了在网络上发送那些没有改变的信息，减少用户等待时间，带来非常好的用户体验。<br>2.异步与服务器通信。<br>AJAX使用异步方式与服务器通信，不需要打断用户的操作，具有更加迅速的响应能力。优化了Browser和Server之间的沟通，减少不必要的数据传输、时间及降低网络上数据流量。<br>3.前端和后端负载平衡。<br>AJAX可以把以前一些服务器负担的工作转嫁到客户端，利用客户端闲置的能力来处理，减轻服务器和带宽的负担，节约空间和宽带租用成本。并且减轻服务器的负担，AJAX的原则是“按需取数据”，可以最大程度的减少冗余请求和响应对服务器造成的负担，提升站点性能。<br>4.基于标准被广泛支持。<br>AJAX基于标准化的并被广泛支持的技术，不需要下载浏览器插件或者小程序，但需要客户允许JavaScript在浏览器上执行。随着Ajax的成熟，一些简化Ajax使用方法的程序库也相继问世。同样，也出现了另一种辅助程序设计的技术，为那些不支持JavaScript的用户提供替代功能。<br> 5.界面与应用分离。<br>Ajax使WEB中的界面与应用分离（也可以说是数据与呈现分离），有利于分工合作、减少非技术人员对页面的修改造成的WEB应用程序错误、提高效率、也更加适用于现在的发布系统。</p><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>1.AjAX干掉了Back和加入收藏书签功能，即对浏览器机制的破坏。<br>2.AJAX的安全问题。<br>3.因为网络延迟需要给用户提供必要提示</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;认识-Ajax&quot;&gt;&lt;a href=&quot;#认识-Ajax&quot; class=&quot;headerlink&quot; title=&quot;认识 Ajax&quot;&gt;&lt;/a&gt;认识 Ajax&lt;/h2&gt;&lt;h3 id=&quot;什么是-Ajax&quot;&gt;&lt;a href=&quot;#什么是-Ajax&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="前端" scheme="https://wuzimo233.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="学习" scheme="https://wuzimo233.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Ajax" scheme="https://wuzimo233.github.io/tags/Ajax/"/>
    
  </entry>
  
  <entry>
    <title>博客与博主</title>
    <link href="https://wuzimo233.github.io/posts/1.html"/>
    <id>https://wuzimo233.github.io/posts/1.html</id>
    <published>2022-04-12T17:17:00.000Z</published>
    <updated>2022-04-15T06:14:16.957Z</updated>
    
    <content type="html"><![CDATA[<p>相遇皆是缘分</p><h3 id="为什么建博客？"><a href="#为什么建博客？" class="headerlink" title="为什么建博客？"></a>为什么建博客？</h3><p>因为学习一些知识总是学了就忘，或者敲了不复习，记得手写笔记也根本不爱翻动。花了大半天时间搭建个博客来记录未来学到的知识，勤能补拙吧~</p><h3 id="展望博客"><a href="#展望博客" class="headerlink" title="展望博客"></a>展望博客</h3><p>我会整理一些个人所学的知识（前端方向和一些其它数码、科技、摄影先暂时想这么多）或生活方面有兴趣的事发到博客上。</p><h3 id="关于博主"><a href="#关于博主" class="headerlink" title="关于博主"></a>关于博主</h3><p>普普通通的社畜。。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> 勇敢就是，在你还没开始的时候就知道自己会输，但依然要去做，而且无论如何都要把它坚持到底。你很少能赢，但有时也会。​ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>go on！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;相遇皆是缘分&lt;/p&gt;
&lt;h3 id=&quot;为什么建博客？&quot;&gt;&lt;a href=&quot;#为什么建博客？&quot; class=&quot;headerlink&quot; title=&quot;为什么建博客？&quot;&gt;&lt;/a&gt;为什么建博客？&lt;/h3&gt;&lt;p&gt;因为学习一些知识总是学了就忘，或者敲了不复习，记得手写笔记也根本不爱翻动</summary>
      
    
    
    
    <category term="感想" scheme="https://wuzimo233.github.io/categories/%E6%84%9F%E6%83%B3/"/>
    
    
    <category term="生活" scheme="https://wuzimo233.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
</feed>
